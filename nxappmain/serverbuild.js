//>>built
require({cache:{"xide/types":function(){define(["dcl/dcl"],function(p){return p(null,{declaredClass:"xide/types"})})},"dcl/dcl":function(){(function(p){"undefined"!=typeof define?define(["./mini"],p):"undefined"!=typeof module?module.exports=p(require("./mini")):dcl=p(dcl)})(function(p){function r(){}function n(b,a,g){var h=b||r,f=a||r,d=g||r,e=function(){var a,c;h.apply(this,arguments);try{a=d.apply(this,arguments)}catch(k){a=k,c=!0}f.call(this,arguments,a);if(c)throw a;return a};e.advices={before:b,
after:a,around:g};return e}function q(b){return function(a,g){var h=a._meta,f;h&&((f=+h.weaver[g]||0)&&f!=b&&p._error("set chaining",g,a,b,f),h.weaver[g]=b)}}var b=p(p.Super,{constructor:function(){this.before=this.around.before;this.after=this.around.after;this.around=this.around.around}});p.mix(p,{Advice:b,advise:function(m){return p._makeSuper(m,b)},before:function(b){return p.advise({before:b})},after:function(b){return p.advise({after:b})},around:p.superCall,chainBefore:q(1),chainAfter:q(2),
isInstanceOf:function(b,a){if(b instanceof a)return!0;var g=b.constructor._meta,h;if(g)for(g=g.bases,h=g.length-1;0<=h;--h)if(g[h]===a)return!0;return!1},_stub:function(b,a,g,h){h=h[g]=p._extractChain(a,g,"around");var f=p._extractChain(a,g,"before").reverse();a=p._extractChain(a,g,"after");h=b?p._stubChainSuper(h,1==b?function(d){return p._stubChain(d.reverse())}:p._stubChain,g):p._stubSuper(h,g);return f.length||a.length?n(p._stubChain(f),p._stubChain(a),h):h||function(){}}});return p})},"dcl/mini":function(){(function(p){"undefined"!=
typeof define?define([],p):"undefined"!=typeof module?module.exports=p():dcl=p()})(function(){function p(g,h){var f=[0],d,e,l,c,k,t,b,m,r=0,x;if(g)if(g instanceof Array){k={};b=g.slice(0).reverse();for(m=b.length-1;0<=m;--m)if(e=b[m],e._uniqueId=e._uniqueId||q++,d=e._meta){t=d.bases;for(r=t.length-1;0<r;--r)x=t[r]._uniqueId,k[x]=(k[x]||0)+1;b[m]=t.slice(0)}else b[m]=[e];d={};a:for(;b.length;){for(m=0;m<b.length;++m)if(t=b[m],e=t[0],x=e._uniqueId,!k[x]){d[x]||(f.push(e),d[x]=1);t.shift();t.length?
--k[t[0]._uniqueId]:b.splice(m,1);continue a}p._error("cycle",h,b)}g=g[0];r=f.length-((c=g._meta)&&g===f[f.length-(r=c.bases.length)]?r:1)-1}else g._uniqueId=g._uniqueId||q++,f=f.concat((c=g._meta)?c.bases:g);d=g?p.delegate(g.prototype):{};for(t=g&&(c=g._meta)?p.delegate(c.weaver):{constructor:2};0<r;--r)if(e=f[r],c=e._meta,p.mix(d,c&&c.ownProps||e.prototype),c)for(x in b=c.weaver)t[x]=(+t[x]||0)|b[x];for(x in h)n(c=h[x])?t[x]=+t[x]||0:d[x]=c;c={bases:f,ownProps:h,weaver:t,chains:{}};f[0]={_meta:c,
prototype:d};e=d;k=c.weaver;t=c.bases;b=c.chains;for(l in k)e[l]=p._stub(k[l],t,l,b);l=d.constructor;l._meta=c;l.prototype=d;f[0]=l;f=p._postprocess(l);h.declaredClass&&!a[h.declaredClass]&&(a[h.declaredClass]=f);return f}function r(a){this.around=a}function n(a){return a&&a.spr instanceof r}var q=0,b={},m,a={};(m=function(a,h){for(var f in h)a[f]=h[f]})(p,{mix:m,delegate:function(a){return Object.create(a)},allKeys:function(a){var h=[],f;for(f in a)h.push(f);return h},Super:r,superCall:function(a){return p._makeSuper(a)},
_makeSuper:function(a,h){var f=function(){};f.spr=new (h||r)(a);return f},_postprocess:function(a){return a},_error:function(a){throw Error("dcl: "+a);},_instantiate:function(a,h,f){h=a.spr.around(h);h.ctr=a.ctr;return h},_extractChain:function(a,h,f){for(var d=a.length-1,e=[],l,c,k="around"==f;l=a[d];--d)if((c=l._meta)?(c=c.ownProps).hasOwnProperty(h)&&(n(c=c[h])?k?c.spr.around:c=c.spr[f]:k):k&&(c="constructor"==h?l:l.prototype[h])&&c!==b[h])"function"==typeof c?(c.ctr=l,e.push(c)):p._error("wrong super",
l,h);return e},_stubChain:function(a){var h=a.length,f;return h?1==h?(f=a[0],function(){f.apply(this,arguments)}):function(){for(var d=0;d<h;++d)a[d].apply(this,arguments)}:0},_stubSuper:function(a,h){for(var f=0,d,e=b[h];d=a[f];++f)e=n(d)?a[f]=p._instantiate(d,e,h):d;return"constructor"!=h?e:function(){e.apply(this,arguments)}},_stubChainSuper:function(a,h,f){for(var d=0,e,l,c=0;e=a[d];++d)n(e)&&(l=d-c,a[d]=p._instantiate(e,l?1==l?a[c]:h(a.slice(c,d)):0,f),c=d);return(l=d-c)?1==l&&"constructor"!=
f?a[c]:h(c?a.slice(c):a):0},_stub:function(a,h,f,d){h=d[f]=p._extractChain(h,f,"around");return(a?p._stubChainSuper(h,p._stubChain,f):p._stubSuper(h,f))||function(){}}});p.getObject=function(g){return a[g]};return p})},"xide/types/Types":function(){define(["dojo/_base/lang","xide/types","dojo/_base/json","dojo/_base/kernel"],function(p,r,n,q){null==r.customTypes&&(r.customTypes={});null==r.customEnumerations&&(r.customEnumerations={});null==r.widgetMappings&&(r.widgetMappings={});null==r.customMimeIcons&&
(r.customMimeIcons={});r.resolveType=function(b){return r.customTypes[b]?r.customTypes[b]:null};r.registerType=function(b,m){r.customTypes[b]=m};r.registerWidgetMapping=function(b,m){r.widgetMappings[b]=m};r.registerEnumeration=function(b,m){r.customEnumerations[b]=m};r.resolveEnumeration=function(b){return r.customEnumerations[b]?r.customEnumerations[b]:null};r.resolveWidgetMapping=function(b){return r.widgetMappings[b]?r.widgetMappings[b]:null};r.GRID_FEATURE={KEYBOARD_NAVIGATION:"KEYBOARD_NAVIGATION",
KEYBOARD_SELECT:"KEYBOARD_SELECT",SELECTION:"SELECTION",ACTIONS:"ACTIONS",CONTEXT_MENU:"CONTEXT_MENU"};r.VIEW_FEATURE={KEYBOARD_NAVIGATION:"KEYBOARD_NAVIGATION",KEYBOARD_SELECT:"KEYBOARD_SELECT",SELECTION:"SELECTION",ACTIONS:"ACTIONS",CONTEXT_MENU:"CONTEXT_MENU"};r.KEYBOARD_PROFILE={DEFAULT:{prevent_default:!0,prevent_repeat:!1},PASS_THROUGH:{prevent_default:!1,prevent_repeat:!1},SEQUENCE:{prevent_default:!0,is_sequence:!0,prevent_repeat:!0}};r.CI_STATE={NONE:0,PENDING:1,PROCESSING:2,FAILED:4,SUCCESSED:8,
PROCESSED:16,DEQUEUED:32,SOLVED:64,END:128};r.CIFLAG={NONE:0,BASE_64:1,USE_FUNCTION:2,REPLACE_VARIABLES:4,REPLACE_VARIABLES_EVALUATED:8,ESCAPE:16,REPLACE_BLOCK_CALLS:32,REMOVE_DELIMTTERS:64,ESCAPE_SPECIAL_CHARS:128,USE_REGEX:256,USE_FILTREX:512,CASCADE:1024,EXPRESSION:2048,DONT_PARSE:4096,TO_HEX:8192,REPLACE_HEX:16384,WAIT:32768,DONT_ESCAPE:65536,END:131072};r.CI_CORDER={};r.ECIType={BOOL:0,BOX:1,COLOUR:2,ENUMERATION:3,FILE:4,FLAGS:5,FLOAT:6,INTEGER:7,MATRIX:8,OBJECT:9,REFERENCE:10,QUATERNION:11,
RECTANGLE:12,STRING:13,VECTOR:14,VECTOR2D:15,VECTOR4D:16,ICON:17,IMAGE:18,BANNER:19,LOGO:20,STRUCTURE:21,BANNER2:22,ICON_SET:23,SCRIPT:24,EXPRESSION:25,RICHTEXT:26,ARGUMENT:27,JSON_DATA:28,EXPRESSION_EDITOR:29,WIDGET_REFERENCE:30,DOM_PROPERTIES:31,BLOCK_REFERENCE:32,BLOCK_SETTINGS:33,FILE_EDITOR:34,END:35,UNKNOWN:-1};r.ITEM_TYPE={FILE:"BTFILE",WIDGET:"WIDGET",BLOCK:"BLOCK",TEXT:"TEXT",EXPRESSION:"EXPRESSION"};r.EXPRESSION_PARSER||(r.EXPRESSION_PARSER={});r.COMPONENT_NAMES={XIDEVE:"xideve",XNODE:"xnode",
XBLOX:"xblox",XFILE:"xfile",XACE:"xace",XEXPRESSION:"xexpression",XCONSOLE:"xconsole"};r.WIDGET_REFERENCE_MODE={BY_ID:"byid",BY_CLASS:"byclass",BY_CSS:"bycss",BY_EXPRESSION:"expression"};r.VIEW_SPLIT_MODE={DESIGN:1,SOURCE:2,SPLIT_VERTICAL:6,SPLIT_HORIZONTAL:7};r.RESOURCE_VARIABLES={ACE:"ACE",APP_URL:"APP_URL",SITE_URL:"SITE_URL"};r.EVENTS={ERROR:"onError",STATUS:"onStatus",ON_CREATED_MANAGER:"onCreatedManager",ON_ITEM_SELECTED:"onItemSelected",ON_ITEM_REMOVED:"onItemRemoved",ON_ITEM_CLOSED:"onItemClosed",
ON_ITEM_ADDED:"onItemAdded",ON_ITEM_MODIFIED:"onItemModified",ON_NODE_SERVICE_STORE_READY:"onNodeServiceStoreReady",ON_FILE_STORE_READY:"onFileStoreReady",ON_CONTEXT_MENU_OPEN:"onContextMenuOpen",ON_CI_UPDATE:"onCIUpdate",ON_WIDGET_READY:"onWidgetReady",ON_CREATED_WIDGET:"onWidgetCreated",RESIZE:"onResize",ON_MODULE_RELOADED:"onModuleReloaded",ON_MODULE_UPDATED:"onModuleUpdated",ON_DID_OPEN_ITEM:"onDidOpenItem",ON_DID_RENDER_COLLECTION:"onDidRenderCollection",ON_PLUGIN_LOADED:"onPluginLoaded",ON_PLUGIN_READY:"onPluginReady",
ALL_PLUGINS_READY:"onAllPluginsReady",ON_CREATE_EDITOR_BEGIN:"onCreateEditorBegin",ON_CREATE_EDITOR_END:"onCreateEditorEnd",REGISTER_EDITOR:"registerEditor",ON_EXPRESSION_EDITOR_ADD_FUNCTIONS:"onExpressionEditorAddFunctions",ON_ACE_READY:"onACEReady",ON_UNSAVED_CONTENT:"onUnSavedContent",ON_FILE_CHANGED:"fileChanged",ON_FILE_DELETED:"fileDeleted",IMAGE_LOADED:"imageLoaded",IMAGE_ERROR:"imageError",UPLOAD_BEGIN:"uploadBegin",UPLOAD_PROGRESS:"uploadProgress",UPLOAD_FINISH:"uploadFinish",UPLOAD_FAILED:"uploadFailed",
ON_FILE_CONTENT_CHANGED:"onFileContentChanged",ON_COPY_BEGIN:"onCopyBegin",ON_COPY_END:"onCopyEnd",ON_DELETE_BEGIN:"onDeleteBegin",ON_DELETE_END:"onDeleteEnd",ON_MOVE_BEGIN:"onMoveBegin",ON_MOVE_END:"onMoveEnd",ON_CHANGED_CONTENT:"onChangedContent",ON_COMPRESS_BEGIN:"onCompressBegin",ON_COMPRESS_END:"onCompressEnd",ON_COMPONENT_READY:"onComponentReady",ON_ALL_COMPONENTS_LOADED:"onAllComponentsLoaded",ON_APP_READY:"onAppReady",ON_CREATE_STORE:"onCreateStore",ON_STORE_CREATED:"onStoreCreated",ON_STORE_CHANGED:"onStoreChanged",
ON_STATUS_MESSAGE:"onStatusMessage",SAVE_LAYOUT:"layoutSave",RESTORE_LAYOUT:"layoutRestore",ON_SHOW_PANEL:"onShowPanel",ON_PANEL_CLOSED:"onPanelClosed",ON_PANEL_CREATED:"onPanelCreated",ON_MAIN_VIEW_READY:"onMainViewReady",ON_MAIN_MENU_READY:"onMainMenuReady",ON_MAIN_MENU_OPEN:"onMainMenuOpen",ON_VIEW_REMOVED:"onViewRemoved",ON_VIEW_SHOW:"onViewShow",ON_VIEW_HIDE:"onViewHide",ON_VIEW_ADDED:"onViewAdded",ON_OPEN_VIEW:"onOpenView",ON_VIEW_MAXIMIZE_START:"onViewMaximizeStart",ON_VIEW_MAXIMIZE_END:"onViewMaximizeEnd",
ON_CONTAINER_ADDED:"onContainerAdded",ON_CONTAINER_REMOVED:"onContainerRemoved",ON_REMOVE_CONTAINER:"onRemoveContainer",ON_CONTAINER_REPLACED:"onContainerReplaced",ON_CONTAINER_SPLIT:"onContainerSplit"};r.DIALOG_SIZE={SIZE_NORMAL:"size-normal",SIZE_SMALL:"size-small",SIZE_WIDE:"size-wide",SIZE_LARGE:"size-large"};r.DIALOG_TYPE={DEFAULT:"type-default",INFO:"type-info",PRIMARY:"type-primary",SUCCESS:"type-success",WARNING:"type-warning",DANGER:"type-danger"};p.mixin(r,{LAYOUT_RIGHT_CENTER_BOTTOM:"LAYOUT_RIGHT_CENTER_BOTTOM",
LAYOUT_CENTER_BOTTOM:"LAYOUT_CENTER_BOTTOM",LAYOUT_CENTER_RIGHT:"LAYOUT_CENTER_RIGHT",LAYOUT_LEFT_CENTER_RIGHT:"LAYOUT_LEFT_CENTER_RIGHT",LAYOUT_LEFT_CENTER_RIGHT_BOTTOM:"LAYOUT_LEFT_CENTER_RIGHT_BOTTOM"});q.fromJson=function(b,m){var a=null,g=!1;try{a=eval("("+b+")")}catch(h){g=!0}if(g){g=b.substring(b.indexOf("{"),b.lastIndexOf("}")+1);try{g&&(a=eval("("+g+")"))}catch(f){!1!==m&&console.error("error in json parsing! "+b);if(-1!==b.indexOf("error"))return{jsonrpc:"2.0",result:{error:{code:1,message:b,
data:null}},id:0};throw Error(b);}}return a};return r})},"xide/utils/ObjectUtils":function(){define(["xide/utils","require","dojo/Deferred","dojo/_base/json","dojo/has"],function(p,r,n,q,b){function m(d){var a=parseInt(d);return a.toString()===d?a:d}function a(d,e,l,c){_.isNumber(e)&&(e=[e]);if(_.isEmpty(e))return d;if(_.isString(e))return a(d,e.split(".").map(m),l,c);var k=e[0];if(1===e.length)return e=d[k],void 0!==e&&c||(d[k]=l),e;void 0===d[k]&&(_.isNumber(e[1])?d[k]=[]:d[k]={});return a(d[k],
e.slice(1),l,c)}function g(d,a){_.isNumber(a)&&(a=[a]);if(!_.isEmpty(d)){if(_.isEmpty(a))return d;if(_.isString(a))return g(d,a.split("."));var l=m(a[0]),c=d[l];if(1===a.length)void 0!==c&&(_.isArray(d)?d.splice(l,1):delete d[l]);else if(void 0!==d[l])return g(d[l],a.slice(1));return d}}"use strict";p.debounce=function(d,a,l,c,k,t,g){var h=d[a+"_debounced"];h||(h=d[a+"_debounced"]=_.debounce(l,c,k));1!=t||d[a+"_debouncedFirst"]||(d[a+"_debouncedFirst"]=!0,l.apply(d,g));return h()};p.pluck=function(d,
a){var l=[];if(!d)return l;for(var c=0;c<d.length;c++)l.push(d[c][a]);return l};p.download=function(d,a){var l=document.createElement("a");a=_.isString(a)?a:JSON.stringify(a,null,2);l.setAttribute("href","data:text/plain;charset\x3dutf-8,"+encodeURIComponent(a));l.setAttribute("download",d);l.style.display="none";document.body.appendChild(l);l.click();document.body.removeChild(l)};p.hasObject=function(a,e,l){e=null;try{e=r(a)}catch(c){console.error("error in utils.hasObject ",c)}return e};p.getObject=
function(a,e){var l=null;if(p.isString(a)){try{l=r(a)}catch(c){}try{if(!l){var k=new n,l=r([a],function(c){k.resolve(c)});return k.promise}}catch(t){}return l}return p.isObject(a)?a:null!==l?l:e};p.toArray=function(a){var e=[],l;for(l in a)e.push({name:l,value:a[l]});return e};p.toObject=function(a,e){if(!a)return{};if(!1!==e)return _.object(_.map(a,_.values));if(p.isObject(a)&&a[0])return a[0];for(var l={},c=0;c<a.length;++c)l[c]=a[c];return l};p.byString=function(a,e,l){e=e.replace(/\[(\w+)\]/g,
".$1");e=e.replace(/^\./,"");for(e=e.split(".");e.length;)if(l=e.shift(),l in a)a=a[l];else return;return a};var h=Object.prototype.hasOwnProperty,f={has:function(a,e){if(_.isEmpty(a))return!1;_.isNumber(e)?e=[e]:_.isString(e)&&(e=e.split("."));if(_.isEmpty(e)||0===e.length)return!1;for(var l=0;l<e.length;l++){var c=e[l];if((_.isObject(a)||_.isArray(a))&&h.call(a,c))a=a[c];else return!1}return!0},ensureExists:function(d,e,l){return a(d,e,l,!0)},set:function(d,e,l,c){return a(d,e,l,c)},insert:function(a,
e,l,c){var k=f.get(a,e);c=~~c;isArray(k)||(k=[],f.set(a,e,k));k.splice(c,0,l)},empty:function(a,e){if(_.isEmpty(e))return a;if(!_.isEmpty(a)){var l,c;if(!(l=f.get(a,e)))return a;if(_.isString(l))return f.set(a,e,"");if(_.isBoolean(l))return f.set(a,e,!1);if(_.isNumber(l))return f.set(a,e,0);if(_.isArray(l))l.length=0;else if(_.isObject(l))for(c in l)h.call(l,c)&&delete l[c];else return f.set(a,e,null)}},push:function(a,e){var l=f.get(a,e);_.isArray(l)||(l=[],f.set(a,e,l));l.push.apply(l,Array.prototype.slice.call(arguments,
2))},coalesce:function(a,e,l){for(var c,k=0,t=e.length;k<t;k++)if(void 0!==(c=f.get(a,e[k])))return c;return l},get:function(a,e,l){_.isNumber(e)&&(e=[e]);if(_.isEmpty(e))return a;if(_.isEmpty(a)&&a&&null==a.innerHTML)return l;if(_.isString(e))return f.get(a,e.split("."),l);var c=m(e[0]);if(1===e.length){if(a&&void 0===a[c])return l;if(a)return a[c]}return a?f.get(a[c],e.slice(1),l):l},del:function(a,e){return g(a,e)}};p.getAt=function(a,e,l){return f.get(a,e,l)};p.setAt=function(a,e,l){return f.set(a,
e,l)};p.hasAt=function(a,e){return f.has(a,e)};p.ensureAt=function(a,e,l){return f.ensureExists(a,e,l)};p.deleteAt=function(a,e){return f.del(a,e)};p.merge=function(a,e){for(var l in e)"object"!=typeof a[l]?a[l]=e[l]:"object"==typeof e[l]&&(a[l]=p.merge(a[l],e[l]));return a};p.clone=function(a){if(!a||"object"!=typeof a||p.isFunction(a))return a;if(a.nodeType&&"cloneNode"in a)return a.cloneNode(!0);if(a instanceof Date)return new Date(a.getTime());if(a instanceof RegExp)return new RegExp(a);var e,
l,c;if(p.isArray(a))for(e=[],l=0,c=a.length;l<c;++l)l in a&&e.push(p.clone(a[l]));else e=a.constructor?new a.constructor:{};return p._mixin(e,a,p.clone)};p._mixin=function(a,e,l){var c,k,t={};for(c in e)k=e[c],c in a&&(a[c]===k||c in t&&t[c]===k)||(a[c]=l?l(k):k);return a};p.mixin=function(a,e){if(e){a||(a={});for(var l=arguments.length,c=1;c<l;c++)p._mixin(a,arguments[c])}return a};p.cloneKeys=function(a,e){var l={},c;for(c in a)if(!0!==e||c in a)l[c]=a[c];return l};p.isArray=function(a){return _.isArray(a)};
p.isObject=function(a){return _.isObject(a)};p.isString=function(a){return _.isString(a)};p.isNumber=function(a){return _.isNumber(a)};p.isFunction=function(a){return _.isFunction(a)};return p})},"xide/utils":function(){define(["dcl/dcl"],function(p){return p(null,{declaredClass:"xide.utils"})})},"xlog/Server":function(){define(["dcl/dcl","xide/types","xide/factory","dojo/node!winston"],function(p,r,n,q){return p(null,{declaredClass:"xlog.Server",fileLogger:null,loggly:null,delegate:null,publishLog:!0,
loggers:{},constructor:function(b){for(var m in arguments)arguments.hasOwnProperty(m)&&(this[m]=b[m])},createLogger:function(b){var m=new q.Logger({transports:[new q.transports.File(b)]});if(this.publishLog)m.on("logging",function(a,g,h,f){f.logId=b.filename;a={level:g,message:h,data:f,time:(new Date).getTime()};n.publish(r.EVENTS.ON_SERVER_LOG_MESSAGE,a)});return m},start:function(b){this.loggers={};this.options=b;if(b.fileLogger&&(this.fileLogger=q.add(q.transports.File,b.fileLogger),this.publishLog))this.fileLogger.on("logging",
function(b,a,g,h){b={level:a,message:g,data:h,time:(new Date).getTime()};n.publish(r.EVENTS.ON_SERVER_LOG_MESSAGE,b)});b.loggly&&(this.loggly=q.add(q.transports.Loggly,b.loggly));null===b.console&&q.remove(q.transports.Console)}})})},"xide/factory":function(){define([],function(){return{}})},"nxapp/types":function(){define(["dojo/_base/declare"],function(p){return p("nxapp.types",null,{})})},"nxapp/utils/FileUtils":function(){define("dojo/_base/json dojo/node!path dojo/node!fs dojo/node!util nxapp/utils xdojo/has!host-node?dojo/node!glob-fs xdojo/has!host-node?dojo/node!glob-base xdojo/has!host-node?dojo/node!glob".split(" "),
function(p,r,n,q,b,m,a,g){b.list=function(g){try{var f={},d=a(g);d.base&&(f.cwd=d.base,d.isGlob&&(g=d.glob));var e=(new m).readdirSync(g,f),l=[];_.each(e,function(c){l.push((f.cwd?f.cwd+r.sep:"")+c)})}catch(c){return null}return l};b.__toObject=function(a){try{var g=n.statSync(a,function(a){}),d=g.isDirectory();return{path:a,sizeBytes:g.size,size:d?"Folder":"",owner:g.uid,group:g.gid,mode:g.mode,isDir:d,directory:d,name:r.win32.basename(a),fileType:d?"folder":"file",modified:g.mtime.getTime()/1E3}}catch(e){return{path:a,
sizeBytes:0,size:0,owner:0,group:0,mode:0,directory:!1,mime:"unknown",name:r.win32.basename(a),fileType:"file",modified:0}}};b.ls=function(a){function f(c,k){return c?c=!e||k&&"/"!==k?a.join(k,c):""+c:""}var d={},e="win32"===process.platform;if("/*"===a&&e){var l=[];flop.read("/",function(c,a){_.each(a.files,function(c){l.push({path:"/"+c.name+":",sizeBytes:0,size:0,owner:0,group:0,mode:0,directory:!0,mime:"unknown",name:c.name,fileType:"folder",modified:0,drive:!0})})})}else{var c="";if(e)if(5===
a.length){var k=a.split(":/");2==k.length&&(c=k[0][1]+":/",d={root:c},a="/*")}else k=a.split(":/"),2==k.length&&(c=k[0][1]+":/",d={root:c},a=""+k[1]);d=g.sync(a,d);_.isArray(d)||(d=[d]);l=[];_.each(d,function(c){c=b.__toObject(c);e&&c&&c.path&&(c.path=r.resolve(f(c.path)));c.realPath=r.resolve(c.path);c&&l.push(c)});return l}};b.resolve=function(a){var g=r.resolve(a);try{if(n.statSync(g))return g}catch(d){return g}try{if(n.statSync(a))return a;var e=process.cwd()+r.sep+a;if(n.statSync(e))return e}catch(l){}return null};
b.isDirectory=function(a){return(a=b.resolve(a))&&(a=n.statSync(a))&&a.isDirectory()?!0:!1};b.getExtension=function(a){a=r.extname(a||"").split(".");return a[a.length-1]};b.readFile=function(a){var g=n.statSync(a).size,d=new Buffer(g);a=n.openSync(a,"r");if(!g)return"";n.readSync(a,d,0,g,0);n.closeSync(a);return d.toString()};b.writeFile=function(a,g){n.writeFile(a,g,function(a){a&&console.log(a)})};b.writeJSONFile=function(a,g){var d=JSON.stringify(g,null,4);n.writeFile(a,d,function(a){a&&console.log(a)})};
return b})},"nxapp/utils":function(){define(["dojo/_base/declare"],function(p){return p("nxapp.utils",null,{})})},"nxapp/utils/TCPUtils":function(){define(["dojo/node!net","nxapp/utils","nxapp/server/WebSocket","nxapp/server/DeviceServer","nxapp/server/FileServer"],function(p,r,n,q,b){r.checkPort=function(b,a,g){var h=new p.Socket,f=null;h.on("connect",function(){f="open";h.end()});h.setTimeout(1500);h.on("timeout",function(){f="closed";h.destroy()});h.on("error",function(a){f="closed"});h.on("close",
function(d){g(null,f,a,b)});h.connect(b,a)};r.createSocketServer=function(b,a){var g=new n;g.init({options:{port:b.socket_server.port,context:a,host:b.socket_server.host}});g.ctx=a;g.start(null,b);return n};r.createDeviceServer=function(b,a){var g=new q;g.init({options:{port:b.socket_server.port,context:a,host:b.socket_server.host}});g.ctx=a;g.start(null,b);return g};r.createFileServer=function(m,a){var g=new b;g.init({options:{port:m.socket_server.port,context:a,host:m.socket_server.host}});g.ctx=
a;console.error("create file server "+m.socket_server.host);g.start(null,m);return n};r.connect=function(b,a){};return r})},"nxapp/server/WebSocket":function(){define("dcl/dcl dojo/_base/lang xide/types xide/factory nxapp/server/ServerBase nxapp/utils/_LogMixin nxapp/server/_CommandsParserMixin dojo/node!http dojo/node!sockjs dojo/node!colors xide/utils".split(" "),function(p,r,n,q,b,m,a,g,h,f,d){var e=!1;return p([b,m,a],{declaredClass:"nxapp.server.WebSocket",_io_socket:null,clients:null,handleManagerCommand:function(a,
c){switch(a.manager_command){case n.SOCKET_SERVER_COMMANDS.MANAGER_TEST:console.dir("Test Manager command");break;case n.SOCKET_SERVER_COMMANDS.WATCH:var k=this.ctx.getFileManager();k&&k.watch(a.path,a.watch);break;case n.SOCKET_SERVER_COMMANDS.MQTT_PUBLISH:return this.sendMQTTMessage(a,c);case n.SOCKET_SERVER_COMMANDS.MANAGER_START_DRIVER:return this.startDriver(a,c);case n.SOCKET_SERVER_COMMANDS.GET_DEVICE_VARIABLES:return this.getVariables(a,c);case n.SOCKET_SERVER_COMMANDS.WRITE_LOG_MESSAGE:this.logClientMessage(a);
break;case n.SOCKET_SERVER_COMMANDS.MANAGER_STOP_DRIVER:this.stopDriver(a);break;case n.SOCKET_SERVER_COMMANDS.MANAGER_STATUS:a={message:"returning status",deviceConnections:this.options.context.getConnectionManager().getNumberOfConnections()};this.emit(n.SOCKET_SERVER_COMMANDS.SIGNAL_RESPONSE,JSON.stringify(a));break;case n.SOCKET_SERVER_COMMANDS.MANAGER_CLOSE_ALL:this.options.context.getConnectionManager().closeAll()}},handleDeviceCommand:function(a,c){var k=a.device_command,d=this.options.context,
g=this;e=!1;this.showDebugMsg("socket_server")&&e&&console.log("Handle device command: "+k+" | "+n.SOCKET_SERVER_COMMANDS.CALL_METHOD);console.error("handle device command",a);var b=d.getConnectionManager().connect(a.host,a.protocol,a.port,null,null,c);c||e&&console.error("---have no client connect");try{d.getConnectionManager().registerFeedBack(b,function(c,k){g.profile.debug.debugDevices&&e&&console.log("Data received from "+c.host);if(_.isString(k))a.lastResponse=""+k;else if(_.isObject(k))try{a.lastResponse=
JSON.stringify(k)}catch(d){e&&console.error("error serializing data")}g.onDeviceMessage(c,k)})}catch(h){console.error("-register feed back function failed",h),console.trace()}try{switch(k){case n.SOCKET_SERVER_COMMANDS.CALL_METHOD:this.options.context.getConnectionManager().callMethod(b,a,c);break;case n.SOCKET_SERVER_COMMANDS.DEVICE_SEND:this.options.context.getConnectionManager().send(b,a.command,a.options)}}catch(f){console.error("error command parser "+k,f)}},broadCastMessage:function(a,c){for(var k=
this.clients.length;k--;)if(void 0!==this.clients[k]){var d={event:a,data:c};3===this.clients[k].readyState?(this.clients[k].close(),this.clients.remove(this.clients[k])):(e&&console.log(f.green("writing broadcast message "+d.event+" have "+this.clients.length+" clients  readystate : "+this.clients[k].readyState)),d=JSON.stringify(d),this.clients[k].write(d))}},onFileChanged:function(a){this.broadCastMessage(n.EVENTS.ON_FILE_CHANGED,{path:a.path,type:a.type})},start:function(a,c){this.profile=c;this.options=
r.mixin(this.options,a);this.clients=[];var k=this;console.error("######",c);var d=this.options.port,b=this.options.host;if(d){this.initLogger(c.debug);this.log("Socket server running in "+d,"socket_server");var f={};this.showDebugMsg("socket_server")||(f.log=function(){});var f=h.createServer(f),m=g.createServer(this._handler);f.installHandlers(m);m.listen(d,b);this._handleSocketEmits(f);q.publish(n.EVENTS.ON_WEBSOCKET_START,{socket_server:{port:d,socket_handler:f}},this);f.on("connection",function(c){var a=
k.clients.push(c);c.on("close",function(){e&&console.error("close connection :  "+a);delete k.clients[a]})});return!0}console.error("Port must be provided into options");return!1},emit:function(a,c){console.log("emit + "+this.id+"#"+a,c);this.showDebugMsg("socket_server")&&!_.isString(c)&&_.isObject(c)&&(c=JSON.stringify(c));this.socket?this.socket.write(c):e&&console.error("-------- WebSocket::emit failed. Have no socket! "+a+" id "+this.id)},_handleSocketEmits:function(a){var c=this.options.port,
k=this;a.on("connection",function(a){k.socket=a;e&&console.log("client connected");q.publish(n.EVENTS.ON_WEBSOCKET_CONNECTION,{connection:{port:c,socket_handler:a}},this);a.on("data",function(c){r.isString(c)&&(c=dojo.fromJson(c));c.manager_command?k.handleManagerCommand(c,a):k.handleDeviceCommand(c,a)});a.on("close",function(){console.error("closed!")})})},constructor:function(){this.id=d.createUUID()}})})},"nxapp/server/ServerBase":function(){define(["dcl/dcl","xide/model/Base","xide/utils","xide/mixins/EventedMixin"],
function(p,r,n,q){return p([r.dcl,q.dcl],{options:null,delegate:null,ctx:null,declaredClass:"nxapp.server.ServerBase",_defaultOptions:function(){return{delegate:this}},init:function(b){this.options=n.mixin(this._defaultOptions(),b.options)}})})},"xide/model/Base":function(){define(["dcl/dcl","dojo/_base/declare","xide/utils"],function(p,r,n){var q={declaredClass:"xide/model/Base",constructor:function(b){n.mixin(this,b)},getLabel:function(){return null},getID:function(){return null}};r=r("xide/model/Base",
null,q);r.dcl=p(null,q);return r})},"xide/mixins/EventedMixin":function(){define("dojo/_base/array dcl/dcl xdojo/declare xdojo/has xide/types xide/factory".split(" "),function(p,r,n,q,b,m){q={_didRegisterSubscribers:!1,subscribers:null,subscribes:{},emits:{},__events:null,addPublishFilter:function(a,g){a&&(null!=g?this.emits[a]=g:a in this.emits&&delete this.emits[a])},filterSubscribe:function(a){return this.subscribes?!1!==this.subscribes[a]:!0},filterPublish:function(a){return this.emits?!1!==this.emits[a]:
!0},subscribe:function(a,g,b){this.__events||(this.__events={});a=m.subscribe(a,g,b||this,this.filterSubscribe.bind(this));g=this.__events;b=0;for(var f=a.length;b<f;b++){var d=a[b].type;g[d]||(g[d]=[]);g[d].push(a[b])}return a},publish:function(a,g,b,f){var d=this;0<f?setTimeout(function(){m.publish(a,g,b||d,d.filterPublish.bind(d))}.bind(d),f):m.publish(a,g,b||d,d.filterPublish.bind(d))},_destroyHandle:function(a){},_destroyHandles:function(){if(this.__events){for(var a in this.__events)p.forEach(this.__events[a],
function(a){a&&a.remove&&a.remove()});delete this.__events}},destroy:function(){this._emit("destroy");this.inherited&&this.inherited(arguments);this._destroyHandles()},once:function(a,g){function b(){f.unsubscribe(a,g);return g.apply(f,arguments)}var f=this;b.listener=g;f._on(a,b);return this},_emit:function(a){if(this.__events){if(!this._didRegisterSubscribers&&this.subscribers){for(var g=0;g<this.subscribers.length;g++){var b=this.subscribers[g];this._on(b.event,b.handler,b.owner)}this._didRegisterSubscribers=
!0}if(!0===arguments[2])throw Error("Please use emit.sticky() instead of passing sticky\x3dtrue for event: "+a);g=this.__events[a];b=1<arguments.length?arguments[2]:null;if(g){var f;if("function"==typeof g)switch(arguments.length){case 1:return g.call(this);case 2:return g.call(this,arguments[1]);case 3:return g.call(this,arguments[1],arguments[2]);default:var d=Array.prototype.slice.call(arguments,1);f=g.apply(this,d)}else if(_.isArray(g))for(var d=Array.prototype.slice.call(arguments,1),e=g.slice(),
l,c=null,k=null,g=0,t=e.length;g<t;g++)c=e[g],k=c.owner||this,d&&d[0]&&(d[0].owner=d[0]?d[0].owner||k:null),c.handler&&(l=c.handler.apply(k,d)),void 0!==l&&(f=l);b&&!0===b["public"]&&this.publish(a,d);return f}}},unsubscribe:function(a,g){if(!this.__events||!this.__events[a])return this;if("function"!==typeof g||!g)return p.forEach(this.__events[a],dojo.unsubscribe),delete this.__events[a],this.__events[a]=[],this;var b=this.__events[a];if(_.isArray(b)){var f=[];_.each(b,function(a,e,l){(a.handler==
g?a.handler:a.handler.listener==g&&a.handler.listener)&&f.push(a)});_.each(f,function(a){a.remove()});0===b.length&&delete this.__events[a]}else(this.__events[a].listener||this.__events[a])===g&&delete this.__events[a];return this},listeners:function(a){this.__events||(this.__events={});this.__events[a]||(this.__events[a]=[]);isArray(this.__events[a])||(this.__events[a]=[this.__events[a]]);return this.__events[a]},addHandle:function(a,g){this.__events||(this.__events={});this.__events[a]||(this.__events[a]=
[]);g.type=a;this.__events[a].push(g);return g},__on:function(a,g,b,f){var d=f;"function"!=typeof b||f||(f=b,b=null);a=a.jquery?a:$(a);a.on(g,b,f);this.__events||(this.__events={});this.__events[g]||(this.__events[g]=[]);var e=this.__events[g];a={handler:d,owner:this,type:g,element:a,selector:b,remove:function(){e.remove(this);this.element.off(this.type,this.selector,this.handler)}};e.push(a);return a},_on:function(a,g,b){try{this.__events||(this.__events={});this.__events[a]||(this.__events[a]=[]);
var f=this.__events[a];if(!f)this.__events[a]=g;else if(_.isArray(f)){if(-1!=f.indexOf(g))return console.warn("adding same listener twice",a);g={handler:g,owner:b||this,type:a,remove:function(){f.remove(this);b&&b.__events&&b.__events[a]&&b.__events[a].remove(this);this.handler=this.owner=null;delete this.type}};f.push(g);return g}}catch(d){logError(d)}return this}};n=n(null,q);n.Impl=q;n.dcl=r(null,q);r.chainAfter(n.dcl,"destroy");return n})},"nxapp/utils/_LogMixin":function(){define(["dcl/dcl"],
function(p){return p(null,{declaredClass:"nxapp.utils._LogMixin",debug_conf:null,logger:null,initLogger:function(p){this.debug_conf=p},log:function(p,n,q,b){n||(n=this._debugContext().main);n&&!this.showDebugMsg(n)||!this.logger||(q=q||"info",b.time=(new Date).getTime(),this.logger.log(q,p,b))},logEx:function(p,n,q,b){this.logger?(n=n||"info",b=b||{},b.type=q||"Unknown",b.time=b.time||(new Date).getTime(),this.logger.log(n,p,b)):console.error("have no logger!")},showDebugMsg:function(p){if(null!=
this.debug_conf)return this.debug_conf.all?!0:this.debug_conf[p]?!0:!1;this.debug_conf={all:!0};return!0}})})},"nxapp/server/_CommandsParserMixin":function(){define(["dcl/dcl","nxapp/types/Types","nxapp/utils/_console"],function(p,r,n){var q=!1;return p(null,{declaredClass:"nxapp.server._CommandsParserMixin",handleManagerCommand:function(b,m){switch(b.manager_command){case r.SOCKET_SERVER_COMMANDS.MANAGER_TEST:console.dir("Test Manager command");break;case r.SOCKET_SERVER_COMMANDS.WATCH:var a=this.ctx.getFileManager();
a&&a.watch(b.path,b.watch);break;case r.SOCKET_SERVER_COMMANDS.MQTT_PUBLISH:return this.sendMQTTMessage(b,m);case r.SOCKET_SERVER_COMMANDS.MANAGER_START_DRIVER:return this.startDriver(b,m);case r.SOCKET_SERVER_COMMANDS.GET_DEVICE_VARIABLES:return this.getVariables(b,m);case r.SOCKET_SERVER_COMMANDS.WRITE_LOG_MESSAGE:this.logClientMessage(b);break;case r.SOCKET_SERVER_COMMANDS.MANAGER_STOP_DRIVER:this.stopDriver(b);break;case r.SOCKET_SERVER_COMMANDS.MANAGER_STATUS:b={message:"returning status",deviceConnections:this.options.context.getConnectionManager().getNumberOfConnections()};
this.emit(r.SOCKET_SERVER_COMMANDS.SIGNAL_RESPONSE,JSON.stringify(b));break;case r.SOCKET_SERVER_COMMANDS.MANAGER_CLOSE_ALL:this.options.context.getConnectionManager().closeAll()}},handleDeviceCommand:function(b,m){var a=b.device_command,g=this.options.context,h=this;q=!1;this.showDebugMsg("socket_server")&&q&&console.log("Handle device command: "+a+" | "+r.SOCKET_SERVER_COMMANDS.CALL_METHOD);console.error("handle device command",b);var f=g.getConnectionManager().connect(b.host,b.protocol,b.port,
null,null,m);m||q&&console.error("---have no client connect");try{g.getConnectionManager().registerFeedBack(f,function(a,c){h.profile.debug.debugDevices&&q&&console.log("Data received from "+a.host);if(_.isString(c))b.lastResponse=""+c;else if(_.isObject(c))try{b.lastResponse=JSON.stringify(c)}catch(k){q&&console.error("error serializing data")}h.onDeviceMessage(a,c)})}catch(d){console.error("-register feed back function failed",d),console.trace()}try{switch(a){case r.SOCKET_SERVER_COMMANDS.CALL_METHOD:this.options.context.getConnectionManager().callMethod(f,
b,m);break;case r.SOCKET_SERVER_COMMANDS.DEVICE_SEND:this.options.context.getConnectionManager().send(f,b.command,b.options)}}catch(e){console.error("error command parser "+a,e)}}})})},"nxapp/types/Types":function(){define(["dojo/_base/lang","xide/types/Types","xcf/types/Types"],function(p,r){p.mixin(r.EVENTS,{ON_FILE_CHANGED:"fileChanged",ON_CONNECTION_CREATED:"connectionCreated",ON_CONNECTION_ERROR:"connectionError",ON_WEBSOCKET_START:"webSocketStart",ON_WEBSOCKET_CONNECTION:"webSocketConnection",
ON_MQTT_MESSAGE:"onMQTTMessage",ON_DEVICE_MESSAGE:"onDeviceMessage",ON_COMMAND_FINISH:"onCommandFinish",ON_COMMAND_ERROR:"onCommandError",ON_DEVICE_DISCONNECTED:"onDeviceDisconnected",ON_DEVICE_CONNECTED:"onDeviceConnected",STORE_CHANGED:"storeChange",BEFORE_STORE_CHANGE:"beforeStoreChange",STORE_REFRESHED:"storeRefreshed",ON_DID_OPEN_ITEM:"onDidOpenItem",ON_SHOW_PANEL:"onShowPanel",ITEM_SELECTED:"itemSelected",ERROR:"fileOperationError",STATUS:"fileOperationStatus",IMAGE_LOADED:"imageLoaded",IMAGE_ERROR:"imageError",
RESIZE:"resize",UPLOAD_BEGIN:"uploadBegin",UPLOAD_PROGRESS:"uploadProgress",UPLOAD_FINISH:"uploadFinish",ON_CLIPBOARD_COPY:"onClipboardCopy",ON_CLIPBOARD_PASTE:"onClipboardPaste",ON_CLIPBOARD_CUT:"onClipboardCut",ON_CONTEXT_MENU_OPEN:"onContextMenuOpen",ON_PLUGIN_LOADED:"onPluginLoaded",ON_PLUGIN_READY:"onPluginReady",ON_MAIN_VIEW_READY:"onMainViewReady2",REGISTER_EDITOR:"registerEditor",REGISTER_ACTION:"registerAction",ON_FILE_CONTENT_CHANGED:"onFileContentChanged",ON_PANEL_CLOSED:"onPanelClosed",
ON_PANEL_CREATED:"onPanelCreated",SET_DEVICE_VARIABLES:"setDeviceVariables"});r.LOG_CONTEXT={DEVICE:"Device"};r.test=2;return r})},"xcf/types/Types":function(){define(["xaction/types","xide/types/Types","xide/types","xide/utils/ObjectUtils"],function(p,r,n,q){n.VARIABLE_FLAGS={PUBLISH:2,PUBLISH_IF_SERVER:4};n.LOGGING_FLAGS={NONE:0,GLOBAL_CONSOLE:1,STATUS_BAR:2,POPUP:4,FILE:8,DEV_CONSOLE:16,DEVICE_CONSOLE:32};q.mixin(n.ITEM_TYPE,{DEVICE:"Device",DEVICE_GROUP:"Device Group",DRIVER:"Driver",DRIVER_GROUP:"Driver Group",
PROTOCOL:"Protocol",PROTOCOL_GROUP:"Protocol Group"});n.SERVICE_STATUS={OFFLINE:"offline",ONLINE:"online",TIMEOUT:"timeout"};n.PROTOCOL={TCP:"tcp",UDP:"udp",SERIAL:"serial",DRIVER:"driver",SSH:"ssh",MQTT:"mqtt"};q.mixin(n.EVENTS,{ON_DEBUGGER_READY:"onDebuggerReady",ON_DEVICE_SELECTED:"onDeviceSelected",ON_DEVICE_GROUP_SELECTED:"onDeviceGroupSelected",ON_PROTOCOL_SELECTED:"onProtocolSelected",ON_PROTOCOL_GROUP_SELECTED:"onProtocolGroupSelected",ON_PROTOCOL_CHANGED:"onProtocolChanged",ON_MQTT_MESSAGE:"onMQTTMessage",
ON_DEVICE_MESSAGE:"onDeviceMessage",ON_DEVICE_MESSAGE_EXT:"onDeviceMessageExt",ON_COMMAND_FINISH:"onCommandFinish",ON_COMMAND_PROGRESS:"onCommandProgress",ON_COMMAND_PAUSED:"onCommandPaused",ON_COMMAND_STOPPED:"onCommandStopped",ON_COMMAND_ERROR:"onCommandError",ON_DEVICE_DISCONNECTED:"onDeviceDisconnected",ON_DEVICE_CONNECTED:"onDeviceConnected",ON_DEVICE_COMMAND:"onDeviceCommand",ON_DEVICE_STATE_CHANGED:"onDeviceStateChanged",ON_DEVICE_DRIVER_INSTANCE_READY:"onDeviceDriveInstanceReady",ON_DRIVER_SELECTED:"onDriverSelected",
ON_DRIVER_GROUP_SELECTED:"onDriverGroupSelected",ON_DRIVER_VARIABLE_ADDED:"onDriverVariableAdded",ON_DRIVER_VARIABLE_REMOVED:"onDriverVariableRemoved",ON_DRIVER_VARIABLE_CHANGED:"onDriverVariableChanged",ON_DRIVER_COMMAND_ADDED:"onDriverCommandAdded",ON_DRIVER_COMMAND_REMOVED:"onDriverCommandRemoved",ON_DRIVER_COMMAND_CHANGE:"onDriverVariableChanged",ON_SCOPE_CREATED:"onScopeCreated",ON_DRIVER_MODIFIED:"onDriverModified",SET_DEVICE_VARIABLES:"setDeviceVariables",ON_SERVER_LOG_MESSAGE:"onServerLogMessage",
ON_CLIENT_LOG_MESSAGE:"onClientLogMessage",ON_DEVICE_SERVER_CONNECTED:"onDeviceServerConnected",ON_RUN_CLASS_EVENT:"onRunClassEvent"});n.MESSAGE_SOURCE={DEVICE:"DEVICE",GUI:"GUI",BLOX:"BLOX",CODE:"CODE"};n.DEVICE_STATE={CONNECTING:"DeviceIsConnecting",CONNECTED:"DeviceIsConnected",SYNCHRONIZING:"DeviceIsSynchronizing",READY:"DeviceIsReady",DISCONNECTED:"DeviceIsDisconnected",DISABLED:"DeviceIsDisabled",LOST_DEVICE_SERVER:"LostDeviceServerConnection"};n.DRIVER_PROPERTY={CF_DRIVER_NAME:"CF_DRIVER_NAME",
CF_DRIVER_ICON:"CF_DRIVER_ICON",CF_DRIVER_CLASS:"CF_DRIVER_CLASS",CF_DRIVER_ID:"CF_DRIVER_ID",CF_DRIVER_COMMANDS:"CF_DRIVER_COMMANDS",CF_DRIVER_VARIABLES:"CF_DRIVER_VARIABLES",CF_DRIVER_RESPONSES:"CF_DRIVER_RESPONSES"};n.PROTOCOL_PROPERTY={CF_PROTOCOL_TITLE:"Title",CF_PROTOCOL_ICON:"CF_PROTOCOL_ICON",CF_PROTOCOL_CLASS:"CF_PROTOCOL_CLASS",CF_PROTOCOL_ID:"CF_PROTOCOL_ID",CF_PROTOCOL_COMMANDS:"CF_PROTOCOL_COMMANDS",CF_PROTOCOL_VARIABLES:"CF_PROTOCOL_VARIABLES",CF_PROTOCOL_RESPONSES:"CF_PROTOCOL_RESPONSES"};
n.DEVICE_PROPERTY={CF_DEVICE_DRIVER:"Driver",CF_DEVICE_HOST:"Host",CF_DEVICE_PORT:"Port",CF_DEVICE_PROTOCOL:"Protocol",CF_DEVICE_TITLE:"Title",CF_DEVICE_ID:"Id",CF_DEVICE_ENABLED:"Enabled",CF_DEVICE_OPTIONS:"Options",CF_DEVICE_DRIVER_OPTIONS:"DriverOptions",CF_DEVICE_LOGGING_FLAGS:"Logging Flags"};n.LOG_OUTPUT={DEVICE_CONNECTED:"Device Connected",DEVICE_DISCONNECTED:"Device Disonnected",RESPONSE:"Response",SEND_COMMAND:"Send Command",DEVICE_ERROR:"Device Error"};n.DEFAULT_DEVICE_LOGGING_FLAGS={};
p=n.LOGGING_FLAGS;n.DEFAULT_DEVICE_LOGGING_FLAGS[n.LOG_OUTPUT.DEVICE_CONNECTED]=p.GLOBAL_CONSOLE|p.POPUP|p.STATUS_BAR|p.DEVICE_CONSOLE;n.DEFAULT_DEVICE_LOGGING_FLAGS[n.LOG_OUTPUT.DEVICE_DISCONNECTED]=p.GLOBAL_CONSOLE|p.POPUP|p.STATUS_BAR|p.DEVICE_CONSOLE;n.DEFAULT_DEVICE_LOGGING_FLAGS[n.LOG_OUTPUT.RESPONSE]=p.DEVICE_CONSOLE|p.GLOBAL_CONSOLE;n.DEFAULT_DEVICE_LOGGING_FLAGS[n.LOG_OUTPUT.SEND_COMMAND]=p.DEVICE_CONSOLE|p.GLOBAL_CONSOLE;n.DEFAULT_DEVICE_LOGGING_FLAGS[n.LOG_OUTPUT.DEVICE_ERROR]=p.GLOBAL_CONSOLE|
p.POPUP|p.STATUS_BAR|p.DEV_CONSOLE|p.DEVICE_CONSOLE;n.DRIVER_FLAGS={RUNS_ON_SERVER:2,DEBUG:4,SERVER:16};q.mixin(n.ITEM_TYPE,{CF_DRIVER_VARIABLE:"DriverVariable",CF_DRIVER_BASIC_COMMAND:"DriverBasicCommand",CF_DRIVER_CONDITIONAL_COMMAND:"DriverConditionalCommand",CF_DRIVER_RESPONSE_VARIABLE:"DriverResponseVariable"});n.BLOCK_GROUPS={CF_DRIVER_VARIABLE:"DriverVariable",CF_DRIVER_BASIC_COMMAND:"DriverBasicCommand",CF_DRIVER_CONDITIONAL_COMMAND:"DriverConditionalCommand",CF_DRIVER_RESPONSE_VARIABLE:"DriverResponseVariable",
CF_DRIVER_RESPONSE_BLOCKS:"conditionalProcess",CF_DRIVER_RESPONSE_VARIABLES:"processVariables",CF_DRIVER_BASIC_VARIABLES:"basicVariables"};n.COMMAND_TYPES={BASIC_COMMAND:"basic",CONDITIONAL_COMMAND:"conditional",INIT_COMMAND:"init"};q.mixin(n.ECIType,{DEVICE_NETWORK_SETTINGS:n.ECIType.END+1,DRIVER_COMMAND_SETTINGS:"CommandSettings"});n.VFS_ROOTS={SYSTEM_DRIVERS:"system_drivers",USER_DRIVERS:"user_drivers"};n.SOCKET_SERVER_COMMANDS={SIGNAL_MANAGER:"Manager_command",RUN_FILE:"Run_File",RUN_CLASS:"Run_Class",
SIGNAL_DEVICE:"Device_command",SIGNAL_RESPONSE:"WebSocket_response",MANAGER_TEST:"Manager_Test",MANAGER_CLOSE_ALL:"Close_All_Connections",MANAGER_STATUS:"status",MANAGER_START_DRIVER:"startDriver",MANAGER_STOP_DRIVER:"stopDriver",DEVICE_SEND:"Device_Send",CALL_METHOD:"Call_Method",RUN_SHELL:"Run_Shell",WATCH:"Watch_Directory",MQTT_PUBLISH:"MQTT_PUBLISH",MQTT_SUBSCRIBE:"MQTT_SUBSCRIBE",GET_DEVICE_VARIABLES:"getVariables",WRITE_LOG_MESSAGE:"Write_Log_Message",INIT_DEVICES:"INIT_DEVICES"};return n})},
"xaction/types":function(){define(["xide/types","dojo/_base/lang"],function(p,r){r.mixin(p.EVENTS,{ON_ACTION_CHANGE_CONTEXT:"onChangeActionContext",ON_ACTION_CONTEXT_CHANGED:"onActionContextChanged",REGISTER_ACTION:"registerAction",SET_ITEM_ACTIONS:"onSetItemsActions",ON_CLIPBOARD_COPY:"onClipboardCopy",ON_CLIPBOARD_PASTE:"onClipboardPaste",ON_CLIPBOARD_CUT:"onClipboardCut",ON_RENDER_ACTIONS:"onRenderActions",ON_DID_ACTION:"onDidAction",ON_AFTER_ACTION:"onAfterAction"});p.ACTION={LAYOUT:"View/Layout",
COLUMNS:"View/Columns",SELECTION:"File/Select",CLIPBOARD:"Edit/Clipboard",UNDO:"Edit/Undo",REDO:"Edit/Redo",CLIPBOARD_COPY:"Edit/Clipboard/Copy",CLIPBOARD_PASTE:"Edit/Clipboard/Paste",CLIPBOARD_CUT:"Edit/Clipboard/Cut",COPY:"File/Copy",MOVE:"File/Move",RENAME:"File/Rename",DELETE:"File/Delete",OPEN:"File/Open",EDIT:"File/Edit",SAVE:"File/Save",SEARCH:"File/Search",TOOLBAR:"View/Show/Toolbar",STATUSBAR:"View/Show/Statusbar",BREADCRUMB:"View/Show/Breadcrumb",HEADER:"View/Show/Header",DOWNLOAD:"File/Download",
DOWNLOAD_TO:"File/downloadTo",INFO:"File/Info",COMPRESS:"File/Compress",RELOAD:"File/Reload",UPLOAD:"File/Upload",PREVIEW:"File/Preview",OPEN_IN:"File/Open In",INSERT_IMAGE:"insertImage",COPY_PASTE:"copypaste",DND:"dnd",OPTIONS:"options",NEW_FILE:"File/New/New File",NEW_DIRECTORY:"File/New/New Folder",GET_CONTENT:"get",SET_CONTENT:"set",FIND:"File/Find",CUSTOM:"custom",PERMA_LINK:"permaLink",ADD_MOUNT:"ADD_MOUNT",REMOVE_MOUNT:"REMOVE_MOUNT",EDIT_MOUNT:"EDIT_MOUNT",PERSPECTIVE:"PERSPECTIVE",RUN:"File/Run",
GO_UP:"Navigation/Go Up",STOP:"File/Stop",CLOSE:"View/Close",FULLSCREEN:"View/Fullscreen",OPEN_IN_TAB:"File/OpenInNewTab",SOURCE:"Navigation/Source",RIBBON:"View/Show/Ribbon",MAIN_MENU:"View/Show/MainMenu",NAVIGATION:"View/Show/Navigation",BASH_CONSOLE:"File/Console/Bash",JS_CONSOLE:"File/Console/JS",PHP_CONSOLE:"File/Console/PHP",CONSOLE:"File/Console/PHP",SIZE_STATS:"View/Show/SizeStats",WELCOME:"Window/Welcome"};p.ACTION_TYPE={MULTI_TOGGLE:"multiToggle",SINGLE_TOGGLE:"singleToggle"};p.ACTION_ICON=
{CLIPBOARD_COPY:"fa-copy",CLIPBOARD_PASTE:"fa-paste",UPLOAD:"fa-upload",RENAME:"el-icon-edit",DELETE:"text-danger fa-remove",RELOAD:"fa-refresh",EDIT:"fa-pencil",SAVE:"fa-floppy-o",SEARCH:"fa-search",NEW_DIRECTORY:"fa-magic",NEW_FILE:"fa-magic",RUN:"text-success el-icon-play",COMPRESS:"fa-file-archive-o",EXTRACT:"fa-folder-open",DOWNLOAD:"fa-download",GO_UP:"fa-level-up",TOOLBAR:"fa-bars",STATUSBAR:"fa-terminal",PREVIEW:"fa-eye",MAXIMIZE:"fa-arrows-alt",UNDO:"fa-undo",REDO:"fa-repeat"};return p})},
"nxapp/utils/_console":function(){define(["dojo/has!host-node?dojo/node!tracer","nxapp/utils"],function(p,r){var n=n;p&&(n=p.colorConsole({format:"\x3c{{title}}\x3e {{message}} (in {{file}}:{{line}})",dateformat:"HH:MM:ss.L"}));"undefined"==typeof logError&&(global.logError=function(q,b){n.error("Error "+b,q)});r.stack=function(){n.log(Error().stack)};return n})},"nxapp/server/DeviceServer":function(){define("dcl/dcl dojo/_base/lang xide/types xide/factory nxapp/server/WebSocket dojo/node!http dojo/node!sockjs dojo/node!path dojo/node!fs-jetpack nxapp/utils/_console xide/utils nxapp/model/Connection".split(" "),
function(p,r,n,q,b,m,a,g,h,f,d,e){var l=!1;return p([b],{mqttManager:null,declaredClass:"nxapp.server.WebSocket",handleManagerCommand:function(c,a){switch(c.manager_command){case n.SOCKET_SERVER_COMMANDS.MANAGER_TEST:f.dir("Test Manager command");break;case n.SOCKET_SERVER_COMMANDS.RUN_SHELL:return this.ctx.getDeviceManager().runShell(c.cmd,c.args,c.options);case n.SOCKET_SERVER_COMMANDS.RUN_FILE:return this.ctx.runFile(c);case n.SOCKET_SERVER_COMMANDS.INIT_DEVICES:return this.ctx.loadDevices(c);
case n.SOCKET_SERVER_COMMANDS.RUN_CLASS:return this.ctx.runClass(c);case n.SOCKET_SERVER_COMMANDS.WATCH:var d=this.ctx.getFileManager();d&&d.watch(c.path,c.watch);break;case n.SOCKET_SERVER_COMMANDS.MQTT_PUBLISH:return this.sendMQTTMessage(c,a);case n.SOCKET_SERVER_COMMANDS.MANAGER_START_DRIVER:return this.startDriver(c,a);case n.SOCKET_SERVER_COMMANDS.GET_DEVICE_VARIABLES:return this.getVariables(c,a);case n.SOCKET_SERVER_COMMANDS.WRITE_LOG_MESSAGE:this.logClientMessage(c);break;case n.SOCKET_SERVER_COMMANDS.MANAGER_STOP_DRIVER:this.stopDriver(c);
break;case n.SOCKET_SERVER_COMMANDS.MANAGER_STATUS:c={message:"returning status",deviceConnections:this.options.context.getConnectionManager().getNumberOfConnections()};this.emit(n.SOCKET_SERVER_COMMANDS.SIGNAL_RESPONSE,JSON.stringify(c));break;case n.SOCKET_SERVER_COMMANDS.MANAGER_CLOSE_ALL:this.options.context.getConnectionManager().closeAll()}},handleDeviceCommand:function(c,a){var e=c.device_command,g=this.options.context,b=this;l=!1;var h=c.options,m=null;a||l&&f.error("---have no client ");
h.host&&h.protocol?m=g.getConnectionManager().connect(h.host,h.protocol,h.port||"",null,h,a):f.error("handle device command: invalid args. data.options is not xide/types/DeviceInfo",d.inspect(c));try{m&&(m.options=h,g.getConnectionManager().registerFeedBack2(m,function(a,k){if(_.isString(k))c.lastResponse=""+k;else if(_.isObject(k))try{c.lastResponse=JSON.stringify(k)}catch(d){l&&f.error("error serializing data")}b.onDeviceMessage(a,k)}))}catch(q){f.error("-register feed back function failed",q),
f.trace(q)}try{switch(e){case n.SOCKET_SERVER_COMMANDS.CALL_METHOD:this.options.context.getConnectionManager().callMethod(m,c,a);break;case n.SOCKET_SERVER_COMMANDS.DEVICE_SEND:this.options.context.getConnectionManager().send(m,c.command,c.options)}}catch(p){f.error("error command parser "+e,p.stack)}},sendMQTTMessage:function(c,a){var d=c.data.device;c.data.sourceHost=a.remoteAddress;c.data.sourcePort=a.remotePort;if(d){if((d=this.ctx.getConnectionManager().getConnection2(d))&&d.variables){var e=
c.topic.split("/");if(4==e.length&&"Variable"==e[2]){e=e[3];if(!e)return;for(var g=0;g<d.variables.length;g++){var l=d.variables[g];l.name===e&&(l.value=c.data.value)}}}}else f.error("cant find device");this.mqttManager?this.mqttManager.publishTopic(c.topic,c.data):f.log("have no mqtt")},updateDeviceState:function(c,a){this.mqttManager&&this.mqttManager.publishTopic(c,a)},sendClientMessage:function(c,a,e,g){l&&f.log("DeviceServer::sendClientMessage "+e+" "+c.remoteAddress+" : "+c.remotePort);a={data:d.mixin({device:a},
g),event:e};c.write(JSON.stringify(a))},getVariables:function(c,a){var d=c.device,e=this.ctx.getConnectionManager().getConnection2(d),g=[];if(e){e.options=d;var l=e.variables;l?(g=l,this.sendClientMessage(a,d,n.EVENTS.SET_DEVICE_VARIABLES,{variables:l})):(g=e.variables=c.variables,_.each(g,function(c){c.value=c.initial}),this.sendClientMessage(a,d,n.EVENTS.SET_DEVICE_VARIABLES,{variables:c.variables}))}if((e=a.mqtt)&&!e.didSubscribe)for(l=0;l<g.length;l++)e.subscribe(d.host+"/"+d.port+"/Variable/"+
g[l].name)},logClientMessage:function(c){var a=c.data.device;c.data.device?this.logEx(c.message,c.level,c.type,{device:a,deviceMessage:"",time:c.time}):f.error("wrong log parameters, host missing",c)},getLogger:function(c){var a=this.ctx.getLogManager(),e=a.options,l=d.replaceAll("/","_",c.host)+"_"+c.port+"_"+c.protocol+".json",b=a.loggers[l],e=(c=c[c.deviceScope])?h.dir(c+g.sep+"logs").path():e.fileLogger.dirname;b||(b=a.createLogger({filename:l,dirname:e,json:!0,console:null}),a.loggers[l]=b);
return b},logEx:function(c,a,d,e){var g=this.getLogger(e.device);a=a||"info";e=e||{};e.type=d||"Unknown";e.time=e.time||(new Date).getTime();g.log(a,c,e)},stopDriver:function(c){var a=this.ctx.getConnectionManager(),d=this.ctx.getDeviceManager(),g=a.getConnection2(c);g&&(g.options=c,g.client.close());a.removeConnection(g,null,!0);!g&&l&&f.log("have no such connection "+e.generateId(c),c);d.stopDevice(c.id)},sendClientEvent:function(c){},startDriver:function(c,a){var d=this.ctx.getConnectionManager(),
g=this.ctx.getDeviceManager(),b=d.getConnection2(c);if(!b)return l&&f.log("start driver: connection doesnt exists "+c.host+" : "+c.port+"@"+c.protocol+" : "+c.deviceScope+" id : "+e.generateId(c)),c[c.driverScope]?d.connect(c.host,c.protocol,c.port,c.mqtt,c,a):(f.error("have no driver scope"),null);b.options=c;d.onConnect2(b,!0,!0);d=c.driverOptions&1<<n.DRIVER_FLAGS.RUNS_ON_SERVER;if(!c.deviceScope)throw f.error("has no device scope",c),Error("has no device scope",c);d&&g&&g.startDevice&&(d=g.getItemById(c.id))&&
((b=g.toDeviceControlInfo(d))&&g.startDevice(d,!0),b&&l&&f.log("driver runs server side, start device! "+b.toString()));return"xxxx"},onFileChanged:function(c){this.broadCastMessage(n.EVENTS.ON_FILE_CHANGED,{path:c.path,event:c.event})},onDeviceMessage:function(c,a,d){if(c)if(null==a)l&&f.error("---onDeviceMessage:have no data "+c.options.id+" server id \x3d "+e.generateId(c.options));else{d={device:c.options,deviceMessage:a,bytes:d&&d.join?d.join(","):""};var g=a.event||n.EVENTS.ON_DEVICE_MESSAGE;
if(c&&c.isRunAsServer()&&g===n.EVENTS.ON_DEVICE_MESSAGE)this.ctx.getDeviceManager().onDeviceServerMessage({event:n.EVENTS.ON_DEVICE_MESSAGE,data:{data:d}});else this.broadCastMessage(a.event||n.EVENTS.ON_DEVICE_MESSAGE,d)}else f.error("---onDeviceMessage:have no connection object")},onLogMessage:function(c){this.broadCastMessage(n.EVENTS.ON_SERVER_LOG_MESSAGE,c)},onClientDisconnect:function(c){c.mqtt&&(c.mqtt.end(),delete c.mqtt)},onClientConnection:function(c){if(this.mqttManager){var a=this;if(!c)l&&
f.error("DeviceServer::onClientConnection connection null");else if(!c.mqtt){var d=this.mqttManager.createMQTTClient(c.remoteAddress,c.remotePort);d.client=c;c.mqtt=d;d.on("message",function(d,e){e.sourceHost!==c.remoteAddress&&e.sourcePort!==c.remotePort&&a.sendClientMessage(c,{},n.EVENTS.ON_MQTT_MESSAGE,{topic:d,message:e.toString(),host:c.remoteAddress,port:c.remotePort})})}}},start:function(c,k){this.profile=k;this.options=r.mixin(this.options,c);this.clients=[];var d=this,e=this.options.port,
g=this.options.host;this.subscribe(n.EVENTS.ON_SERVER_LOG_MESSAGE,this.onLogMessage,this);if(e){this.initLogger(k.debug);this.log("Socket server running in "+e,"socket_server");var b={heartbeat_delay:1E3};l||(b.log=function(){});var b=a.createServer(b),h=m.createServer(this._handler);b.installHandlers(h);h.listen(e,g);this._handleSocketEmits(b);this.publish(n.EVENTS.ON_WEBSOCKET_START,{socket_server:{port:e,socket_handler:b}},this);b.on("connection",function(c){var a=d.clients.push(c);l&&f.log("on device server client connection "+
a);d.onClientConnection(c);c.on("close",function(){l&&f.info("close client connection "+a);d.onClientDisconnect(c);d.clients.remove(c)})});return!0}f.error("Port must be provided into options");return!1},_handleSocketEmits:function(c){var a=this.options.port,e=this;c.on("connection",function(c){e.socket=c;q.publish(n.EVENTS.ON_WEBSOCKET_CONNECTION,{connection:{port:a,socket_handler:c}},this);c.on("data",function(a){_.isString(a)&&(a=d.fromJson(a));a.manager_command?e.handleManagerCommand(a,c):e.handleDeviceCommand(a,
c)});c.on("close",function(){})})}})})},"nxapp/model/Connection":function(){define("dcl/dcl xide/model/Base xide/mixins/EventedMixin xide/encoding/MD5 xide/utils xide/types".split(" "),function(p,r,n,q,b,m){function a(a,h){var f=a[a.deviceScope],d=a[a.driverScope];if(!f&&h){var e=h.ctx.getDeviceManager();if(e){var l=e.getDeviceById(a.id);l&&(d=e.toDeviceControlInfo(l),f=d[d.deviceScope],d=d[d.driverScope])}}f=b.replaceAll("/","",f+d);f=b.replaceAll("\\","",f);return q(JSON.stringify({protocol:a.protocol,
port:a.port,host:a.host,hash:f,isServer:a.driverOptions&1<<m.DRIVER_FLAGS.SERVER,runAsServer:a.driverOptions&1<<m.DRIVER_FLAGS.RUNS_ON_SERVER}),1)}p=p([n.dcl],{connected:!1,__registered:!1,declaredClass:"nxapp/model/Connection",client:null,options:null,socket:null,id:null,toString:function(){var a=this.options;return a.deviceScope+"://"+a.host+":"+a.port+"@"+a.protocol+"@"+(this.isServer()?"server":"")},constructor:function(g,h){this.client=g;this.options=h;b.mixin(this,{protocol:h.protocol,port:h.port,
host:h.host});this.id=a(h);g.connection=this},isServer:function(){return this.options.driverOptions&1<<m.DRIVER_FLAGS.SERVER},isRunAsServer:function(){return this.options.driverOptions&1<<m.DRIVER_FLAGS.RUNS_ON_SERVER}});p.generateId=a;p.generateHash=function(a){var h=b.replaceAll("/","",a[a.deviceScope]+a[a.driverScope]),h=b.replaceAll("\\","",h);return{protocol:a.protocol,port:a.port,host:a.host,hash:h,isServer:a.driverOptions&1<<m.DRIVER_FLAGS.SERVER,runAsServer:a.driverOptions&1<<m.DRIVER_FLAGS.RUNS_ON_SERVER}};
return p})},"xide/encoding/MD5":function(){define(["./_base"],function(p){function r(a,b){return a<<b|a>>>32-b}function n(a,b,f,d,e,l){return p.addWords(r(p.addWords(p.addWords(b,a),p.addWords(d,l)),e),f)}function q(a,b,f,d,e,l,c){return n(b&f|~b&d,a,b,e,l,c)}function b(a,b,f,d,e,l,c){return n(b&d|f&~d,a,b,e,l,c)}function m(a,b,f,d,e,l,c){return n(f^(b|~d),a,b,e,l,c)}function a(a,h){a[h>>5]|=128<<h%32;a[(h+64>>>9<<4)+14]=h;for(var f=1732584193,d=-271733879,e=-1732584194,l=271733878,c=0;c<a.length;c+=
16)var k=f,t=d,v=e,A=l,f=q(f,d,e,l,a[c+0],7,-680876936),l=q(l,f,d,e,a[c+1],12,-389564586),e=q(e,l,f,d,a[c+2],17,606105819),d=q(d,e,l,f,a[c+3],22,-1044525330),f=q(f,d,e,l,a[c+4],7,-176418897),l=q(l,f,d,e,a[c+5],12,1200080426),e=q(e,l,f,d,a[c+6],17,-1473231341),d=q(d,e,l,f,a[c+7],22,-45705983),f=q(f,d,e,l,a[c+8],7,1770035416),l=q(l,f,d,e,a[c+9],12,-1958414417),e=q(e,l,f,d,a[c+10],17,-42063),d=q(d,e,l,f,a[c+11],22,-1990404162),f=q(f,d,e,l,a[c+12],7,1804603682),l=q(l,f,d,e,a[c+13],12,-40341101),e=q(e,
l,f,d,a[c+14],17,-1502002290),d=q(d,e,l,f,a[c+15],22,1236535329),f=b(f,d,e,l,a[c+1],5,-165796510),l=b(l,f,d,e,a[c+6],9,-1069501632),e=b(e,l,f,d,a[c+11],14,643717713),d=b(d,e,l,f,a[c+0],20,-373897302),f=b(f,d,e,l,a[c+5],5,-701558691),l=b(l,f,d,e,a[c+10],9,38016083),e=b(e,l,f,d,a[c+15],14,-660478335),d=b(d,e,l,f,a[c+4],20,-405537848),f=b(f,d,e,l,a[c+9],5,568446438),l=b(l,f,d,e,a[c+14],9,-1019803690),e=b(e,l,f,d,a[c+3],14,-187363961),d=b(d,e,l,f,a[c+8],20,1163531501),f=b(f,d,e,l,a[c+13],5,-1444681467),
l=b(l,f,d,e,a[c+2],9,-51403784),e=b(e,l,f,d,a[c+7],14,1735328473),d=b(d,e,l,f,a[c+12],20,-1926607734),f=n(d^e^l,f,d,a[c+5],4,-378558),l=n(f^d^e,l,f,a[c+8],11,-2022574463),e=n(l^f^d,e,l,a[c+11],16,1839030562),d=n(e^l^f,d,e,a[c+14],23,-35309556),f=n(d^e^l,f,d,a[c+1],4,-1530992060),l=n(f^d^e,l,f,a[c+4],11,1272893353),e=n(l^f^d,e,l,a[c+7],16,-155497632),d=n(e^l^f,d,e,a[c+10],23,-1094730640),f=n(d^e^l,f,d,a[c+13],4,681279174),l=n(f^d^e,l,f,a[c+0],11,-358537222),e=n(l^f^d,e,l,a[c+3],16,-722521979),d=n(e^
l^f,d,e,a[c+6],23,76029189),f=n(d^e^l,f,d,a[c+9],4,-640364487),l=n(f^d^e,l,f,a[c+12],11,-421815835),e=n(l^f^d,e,l,a[c+15],16,530742520),d=n(e^l^f,d,e,a[c+2],23,-995338651),f=m(f,d,e,l,a[c+0],6,-198630844),l=m(l,f,d,e,a[c+7],10,1126891415),e=m(e,l,f,d,a[c+14],15,-1416354905),d=m(d,e,l,f,a[c+5],21,-57434055),f=m(f,d,e,l,a[c+12],6,1700485571),l=m(l,f,d,e,a[c+3],10,-1894986606),e=m(e,l,f,d,a[c+10],15,-1051523),d=m(d,e,l,f,a[c+1],21,-2054922799),f=m(f,d,e,l,a[c+8],6,1873313359),l=m(l,f,d,e,a[c+15],10,
-30611744),e=m(e,l,f,d,a[c+6],15,-1560198380),d=m(d,e,l,f,a[c+13],21,1309151649),f=m(f,d,e,l,a[c+4],6,-145523070),l=m(l,f,d,e,a[c+11],10,-1120210379),e=m(e,l,f,d,a[c+2],15,718787259),d=m(d,e,l,f,a[c+9],21,-343485551),f=p.addWords(f,k),d=p.addWords(d,t),e=p.addWords(e,v),l=p.addWords(l,A);return[f,d,e,l]}p.MD5=function(b,h){var f=h||p.outputTypes.Base64,d=a(p.stringToWord(b),8*b.length);switch(f){case p.outputTypes.Raw:return d;case p.outputTypes.Hex:return p.wordToHex(d);case p.outputTypes.String:return p.wordToString(d);
default:return p.wordToBase64(d)}};p.MD5._hmac=function(b,h,f){f=f||p.outputTypes.Base64;var d=p.stringToWord(h);16<d.length&&(d=a(d,8*h.length));var e=[];h=[];for(var l=0;16>l;l++)e[l]=d[l]^909522486,h[l]=d[l]^1549556828;b=a(e.concat(p.stringToWord(b)),512+8*b.length);b=a(h.concat(b),640);switch(f){case p.outputTypes.Raw:return b;case p.outputTypes.Hex:return p.wordToHex(b);case p.outputTypes.String:return p.wordToString(b);default:return p.wordToBase64(b)}};return p.MD5})},"xide/encoding/_base":function(){define(["dojo/_base/lang"],
function(p){return{outputTypes:{Base64:0,Hex:1,String:2,Raw:3},addWords:function(p,n){var q=(p&65535)+(n&65535);return(p>>16)+(n>>16)+(q>>16)<<16|q&65535},stringToWord:function(p){for(var n=[],q=0,b=8*p.length;q<b;q+=8)n[q>>5]|=(p.charCodeAt(q/8)&255)<<q%32;return n},wordToString:function(p){for(var n=[],q=0,b=32*p.length;q<b;q+=8)n.push(String.fromCharCode(p[q>>5]>>>q%32&255));return n.join("")},wordToHex:function(p){for(var n=[],q=0,b=4*p.length;q<b;q++)n.push("0123456789abcdef".charAt(p[q>>2]>>
q%4*8+4&15)+"0123456789abcdef".charAt(p[q>>2]>>q%4*8&15));return n.join("")},wordToBase64:function(p){for(var n=[],q=0,b=4*p.length;q<b;q+=3)for(var m=(p[q>>2]>>q%4*8&255)<<16|(p[q+1>>2]>>(q+1)%4*8&255)<<8|p[q+2>>2]>>(q+2)%4*8&255,a=0;4>a;a++)8*q+6*a>32*p.length?n.push("\x3d"):n.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(m>>6*(3-a)&63));return n.join("")},stringToUtf8:function(p){for(var n="",q=-1,b,m;++q<p.length;)b=p.charCodeAt(q),m=q+1<p.length?p.charCodeAt(q+
1):0,55296<=b&&56319>=b&&56320<=m&&57343>=m&&(b=65536+((b&1023)<<10)+(m&1023),q++),127>=b?n+=String.fromCharCode(b):2047>=b?n+=String.fromCharCode(192|b>>>6&31,128|b&63):65535>=b?n+=String.fromCharCode(224|b>>>12&15,128|b>>>6&63,128|b&63):2097151>=b&&(n+=String.fromCharCode(240|b>>>18&7,128|b>>>12&63,128|b>>>6&63,128|b&63));return n}}})},"nxapp/server/FileServer":function(){define("dojo/_base/declare dojo/_base/lang xide/types xide/factory nxapp/server/WebSocket nxapp/utils/_LogMixin dojo/node!http dojo/node!sockjs".split(" "),
function(p,r,n,q,b,m,a,g){return p("nxapp.server.WebSocket",[b,m],{onFileChanged:function(a){this.broadCastMessage(n.EVENTS.ON_FILE_CHANGED,{path:a.path,modulePath:a.modulePath,mask:a.mask,type:a.type})},start:function(b,f){this.profile=f;this.options=r.mixin(this.options,b);this.clients=[];var d=this;q.subscribe(n.EVENTS.ON_FILE_CHANGED,this.onFileChanged,this);var e=this.options.port,l=this.options.host;if(e){this.initLogger(f.debug);this.log("File Socket server running in "+e,"socket_server");
var c={};this.showDebugMsg("socket_server")||(c.log=function(){});var c=g.createServer(c),k=a.createServer(this._handler);c.installHandlers(k);k.listen(e,l);this._handleSocketEmits(c);q.publish(n.EVENTS.ON_WEBSOCKET_START,{socket_server:{port:e,socket_handler:c}},this);c.on("connection",function(a){var c=d.clients.push(a);a.on("close",function(){delete d.clients[c]})});return!0}console.error("Port must be provided into options");return!1},_handleSocketEmits:function(a){var b=this.options.port,d=this;
a.on("connection",function(a){d.socket=a;q.publish(n.EVENTS.ON_WEBSOCKET_CONNECTION,{connection:{port:b,socket_handler:a}},this);a.on("close",function(){})})}})})},"nxappmain/nxAppBase":function(){define("dcl/dcl nxapp/utils/FileUtils dojo/node!commander dojo/node!fs dojo/node!os dojo/node!path dojo/node!util xide/factory/Events dojo/has xide/model/Base xide/utils".split(" "),function(p,r,n,q,b,m,a,g,h,f,d){h.add("windows",function(){return"win32"===b.platform()});h.add("osx",function(){return"darwin"===
b.platform()});h.add("linux",function(){return"linux"===b.platform()});h.add("arm",function(){return"arm"===b.arch()});return p(f.dcl,{declaredClass:"nxappmain.nxAppBase",profile:null,commander:null,profilePath:"/nxappmain/profile_device_server.json",getDefaultProfilePath:function(){return process.cwd()+this.profilePath},getProfile:function(a){var d={};a||(a=this.commander.profile&&0<this.commander.profile.length?this.commander.profile:this.getDefaultProfilePath());q.existsSync(a)||(a=process.cwd()+
this.profilePath);var c=r.readFile(a);c?d=dojo.fromJson(c):console.error("have no profile at : "+a);if(c=(c=this.commander.system)?r.resolve(c):null)d.data=c,d.watchr.paths=[c+a.sep+"system",c+a.sep+"workspace"];return d},init:function(){this.commander||(n.version("0.0.1").option("-i, --info","return service profile").option("-f, --file \x3cpath\x3e","run a file").option("-u, --user \x3cpath\x3e","user directory").option("--start \x3cboolean\x3e","start devices").option("--serverSide \x3cboolean\x3e",
"make devices server side").option("-s, --system \x3cname\x3e","path to system scope").option("-j, --jhelp","output options as json").option("-t, --test","enable test mode").option("--mqtt \x3cboolean\x3e","enable or disable MQTT functionality"),this.commander=n,this.commander.allowUnknownOption(!0),this.commander.parse(process.argv));if(n.jhelp){var a=[];n.options.map(function(c){a.push(c)});console.log(JSON.stringify(a));process.exit()}this.profile=this.getProfile(this.profilePath);d.mixin(this.profile,
this.commander);var b=m.resolve(this.profile.system);q.existsSync(b)||(b=process.cwd()+"/data/system",this.profile.system=b,n.system=b);this.profile.user&&(b=m.resolve(this.profile.user),q.existsSync(b)&&(this.profile.user=b));this.commander.start&&(this.profile.start="true"===this.commander.start);this.commander.serverSide&&(this.profile.serverSide="true"===this.commander.serverSide)}})})},"xide/factory/Events":function(){define(["xide/factory","dojo/_base/connect","dojo/_base/lang","dojo/on","dojo/has"],
function(p,r,n,q,b){var m={click:null,dblclick:null,mousedown:null,mouseup:null,mouseover:null,mousemove:null,mouseout:null,keypress:null,keydown:null,keyup:null,focus:null,blur:null,change:null};p.publish=function(a,b,h,f){b=b?_.isString(b)?{message:b}:b:{};h=a;var d=r.publish,e=[];_.isArray(a)||(h=[a]);a=0;for(var l=h.length;a<l;a++){var c=h[a];if(!f||f(c))e=d(c,b)}return e};p.subscribe=function(a,b,h,f){var d=a,e=r.subscribe,l=[];_.isArray(a)||(d=[a]);a=0;for(var c=d.length;a<c;a++)if(d[a]&&(!f||
f(v))){var k=d[a],t=_.isString(k),v=t?k:k.key,k=t?b:k.handler,t=v in m;null!=h?(k=null!=k?k:h[v],t=t?q(h,v,n.hitch(h,k)):e(v,n.hitch(h,k)),t.handler=n.hitch(h,k)):(t=r.subscribe(v,k),t.handler=k);t.type=v;l.push(t)}return l};return p})},"nxapp/manager/Context":function(){define("dcl/dcl ./ConnectionManager xide/manager/ContextBase require nxapp/utils/_console xide/types xide/utils dojo/node!path".split(" "),function(p,r,n,q,b,m,a,g){return p(n,{declaredClass:"nxapp.manager.Context",connectionManager:null,
blockManager:null,deviceServer:null,logManager:null,loadDevices:function(a){b.log("load devices",a);var f=this.getDeviceManager(),d=this.getDriverManager();f.debug();var e=f.getStores()[a.scope],l=a.path;e?e.connected?b.warn("store "+e.scope+" is already connected"):b.info("connecting store "+e.scope):(b.info("connecting store "+a.scope),d.createStore({items:this.getDrivers(g.resolve(l+"/drivers"),"user_drivers")},"user_drivers",!0),f.initStore({items:this.getDevices(g.resolve(l+"/devices"),"user_devices")},
"user_devices",!0))},runFile:function(a){b.log("run file",a)},broadCastMessage:function(b,g){this.getDeviceServer().broadCastMessage(m.EVENTS.ON_RUN_CLASS_EVENT,a.mixin({event:m.EVENTS.ON_RUN_CLASS_EVENT},g))},runClass:function(a){var g=a["class"],d=this;try{q([g],function(e){e=new e(a.args);try{e.run({data:a,clear:function(){this.data.progress=null;this.data.finish=null;this.data.error=null;this.data.data=null},onProgress:function(a,c){this.clear();this.data.progress=a;this.data.data=c;d.broadCastMessage(null,
this.data)},onFinish:function(a,c){this.clear();this.data.finish=a;this.data.data=c;d.broadCastMessage(null,this.data)},onError:function(a,c){this.clear();this.data.error=a;this.data.data=c;d.broadCastMessage(null,this.data)}})}catch(c){b.error("error running class "+g,c),a.error=c.message,d.broadCastMessage(null,a)}})}catch(e){b.error("error loading class "+g,e)}},getDeviceServer:function(){return this.deviceServer},getConnectionManager:function(){return this.connectionManager},initManagers:function(a){this.connectionManager.init(a)},
constructManagers:function(){this.connectionManager=new r({ctx:this})},getLogManager:function(){return this.logManager}})})},"nxapp/manager/ConnectionManager":function(){define("dcl/dcl nxapp/manager/ManagerBase nxapp/utils/_LogMixin nxapp/protocols/Tcp nxapp/protocols/Udp nxapp/protocols/Driver nxapp/protocols/SSH nxapp/protocols/Serial nxapp/protocols/MQTT nxapp/protocols/ProtocolBase nxapp/types/Types xide/factory xide/utils nxapp/utils/_console xide/data/_Base nxapp/model/Connection xide/data/TreeMemory xide/data/ObservableStore dstore/Trackable dojo/_base/declare".split(" "),
function(p,r,n,q,b,m,a,g,h,f,d,e,l,c,k,t,v,A,E,x){return p([r,n],{declaredClass:"nxapp.manager.ConnectionManager",options:null,profile:null,lastUpTime:null,mqttManager:null,pool:[],poolNotFound:-1,store:null,onWakeup:function(){this.lastUpTime=(new Date).getTime();for(var a=0;a<this.pool.length;a++){var c=this.pool[a];c.socket&&c.socket.close&&c.socket.close();c.socket&&c.socket._socket&&c.socket._socket.close&&c.socket._socket.close()}this.pool=[]},init:function(a){this.profile=a;this.initLogger(a.debug);
this.lastUpTime=(new Date).getTime();this.store=new (x("nxapp.data.Store",[v,E,A],{}))({idProperty:"id",Model:t});var c=this;setInterval(function(){var a=(new Date).getTime();if(3E3<a-c.lastUpTime)c.onWakeup();c.lastUpTime=a},1E3)},connect:function(k,l,f,v,n,u){if(!k)return c.error("ConnectionManager::connect : have no host"),null;if(!l)return c.error("ConnectionManager::connect : have no protocol"),null;if(!n)return c.error("ConnectionManager::connect : have no options"),null;u=t.generateId(n,this);
if(u=this.store.getSync(u)){if(!u.isServer()&&!u.isRunAsServer())this.onConnect2(u,!0,!0);return u}var p=u=null;switch(l){case d.PROTOCOL.TCP:u=new q({owner:this,options:n,delegate:this});break;case d.PROTOCOL.UDP:u=new b({owner:this,options:n,delegate:this});break;case d.PROTOCOL.DRIVER:u=new m({owner:this,options:n,delegate:this});break;case d.PROTOCOL.SSH:u=new a({owner:this,options:n,delegate:this});break;case d.PROTOCOL.SERIAL:u=new g({owner:this,options:n,delegate:this});break;case d.PROTOCOL.MQTT:u=
new h({owner:this,options:n,delegate:this})}if(u){k=this.addConnection2(u,n);u.init();u.connection=k;p=u.connect();k.socket=p;e.publish(d.EVENTS.ON_CONNECTION_CREATED,{connection:k},this);if(this.mqttManager)this.mqttManager.onConnectedToDevice(n,u,v);return k}e.publish(d.EVENTS.ON_CONNECTION_ERROR,{connection:{port:f,host:k,protocol:l}},this);return!1},send:function(a,k,e){if(a){var b=a.client;if(b){var l=b._socket;a.client||c.error("connection has no client");if(l){if(!l.writable)return c.error("socket not writable, closing connection"+
a.lastError),this.close(a,!0),!1}else return c.error("have no socket"),!1;a&&a.options&&this.logEx(d.LOG_OUTPUT.SEND_COMMAND+" : "+k,"info","server",d.LOG_OUTPUT.SEND_COMMAND,a);return b.send(k,e)}c.error("send "+k+" have no client")}else c.error("send "+k+" have no connection")},callMethod:function(a,k){k=l.getJson(k);var d=k.method,e=k.args;if(a)if(a.client){if(a.client[d])return a.client[d].apply(a.client,[e,k]);c.error("no such method "+d)}else c.error("call method : connection has no client object");
else c.error("call method : invalid connection")},close:function(a){if(a){a._destroyed=!0;var c=a.client._socket;a.client=null;c&&c._socket&&c._socket.close&&c._socket.close()}},closeAll:function(){var a=this;this.forEachPool(function(c,k){a.close(k)});this.clearPool()},onTimeout:function(a){},onClose:function(a,c){a&&a.options&&(this.logEx(d.LOG_OUTPUT.DEVICE_DISCONNECTED,"info","server",d.LOG_OUTPUT.DEVICE_DISCONNECTED,a),this.publish(d.EVENTS.ON_DEVICE_DISCONNECTED,{device:a.options,connection:a}));
a._destroyed=!0;this.removeConnection(a,c)},onDrain:function(a){},onError:function(a,k,d){d&&c.log(" Error: "+d.host+":"+d.port+"@"+d.protocol,k);a&&(a.lastError=k);this.removeConnection(a,d)},onFinish:function(a,k,d){k=this.connectionExists(a.host,a.port,a.protocol);k!=this.poolNotFound?this.callFeedBack(k,data):c.error("ConnectionManager::onData : cant find pool - reference:"+k+":"+a.host+":"+a.port+":"+a.protocol)},onData:function(a,k,e){try{this.callFeedBack2(a,k,e)}catch(b){c.error("call feedback error : "+
b.message),c.log(b.stack)}a&&a.options&&this.logEx(d.LOG_OUTPUT.RESPONSE+":"+k,"info","server",d.LOG_OUTPUT.RESPONSE,a)},hasFlag:function(a,c){var k=d.LOGGING_FLAGS,e=a.loggingFlags,e=_.isString(e)?l.fromJson(e):e||{},e=e[c];return null!=e&&e&k.FILE?!0:!1},onConnect2:function(a,c,k){if(a.connected){c={device:a.options,isReplay:k};var e=this.ctx.getDeviceServer();this.getConnection2(a.options);e.broadCastMessage(d.EVENTS.ON_DEVICE_CONNECTED,c);this.publish(d.EVENTS.ON_DEVICE_CONNECTED,{device:a.options,
isReplay:k,connection:a});a&&!a.__registered&&(this.registerFeedBack2(a,function(a,c,k){c&&(c.lastResponse=_.isString(c)?c:JSON.stringify(c,null,2));e.onDeviceMessage(a,c,k)}),a.__registered=!0);a&&a.options&&!k&&this.logEx(d.LOG_OUTPUT.ON_DEVICE_CONNECTED,"info","server",d.LOG_OUTPUT.ON_DEVICE_CONNECTED,a);if(a.client&&a.client.onConnect)a.client.onConnect();return a}},logEx:function(a,c,k,d,e){var b=this.ctx.getDeviceServer();if(e&&e.options){var l=e.options;this.hasFlag(l,d)&&b.logEx(a+" "+e.toString(),
c||"info",k||"server",{device:l})}},_onConnect:function(a,k,e,b){c.log("Connected to "+b.declaredClass+":"+a+":"+k+" via "+e+" : ",b.options);if(!b.options)throw c.error("have no options: ",b),Error("Asdf");a={device:{host:a,port:k,protocol:e,options:b?b.options:null}};this.ctx.getDeviceServer().broadCastMessage(d.EVENTS.ON_DEVICE_CONNECTED,a);var l=this.ctx.getDeviceServer();b&&(b.__registered?c.error("already registered"):(this.registerFeedBack2(connection,function(a,c,k){c.lastResponse=""+c;l.onDeviceMessage(a,
c)}),b.__registered=!0))},onHandle:function(a,c){},getNumberOfConnections:function(){return this.pool.length},getDeviceConnection:function(){if(this.getNumberOfConnections())for(var a=0;a<this.pool.length;a++);},addConnection:function(a,c,k,d,e,b,l,g){l=new t(l,a,g);this.store.putSync(l);this.pool.push({socket:a,host:c,port:k,protocol:d,user:e,customFields:b,feedbackTo:[]});return l},addConnection2:function(a,c){var k=new t(a,c);return this.store.putSync(k)},removeConnection:function(a,c,k){var e=
this;a&&(a=this.getConnection2(a.options));a&&(a=this.getConnection2(a.options),this.ctx.getDeviceServer()&&setTimeout(function(){var c={device:a.options,error:a.lastError,stopped:k};e.ctx.getDeviceServer().broadCastMessage(d.EVENTS.ON_DEVICE_DISCONNECTED,c)},1E3),this.store.removeSync(a.id),a._destroyed=!0)},clearPool:function(){this.pool=[]},getConnection:function(a){if(3==arguments.length){for(var c=arguments[0],k=arguments[1],d=arguments[2],e=0;e<this.pool.length;e++){var b=this.pool[e];if(b.host==
c&&b.port==d&&b.protocol==k)return b}return null}return this.pool[a]},getConnection2:function(a){return this.store.getSync(t.generateId(a,this))},getConnectionById:function(a){return this.store.getSync(a)},registerFeedBack2:function(a,c){a&&(a.feedbackTo||(a.feedbackTo=[]),a&&0<a.feedbackTo.length||a.feedbackTo.push(c))},_registerFeedBack:function(a,k){var d=this.getConnection(a);null==d?c.error("cant find connection for pool ref:"+a):d&&0<d.feedbackTo.length||d.feedbackTo.push(k)},callFeedBack:function(a,
c){throw Error();},callFeedBack2:function(a,k,d){if(a)if(a.feedbackTo&&0!=a.feedbackTo.length)for(var e=0;e<a.feedbackTo.length;e++)a.feedbackTo[e](a,k,d);else c.error("-- call feed back: have no feedback targets",a.options.host);else c.error("-- call feed back: have no connection")},connectionExists:function(a,c,k){var d=this.poolNotFound;_.each(this.pool,function(e,b){e&&e.host===a&&e.port===c&&e.protocol===k&&(d=b)});return d},forEachPool:function(a){_.each(this.pool,function(c,k){a(c,k)})}})})},
"nxapp/manager/ManagerBase":function(){define(["dcl/dcl","xide/model/Base","xide/mixins/EventedMixin"],function(p,r,n){r=p([r.dcl,n.dcl],{declaredClass:"nxapp.manager.ManagerBase",ctx:null,profile:null,init:function(q){this.profile=q}});p.chainAfter(r,"init");return r})},"nxapp/protocols/Tcp":function(){define("dcl/dcl nxapp/utils nxapp/protocols/ProtocolBase dojo/node!net dojo/node!child_process dojo/node!util dojo/node!path xide/mixins/EventedMixin xide/mixins/ReloadMixin xide/types dojo/Deferred xcf/model/Variable".split(" "),
function(p,r,n,q,b,m,a,g,h,f,d,e){p=p(n,{declaredClass:"nxapp.protocols.Tcp",_socket:null,protocolName:"tcp",delegate:null,driverInstance:null,_handleSocketEmits:function(a){var c=this;c.clients=[];var k=this.blockScope,d=k.getVariable("value"),e=k.getVariables({group:f.BLOCK_GROUPS.CF_DRIVER_RESPONSE_VARIABLES}),b=k.getBlocks({group:f.BLOCK_GROUPS.CF_DRIVER_RESPONSE_BLOCKS});a.on("connection",function(a){c.socket=a;c.clients.push(a);a.on("data",function(a){a=[{string:a.toString(),bytes:a.join(",")}];
for(var c=0;c<a.length;c++)if(0!=a[c].length){d.value=new String(a[c].string);d.value.setBytes(a[c].bytes);for(var l=0;l<e.length;l++){var g=e[l];if("value"!=e[l].title){var h=null,h=d.value;"number"!=typeof h&&(h=""+h,h="'"+h+"'");g.target&&"None"!=g.target&&null!=h&&"null"!=h&&"'null'"!=h&&(g=k.getVariable(g.target))&&(g.value=h,this.publish(f.EVENTS.ON_DRIVER_VARIABLE_CHANGED,{item:g,scope:k,owner:this,save:!1,source:f.MESSAGE_SOURCE.BLOX}))}}for(l=0;l<a.length;l++)if(g=a[l],_.isObject(g)&&g.src&&
(h=k.getBlockById(g.src))&&h.onData)h.onData(g);for(l=0;l<b.length;l++)if(h=b[l],0!=h.enabled){h.override={args:[d.value]};try{k.solveBlock(b[l],{highlight:!1})}catch(m){console.log("----solving response block crashed ",m),console.trace()}}}});a.on("close",function(){})})},_creatingServer:!1,makeServer:function(){if(!this._creatingServer){this._creatingServer=!0;try{var a=this.options,c=a.port,k=a.host,d=this;this.owner.ctx.getDriverManager().createDriverInstance(a).then(function(a){d.blockScope=
a.blockScope;d.driverInstance=a.driverInstance});var e=new q.Server;e.listen(c,k);d._socket=e;e.writable=!0;d._handleSocketEmits(e);d.connection.connected=!0;d.delegate.onConnect2(d.connection);this.subscribe(f.EVENTS.ON_DEVICE_CONNECTED,this.onDeviceConnected);this.subscribe(f.EVENTS.ON_DEVICE_DISCONNECTED,this.onDeviceDisconnected)}catch(b){console.error("error creating server",b)}return this}},connections:null,onDeviceConnected:function(a){if(a=a.connection){var c=a.options,k=this.options;this.connections||
(this.connections=[]);a.id!==this.connection.id&&(this.delegate.getConnectionById(a.id)&&k.host===c.host&&k.port===c.port&&k.protocol===c.protocol&&!a.isServer()?-1===this.connections.indexOf(a)&&this.connections.push(a):a.isServer())}},onDeviceDisconnected:function(a){if(a=a.connection)this.connections||(this.connections=[]),-1!==this.connections.indexOf(a)&&this.connections.remove(a)},connect:function(){if(this.isServer())return this.makeServer();var a=this.options,c=this.options.port,k=this.options.host;
this.clients=[];this._socket=new q.Socket(r.mixin({allowHalfOpen:!0,writable:!0,readable:!0},a.options));var d=this;this._socket.connect(c,k,function(){d.connection.connected=!0;d.delegate.onConnect2(d.connection)});this._socket.setNoDelay(!0);this._socket.setKeepAlive(!0,0);this._socket.owner=this;this._setupEventListeners(this._socket,this.delegate);return this},broadCastMessage:function(a,c){var k=this;this.connections&&_.each(this.connections,function(a){a&&a._destroyed&&k.connections.remove(a);
if(a)if(a.client)a.client.delegate.onData(a,c.toString(),c);else console.error("not at a real connection",a);else console.error("invalid connection",a)})},send:function(a){null==a?console.error("TCP : invalid command"):(a=r.bufferFromDecString(a),a=new Buffer(a),this.isServer()?this.broadCastMessage(f.EVENTS.ON_DEVICE_MESSAGE,a):this._socket.write(a))},destroy:function(){this.blockScope&&this.blockScope.destroy();this.driverInstance&&this.driverInstance.destroy();delete this.blockScope;delete this.driverInstance;
delete this.connections;delete this.clients;delete this._socket;this._destroyed=!0},close:function(){this.isServer()?(this._socket.close(),this.destroy()):this._socket.end()}});p.net=q;return p})},"nxapp/protocols/ProtocolBase":function(){define("dcl/dcl xide/model/Base xide/types xide/utils nxapp/utils/_LogMixin xide/mixins/ReloadMixin".split(" "),function(p,r,n,q,b,m){r=p([r.dcl,b,m.dcl],{onReloaded:function(){console.error("on reloaded")},options:null,declaredClass:"nxapp.protocols.ProtocolBase",
protocolName:"undefined",debug_connection:"protocol_connection",debug_messages:"protocol_messages",delegate:null,connection:null,_setupEventListeners:function(a,b){var h=this,f=h.connection;a.handle=function(a){b.onHandle(f,a)};a.on("data",function(a){b.onData(f,a.toString(),a);for(var e=0;e<a.length;e++);});b||(console.error("have no handler"),q.stack());f||(console.error("have no connection"),q.stack());a.on("error",function(a){h.isDebug()&&console.error("socket error : ",a);b.onError(f,a)});a.on("drain",
function(){b.onDrain(f)});a.on("timeout",function(){b.onTimeout(f)});a.on("close",function(a){b.onClose(f,a)})},isDebug:function(){var a=this.connection;return a&&(a=a.options)&&(a=a.driverOptions)&&a&1<<n.DRIVER_FLAGS.DEBUG?!0:!1},isServer:function(){var a=this.connection;return a&&(a=a.options)&&(a=a.driverOptions)&&a&1<<n.DRIVER_FLAGS.SERVER?!0:!1},runAsServer:function(){var a=this.connection;return a&&(a=a.options)&&(a=a.driverOptions)&&a&1<<n.DRIVER_FLAGS.RUNS_ON_SERVER?!0:!1},_defaultOptions:function(){return{port:23,
text_encoding:"utf8",end_of_command:"\r"}},toString:function(a,b){var h=q.bufferFromDecString(a);return(new Buffer(h)).toString(b)},init:function(){this.initLogger(this.options.debug);this.initReload();var a=this;this.subscribe(n.EVENTS.ON_MODULE_RELOADED,function(b){a.modulePath&&b.module&&a.modulePath===b.module&&(a.mergeFunctions(a,b.newModule.prototype),a.onReloaded())})},mergeFunctions:function(a,b){for(var h in b)"constructor"!==h&&"inherited"!==h&&_.isFunction(b[h])&&(a[h]=null,a[h]=b[h],console.log("update : "+
h))},logConnection:function(a){this.log(a,this.debug_connection)},logMessages:function(a){this.log(a,this.debug_messages)},send:function(a){},onConnect:function(){},destroy:function(){}});p.chainAfter(r,"onConnect");p.chainAfter(r,"init");p.chainAfter(r,"close");p.chainAfter(r,"destroy");return r})},"xide/mixins/ReloadMixin":function(){define(["xdojo/declare","dcl/dcl","xide/types","xide/utils","xide/mixins/EventedMixin"],function(p,r,n,q,b){var m={_mergeFunctions:!0,_mergeMissingVariables:!0,isInstanceOf_:function(a){try{if(!!this instanceof
a||this.isInstanceOf&&this.isInstanceOf(a))return!0;var b=q.getAt(this,"constructor._meta.bases",[]),h=a.prototype.declaredClass;return _.findWhere(b,function(d){return d==a||q.getAt(d,"superclass.declaredClass")===h||q.getAt(d,"prototype.declaredClass")===h})}catch(f){console.log("ReloadMixin :: this.isInstanceOf_ crashed "+f)}return!1},mergeFunctions:function(a,b){for(var h in b)"constructor"!==h&&"inherited"!==h&&(_.isFunction(b[h])&&(a[h]=null,a[h]=b[h]),_.isArray(b[h])&&null==a[h]&&(a[h]=b[h]))},
onModuleReloaded:function(a){var b=a.newModule;if(b&&b.prototype&&!a._processed){var h=b.prototype,f=h.declaredClass,d=!1,e=this.declaredClass;f&&(f&&e&&(d=q.replaceAll("/",".",e)===q.replaceAll("/",".",f)),d?(this.mergeFunctions(this,h),this.onReloaded&&(a._processed=!0,this.onReloaded(b))):a.module&&q.replaceAll("//","/",a.module)===e&&this.mergeFunctions(this,h))}},initReload:function(){this.subscribe(n.EVENTS.ON_MODULE_RELOADED)}};p=p(null,m);p.Impl=m;p.dcl=r(b.dcl,m);return p})},"xcf/model/Variable":function(){define(["dcl/dcl",
"xide/types","xblox/model/variables/Variable"],function(p,r,n){return p(n,{declaredClass:"xcf.model.Variable",hasInlineEdits:!0,gui:"off",cmd:"off",save:!1,target:"None",name:"No Title",value:-1,observed:["value","initial","name"],solve:function(){var q="";if("processVariables"==this.group){var b=this.scope.getVariable("value");b&&(b=b.value,this.isNumber(b)||(b="'"+b+"'"),q="var value \x3d "+b+";\n")}return this.scope.parseExpression(q+this.getValue(),!0)},canEdit:function(){return!0},canDisable:function(){return!1},
getFields:function(){var q=this.getDefaultFields();q.push(this.utils.createCI("title",13,this.name,{group:"General",title:"Name",dst:"name"}));var b=this;q.push(this.utils.createCI("value",this.types.ECIType.EXPRESSION,this.value,{group:"General",title:"Value",dst:"value",widget:{allowACECache:!0,showBrowser:!1,showSaveButton:!0,editorOptions:{showGutter:!1,autoFocus:!1,hasConsole:!1},aceOptions:{hasEmmet:!1,hasLinking:!1,hasMultiDocs:!1},item:this},delegate:{runExpression:function(m,a,g){if("processVariables"==
b.group){var h=b.scope.getVariable("value"),f="";h&&(h=h.value,b.isNumber(h)||(h="'"+h+"'"),f="var value \x3d "+h+";\n")}return b.scope.expressionModel.parse(b.scope,f+m,!1,a,g)}}}));q.push(this.utils.createCI("flags",5,this.flags,{group:"General",title:"Flags",dst:"flags",data:[{value:4096,label:"Dont parse",title:"Do not parse the string and use it as is"},{value:2048,label:"Expression",title:"Parse it as Javascript"}],widget:{hex:!0}}));return q},onChangeField:function(q,b,m){"value"===q&&this.publish(r.EVENTS.ON_DRIVER_VARIABLE_CHANGED,
{item:this,scope:this.scope,save:!1,source:r.MESSAGE_SOURCE.GUI})}})})},"xblox/model/variables/Variable":function(){define(["dcl/dcl","xide/types","xblox/model/Block"],function(p,r,n){return p(n,{declaredClass:"xblox.model.variables.Variable",name:null,value:null,register:!0,readOnly:!1,initial:null,isVariable:!0,flags:4096,getValue:function(){return this.value},canDisable:function(){return!1},canMove:function(){return!1},getIconClass:function(){return"el-icon-quotes-alt"},getBlockIcon:function(){return'\x3cspan class\x3d"'+
this.icon+'"\x3e\x3c/span\x3e '},toText:function(){return"\x3cspan class\x3d'text-primary'\x3e"+this.getBlockIcon()+this.makeEditable("name","right","text","Enter a unique name","inline")+"\x3c/span\x3e"},solve:function(){this.scope.parseExpression(this.getValue(),!0);return[]},getFields:function(){var q=this.getDefaultFields(),b=this;q.push(this.utils.createCI("title",r.ECIType.STRING,this.name,{group:"General",title:"Name",dst:"name"}));q.push(this.utils.createCI("value",r.ECIType.EXPRESSION,this.value,
{group:"General",title:"Value",dst:"value",delegate:{runExpression:function(m,a,g){return b.scope.expressionModel.parse(b.scope,m,!1,a,g)}}}));return q}})})},"xblox/model/Block":function(){define("dcl/dcl dojo/Deferred dojo/_base/lang dojo/has xblox/model/ModelBase xide/factory xide/utils xide/types xdojo/has!xblox-ui?xblox/model/Block_UI".split(" "),function(p,r,n,q,b,m,a,g,h){function f(a,e){for(var b=0;b<e.length;b++)if(a.id===e[b].id)return b}b=[b];b.push(p(null,{getStatusIcon:function(){},getStatusClass:function(){},
setStatusClass:function(){},onActivity:function(){},onRun:function(){},onFailed:function(){},onSuccess:function(){},getIconClass:function(){}}));a.mixin(g,{BLOCK_FLAGS:{NONE:0,ACTIVE:1,SCRIPT:2,RESERVED1:4,USEFUNCTION:8,RESERVED2:16,SINGLE:32,WAITSFORMESSAGE:64,VARIABLEINPUTS:128,VARIABLEOUTPUTS:256,VARIABLEPARAMETERINPUTS:512,VARIABLEPARAMETEROUTPUTS:1024,TOPMOST:16384,BUILDINGBLOCK:32768,MESSAGESENDER:65536,MESSAGERECEIVER:131072,TARGETABLE:262144,CUSTOMEDITDIALOG:524288,RESERVED0:1048576,EXECUTEDLASTFRAME:2097152,
DEACTIVATENEXTFRAME:4194304,RESETNEXTFRAME:8388608,INTERNALLYCREATEDINPUTS:16777216,INTERNALLYCREATEDOUTPUTS:33554432,INTERNALLYCREATEDINPUTPARAMS:67108864,INTERNALLYCREATEDOUTPUTPARAMS:134217728,INTERNALLYCREATEDLOCALPARAMS:1073741824,ACTIVATENEXTFRAME:268435456,LOCKED:536870912,LAUNCHEDONCE:2147483648},BLOCK_CALLBACKMASK:{PRESAVE:1,DELETE:2,ATTACH:4,DETACH:8,PAUSE:16,RESUME:32,CREATE:64,RESET:4096,POSTSAVE:256,LOAD:512,EDITED:1024,SETTINGSEDITED:2048,READSTATE:4096,NEWSCENE:8192,ACTIVATESCRIPT:16384,
DEACTIVATESCRIPT:32768,RESETINBREAKPOINT:65536,RENAME:131072,BASE:14,SAVELOAD:769,PPR:304,EDITIONS:3072,ALL:4294967295}});b=p(b,{declaredClass:"xblox.model.Block",scopeId:null,isCommand:!1,outlet:0,_destroyed:!1,enabled:!0,serializeMe:!0,name:null,shareTitle:"",sharable:!1,items:null,parent:null,_return:null,_lastResult:null,_deferredObject:null,_currentIndex:0,_lastRunSettings:null,_onLoaded:!1,beanType:"BLOCK",override:{},ignoreSerialize:"_didSubscribe _currentIndex _deferredObject _destroyed _return parent __started ignoreSerialize _lastRunSettings _onLoaded beanType sharable override virtual _scenario _didRegisterSubscribers additionalProperties renderBlockIcon serializeMe _statusIcon _statusClass hasInlineEdits _loop help owner _lastCommand allowActionOverride canDelete isCommand lastCommand autoCreateElse _postCreated".split(" "),
_parseString:function(d,e,b,c){try{e=e||this._lastSettings||{};c=c||e.flags||g.CIFLAG.EXPRESSION;var k=this.scope,f=!(c&g.CIFLAG.DONT_PARSE),h=c&g.CIFLAG.EXPRESSION;c&g.CIFLAG.TO_HEX&&(d=a.to_hex(d));!1!==f&&(d=a.convertAllEscapes(d,"none"));var m=e.override||this.override||{},q=m&&m.variables?m.variables:null,n="",n=h&&!1!==f?k.parseExpression(d,null,q,null,null,null,m.args,c):""+d}catch(p){console.error(p)}return n},postCreate:function(){},childrenByClass:function(a){for(var e=this.getChildren(),
b=[],c=0;c<e.length;c++){var k=e[c];k.isInstanceOf(a)&&b.push(k)}return b},childrenByNotClass:function(a){for(var e=this.getChildren(),b=[],c=0;c<e.length;c++){var k=e[c];k.isInstanceOf(a)||b.push(k)}return b},getInstance:function(){var a=this.scope.instance;return a?a:null},pause:function(){},mergeNewModule:function(a){for(var e in a){var b=a[e];b&&_.isFunction(b)&&(this[e]=b)}},__onReloaded:function(d){this.mergeNewModule(d.prototype);d=this.declaredClass;(d=n.getObject(a.replaceAll("/",".",d))||
n.getObject(d))&&d.prototype&&d.prototype.solve&&this.mergeNewModule(d.prototype)},reparent:function(){if(!this)return!1;if(!this.getParent()){var a=this.next(null,1)||this.next(null,-1);a&&(this.group=null,a._add(this))}},unparent:function(a,b){if(!this)return!1;var l=this.getParent();l&&l.removeBlock&&l.removeBlock(this,!1);this.group=a;this.parent=this.parentId=null;!1!==b&&(this._place(null,-1,null),this._place(null,-1,null))},move:function(a){if(!this)return!1;var b=this.getParent(),l=null;if(b){l=
b[b._getContainer(this)];if(!l||2>l.length||!this.containsItem(l,this))return!1;b=this.indexOf(l,this);if(0>b+a)return!1;var c=l[b+a];if(!c)return!1;l[b+a]=this;l[b]=c}else this._place(null,a);return!0},_place:function(a,b,l){var c=this._store,k=this;(a=a||k.next(null,b))?(a=_.isString(a)?c.getSync(a):a,k=_.isString(k)?c.getSync(k):k,l=l||c.storage.fullData,b=-1==b?0:1,l.remove(k),-1==b&&(b=0),l.splice(Math.max(f(a,l)+b,0),0,k),c._reindex()):console.error("have no next",this)},index:function(){var a=
this.getParent(),b=null,l=this.group,b=this._store;if(a)return b=a[a._getContainer(this)]||[],b=b.filter(function(a){return a.group===l}),!b||2>b.length||!this.containsItem(b,this)?!1:this.indexOf(b,this);b=b.storage.fullData;b=b.filter(function(a){return a.group===l});return this.indexOf(b,this)},numberOfParents:function(){var a=0,b=this.getParent();b&&(a++,a+=b.numberOfParents());return a},getTopRoot:function(){var a=this.getParent();if(a){var b=a.getParent();b&&(a=b)}return a},next:function(a,
b){function l(a,b,d){var e=a.indexOf(b,a);if(e=b[e+d*c]){if(!e.parentId&&e.group&&e.group===a.group)return e;c++;return l(a,b,d)}return null}var c=1;a=a||this._store.storage.fullData;return l(this,a,b)},getParent:function(){return this.parentId?this.scope.getBlockById(this.parentId):null},getScope:function(){var a=this.scope;if(this.scopeId&&0<this.scopeId.length){var b=a.owner;b&&b.hasScope&&(b.hasScope(this.scopeId)?a=b.getScope(this.scopeId):console.error("have scope id but cant resolve it",this))}return a},
canAdd:function(){return null},getTarget:function(){var a=this._targetReference;if(a)return a;var b=this.getParent();b&&b.getTarget&&(a=b.getTarget());return a},addToEnd:function(a,b){b&&null!=a.length&&null!=b.length&&a.push.apply(a,b);return a},removeBlock:function(a,b){a&&(!1!==b&&a.empty&&a.empty(),!1!==b&&delete a.items,a.parent=null,this.items&&this.items.remove(a))},_getContainer:function(a){return"items"},empty:function(a){try{this._empty(a)}catch(b){debugger}},_empty:function(a){if(a=a||
this.items)for(var b=0;b<a.length;b++){var l=a[b];l&&l.empty&&l.empty();l&&this.scope&&this.scope.blockStore&&this.scope.blockStore.remove(l.id)}},containsItem:function(a,b){for(var l=a.length;l--;)if(a[l].id===b.id)return!0;return!1},indexOf:function(a,b){for(var l=a.length;l--;)if(a[l].id===b.id)return l;return-1},_getBlock:function(a){try{if(!this||!this.parentId)return!1;var b=this.scope.getBlockById(this.parentId);if(!b)return null;var l=b[b._getContainer(this)];if(!l||2>l.length||!this.containsItem(l,
this))return null;var c=this.indexOf(l,this);if(0>c+a)return!1;var k=l[c+a];if(k)return k}catch(g){debugger}return null},getPreviousBlock:function(){return this._getBlock(-1)},getNextBlock:function(){return this._getBlock(1)},_getPreviousResult:function(){var a=this.getPreviousBlock()||this.getParent();return a&&null!=a._lastResult?this.isArray(a._lastResult)?a._lastResult:[a._lastResult]:null},getPreviousResult:function(){var a=null;if((a=(a=this.getPreviousBlock())&&a._lastResult&&a.enabled?a:this.getParent())&&
!a._lastResult){var b=a.getParent();b&&(a=b)}return a&&null!=a._lastResult?(this.isArray(a._lastResult),a._lastResult):null},_getArg:function(a,b){var l=parseFloat(a);return isNaN(l)?"true"===a||"false"===a?"true"===a?!0:!1:a&&b&&_.isString(a)?"'"+a+"'":a:l},getArgs:function(b){var e=[];b=b||{};var l=b.args||this._get("args");b.override&&b.override.args&&(l=b.override.args);l&&(e=a.getJson(l,null,!1));if(e&&0==e.length&&l&&l.length&&_.isString(l)){if(-1!==l.indexOf(",")){l=l.split(",");for(b=0;b<
l.length;b++){var c=parseFloat(l[b]);isNaN(c)?"true"===l[b]||"false"===l[b]?e.push(a.toBoolean(l[b])):e.push(l[b]):e.push(c)}return e}e=[this._getArg(l)]}!_.isArray(e)&&(e=[]);b=this.getPreviousResult();null!=b&&(_.isArray(b)&&1==b.length?e.push(b[0]):e.push(b));return e||[l]},remove:function(a){this._destroyed=!0;null!=this.parentId&&null==this.parent&&(this.parent=this.scope.getBlockById(this.parentId));if(this.parent&&this.parent.removeBlock)this.parent.removeBlock(this);else if(a=a||this)a.empty&&
a.empty(),delete a.items,a.parent=null,this.items&&this.items.remove(a)},prepareBlockContructorArgs:function(a){a||(a={});a.id||(a.id=this.createUUID());a.items||(a.items=[])},_add:function(a,b,l,c){var k=null;try{b?(this.prepareBlockContructorArgs(b),k=m.createBlock(a,b,null,c)):null==b&&(k=a);(k.scope=this.scope)&&(k=this.scope.registerBlock(k,c));if(k.id===this.id){console.error("adding new block to our self");debugger}k.parent=this;k.parentId=this.id;var g=l||this._getContainer();if(g)if(this[g]||
(this[g]=[]),-1!=this.indexOf(this[g],k))console.error(" have already "+k.id+" in "+g);else{if(this.id==k.id){console.error("tried to add our self to "+g);return}this[g].push(k)}return k}catch(f){logError(f,"_add")}return null},getStore:function(){return this.getScope().getStore()},add:function(a,b,l){a=this._add(a,b,l);return a.getStore().getSync(a.id)},getContext:function(){return this.scope.instance&&this.scope.instance?this.scope.instance:null},resolved:function(){this._deferredObject&&(this._deferredObject.resolve(),
delete this._deferredObject)},_solve:function(a,b){b=b||{highlight:!1};for(var l=[],c=0;c<this.items.length;c++)this.addToEnd(l,this.items[c].solve(a,b));return l},solve:function(a,b){b=b||{highlight:!1};for(var l=[],c=0;c<this.items.length;c++)this.addToEnd(l,this.items[c].solve(a,b));return l},solveMany:function(a,b){!this._lastRunSettings&&b&&(this._lastRunSettings=b);b=this._lastRunSettings||b;this._currentIndex=0;this._return=[];var l=this[this._getContainer()];if(l.length)return l=this.runFrom(l,
0,b),this.onSuccess(this,b),l;this.onSuccess(this,b);return[]},runFrom:function(a,b,l){var c=this;a=a||this.items;var k=function(b){b._deferredObject.then(function(k){b._lastResult=b._lastResult||k;c._currentIndex++;c.runFrom(a,c._currentIndex,l)})};if(a.length)for(;b<a.length;b++){var g=a[b];if(!0===g.deferred){g._deferredObject=new r;this._currentIndex=b;k(g);this.addToEnd(this._return,g.solve(this.scope,l));break}else this.addToEnd(this._return,g.solve(this.scope,l))}else this.onSuccess(this,l);
return this._return},serializeField:function(a){return-1==this.ignoreSerialize.indexOf(a)},onLoad:function(){},activate:function(){},deactivate:function(){},_get:function(a){if(this.override)return a in this.override?this.override[a]:this[a]},onDidRun:function(){this.override&&(this.override.args&&delete this.override.args,delete this.override)},destroy:function(){this.stop(!0);this.reset();this._destroyed=!0},reset:function(){this._lastSettings={};this._loop&&(clearTimeout(this._loop),this._loop=
null);delete this.override;this.override={}},stop:function(){this.reset()}});b.FLAGS=g.BLOCK_FLAGS;b.EMITS=g.BLOCK_CALLBACKMASK;q("xblox-ui")&&n.mixin(b.prototype,h.prototype);b.prototype.onSuccess||(b.prototype.onSuccess=function(){},b.prototype.onRun=function(){},b.prototype.onFailed=function(){});p.chainAfter(b,"stop");p.chainAfter(b,"destroy");p.chainAfter(b,"onDidRun");return b})},"xblox/model/ModelBase":function(){define(["dcl/dcl","xide/utils","xide/types","xide/mixins/EventedMixin"],function(p,
r,n,q){q=p(q.dcl,{declaredClass:"xblox.model.ModelBase",id:null,description:"",parent:null,parentId:null,group:null,order:0,_store:null,outputs:function(){return[]},takes:function(){return[]},needs:function(){return[]},constructor:function(b){for(var m in b)b.hasOwnProperty(m)&&(this[m]=b[m]);this.id||(this.id=this.createUUID());this.utils=r;this.types=n},keys:function(b){var m=[],a;for(a in b)m.push(a);return m},values:function(b){var m=[],a;for(a in b)m.push(b[a]);return m},toArray:function(){return this.map()},
size:function(){return this.toArray().length},createUUID:function(){var b=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return b()+b()+"-"+b()+"-"+b()+"-"+b()+"-"+b()+b()+b()},canEdit:function(){return!0},getFields:function(){return null},isString:function(b){return"string"==typeof b},isNumber:function(b){return"number"==typeof b},isBoolean:function(b){return"boolean"==typeof b},isObject:function(b){return"object"===typeof b},isArray:function(b){return Array.isArray?Array.isArray(b):
!1},getValue:function(b){var m=parseFloat(b);return isNaN(m)?"true"===b||!0===b?!0:"false"===b||!1===b?!1:b:m},isScript:function(b){return this.isString(b)&&(-1!=b.indexOf("return")||-1!=b.indexOf(";")||-1!=b.indexOf("(")||-1!=b.indexOf("+")||-1!=b.indexOf("-")||-1!=b.indexOf("\x3c")||-1!=b.indexOf("*")||-1!=b.indexOf("/")||-1!=b.indexOf("%")||-1!=b.indexOf("\x3d")||-1!=b.indexOf("\x3d\x3d")||-1!=b.indexOf("\x3e")||-1!=b.indexOf("[")||-1!=b.indexOf("{")||-1!=b.indexOf("}"))},replaceAll:function(b,
m,a){return this.isString(a)?a.split(b).join(m):a},isInValidState:function(){return!0},destroy:function(){}});p.chainAfter(q,"destroy");return q})},"nxapp/protocols/Udp":function(){define(["dcl/dcl","nxapp/protocols/ProtocolBase","dojo/node!dgram","xide/utils"],function(p,r,n,q){return p(r,{declaredClass:"nxapp.protocols.Udp",_socket:null,protocolName:"udp",port:null,host:null,onData:function(b){var m=this.delegate;this.isDebug()&&console.log("UDP: got data : "+this.connection.toString(),b);m.onData(this.connection,
b)},makeServer:function(b,m){var a=this;b.bind(m.port,m.ip);a.isDebug()&&console.log("UDP: Make server, bind socket to "+m.ip+" :: "+m.port);b.on("listening",function(){var g=b.address();a.isDebug()&&console.log("\t UDP Server listening on "+g.address+":"+g.port)});b.on("message",function(b,h){a.isDebug()&&console.log("UDP: on server message "+a.connection.toString()+" - "+h.address+":"+h.port+" - "+b);a.onData(b.toString())})},connect:function(){var b=this.options;this.port=this.options.port;this.host=
this.options.host;this.protocol=this.protocolName;this._socket=n.createSocket("udp4");b=q.getJson(b.options);this._setupEventListeners(this._socket,this.delegate);this._socket.writable=!0;this.connection.connected=!0;this.delegate.onConnect2(this.connection);b&&!0===b.server&&this.makeServer(this._socket,b);return this},send:function(b,m){try{var a=this,g=q.bufferFromDecString(b),h=new Buffer(g),f=h.toString();console.log("UDP - "+a.connection.toString()+" Sending command: "+b+" \x3d "+f+" l\x3d "+
f.length);this._socket.send(h,0,h.length,this.port,this.host,function(b,d){if(b)a.delegate.onError(b)})}catch(d){console.error("crash !")}},close:function(){try{this._socket.close()}catch(b){console.error("Error closing udp connection : ",b)}}})})},"nxapp/protocols/Driver":function(){define("dcl/dcl nxapp/utils nxapp/protocols/ProtocolBase dojo/node!path require xide/types nxapp/utils/_console".split(" "),function(p,r,n,q,b,m,a){n=p(n,{declaredClass:"nxapp.protocols.Driver",_socket:null,protocolName:"driver",
instance:null,constructor:function(a){r.mixin(this,a)},onError:function(b,h,f){this.isDebug()&&a.info("Driver-\x3eonError "+b+" id "+h.params.id+" src "+h.params.src);try{this.delegate.onData(this.connection,r.mixin({cmd:b,event:m.EVENTS.ON_COMMAND_ERROR,result:f.toString()},h),f)}catch(d){a.error("onFinish-Error:",d)}},onConnected:function(){this.isDebug()&&a.log("# driver onConnected "+this.options.host+" : "+this.options.port+" @ "+this.protocolName);this.connection.connected=!0;this.delegate.onConnect2(this.connection)},
onConnect:function(){this._socket.onConnect&&this._socket.onConnect()},onFinish:function(b,h,f){this.isDebug()&&a.info("Driver-\x3eonFinish "+b+" id "+h.params.id+" src "+h.params.src);try{this.delegate.onData(this.connection,r.mixin({cmd:b,event:m.EVENTS.ON_COMMAND_FINISH,result:f.toString()},h),f)}catch(d){a.error("onFinish-Error:",d)}},onProgress:function(b,h,f){this.isDebug()&&a.info("Driver-\x3eonProgress "+b+" id "+h.params.id+" src "+h.params.src);try{this.delegate.onData(this.connection,r.mixin({cmd:b,
event:m.EVENTS.ON_COMMAND_PROGRESS,result:f.toString()},h),f)}catch(d){a.error("onFinish-Progress:",d)}},onPaused:function(b,h,f){this.isDebug()&&a.info("Driver-\x3eonPaused "+b+" id "+h.params.id+" src "+h.params.src);try{this.delegate.onData(this.connection,r.mixin({cmd:b,event:m.EVENTS.ON_COMMAND_PAUSED,result:f.toString()},h),f)}catch(d){a.error("onFinish-Paused:",d)}},onStopped:function(b,h,f){this.isDebug()&&a.info("Driver-\x3eonStopped "+b+" id "+h.params.id+" src "+h.params.src);try{this.delegate.onData(this.connection,
r.mixin({cmd:b,event:m.EVENTS.ON_COMMAND_STOPPED,result:f.toString()},h),f)}catch(d){a.error("onFinish-Stopped:",d)}},_connect:function(b,h,f){b=new b(h);b.owner=this;b.options=this.options;b.delegate=this.delegate;b.connection=this.connection;this.modulePath=b.modulePath=f;b.connect||a.error("have no connect");this._socket=b;this._socket.writable=!0;b.connect()},onData:function(b,h){this.isDebug()&&a.log("Driver on data : ");h=h||new Buffer(b);this.delegate.onData(this.connection,b,h);this._socket&&
this._socket.onData&&this._socket.onData(this.connection,b,h)},connect:function(){var g=this.options;this.isDebug()&&a.log("connect custom driver");if(!g||!g.driver)return a.error("no driver in options",g),this;try{var h=g[g.driverScope],f=h+"/"+g.driver,f=r.replaceAll("/",q.sep,f);q.dirname(f);this.isDebug()&&a.log("load driver : "+f+" drivers root : "+h+" from "+q.dirname(f));var d=this;try{b.undef(f),b([f],function(c){try{d._connect?d._connect(c,g,f):a.error("have no _connect")}catch(b){a.error("error calling connect on "+
f+" | Error "+b.message,b)}})}catch(e){a.error("-----error loading driver module "+f+" :: "+e.message,e),a.error("-----error loading driver module "+f+" :: "+e.message,e.stack),r.stack()}}catch(l){a.error("Error connecting driver "+l.message)}return this},send:function(b,h){null==b?a.error("TCP : invalid command"):(this.isDebug()&&a.log("send : ",b),this._socket.write(b,h))},close:function(){this._socket&&this._socket.destroy()}});p.chainAfter(n,"close");p.chainAfter(n,"destroy");return n})},"nxapp/protocols/SSH":function(){define("dcl/dcl xide/utils nxapp/types/Types nxapp/protocols/ProtocolBase dojo/node!net dojo/node!fs dojo/node!path dojo/node!ssh2 dojo/node!strip-ansi dojo/node!child_process dojo/node!util dojo/node!deferred dojo/node!ansi-to-html dojo/node!ansi_up nxapp/utils/_console".split(" "),
function(p,r,n,q,b,m,a,g,h,f,d,e,l,c,k){var t=!1;return p(q,{declaredClass:"nxapp.protocols.SSH",_socket:null,protocolName:"ssh",instance:null,sshOptions:null,getOptions:function(c,b,e){var d=null;if(e.privateKeyPath){var l=a.resolve(e.privateKeyPath);l?d=m.readFileSync(l).toString():t||this.isDebug()&&k.warn("Sorry, cant resolve file "+e.privateKeyPath)}c={config:!1,host:c,username:e.username,password:e.password,agent:"",agentForward:!1,port:b,proxy:{port:b},ignoreErrors:!1,minimatch:{},debug:t||
this.isDebug()?function(a){k.log("SSH _ DEBUG : "+a)}:null,suppressRemoteErrors:!1,callback:function(){}};d&&(c.privateKey=d);return r.mixin(c,e)},onConnected:function(){t||this.isDebug()&&k.log("# "+this.protocolName+" - Protocol:: onConnected "+this.options.host+" : "+this.options.port+" @ "+this.protocolName);this.connection.connected=!0;this.delegate.onConnect2(this.connection)},onError:function(a,c){this.delegate.onError(this.connection,r.mixin({code:a},c),this.options)},onClose:function(){this.delegate.onClose(this.connection,
this.options)},connect:function(){var a=this.options,c=this;if(!a||!a.driver)return t||c.isDebug()&&k.error("no driver in options",a),this;var b=a.host,e=a.port,a=r.getJson(a.options);!0===a.debug&&(t=!0);var d=this.getOptions(b,e,a),a=function(a){var c={host:a.host,port:a.port,username:a.username,readyTimeout:a.readyTimeout,agentForward:a.agentForward};a.privateKey?(c.privateKey=a.privateKey.trim(),a.passphrase&&(c.passphrase=a.passphrase.trim())):a.password?(c.password=a.password,a.agent&&(c.agent=
a.agent)):c.agent=a.agent;return c}(d);this.sshOptions=d;this.host=b;this.port=e;this.protocol=this.protocolName;t||c.isDebug()&&k.log("SSH-\x3econnecting SSH with");var l=new g;l.on("keyboard-interactive",function(a,c,b,k,e){k.forEach(function(a){-1!==a.prompt.toLowerCase().indexOf("password")&&e([d.password])})});l.on("connect",function(){t||c.isDebug()&&k.log("SSH-\x3eConnection :: connect")});l.on("ready",function(){t||c.isDebug()&&k.log("SSH-\x3eConnection :: ready");var a,b,e;l.once("session",
function(d,l){d().once("pty",function(c,d,l){a=l.rows;b=l.cols;e=l.term;c&&c();t&&k.log("SSH-\x3e pty "+a+" "+b+" "+e)}).once("shell",function(a,b){t||c.isDebug()&&k.log("SSH-\x3eshell")})});c.onConnected()});l.on("error",function(a){t||c.isDebug()&&k.warn("SSH-\x3eConnection - Error :: "+a);a=a.level+":"+a.message;c.onError(a);c.lastError=a});l.on("debug",function(a){t||c.isDebug()&&k.log("SSH-\x3eConnection :: debug :: "+a)});l.on("end",function(){t||c.isDebug()&&k.log("SSH-\x3eConnection :: end");
c.onClose()});l.on("close",function(a){if(a)t||c.isDebug()&&k.log("SSH - Connection :: Close, had Error ");else c.onClose()});l.connect(a);this._socket=l;this._socket.writable=!0;return this},onData:function(a,c){this.isDebug()&&k.log("SSH-\x3eonData",a);this.delegate.onData(this.connection,a||"",c)},onProgress:function(a,c,b){this.isDebug()&&k.info("SSH-\x3eonProgress "+a+" id "+c.params.id+" src "+c.params.src);try{this.delegate.onData(this.connection,r.mixin({cmd:a,event:n.EVENTS.ON_COMMAND_PROGRESS,
result:b.toString()},c),b)}catch(e){k.error("onFinish-Progress:",e)}},onCommandError:function(a,c,b){t||this.isDebug()&&k.log("SSH-\x3eonCommandError "+a+" id "+c.params.id+" src "+c.params.src);try{this.delegate.onData(this.connection,r.mixin({cmd:a,event:n.EVENTS.ON_COMMAND_ERROR},c),b)}catch(e){k.error("---",e)}},onFinish:function(a,c,b){t||this.isDebug()&&k.info("SSH-\x3eonFinish "+a+" id "+c.params.id+" src "+c.params.src);try{this.delegate.onData(this.connection,r.mixin({cmd:a,event:n.EVENTS.ON_COMMAND_FINISH},
c),b)}catch(e){k.error("onFinish-Error:",e)}},execCommand:function(a,b){var d=this._socket,f=this,g=f.sshOptions,h=e(),m=b.params,q=m.id,n=m.wait,p=new l(g.ansiOptions||{}),r=1==g.waitForEOF,G="";if(0===a.length)f.isDebug()&&k.log("SSH-\x3eno more SSH commands, call Defered::resolve");else{var B=a.shift();f.isDebug()&&k.log("SSH-\x3eExecuting :: "+B,b.params);d.exec(B,g,function(e,d){if(e)t||f.isDebug()&&k.log("---error in SSH ",e);else{var l;d.on("data",function(a,e){l=String(a);!0!==g.ansiUp&&1==
g.html?l=p.toHtml(l):1==g.ansiUp&&1==g.html&&(l=c.ansi_to_html(l));f.isDebug()&&k.log("SSH DATA : signal \x3d "+e+" : "+l);if("stderr"!==e)if(r)G+=l,d.lastData=G;else{if(n)f.onProgress(B,b,a);else f.onData(l,a);d.lastData=l}});d.on("end",function(a){t||f.isDebug()&&k.log("SSH-\x3eStream :: EOF, had Error "+(1==d.hadError));l&&"function"===typeof g.callback&&g.callback(l.trim());!0!==d.hadError?(r&&(t||f.isDebug()&&k.error("--------------release data on EOF"),f.onData(d.lastData)),h.resolve(q)):h.reject({id:q,
error:d.lastData})});d.on("exit",function(){t||f.isDebug()&&k.log("SSH-\x3eStream :: exit")});d.on("close",function(c,e){t||f.isDebug()&&k.log("SSH-\x3eStream :: close :: code: "+c+", signal: "+e);127==c&&(d.hadError=!0,h.reject({id:q,error:d.lastData}));g.ignoreErrors||0===c?f.execCommand(a,b):(t||f.isDebug()&&k.error("SSH-\x3eError executing task "+B+" _ code "+c),f.onCommandError(B,b))})}})}return h.promise},send:function(a,c){if(null==a)k.error("SSH: invalid command");else{c=c||{id:r.createUUID()};
a=this.toString(a);t||this.isDebug()&&k.log("SSH-\x3esend : "+a);var b=this.execCommand([a],c),e=this;b.then(function(b){e.onFinish(a,c)},function(b){c.error=b.error;e.onCommandError(a,c)});return b}},close:function(){this._socket&&this._socket.end()}})})},"nxapp/protocols/Serial":function(){define("dcl/dcl xide/utils xide/utils/StringUtils nxapp/types/Types nxapp/protocols/ProtocolBase dojo/node!net dojo/node!path dojo/node!child_process dojo/node!util dojo/node!deferred nxapp/utils/_console xdojo/has dojo/has!serialport?dojo/node!serialport".split(" "),
function(p,r,n,q,b,m,a,g,h,f,d,e,l){var c=!1;return p(b,{declaredClass:"nxapp.protocols.Serial",_socket:null,protocolName:"serial",instance:null,client:null,sshOptions:null,getOptions:function(a,c,b,e){return r.mixin({baudrate:9600,parity:"none",rtscts:!1,xon:!1,xoff:!1,xany:!1,hupcl:!0,cts:!1,dtr:!0,dts:!1,brk:!1,rts:!1,databits:8,stopbits:1,bufferSize:65536,parser:l.parsers.raw},b)},onConnected:function(){this.connection.connected=!0;this.delegate.onConnect2(this.connection)},onError:function(a,
c){this.delegate.onError(this.connection,r.mixin({code:a},c),this.options)},onClose:function(){this.delegate.onClose(this.connection,this.options)},connect:function(){try{var a=this.options;if(!e("serialport"))return this.onError("have serial port");if(!a||!a.driver)return this;var b=this,f=a.host,g=a.port,h=r.getJson(a.options||{});!0===h.debug&&(c=!0);var m=this.getOptions(f,g,h,(a.responseSettings||{}).delimiter);this.serialOptions=m;this.protocol=this.protocolName;var q=new l(f,m);this.client=
q;q.on("error",function(a){b.onError(a.toString(),a)});try{q.on("open",function(a){if(a){var c=a.level+":"+a.message;b.onError(c);b.lastError=c;b.isDebug()&&d.warn("Serial-\x3eConnection - Error :: "+f+":"+a)}else b.onConnected(),q.on("data",function(a){b.isDebug()&&d.log("Serial-\x3eonData "+a.toString());b.onData(a.toString(),a)})})}catch(n){this.isDebug()&&d.error("Serial-\x3econnect error :: code: ",n)}q.on("close",function(a){try{b.isDebug()&&d.log("Serial-\x3eclose :: code: ",a),b.onClose(),
q.close()}catch(c){b.isDebug()&&d.error("Serial-\x3eclose :: code: ",c)}});this._socket={};this._socket.writable=!0;return this}catch(p){return this.isDebug()&&d.error("error connection serial ",p),b.onError(p.message),d.trace(),this}},onData:function(a,c){this.delegate.onData(this.connection,a,c)},onCommandError:function(a,b){c||this.isDebug()&&d.log("SERIAL-\x3eCommandError "+a+" id "+b.id+" src "+b.src);try{this.delegate.onData(this.connection,r.mixin({cmd:a,event:q.EVENTS.ON_COMMAND_ERROR},b))}catch(e){d.error("---",
e)}},onFinish:function(a,b){c||this.isDebug()&&d.log("SERIAL-\x3eonFinish "+a+" id "+b.id+" src "+b.src);try{this.delegate.onData(this.connection,r.mixin({cmd:a,event:q.EVENTS.ON_COMMAND_FINISH},b))}catch(e){d.error("onFinish-Error:",e)}},send:function(a,c){if(null==a)d.error("SERIAL invalid command");else{c||r.createUUID();var b=r.bufferFromDecString(a),b=new Buffer(b),e=b.toString();this.isDebug()&&d.log("Serial - Sending command: "+a+" \x3d "+e+" l\x3d "+e.length);this.client.write(b)}},close:function(){this.client&&
this.client.close()}})})},"xide/utils/StringUtils":function(){define(["dojo/_base/lang","xide/utils","xide/types","dojo/json","xide/lodash"],function(p,r,n,q,b){function m(a){var c="";a=parseInt(a,16);65535>=a?c+=String.fromCharCode(a):1114111>=a?(a-=65536,c+=String.fromCharCode(55296|a>>10)+String.fromCharCode(56320|a&1023)):c+="hex2Char error: Code point out of range: "+g(a);return c}function a(a){var c="";65535>=a?c+=String.fromCharCode(a):1114111>=a?(a-=65536,c+=String.fromCharCode(55296|a>>10)+
String.fromCharCode(56320|a&1023)):c+="dec2char error: Code point out of range: "+g(a);return c}function g(a){return(a+0).toString(16).toUpperCase()}function h(a){return y[a>>4&15]+y[a&15]}function f(a){return a=a.replace(/0x([A-Fa-f0-9]{1,4})(\s)?/g,function(a,c){m(c);return m(c)})}function d(a){a=a.replace(/[Uu]\+10([A-Fa-f0-9]{4})/g,function(a,c){return m("10"+c)});return a=a.replace(/[Uu]\+([A-Fa-f0-9]{1,5})/g,function(a,c){return m(c)})}function e(a){return a=a.replace(/&#x([A-Fa-f0-9]{1,6});/g,
function(a,c){return m(c)})}function l(c){return c=c.replace(/&#([0-9]{1,7});/g,function(c,b){return a(b)})}function c(a){return a=a.replace(/0x([A-Fa-f0-9]{1,6})/g,function(a,c){return m(c)})}function k(a,c){c?(a=a.replace(/\\([A-Fa-f0-9]{1,6})(\s)?/g,function(a,c){return m(c)}),a=a.replace(/\\/g,"")):a=a.replace(/\\([A-Fa-f0-9]{2,6})(\s)?/g,function(a,c){return m(c)});return a}function t(a,c){a=a.replace(/\\u\{([A-Fa-f0-9]{1,})\}/g,function(a,c){return m(c)});a=a.replace(/\\U([A-Fa-f0-9]{8})/g,
function(a,c){return m(c)});a=a.replace(/\\u([A-Fa-f0-9]{4})/g,function(a,c){return m(c)});c&&(a=a.replace(/\\b/g,"\b"),a=a.replace(/\\t/g,"\t"),a=a.replace(/\\n/g,"\n"),a=a.replace(/\\v/g,"\v"),a=a.replace(/\\f/g,"\f"),a=a.replace(/\\r/g,"\r"),a=a.replace(/\\\'/g,"'"),a=a.replace(/\\\"/g,'"'),a=a.replace(/\\\\/g,"\\"));return a}function v(c){return c=c.replace(/((%[A-Fa-f0-9]{2})+)/g,function(c,b){for(var k="",e=0,d=0,l=b.split("%"),f=1;f<l.length;f++){var h=parseInt(l[f],16);switch(e){case 0:0<=
h&&127>=h?k+=a(h):192<=h&&223>=h?(e=1,d=h&31):224<=h&&239>=h?(e=2,d=h&15):240<=h&&247>=h?(e=3,d=h&7):k+="convertpEsc2Char: error "+g(h)+"! ";break;case 1:if(128>h||191<h)k+="convertpEsc2Char: error "+g(h)+"! ";e--;k+=a(d<<6|h-128);d=0;break;case 2:case 3:if(128>h||191<h)k+="convertpEsc2Char: error "+g(h)+"! ";d=d<<6|h-128;e--}}return k})}function A(a){return a=a.replace(/&([A-Za-z0-9]+);/g,function(a,c){return c in entities?entities[c]:a})}function E(c,b){"hex"==b?c=c.replace(/(\b[A-Fa-f0-9]{2,6}\b)/g,
function(a,c){return m(c)}):"dec"==b?c=c.replace(/(\b[0-9]+\b)/g,function(c,b){return a(b)}):"utf8"==b?c=c.replace(/(( [A-Fa-f0-9]{2})+)/g,function(a,c){return x(c)}):"utf16"==b&&(c=c.replace(/(( [A-Fa-f0-9]{1,6})+)/g,function(a,c){return w(c)}));return c}function x(c){var b="",k=0,e=0;c=c.replace(/^\s+/,"");c=c.replace(/\s+$/,"");if(0==c.length)return"";c=c.replace(/\s+/g," ");c=c.split(" ");for(var d=0;d<c.length;d++){var l=parseInt(c[d],16);switch(k){case 0:0<=l&&127>=l?b+=a(l):192<=l&&223>=l?
(k=1,e=l&31):224<=l&&239>=l?(k=2,e=l&15):240<=l&&247>=l?(k=3,e=l&7):b+="convertUTF82Char: error1 "+g(l)+"! ";break;case 1:if(128>l||191<l)b+="convertUTF82Char: error2 "+g(l)+"! ";k--;b+=a(e<<6|l-128);e=0;break;case 2:case 3:if(128>l||191<l)b+="convertUTF82Char: error3 "+g(l)+"! ";e=e<<6|l-128;k--}}return b.replace(/ $/,"")}function w(c){var b=0,k="";c=c.replace(/^\s+/,"");c=c.replace(/\s+$/,"");if(0==c.length)return null;c=c.replace(/\s+/g," ");c=c.split(" ");for(var e=0;e<c.length;e++){var d=parseInt(c[e],
16);if(0>d||65535<d)k+="!Error in convertUTF162Char: unexpected value, b\x3d"+g(d)+"!";if(0!=b)if(56320<=d&&57343>=d){k+=a(65536+(b-55296<<10)+(d-56320));b=0;continue}else k+="Error in convertUTF162Char: low surrogate expected, b\x3d"+g(d)+"!",b=0;55296<=d&&56319>=d?b=d:k+=a(d)}return k}function C(a,c){var b=[],k=[];null==c&&(c=function(a,c){return b[0]===c?"[Circular ~]":"[Circular ~."+k.slice(0,b.indexOf(c)).join(".")+"]"});return function(e,d){if(0<b.length){var l=b.indexOf(this);~l?b.splice(l+
1):b.push(this);~l?k.splice(l,Infinity,e):k.push(e);~b.indexOf(d)&&(d=c.call(this,e,d))}else b.push(d);return null==a?d:a.call(this,e,d)}}var y="0123456789ABCDEF".split("");r.dec2hex4=function(a){return y[a>>12&15]+y[a>>8&15]+y[a>>4&15]+y[a&15]};r.dec2hex=g;r.dec2char=a;r.dec2hex2=h;r.convertUTF82Char=x;r.convertUTF162Char=w;r.convertUnicode2Char=d;r.convertCharStr2pEsc=function(a){var c="",b;b=0;for(var k="",e=0;e<a.length;e++){var d=a.charCodeAt(e);if(0>d||65535<d)k+="Error in convertChar2CP: byte out of range "+
g(d)+"!";if(0!=b)if(56320<=d&&57343>=d){k+=g(65536+(b-55296<<10)+(d-56320))+" ";b=0;continue}else k+="Error in convertChar2CP: surrogate out of range "+g(b)+"!",b=0;55296<=d&&56319>=d?b=d:k+=g(d)+" "}b=k.substring(0,k.length-1);if(0==a.length)return"";a=b.split(" ");for(b=0;b<a.length;b++)k=parseInt(a[b],16),c=32==k?c+"%20":65<=k&&90>=k?c+String.fromCharCode(k):97<=k&&122>=k?c+String.fromCharCode(k):48<=k&&57>=k?c+String.fromCharCode(k):45==k||46==k||95==k||126==k?c+String.fromCharCode(k):127>=k?
c+("%"+h(k)):2047>=k?c+("%"+h(192|k>>6&31)+"%"+h(128|k&63)):65535>=k?c+("%"+h(224|k>>12&15)+"%"+h(128|k>>6&63)+"%"+h(128|k&63)):1114111>=k?c+("%"+h(240|k>>18&7)+"%"+h(128|k>>12&63)+"%"+h(128|k>>6&63)+"%"+h(128|k&63)):c+("!Error "+g(k)+"!");return c};r.convertAllEscapes=function(a,b){a=d(a);a=f(a);a=c(a);a=e(a);a=l(a);a=t(a,!1);a=k(a,!1);a=v(a);a=A(a);return a=E(a,b)};var z="0123456789abcdef".split("");r.round=function(a,c,b){if("number"!==typeof a||isNaN(a)||Infinity===a||-Infinity===a)return"";c=
"undefined"===typeof c?3:parseInt(c,10)||0;var k=Math.pow(10,c);a=(Math.round(a*k)/k).toFixed(c);b||(a=""+ +a);return a};r.replaceHex=function(a){return b.isString(a)?a.replace(/x([0-9A-Fa-f]{2})/gmi,function(a,c){return String.fromCharCode(parseInt(c,16))}):a};var D=function(a,c){for(a=a.toString(16).toUpperCase();a.length<c;)a="0"+a;return a};r.stringToHex=function(a){for(var c="",b=0,k=a.length,e;b<k;b+=1)e=a.charCodeAt(b),c+=D(e.toString(16),2)+" ";return c};r.stringToBufferStr=function(a){for(var c=
0,b=a.length,k,e=[];c<b;c+=1)k=a.charCodeAt(c),e.push(k);return e.join(",")};r.stringToBuffer=function(a){for(var c=0,b=a.length,k,e=[];c<b;c+=1)k=a.charCodeAt(c),e.push(k);return e};r.bufferToHexString=function(a){a=-1!==a.indexOf(",")?a.split(","):[a];for(var c=[],b=0;b<a.length;b++)c.push(r.dec2hex2(a[b]));return c.join(" ")};r.bufferFromDecString=function(a){a=-1!==a.indexOf(",")?a.split(","):[a];for(var c=0;c<a.length;c++)a[c]=parseInt(a[c]);return a};r.stringFromDecString=function(a){a=r.bufferFromDecString(a);
for(var c="",b=0;b<a.length;b++)c+=String.fromCharCode(a[b],16);return c};r.stringToHex2=function(a){for(var c="",b=0,k=a.length,e;b<k;b+=1)e=a.charCodeAt(b),c+=D(e.toString(16),2)+" ";return c};r.hexToString=function(a){a=a.split(" ");for(var c="",b=0,k=a.length,e;b<k;b+=1)e=String.fromCharCode(parseInt(a[b],16)),c+=e;return c};r.prettyHex=function(a){var c=Math.ceil(a.length/16),b=a.length%16||16,k=a.length.toString(16).length;6>k&&(k=6);for(var e="Offset";e.length<k;)e+=" ";var e="\u001b[36m"+
e+"  ",d;for(d=0;16>d;d++)e+=" "+D(d,2);e+="\u001b[0m\n";a.length&&(e+="\n");var l=0,f,g;for(d=0;d<c;d++){e+="\u001b[36m"+D(l,k)+"\u001b[0m  ";f=d===c-1?b:16;g=16-f;var h;for(h=0;h<f;h++)e+=" "+D(a[l],2),l++;for(h=0;h<g;h++)e+="   ";l-=f;e+="   ";for(h=0;h<f;h++)g=a[l],e+=31<g&&127>g||159<g?String.fromCharCode(g):".",l++;e+="\n"}return e};r.hexEncode=function(a,c){var b,k,e="";for(k=0;k<a.length;k++)b=a.charCodeAt(k).toString(16),e+=((null!==c?c:"000")+b).slice(-4);return e};r.markHex=function(a,
c,b,k){c=c||"";b=b||"";var e=""+a;a=/[^\x20-\x7E]/gim;a.exec(e);e.match(a);e.replace(a,function(a,k){var d=r.hexEncode(a,"$");2==d.length&&(d=d.replace("$","$0"));d=d.toUpperCase();e=e.replace(a,c+d+b)});return e};r.to_hex=function(a){for(var c="",b=!0,k=32;0<k;){var k=k-4,e=a>>k&15;b&&0==e||(b=!1,c+=z[e])}return"0x"+(""==c?"0":c)};r.stringify=function(a){return JSON.stringify(a,C(),2)};r.humanFileSize=function(a,c){var b=c?1E3:1024;if(Math.abs(a)<b)return a+" B";var k=c?"kB MB GB TB PB EB ZB YB".split(" "):
"KiB MiB GiB TiB PiB EiB ZiB YiB".split(" "),e=-1;do a/=b,++e;while(Math.abs(a)>=b&&e<k.length-1);return a.toFixed(1)+" "+k[e]};"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(a){return 0===this.indexOf(a)});"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(a){return this.substring(this.length-a.length,this.length)===a});r.isNativeEvent=function(a){var c={onclick:null,ondblclick:null,onmousedown:null,onmouseup:null,onmouseover:null,
onmousemove:null,onmouseout:null,onkeypress:null,onkeydown:null,onkeyup:null,onfocus:null,onblur:null,onchange:null};if(a in c)return!0;c={click:null,dblclick:null,mousedown:null,mouseup:null,mouseover:null,mousemove:null,mouseout:null,keypress:null,keydown:null,keyup:null,focus:null,blur:null,change:null};return a in c};r.isSystemEvent=function(a){for(var c in n.EVENTS)if(n.EVENTS[c]===a)return!0;return!1};r.contains=function(a,c){for(var b=0;b<a.length;b++)if(a[b]===c)return b;return-1};r.getObjectKeyByValue=
function(a,c){if(a&&c)for(var b in a)if(a.hasOwnProperty(b)&&a[b]===c)return b;return null};r.removeURLParameter=function(a,c){var b=a.split("?");if(2<=b.length){for(var k=encodeURIComponent(c)+"\x3d",e=b[1].split(/[&;]/g),d=e.length;0<d--;)-1!==e[d].lastIndexOf(k,0)&&e.splice(d,1);a=b[0]+"?"+e.join("\x26")}return a};r.replaceUrlParam=function(a,c,b){if(-1==a.indexOf(c))return a+=(0<a.indexOf("?")?"\x26":"?")+c+"\x3d"+b;var k=a.replace(new RegExp("("+c+"\x3d).*?(\x26|$)"),"$1"+b+"$2");k==a&&(k=k+
(0<k.indexOf("?")?"\x26":"?")+c+"\x3d"+b);return k};r.buildPath=function(a,c,b){var k=""+a,k=r.replaceAll("/","",a);a=(""+c).replace("./","/").replace(/^\/|\/$/g,"");k=k+"://"+a;return!0===b?encodeURIComponent(k):k};r.isImage=function(a){return null!=a.toLowerCase().match(/\.(jpeg|jpg|gif|png)$/)};r.hasFlag3=function(a,c){return 1<<c&a?!0:!1};r.hasFlag=function(a,c){return 1<<c&a?!0:!1};r.disableFlag=function(a,c){return a&~(1<<c)};r.cleanUrl=function(a){a&&(a=a.replace("//","/"),a=a.replace("./",
"/"),a=a.replace("http:/","http://"),a=a.replace("./","/"),a=a.replace("////","/"),a=a.replace("///","/"));return a};r.getJson=function(a,c,k){try{return b.isString(a)?q.parse(a,!1):!0===c?null:a}catch(e){!1!==k&&console.error("error parsing json data "+a+" error \x3d "+e)}return null};r.fromJson=function(a){if(!b.isString(a))return a;var c=null,k=!1;try{c=eval("("+a+")",{})}catch(e){k=!0}if(k){a=a.substring(a.indexOf("{"),a.lastIndexOf("}")+1);try{c=eval("("+a+")",{})}catch(d){throw Error(a);}}return c};
r.replaceAll=function(a,c,b){return b?b.split(a).join(c):""};r.isValidString=function(a){return null!=a&&null!=a.length&&0<a.length&&"undefined"!=a};r.substituteString=function(a,c){return a.replace(/\$\{([^\s\:\}]+)(?:\:([^\s\:\}]+))?\}/g,function(a,b){return c[b]})};r.findOcurrences=function(a,c){var b=r.escapeRegExp(c.begin),k=r.escapeRegExp(c.end);return a.match(new RegExp(b+"([^"+k+"]*)"+k,"g"))};r.escapeRegExp=function(a){for(var c="[ ] ( ) { } * + . | ||".split(" "),b=0;b<c.length;b++)a=a.replace(c[b],
"\\"+c[b]);return a};r.multipleReplace=function(a,c){var b=[],k;for(k in c)b[b.length]=k;return a.replace(new RegExp(b.join("\\b|\\b"),"g"),function(a){return c[a]||c["\\"+a]})};r.replace=function(a,c,k,e){if(!a)return"";if(k&&b.isObject(k)||b.isArray(k)){if(e){c=r.findOcurrences(a,e);var d=r.replaceAll;if(c)for(var l=0,f=c.length;l<f;l++){var g=c[l],h=d(e.begin,"",g),h=d(e.end,"",h);a=d(g,k[h],a)}}else return r.multipleReplace(a,k);return a}return r.replaceAll(c,k,a)};r.capitalize=function(a){return a.substring(0,
1).toUpperCase()+a.substring(1)};r.vsprintf=function(a,c){return r.sprintf.apply(this,[a].concat(c))};r.sprintf=function(){var a=arguments,c=0,b=function(a,c,b,k){b||(b=" ");c=a.length>=c?"":Array(1+c-a.length>>>0).join(b);return k?a+c:c+a},k=function(a,c,k,e,d,l){var f=e-a.length;0<f&&(a=k||!d?b(a,e,l,k):a.slice(0,c.length)+b("",f,"0",!0)+a.slice(c.length));return a},e=function(a,c,e,d,l,f,g){a>>>=0;e=e&&a&&{2:"0b",8:"0",16:"0x"}[c]||"";a=e+b(a.toString(c),f||0,"0",!1);return k(a,e,d,l,g)};return a[c++].replace(/%%|%(\d+\$)?([-+\'#0 ]*)(\*\d+\$|\*|\d+)?(\.(\*\d+\$|\*|\d+))?([scboxXuideEfFgG])/g,
function(d,l,f,g,h,t,m){var v,q;if("%%"===d)return"%";var n=!1;q="";var p=h=!1;v=" ";for(var A=f.length,r=0;f&&r<A;r++)switch(f.charAt(r)){case " ":q=" ";break;case "+":q="+";break;case "-":n=!0;break;case "'":v=f.charAt(r+1);break;case "0":h=!0;break;case "#":p=!0}g=g?"*"===g?+a[c++]:"*"==g.charAt(0)?+a[g.slice(1,-1)]:+g:0;0>g&&(g=-g,n=!0);if(!isFinite(g))throw Error("sprintf: (minimum-)width must be finite");t=t?"*"===t?+a[c++]:"*"==t.charAt(0)?+a[t.slice(1,-1)]:+t:-1<"fFeE".indexOf(m)?6:"d"===
m?0:void 0;l=l?a[l.slice(0,-1)]:a[c++];switch(m){case "s":return m=String(l),null!=t&&(m=m.slice(0,t)),k(m,"",n,g,h,v);case "c":return m=String.fromCharCode(+l),null!=t&&(m=m.slice(0,t)),k(m,"",n,g,h,void 0);case "b":return e(l,2,p,n,g,t,h);case "o":return e(l,8,p,n,g,t,h);case "x":return e(l,16,p,n,g,t,h);case "X":return e(l,16,p,n,g,t,h).toUpperCase();case "u":return e(l,10,p,n,g,t,h);case "i":case "d":return v=+l||0,v=Math.round(v-v%1),d=0>v?"-":q,l=d+b(String(Math.abs(v)),t,"0",!1),k(l,d,n,g,
h);case "e":case "E":case "f":case "F":case "g":case "G":return v=+l,d=0>v?"-":q,q=["toExponential","toFixed","toPrecision"]["efg".indexOf(m.toLowerCase())],m=["toString","toUpperCase"]["eEfFgG".indexOf(m)%2],l=d+Math.abs(v)[q](t),k(l,d,n,g,h)[m]();default:return d}})};r.cleanString=function(a){return a?a=a.replace(/[\r]/g,"").replace(/[\b]/g,"").replace(/[\f]/g,"").replace(/[\n]/g,"").replace(/\\/g,""):null};r.normalizePath=function(a){if(!a)return null;a=r.cleanString(a);a=a.replace("./","");a=
a.replace("/.","");return a=a.replace(/([^:]\/)\/+/g,"$1")};n.PATH_PARTS={DIRNAME:1,BASENAME:2,EXTENSION:4,FILENAME:8,PATHINFO_ALL:0};r.basename=function(a,c){var b=a,k=b.charAt(b.length-1);if("/"===k||"\\"===k)b=b.slice(0,-1);b=b.replace(/^.*[\/\\]/g,"");"string"===typeof c&&b.substr(b.length-c.length)==c&&(b=b.substr(0,b.length-c.length));return b};r.pathinfo=function(a,c){var b="",k="",e="",d=0,l={},f=0,g=0,h=f=!1,t=!1;if(!a)return!1;c||(c="PATHINFO_ALL");var m={PATHINFO_DIRNAME:1,PATHINFO_BASENAME:2,
PATHINFO_EXTENSION:4,PATHINFO_FILENAME:8,PATHINFO_ALL:0};for(e in m)m.hasOwnProperty(e)&&(m.PATHINFO_ALL|=m[e]);if("number"!==typeof c){c=[].concat(c);for(g=0;g<c.length;g++)m[c[g]]&&(d|=m[c[g]]);c=d}e=function(a){a+="";var c=a.lastIndexOf(".")+1;return c?c!==a.length?a.substr(c):"":!1};c&m.PATHINFO_DIRNAME&&(d=a.replace(/\\/g,"/").replace(/\/[^\/]*\/?$/,""),l.dirname=d===a?".":d);c&m.PATHINFO_BASENAME&&(!1===f&&(f=r.basename(a)),l.basename=f);c&m.PATHINFO_EXTENSION&&(!1===f&&(f=r.basename(a)),!1===
h&&(h=e(f)),!1!==h&&(l.extension=h));c&m.PATHINFO_FILENAME&&(!1===f&&(f=r.basename(a)),!1===h&&(h=e(f)),!1===t&&(t=f.slice(0,f.length-(h?h.length+1:!1===h?0:1))),l.filename=t);f=0;for(b in l)l.hasOwnProperty(b)&&(f++,k=b);return 1===f?l[k]:l};r.parse_url=function(a,c){var b;b="source scheme authority userInfo user pass host port relative path directory file query fragment".split(" ");for(var k=this.php_js&&this.php_js.ini||{},e=k["phpjs.parse_url.mode"]&&k["phpjs.parse_url.mode"].local_value||"php",
d={php:/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/\/?)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},
d=d[e].exec(a),l={},f=14;f--;)d[f]&&(l[b[f]]=d[f]);if(c)return l[c.replace("PHP_URL_","").toLowerCase()];if("php"!==e){var g=k["phpjs.parse_url.queryKey"]&&k["phpjs.parse_url.queryKey"].local_value||"queryKey",d=/(?:^|&)([^&=]*)=?([^&]*)/g;l[g]={};b=l[b[12]]||"";b.replace(d,function(a,c,b){c&&(l[g][c]=b)})}delete l.source;return l};r.getMimeTable=function(){return{}};r.getMimeTable2=function(){return{mid:"fa-file-audio-o",txt:"fa-file-text-o",sql:"fa-cube",js:"fa-cube",gif:"fa-file-picture-o",jpg:"fa-file-picture-o",
html:"fa-cube",htm:"fa-cube",rar:"fa-file-zip-o",gz:"fa-file-zip-o",tgz:"fa-file-zip-o",z:"fa-file-zip-o",ra:"fa-file-movie-o",ram:"fa-file-movie-o",rm:"fa-file-movie-o",pl:"source_pl.png",zip:"fa-file-zip-o",wav:"fa-file-audio-o",php:"fa-cube",php3:"fa-cube",phtml:"fa-cube",exe:"fa-file-o",bmp:"fa-file-picture-o",png:"fa-file-picture-o",css:"fa-cube",mp3:"fa-file-audio-o",m4a:"fa-file-audio-o",aac:"fa-file-audio-o",xls:"fa-file-excel-o",xlsx:"fa-file-excel-o",ods:"fa-file-excel-o",sxc:"fa-file-excel-o",
csv:"fa-file-excel-o",tsv:"fa-file-excel-o",doc:"fa-file-word-o",docx:"fa-file-word-o",odt:"fa-file-word-o",swx:"fa-file-word-o",rtf:"fa-file-word-o",ppt:"fa-file-powerpoint-o",pps:"fa-file-powerpoint-o",odp:"fa-file-powerpoint-o",sxi:"fa-file-powerpoint-o",pdf:"fa-file-pdf-o",mov:"fa-file-movie-o",avi:"fa-file-movie-o",mpg:"fa-file-movie-o",mpeg:"fa-file-movie-o",mp4:"fa-file-movie-o",m4v:"fa-file-movie-o",ogv:"fa-file-movie-o",webm:"fa-file-movie-o",wmv:"fa-file-movie-o",swf:"fa-file-movie-o",flv:"fa-file-movie-o",
tiff:"fa-file-picture-o",tif:"fa-file-picture-o",svg:"fa-file-picture-o",psd:"fa-file-picture-o",ers:"horo.png"}};r.getIconTable=function(){return{}};r.urlDecode=function(a,c){if(!a||!a.length)return{};for(var b={},k=a.split("\x26"),e,d,l=0,f=k.length;l<f;l++)e=k[l].split("\x3d"),d=decodeURIComponent(e[0]),e=decodeURIComponent(e[1]),null!=e&&"true"===e?e=!0:"false"===e&&(e=!1),!0!==c?"undefined"==typeof b[d]?b[d]=e:("string"==typeof b[d]&&(b[d]=[b[d]]),b[d].push(e)):b[d]=e;return b};r.getUrlArgs=
function(a){var c={};if(a&&(-1!=a.indexOf("?")||-1!=a.indexOf("\x26"))){a=(a.substr(a.indexOf("?")+1)||location.search.substring(1)).split("\x26");for(var b=0;b<a.length;b++){var k=a[b].indexOf("\x3d"),e=a[b].substring(0,k),k=a[b].substring(k+1),k=decodeURIComponent(k);c[e]=k}}return c};r.urlArgs=function(a){a=r.getUrlArgs(a);var c={},b;for(b in a){var k=a[b],e=r.findOcurrences(k,{begin:"|",end:"|"}),d=null;if(e&&e.length)for(var k=k.replace(e[0],""),e=e[0].substr(1,e[0].length-2).split(","),d={},
l=0;l<e.length;l++){var f=e[l].split(":");d[f[0]]=f[1]}k&&k.length&&(c[b]={value:k,options:d})}return c};r.getIcon=function(a){if(!a)return"txt2.png";if(a=r.getFileExtension(a)){var c=r.getMimeTable();if(null!=c[a])return c[a]}return"txt2.png"};r.getIconClass=function(a){if(!a)return"fa-file-o";a=r.getFileExtension(a);if(n.customMimeIcons[a])return n.customMimeIcons[a];if(a){var c=r.getMimeTable2();if(null!=c[a])return c[a]}return"fa-file-o"};r.getFileExtension=function(a){if(!a||""==a)return"";a=
r.getBaseName(a).split(".");return 1<a.length?a[a.length-1].toLowerCase():""};r.createUUID=function(){var a=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()};r.getBaseName=function(a){if(null==a)return null;var c="/";-1!==a.indexOf("\\")&&(c="\\");return a.substr(a.lastIndexOf(c)+1,a.length)};r.basename=function(a,c){var b=a,k=b.charAt(b.length-1);if("/"===k||"\\"===k)b=b.slice(0,-1);b=b.replace(/^.*[\/\\]/g,"");"string"===
typeof c&&b.substr(b.length-c.length)===c&&(b=b.substr(0,b.length-c.length));return b};r.pathinfo=function(a,c){var b=r.basename,k="",e="",d="",l=0,f={},g=0,h=0,t=g=!1,m=!1;if(!a)return!1;c||(c="PATHINFO_ALL");var v={PATHINFO_DIRNAME:1,PATHINFO_BASENAME:2,PATHINFO_EXTENSION:4,PATHINFO_FILENAME:8,PATHINFO_ALL:0};for(d in v)v.hasOwnProperty(d)&&(v.PATHINFO_ALL|=v[d]);if("number"!==typeof c){c=[].concat(c);for(h=0;h<c.length;h++)v[c[h]]&&(l|=v[c[h]]);c=l}d=function(a){a+="";var c=a.lastIndexOf(".")+
1;return c?c!==a.length?a.substr(c):"":!1};c&v.PATHINFO_DIRNAME&&(l=a.replace(/\\/g,"/").replace(/\/[^\/]*\/?$/,""),f.dirname=l===a?".":l);c&v.PATHINFO_BASENAME&&(!1===g&&(g=b(a)),f.basename=g);c&v.PATHINFO_EXTENSION&&(!1===g&&(g=b(a)),!1===t&&(t=d(g)),!1!==t&&(f.extension=t));c&v.PATHINFO_FILENAME&&(!1===g&&(g=b(a)),!1===t&&(t=d(g)),!1===m&&(m=g.slice(0,g.length-(t?t.length+1:!1===t?0:1))),f.filename=m);g=0;for(k in f)f.hasOwnProperty(k)&&(g++,e=k);return 1===g?f[e]:f};r.strip_tags=function(a,c){c=
(((c||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");return a.replace(/\x3c!--[\s\S]*?--\x3e|<\?(?:php)?[\s\S]*?\?>/gi,"").replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,function(a,b){return-1<c.indexOf("\x3c"+b.toLowerCase()+"\x3e")?a:""})};return r})},"xide/lodash":function(){define([],function(){if("undefined"!==typeof _)return _})},"nxapp/protocols/MQTT":function(){define("dcl/dcl xdojo/declare xide/utils nxapp/types/Types nxapp/protocols/ProtocolBase dojo/node!net dojo/node!path dojo/node!child_process dojo/node!util dojo/node!deferred nxapp/utils/_console dojo/node!mqtt".split(" "),
function(p,r,n,q,b,m,a,g,h,f,d,e){var l=!0;return p(b,{declaredClass:"nxapp.protocols.MQTT",_socket:null,protocolName:"mqtt",instance:null,subscriptions:null,mqttClient:null,getOptions:function(a,b,e){return n.mixin({clean:!1,clientId:e.clientId||a+":"+b,port:b},e)},onConnected:function(){l&&d.log("# "+this.protocolName+" - Protocol:: onConnected "+this.options.host+" : "+this.options.port+" @ "+this.protocolName);this.connection.connected=!0;this.delegate.onConnect2(this.connection)},onError:function(a,
b){this.delegate.onError(this.connection,n.mixin({code:a},b),this.options)},onClose:function(a){this.delegate.onClose(this.connection,a)},connect:function(){var a=this.options;if(!a||!a.driver)return l||this.isDebug()&&d.error("no driver in options",a),this;var b=this,f=a.host,g=a.port,a=n.getJson(a.options||{});!0===a.debug&&(l=!0);a=this.getOptions(f,g,a);this.host=f;this.port=g;this.protocol=this.protocolName;l||this.isDebug()&&d.log("MQTT-\x3econnecting to "+f+" with",a);var h=e.connect(f,a);
this.mqttClient=h;try{h.on("connect",function(a){b.onConnected()})}catch(m){l||this.isDebug()&&d.error("MQTT-\x3econnect error :: code: ",m)}h.on("close",function(a){l||b.isDebug()&&d.log("MQTT-\x3eclose :: code: ",a);b.onClose();h.end()});this._socket={};this._socket.writable=!0;return this},onData:function(a,b){this.delegate.onData(this.connection,a,b)},onCommandError:function(a,b){l||this.isDebug()&&d.log("MQTT-\x3eCommandError "+a+" id "+b.id+" src "+b.src);try{this.delegate.onData(this.connection,
n.mixin({cmd:a,event:q.EVENTS.ON_COMMAND_ERROR},b))}catch(e){d.error("---",e)}},onFinish:function(a,b,e){l||this.isDebug()&&d.log("MQTT onFinish "+a+" id "+b.id+" src "+b.src);try{this.delegate.onData(this.connection,n.mixin({cmd:a,event:q.EVENTS.ON_COMMAND_FINISH},b),e)}catch(f){d.error("onFinish-Error:",f)}},addSubscription:function(a,b,e){!this.subscriptions&&(this.subscriptions={});if(a){var l=this,f=""+a;if(!this.subscriptions[f]){b={qos:parseInt(b.qos)||0};this.mqttClient.subscribe(f,b);this.isDebug()&&
d.log("add subscription : "+a+" for ",h.inspect(e,{depth:null,colors:!0}));var g=this.subscriptions[f]={id:e.params.id,src:e.params.src,topic:f};this.mqttClient.on("message",function(a,c){if(a===f){var b=n.getJson(c.toString());if(_.isArray(b))l.onData(n.mixin({payload:b,topic:a},g));else if(_.isObject(b))b.topic||(b.topic=a),l.onData(n.mixin(b,g));else if(_.isString(b)||_.isNumber(b))l.onData(n.mixin({payload:b,topic:a},g));else d.error("-unknown "+a)}})}}else d.error("invalid topic")},unSubscribeTopic:function(a,
b,e){a=n.getJson(a);(a=""+a.topic)&&this.unsubscribe(a)},subscribeTopic:function(a,b,e){a=n.getJson(a);b=n.getJson(b);e=""+a.topic;delete a.topic;this.addSubscription(e,a,b)},publishTopic:function(a,b,e){try{a=n.getJson(a);n.getJson(b);var f=""+a.topic,g=a.qos,h=a.retain;delete a.topic;delete a.qos;delete a.retain;var m=a.payload||a;if(_.isObject(m))try{m=JSON.stringify(m)}catch(q){d.error("error generating payload",q);return}this.mqttClient.publish(f,m,{qos:g,retain:h})}catch(p){l||this.isDebug()&&
d.log("---error ",p)}},send:function(a,b){},unsubscribe:function(a){a&&this.mqttClient&&this.subscriptions&&this.subscriptions[a]&&(this.mqttClient.unsubscribe(a),delete this.subscriptions[a])},close:function(){this.mqttClient&&(_.each(this.subscriptions,this.unsubscribe,this),this.mqttClient.end(),this.mqttClient=null)}})})},"xide/data/_Base":function(){define("dojo/_base/declare dstore/Memory dstore/Tree dstore/QueryResults xide/mixins/EventedMixin xide/encoding/MD5 xdojo/has".split(" "),function(p,
r,n,q,b,m,a){return p("xide/data/_Base",b,{__all:null,allowCache:!0,constructor:function(){var a=this;if(a._getQuerierFactory("filter")||a._getQuerierFactory("sort"))this.queryEngine=function(b,d){d=d||{};var e=a._getQuerierFactory("filter"),l=e?e(b):passthrough,e=a._getQuerierFactory("sort"),c=passthrough;e&&(c=e(arrayUtil.map(d.sort,function(a){return{property:a.attribute,descending:a.descending}})));var k=passthrough;isNaN(d.start)&&isNaN(d.count)||(k=function(a){var c=d.start||0,c=a.slice(c,c+
(d.count||Infinity));c.total=a.length;return c});return function(a){return k(c(l(a)))}};var b=this;a.on("add,update,delete",function(f){var d=f.type,e=f.target;b.notify("add"===d||"update"===d?e:void 0,"delete"===d||"update"===d?"id"in f?f.id:a.getIdentity(e):void 0)})},destroy:function(){this._emit("destroy",this)},notify:function(){},refreshItem:function(a){this.emit("update",{target:a})},_queryCache:null,query:function(b,h,f){b&&m(JSON.stringify(b),1);a("xcf-ui");h=h||{};b=b||{};var d=this.filter(b),
e;if(b=h.sort)if("[object Array]"===Object.prototype.toString.call(b))for(;f=b.pop();)d=d.sort(f.attribute,f.descending);else d=d.sort(b);"start"in h&&(e=h.start||0,e=d[d.fetchRangeSync?"fetchRangeSync":"fetchRange"]({start:e,end:h.count?e+h.count:Infinity}),e.total=e.totalLength);e=e||new q(d[d.fetchSync?"fetchSync":"fetch"]());e.observe=function(a,c){var b=d.on("add",function(c){a(c.target,-1,c.index)}),e=d.on("update",function(b){!c&&b.previousIndex===b.index&&isFinite(b.index)||a(b.target,b.previousIndex,
b.index)}),f=d.on("delete",function(c){a(c.target,c.previousIndex,-1)}),g={remove:function(){b.remove();e.remove();f.remove()}};g.cancel=g.remove;return g};a("xcf-ui");return e}})})},"dstore/Memory":function(){define("dojo/_base/declare dojo/_base/array ./Store ./Promised ./SimpleQuery ./QueryResults".split(" "),function(p,r,n,q,b,m){return p([n,q,b],{constructor:function(){this.storage.version=0},postscript:function(){this.inherited(arguments);this.setData(this.data||[])},data:null,autoEmitEvents:!1,
getSync:function(a){return this.storage.fullData[this.storage.index[a]]},putSync:function(a,b){b=b||{};var h=this.storage,f=h.index,d=h.fullData,e=this.Model;!e||a instanceof e||(a=this._restore(a));var l=this.getIdentity(a);null==l&&(this._setIdentity(a,"id"in b?b.id:Math.random()),l=this.getIdentity(a));h.version++;var h=l in f?"update":"add",e={target:a},c;if("update"===h){if(!1===b.overwrite)throw Error("Object already exists");d.splice(c=f[l],1);l=c}else l=this.defaultNewToStart?0:d.length;var k;
if("beforeId"in b){var t=b.beforeId;null===t?k=d.length:(k=f[t],c<k&&--k);void 0!==k?e.beforeId=t:(console.error("options.beforeId was specified but no corresponding index was found"),k=l)}else k=l;d.splice(k,0,a);c=isFinite(c)?Math.min(c,k):k;for(l=d.length;c<l;++c)f[this.getIdentity(d[c])]=c;this.emit(h,e);return a},addSync:function(a,b){(b=b||{}).overwrite=!1;return this.putSync(a,b)},removeSync:function(a){var b=this.storage,h=b.index,b=b.fullData;if(a in h)return h=b.splice(h[a],1)[0],this._reindex(),
!0!==this._ignoreChangeEvents&&this.emit("delete",{id:a,target:h}),!0},setData:function(a){this.parse&&(a=this.parse(a));a.items&&(this.idProperty=a.identifier||this.idProperty,a=a.items);this.storage.fullData=this.data=a;this._reindex()},_reindex:function(){for(var a=this.storage,b=a.index={},h=a.fullData,f=this.Model,d=Object.prototype,e=0,l=h.length;e<l;e++){var c=h[e];if(f&&!(c instanceof f)){var k=this._restore(c,c.__proto__===d);c!==k&&(h[e]=c=k)}b[this.getIdentity(c)]=e}a.version++},fetchSync:function(){var a=
this.data;if(!a||a._version!==this.storage.version){for(var a=this.storage.fullData,b=this.queryLog,h=0,f=b.length;h<f;h++)a=b[h].querier(a);a._version=this.storage.version;this.data=a}return new m(a)},fetchRangeSync:function(a){var b=this.fetchSync();return new m(b.slice(a.start,a.end),{totalLength:b.length})},_includePropertyInSubCollection:function(a){return"data"!==a&&this.inherited(arguments)}})})},"dstore/Store":function(){define("dojo/_base/lang dojo/_base/array dojo/aspect dojo/has dojo/when dojo/Deferred dojo/_base/declare dstore/QueryMethod dstore/Filter dojo/Evented".split(" "),
function(p,r,n,q,b,m,a,g,h,f){function d(a){return function(c,k){var e=this;b(c,function(c){c={target:c};var b=k[1]||{};"beforeId"in b&&(c.beforeId=b.beforeId);e.emit(a,c)});return c}}q.add("object-proto",!!{}.__proto__&&!{}.watch);var e=q("object-proto");return a(f,{constructor:function(e){e&&a.safeMixin(this,e);this.Model&&this.Model.createSubclass&&(this.Model=this.Model.createSubclass([]).extend({_store:this}));this.storage=new f;var c=this;this.autoEmitEvents&&(n.after(this,"add",d("add")),n.after(this,
"put",d("update")),n.after(this,"remove",function(a,e){b(a,function(){c.emit("delete",{id:e[0]})});return a}))},autoEmitEvents:!0,idProperty:"id",queryAccessors:!0,getIdentity:function(a){return a.get?a.get(this.idProperty):a[this.idProperty]},_setIdentity:function(a,c){a.set?a.set(this.idProperty,c):a[this.idProperty]=c},forEach:function(a,c){var k=this;return b(this.fetch(),function(b){for(var e=0,d;void 0!==(d=b[e]);e++)a.call(c,d,e,k);return b})},on:function(a,c){return this.storage.on(a,c)},
emit:function(a,c){c=c||{};c.type=a;try{return this.storage.emit(a,c)}finally{return c.cancelable}},parse:null,stringify:null,Model:null,_restore:function(a,c){var b=this.Model;if(b&&a){var d=b.prototype,f=d._restore;f?a=f.call(a,b,c):e&&c?a.__proto__=d:a=p.delegate(d,a)}return a},create:function(a){return new this.Model(a)},_createSubCollection:function(b){var c=p.delegate(this.constructor.prototype),k;for(k in this)this._includePropertyInSubCollection(k,c)&&(c[k]=this[k]);return a.safeMixin(c,b)},
_includePropertyInSubCollection:function(a,c){return!(a in c)||c[a]!==this[a]},queryLog:[],filter:new g({type:"filter",normalizeArguments:function(a){var c=this.Filter;return a instanceof c?[a]:[new c(a)]}}),Filter:h,sort:new g({type:"sort",normalizeArguments:function(a,c){var b;"function"===typeof a?b=[a]:(b=a instanceof Array?a.slice():"object"===typeof a?[].slice.call(arguments):[{property:a,descending:c}],b=r.map(b,function(a){a=p.mixin({},a);a.descending=!!a.descending;return a}),b=[b]);return b}}),
select:new g({type:"select"}),_getQuerierFactory:function(a){return this["_create"+(a[0].toUpperCase()+a.substr(1))+"Querier"]}})})},"dstore/QueryMethod":function(){define([],function(){return function(p){var r=p.type,n=p.normalizeArguments,q=p.applyQuery,b=p.querierFactory;return function(){var m=Array.prototype.slice.call(arguments),a=n?n.apply(this,m):m,m={type:r,arguments:m,normalizedArguments:a},g=this._getQuerierFactory(r)||b;g&&(m.querier=g.apply(this,a));a=this._createSubCollection({queryLog:this.queryLog.concat(m)});
return q?q.call(this,a,m):a}}})},"dstore/Filter":function(){define(["dojo/_base/declare"],function(p){function r(n){return function(){var q=this.constructor,b=new q;b.type=n;b.args=arguments;return this.type?r("and").call(q.prototype,this,b):b}}p=p(null,{constructor:function(n){var q=typeof n;switch(q){case "object":var q=this,b;for(b in n)var m=n[b],q=m instanceof this.constructor?q[m.type](b,m.args[0]):m&&m.test?q.match(b,m):q.eq(b,m);this.type=q.type;this.args=q.args;break;case "function":case "string":this.type=
q,this.args=[n]}},and:r("and"),or:r("or"),eq:r("eq"),ne:r("ne"),lt:r("lt"),lte:r("lte"),gt:r("gt"),gte:r("gte"),contains:r("contains"),"in":r("in"),match:r("match")});p.filterCreator=r;return p})},"dstore/Promised":function(){define(["dojo/_base/declare","dojo/Deferred","./QueryResults","dojo/when"],function(p,r,n,q){function b(b,a){return function(){var g=new r;try{g.resolve(this[b].apply(this,arguments))}catch(h){g.reject(h)}return a?(g=new n(g.promise),g.totalLength=q(g.totalLength),g):g.promise}}
return p(null,{get:b("getSync"),put:b("putSync"),add:b("addSync"),remove:b("removeSync"),fetch:b("fetchSync",!0),fetchRange:b("fetchRangeSync",!0)})})},"dstore/QueryResults":function(){define(["dojo/_base/lang","dojo/when"],function(p,r){function n(q,b){return r(this,function(m){for(var a=0,g=m.length;a<g;a++)q.call(b,m[a],a,m)})}return function(q,b){var m=b&&"totalLength"in b;if(q.then){q=p.delegate(q);var a=q.then(function(a){var h=m?b.totalLength:a.totalLength||a.length;a.totalLength=h;return!m&&
h});q.totalLength=m?b.totalLength:a;q.response=b&&b.response}else q.totalLength=m?b.totalLength:q.length;q.forEach=n;return q}})},"dstore/SimpleQuery":function(){define(["dojo/_base/declare","dojo/_base/array"],function(p,r){function n(b,m){if(-1<b.indexOf(".")){var a=b.split("."),g=a.length;return function(b){for(var f=0;f<g;f++)b=b&&(m&&b.get?b.get(a[f]):b[a[f]]);return b}}return function(a){return a.get?a.get(b):a[b]}}var q={eq:function(b,m){return b===m},"in":function(b,m){return-1<r.indexOf(m.data||
m,b)},ne:function(b,m){return b!==m},lt:function(b,m){return b<m},lte:function(b,m){return b<=m},gt:function(b,m){return b>m},gte:function(b,m){return b>=m},match:function(b,m,a){return m.test(b,a)},contains:function(b,m,a,g){var h=this;return r.every(m.data||m,function(f){if("object"===typeof f&&f.type){var d=h._getFilterComparator(f.type);return r.some(b,function(b){return d.call(h,b,f.args[1],a,g)})}return-1<r.indexOf(b,f)})}};return p(null,{_createFilterQuerier:function(b){function m(b){var d=
b.type;b=b.args;var e=g._getFilterComparator(d);if(e){var l=b[0],c=n(l,a),k=b[1];k&&k.fetchSync&&(k=k.fetchSync());return function(a){return e.call(g,c(a),k,a,l)}}switch(d){case "and":case "or":for(var t=0,q=b.length;t<q;t++){var p=m(b[t]);h=h?function(a,c){return"and"===d?function(b){return a(b)&&c(b)}:function(b){return a(b)||c(b)}}(h,p):p}return h;case "function":return b[0];case "string":t=g[b[0]];if(!t)throw Error("No filter function "+b[0]+" was found in the collection");return t;case void 0:return function(){return!0};
default:throw Error('Unknown filter operation "'+d+'"');}}var a=this.queryAccessors,g=this,h=m(b);return function(a){return r.filter(a,h)}},_getFilterComparator:function(b){return q[b]||this.inherited(arguments)},_createSelectQuerier:function(b){return function(m){var a=b.length;return r.map(m,b instanceof Array?function(g){for(var h={},f=0;f<a;f++){var d=b[f];h[d]=g[d]}return h}:function(a){return a[b]})}},_createSortQuerier:function(b){var m=this.queryAccessors;return function(a){a=a.slice();a.sort("function"==
typeof b?b:function(a,h){for(var f=0;f<b.length;f++){var d,e=b[f];if("function"==typeof e)d=e(a,h);else{d=e.get||(e.get=n(e.property,m));var e=e.descending,l=d(a);d=d(h);null!=l&&(l=l.valueOf());null!=d&&(d=d.valueOf());d=l===d?0:!!e===(null===l||l>d&&null!==d)?-1:1}if(0!==d)return d}return 0});return a}}})})},"dstore/Tree":function(){define(["dojo/_base/declare"],function(p){return p(null,{constructor:function(){this.root=this},mayHaveChildren:function(p){return"hasChildren"in p?p.hasChildren:!0},
getRootCollection:function(){return this.root.filter({parent:null})},getChildren:function(p){return this.root.filter({parent:this.getIdentity(p)})}})})},"xide/data/TreeMemory":function(){define(["dojo/_base/declare","xide/data/Memory","dstore/Tree","dojo/Deferred","dstore/QueryResults"],function(p,r,n,q,b){return p("xide.data.TreeMemory",[r,n],{_state:{filter:null},parentField:"parentId",reset:function(){this._state.filter=null;this.resetQueryLog()},resetQueryLog:function(){this.queryLog=[]},fetchRange:function(){var m=
this._fetchRange(arguments);return new b(m.then(function(a){return a}),{totalLength:m.then(function(a){return a.length})})},filter:function(b){var a=this.inherited(arguments);this._state.filter=b;return a},_fetchRange:function(b){var a=new q;b=this.fetchRangeSync(b);if(this._state.filter){if(this._state&&this._state.filter&&this._state.filter.parent){var g=this.getSync(this._state.filter.parent);g&&(this.reset(),b={},this.getChildrenSync?b=this.getChildrenSync(g):(b[this.parentField]=g[this.idProperty],
b=this.root.query(b)))}this._state&&this._state.filter&&this._state.filter.group&&(this.getSync(this._state.filter.parent),g&&(this.reset(),b=g.items))}a.resolve(b);return a},children:function(b){for(var a=this.root.data,g=[],h=0;h<a.length;h++){var f=a[h];f[this.parentField]==b[this.idProperty]&&g.push(f)}return a},mayHaveChildren:function(b){return!1===b._mayHaveChildren?!1:!0}})})},"xide/data/Memory":function(){define(["dojo/_base/declare","dstore/Memory","xide/data/_Base"],function(p,r,n){return p("xide.data.Memory",
[r,n],{})})},"xide/data/ObservableStore":function(){define(["dojo/_base/declare","xide/types","xide/mixins/EventedMixin"],function(p,r,n){return p("xide/data/Observable",n,{_ignoreChangeEvents:!0,observedProperties:[],mute:!1,silent:function(q){this._ignoreChangeEvents=q},putSync:function(q,b){this._ignoreChangeEvents=!0;var m=this.inherited(arguments);this._ignoreChangeEvents=!1;!1!==b&&this.emit("added",m);return m},removeSync:function(q){var b=this.getSync(q);b&&b.onRemove&&b.onRemove();return this.inherited(arguments)},
postscript:function(){var q=this;q.inherited(arguments);if(q.on)q.on("add",function(b){b=b.target;q._observe(b);b._store||(b._store=q);b._onCreated&&b._onCreated();b.onAdd&&b.onAdd(b)})},_onItemChanged:function(q,b,m,a){this._ignoreChangeEvents||(b={target:q,property:b,value:m,source:a},this.emit("update",b),q.onItemChanged&&q.onItemChanged(b))},_observe:function(q){var b=this,m=b.observedProperties;q&&q.observed&&(m=m.concat(q.observed));m&&m.forEach(function(a){q.property(a).observe(function(g){b._ignoreChangeEvents||
b._onItemChanged(q,a,g,b)})})},setData:function(q){this.inherited(arguments);this._ignoreChangeEvents=!0;q&&_.each(q,this._observe,this);this._ignoreChangeEvents=!1}})})},"dstore/Trackable":function(){define("dojo/_base/lang dojo/_base/declare dojo/aspect dojo/when dojo/promise/all dojo/_base/array dojo/on".split(" "),function(p,r,n,q,b,m,a){function g(a,b,l){for(var c=a.length-1;0<=c;--c){var k=a[c],f=k.start,k=f+k.count;if(b>k){a.splice(c+1,0,{start:b,count:l-b});return}l>=f&&(b=Math.min(b,f),l=
Math.max(l,k),a.splice(c,1))}a.unshift({start:b,count:l-b})}var h=0,f={track:function(){function b(){return function(){var a=this,c=this.inherited(arguments);q(c,function(c){c=a._results=c.slice();a._partialResults&&(a._partialResults=null);a._ranges=[];g(a._ranges,0,c.length)});return c}}function e(){return function(a){var c=this,b=a.start,k=a.end,e=this.inherited(arguments);this._results||q(e,function(a){return q(a.totalLength,function(e){var d=c._partialResults||(c._partialResults=[]);k=Math.min(k,
b+a.length);d.length=e;e=[b,k-b].concat(a);d.splice.apply(d,e);g(c._ranges,b,k);return a})});return e}}function l(a,b){h++;var k=b.target;b=p.delegate(b,x[a]);q(A._results||A._partialResults,function(e){if(e){var d,l,f,g=A._ranges,h,t="id"in b?b.id:c.getIdentity(k),q=-1,v=-1,n=-1,p=-1;if("delete"===a||"update"===a)for(d=0;-1===q&&d<g.length;++d)for(h=g[d],l=h.start,f=l+h.count;l<f;++l)if(c.getIdentity(e[l])==t){q=b.previousIndex=l;v=d;e.splice(q,1);h.count--;for(l=d+1;l<g.length;++l)g[l].start--;
break}if("add"===a||"update"===a){if(E){if(E([k]).length){var r=0;f=g.length-1;l=-1;for(var x;r<=f&&-1===n;)d=r+Math.round((f-r)/2),h=g[d],v=e.slice(h.start,h.start+h.count),"beforeId"in b&&(l=null===b.beforeId?v.length:w(v,b.beforeId)),-1===l&&(l=q>=Math.max(0,h.start-1)&&q<=h.start+h.count?q:c.defaultNewToStart?0:v.length),v.splice(l,0,k),t=m.indexOf(E(v),k),x=h.start+t,0===t&&0!==h.start?f=d-1:t>=v.length-1&&x<e.length?r=d+1:(n=x,p=d);if(-1===n&&0<r&&r<g.length)var N=!0}}else{l=-1;if("beforeId"in
b)if(null===b.beforeId)n=e.length,l=g.length-1;else for(d=0,f=g.length;-1===p&&d<f;++d)h=g[d],n=w(e,b.beforeId,h.start,h.start+h.count),-1!==n&&(p=d);else"update"===a?(n=q,p=v):c.defaultNewToStart?l=n=0:(n=e.length,l=g.length-1);-1!==l&&-1===p&&(h=g[l])&&h.start<=n&&n<=h.start+h.count&&(p=l)}if(-1<n&&-1<p)for(b.index=n,e.splice(n,0,k),g[p].count++,d=p+1;d<g.length;++d)g[d].start++;else if(N)for(b.beforeIndex=g[r].start,d=r;d<g.length;++d)g[d].start++}b.totalLength=e.length}(e=A["on_tracked"+a])&&
e.call(A,b)})}var c=this.store||this,k=[],f={add:1,update:1,"delete":1},v;for(v in f)k.push(this.on(v,function(a){return function(c){l(a,c)}}(v)));var A=r.safeMixin(p.delegate(this),{_ranges:[],fetch:b(),fetchRange:e(),releaseRange:function(a,c){if(this._partialResults){a:for(var b=this._ranges,k=0,e;e=b[k];++k){var d=e.start,l=d+e.count;if(a<=d)if(c>=l)b.splice(k,1);else{e.start=c;e.count=l-e.start;break a}else if(a<l)if(c>d){b.splice(k,1,{start:d,count:a-d},{start:c,count:l-c});break a}else e.count=
a-e.start}for(b=a;b<c;++b)delete this._partialResults[b]}},on:function(c,b){var k=this,e=this.getInherited(arguments);return a.parse(A,c,b,function(a,c){return c in f?n.after(A,"on_tracked"+c,b,!0):e.call(k,c,b)})},tracking:{remove:function(){for(;0<k.length;)k.pop().remove();this.remove=function(){}}},track:null});this.fetchSync&&(r.safeMixin(A,{fetchSync:b(),fetchRangeSync:e()}),A.fetchSync());var E;m.forEach(this.queryLog,function(a){var c=E,b=a.querier;b&&(E=c?function(a){return b(c(a))}:b)});
var x={add:{index:void 0},update:{previousIndex:void 0,index:void 0},"delete":{previousIndex:void 0}},w=function(a,b,k,e){e=void 0!==e?e:a.length;for(k=void 0!==k?k:0;k<e;++k)if(c.getIdentity(a[k])===b)return k;return-1};return A}};b=r(null,f);b.create=function(a,b){a=r.safeMixin(p.delegate(a),f);r.safeMixin(a,b);return a};return b})},"xide/manager/ContextBase":function(){define(["dcl/dcl","xide/factory","xide/types","xide/utils","xide/mixins/EventedMixin"],function(p,r,n,q,b){b=p(b.dcl,{declaredClass:"xide.manager.ContextBase",
language:"en",managers:[],mixins:null,createManager:function(b,a,g){try{this.managers||(this.managers=[]);var h={ctx:this,config:a||this.config};q.mixin(h,g);if(_.isString(b)&&this.namespace){var f=null,f=-1==b.indexOf(".")?this.namespace+b:""+b;b=dojo.getObject(f)&&p.getObject(f)?f:this.defaultNamespace+b}else _.isObject(b);var d=r.createInstance(b,h);if(d)return this.managers.push(d),r.publish(n.EVENTS.ON_CREATED_MANAGER,{instance:d,className:b,ctx:this,config:a||this.config}),d}catch(e){console.error("error creating manager "+
e,arguments)}},constructManagers:function(){},initManagers:function(){},doMixins:function(b){this.mixins=b||this.mixins;for(var a=0;a<b.length;a++){var g=b[a],h=dojo.getObject(g.declaredClass)||p.getObject(g.declaredClass);g.declaredClass===this.declaredClass&&(h=this);h&&q.mixin(h.prototype,g.mixin)}}});p.chainAfter(b,"constructManagers");p.chainAfter(b,"initManagers");return b})},"nxapp/Commons":function(){define("dojo/_base/declare dojo/has dojo/_base/lang nxapp/types/Types xide/factory xide/factory/Events xide/factory/Objects xide/utils/StringUtils xide/utils/CIUtils xide/utils/ObjectUtils xide/utils/StoreUtils nxapp/utils/FileUtils xide/utils nxapp/utils dojo/node!os dojo/node!util nxapp/utils/_console".split(" "),
function(p,r,n,q,b,m,a,g,h,f,d,e,l,c,k,t,v){p="linux";"win32"===k.platform()?p="windows":"darwin"===k.platform()?p="osx":"linux"===k.platform()&&"arm"==k.arch()&&(p="arm");"arm"===p?r.add("serialport",function(){return!1}):r.add("serialport",function(){return!0});l.mixin(c,l);l.mixin(l,c);l.inspect=function(a){return t.inspect(a,{depth:null,colors:!0})};Array.prototype.remove=function(){for(var a,c=arguments,b=c.length,k;b&&this.length;)for(a=c[--b];-1!=(k=this.indexOf(a));)this.splice(k,1);return this};
Array.prototype.contains=function(a){for(var c=this.length;c--;)if(this[c]==a)return!0;return!1};Array.prototype.indexOfPropertyValue||(Array.prototype.indexOfPropertyValue=function(a,c){for(var b=0;b<this.length;b++)if(this[b][a]&&this[b][a]==c)return b;return-1});"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(a){return this.substring(0,a.length)===a});"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(a){return this.substring(this.length-
a.length,this.length)===a})})},"xide/factory/Objects":function(){define(["dcl/dcl","xide/utils","xide/factory","xdojo/declare"],function(p,r,n,q){n.createInstance=function(b,m,a){var g={};r.mixin(g,m);m=b;if(_.isString(b)&&(m=dojo.getObject(m)||p.getObject(m),!m))return console.error("no such class : "+b),null;a&&(m=q(a,m.prototype));g.id||(g.id=(m.declaredClass||"no_class_").replace(/\//g,"_")+r.createUUID());(b=new m(g))&&(b.ctrArgs=g);return b};return n})},"xide/utils/CIUtils":function(){define(["xide/utils",
"xide/types","xide/factory","dojo/has","xide/lodash"],function(p,r,n,q,b){p.toOptions=function(b){b=p.flattenCIS(b);for(var a=[],g=0;g<b.length;g++){var h=b[g];a.push({name:p.toString(h.name),value:p.getCIValue(h),type:p.toInt(h.type),enumType:p.toString(h.enumType),visible:p.toBoolean(h.visible),active:p.toBoolean(h.active),changed:p.toBoolean(h.changed),group:p.toString(h.group),user:p.toObject(h.user),dst:p.toString(h.dst),params:p.toString(h.params)})}return a};if(q("xideve")||q("xblox-ui"))p.getEventsAsOptions=
function(b){var a=[{label:"Select Event",value:""}],g;for(g in r.EVENTS)a.push({label:r.EVENTS[g],value:r.EVENTS[g]});a=a.concat([{label:"onclick",value:"onclick"},{label:"ondblclick",value:"dblclick"},{label:"onmousedown",value:"mousedown"},{label:"onmouseup",value:"mouseup"},{label:"onmouseover",value:"mouseover"},{label:"onmousemove",value:"mousemove"},{label:"onmouseout",value:"mouseout"},{label:"onkeypress",value:"keypress"},{label:"onkeydown",value:"keydown"},{label:"onkeyup",value:"keyup"},
{label:"onfocus",value:"focus"},{label:"onblur",value:"blur"},{label:"On Load",value:"Load"}]);for(g=0;g<a.length;g++){var h=a[g];if(h.value===b){h.selected=!0;break}}return a};p.flattenCIS=function(b){for(var a=[],g=[],h=0;h<b.length;h++){var f=b[h],d=p.toInt(f.type);d>r.ECIType.END&&(d=r.resolveType(d))&&(p.mixin(a,d),g.push(f))}0<a.length&&(b=b.concat(a));if(g)for(h in g)b.remove(g[h]);return b};p.arrayContains=function(b,a){for(var g=0;g<b.length;g++)if(b[g]===a)return!0;return!1};p.setStoreCIValueByField=
function(b,a,g){null==b[a]&&(b[a]=[]);b[a][0]=p.getStringValue(g);return b};p.createOption=function(b,a,g){return p.mixin({label:b,value:null!=a?a:b},g)};p.createCI=function(b,a,g,h,f){b={dataRef:null,dataSource:null,name:b,group:-1,id:b,title:b,type:a,uid:-1,value:null!=g?g:-1,visible:!0,enumType:-1,"class":"cmx.types.ConfigurableInformation"};p.mixin(b,h);f&&f.publish&&n.publish(f.publish,{CI:b,owner:f.owner},f.owner);return b};p.createCIAsArray=function(b,a,g,h){return{chainType:[g?g:0],dataRef:[null],
dataSource:[null],params:[],name:[b],group:[-1],id:[b],title:[b],type:[a],uid:[-1],value:[h?h:-1],visible:[!0],enumType:[-1],parentId:[-1],"class":["cmx.types.ConfigurableInformation"]}};p.hasValue=function(b){return b.value&&null!=b.value[0]&&0<b.value[0].length&&"0"!=b.value[0]&&"undefined"!=b.value[0]&&"Unset"!=b.value[0]};p.hasValueAndDataRef=function(b){return b.value&&null!=b.value[0]&&0<b.value[0].length&&"0"!=b.value[0]&&"undefined"!=b.value[0]&&"Unset"!=b.value[0]&&b.dataRef&&null!=b.dataRef[0]&&
0<b.dataRef[0].length&&"0"!=b.dataRef[0]&&"undefined"!=b.dataRef[0]};p.getInputCIByName=function(b,a){if(!b)return null;var g=b.inputs;g||(g=b);if(null!=g)for(var h=0;h<g.length;h++){var f=g[h],d=p.getStringValue(f.name);if(null!=d&&d.toLowerCase()===a.toLowerCase())return f}return null};p.getCIByChainAndName=function(b,a,g){if(!b)return null;(a=0==a?b.inputs:1==a?b.outputs:null)||(a=b);if(null!=a)for(b=0;b<a.length;b++){var h=a[b],f=p.getStringValue(h.name);if(null!=f&&f.toLowerCase()===g.toLowerCase())return h}return null};
p.getCIByUid=function(b,a){if(null!=b)for(var g=0;g<b.length;g++){var h=b[g],f=p.getStringValue(h.uid);if(null!=f&&f===a)return h}return null};p.getCIById=function(b,a,g){b=0==a?b.inputs:1==a?b.outputs:null;if(null!=b)for(a=0;a<b.length;a++){var h=b[a];if(h.id[0]==g[0])return h}return null};p.getCIInputValueByName=function(b,a){var g=p.getCIByChainAndName(b,0,a);return g?g.value:null};p.getCIValue=function(b){return p.getCIValueByField(b,"value")};p.getStringValue=function(b){return p.toString(b)};
p.toString=function(m){return null!=m?b.isArray(m)?m&&1==m.length&&null==m[0]?null:""+(null!=m[0]?m[0]:m):""+m:null};p.setIntegerValue=function(b,a){null!=b&&dojo.isArray(b)&&(b[0]=a)};p.getCIValueByField=function(m,a){return null!=m[a]?b.isArray(m[a])?m[a][0]?m[a][0]:m[a]:m[a]:null};p.setCIValueByField=function(b,a,g){if(!b)return b;null==b[a]&&(b[a]=[]);b[a]=g;return b};p.setCIValue=function(b,a,g){(b=p.getInputCIByName(b,a))&&p.setCIValueByField(b,"value",g);return b};p.getCIInputValueByNameAndField=
function(b,a,g){return(b=p.getCIByChainAndName(b,0,a))?b[""+g]:null};p.getCIInputValueByNameAndFieldStr=function(b,a,g){return(b=p.getCIInputValueByNameAndField(b,a,g))?p.getStringValue(b):null};p.getCIInputValueByNameAndFieldBool=function(b,a,g){return(b=p.getCIInputValueByNameAndField(b,a,g))?p.toBoolean(b):null};p.getCIWidgetByName=function(b,a){for(var g=0;g<b.length;g++){var h=b[g];if(h._widget&&h.name===a)return h._widget}return null};return p})},"xide/utils/StoreUtils":function(){define(["xide/utils",
"dojo/store/Memory"],function(p,r){p.removeFromStore=function(n,q,b,m,a){n.getSync(q[m])&&console.error("no such item !! ",n);n.removeSync(q[m]);var g={};g[a]=q[m];if((q=n.query(g))&&q.length)for(g=0;g<q.length;g++)p.removeFromStore(n,q[g],b,m,a)};p.toString=function(n){return null!=n?dojo.isArray(n)?n&&1==n.length&&null==n[0]?null:""+(null!=n[0]?n[0]:n):""+n:null};p.toBoolean=function(n){var q=!1;null!=n&&(n=n[0]?n[0]:n,null!=n&&(q=!(!0!==n&&"true"!==n&&"1"!==n)));return q};p.toObject=function(n){return null!=
n?n[0]?n[0]:n:null};p.toInt=function(n){var q=-1;if(null!=n&&(n=1<n.length?n:n[0]?n[0]:n,null!=n))try{q=parseInt(n)}catch(b){}return q};p.deleteStoreItemById=function(n,q){var b=!1;n.fetch({query:{id:q},queryOptions:{deep:!0},onComplete:function(m){for(;0<m.length;){n.deleteItem(m[0]);n.save();b=!0;break}}});return b};p.getStoreItemByName=function(n,q){var b=null;n.fetch({query:{name:q},queryOptions:{deep:!0},onComplete:function(m){b=0<m.length?m[0]:null}});return b};p.getStoreItemById=function(n,
q){return p.queryStoreEx(n,{id:q})};p.getAppDataElementByIdAndType=function(n,q,b){return p.queryStore(n,{uid:q,type:b})};p.getElementsByType=function(n,q){return p.queryStoreEx(n,{type:q})};p.queryStoreEx=function(n,q,b,m){if(!n)return console.error("utils.queryStoreEx: store \x3d null"),console.trace(),null;if(null!=dojo.store&&n instanceof dojo.store.Memory||n instanceof xide.data.Memory)return n=p.queryMemoryStoreEx(n,q),m&&n&&n[0]?n[0]:n;var a=null;n.fetch?n.fetch({query:q,queryOptions:{deep:!0},
onComplete:function(b){a=b}}):n.query&&(a=n.query(q));return null!=b&&!0===b&&a&&0==a.length?null:!0===m&&a&&1==a.length?a[0]:a};p.queryStore=function(n,q,b){return null!=dojo.store&&n instanceof dojo.store.Memory?p.queryMemoryStoreSingle(n,q):(n=p.queryStoreEx(n,q))&&1==n.length?n[0]:null!=b&&!0===b&&n&&0==n.length?null:n};p.queryMemoryStoreEx=function(n,q){var b=[];n.query(q).forEach(function(m){b.push(m)});return b};p.queryMemoryStoreSingle=function(n,q){var b=p.queryMemoryStoreEx(n,q);return 1==
b.length?b[0]:b};return p})},"nxapp/manager/FileManager":function(){define("dcl/dcl dojo/has nxapp/manager/ManagerBase nxapp/utils/_LogMixin xide/types xide/factory dojo/node!path dojo/node!fs dojo/node!child_process dojo/node!watchr dojo/node!chokidar".split(" "),function(p,r,n,q,b,m,a,g,h,f,d){r("windows");r("arm");return p([n,q],{declaredClass:"nxapp.manager.FileManager",watcher:null,resolve:function(b){var d="",c=a.resolve(dojoConfig.libRoot),k=a.resolve(dojoConfig.clientRoot);if(g.existsSync(a.resolve(b)))return b;
"/"==b[0]?a.resolve(b):a.resolve(c+"/"+b)?d=a.resolve(c+"/"+b):g.existsSync(a.resolve(b))?d=a.resolve(b):a.resolve(k+"/"+b)&&(d=a.resolve(k+"/"+b));return d},watch:function(a,b){try{console.log("watch directory : "+this.resolve(a)),g.existsSync(a)&&b&&this.watcher&&this.watcher.add&&this.watcher.add(a)}catch(c){}},initChokidar:function(e){for(var l=0;l<e.watchr.paths.length;l++){var c=e.watchr.paths[l],k=a.resolve(dojoConfig.libRoot),f=a.resolve(dojoConfig.clientRoot);"/"==c[0]?c=a.resolve(c):a.resolve(k+
"/"+c)?e.watchr.paths[l]=a.resolve(k+"/"+c):g.existsSync(a.resolve(c))?e.watchr.paths[l]=a.resolve(c):a.resolve(f+"/"+c)&&(e.watchr.paths[l]=a.resolve(f+"/"+c))}var h=this,q=d.watch(e.watchr.paths,{persistent:!0,ignoreInitial:!0,awaitWriteFinish:!0});q.on("addDir",function(a){q.add(a);m.publish(b.EVENTS.ON_FILE_CHANGED,{path:a,modulePath:a.replace(dojoConfig.libRoot,"")},h)});q.on("add",function(a){m.publish(b.EVENTS.ON_FILE_CHANGED,{path:a,modulePath:a.replace(dojoConfig.libRoot,""),type:"added"},
h)});q.on("unlinkDir",function(a){q.unwatch(a);m.publish(b.EVENTS.ON_FILE_CHANGED,{path:a,modulePath:a.replace(dojoConfig.libRoot,""),type:"delete"},h)});q.on("change",function(a){m.publish(b.EVENTS.ON_FILE_CHANGED,{path:a,modulePath:a.replace(dojoConfig.libRoot,""),type:"changed"},h)});q.on("raw",function(a,c,k){if("rename"===a)try{var e=e.statSync(k.watchedPath)}catch(d){-1!==k.watchedPath.indexOf(c)&&m.publish(b.EVENTS.ON_FILE_CHANGED,{path:k.watchedPath,modulePath:k.watchedPath.replace(dojoConfig.libRoot,
""),type:"delete"},h)}});this.watcher=q},initWindows_Watchr:function(e){for(var d=0;d<e.watchr.paths.length;d++){var c=e.watchr.paths[d],k=a.resolve(dojoConfig.libRoot),h=a.resolve(dojoConfig.clientRoot);"/"==c[0]?c=a.resolve(c):a.resolve(k+"/"+c)?e.watchr.paths[d]=a.resolve(k+"/"+c):g.existsSync(a.resolve(c))?e.watchr.paths[d]=a.resolve(c):a.resolve(h+"/"+c)&&(e.watchr.paths[d]=a.resolve(h+"/"+c))}_.each(e.watchr.paths,function(a){});var q=this;f.watch({paths:e.watchr.paths,interval:500,listeners:{log:function(a){},
error:function(a){console.log("an error occured:",a)},watching:function(a,c,b){},change:function(a,c,k,e){c&&m.publish(b.EVENTS.ON_FILE_CHANGED,{path:c,modulePath:c.replace(dojoConfig.libRoot,"")},q)}},next:function(a,c){if(a)return console.log("watching everything failed with error",a);console.log("watching everything completed")}})},initWindows:function(b){for(var d=0;d<b.watchr.paths.length;d++){var c=b.watchr.paths[d],k=a.resolve(dojoConfig.libRoot),f=a.resolve(dojoConfig.clientRoot);"/"==c[0]?
c=a.resolve(c):a.resolve(k+"/"+c)?b.watchr.paths[d]=a.resolve(k+"/"+c):g.existsSync(a.resolve(c))?b.watchr.paths[d]=a.resolve(c):a.resolve(f+"/"+c)&&(b.watchr.paths[d]=a.resolve(f+"/"+c))}var m=new function(a,c,b,k){var e=h.spawn;a=e(a,c);var d=this;a.stdout.on("data",function(a){b(d,a)});a.stdout.on("end",k)}(a.resolve(global.cwd+"/inotifywait.exe"),["-r","-m","-q","--format\x3d%w|%e|%f",b.watchr.paths[0]],function(c,b){c.stdout="";for(var k=b.toString().split(/(\r?\n)/g),e=0;e<k.length;e++){var d=
k[e];d&&5<d.length&&(d=d.split("|"),3==d.length&&a.resolve(d[0]+"/"+d[2]))}},function(){console.log("end : "+m.stdout)})},init:function(a){return this.initChokidar(a)},initLinux:function(e,d){for(var c=0;c<e.watchr.paths.length;c++){var k=e.watchr.paths[c],f=a.resolve(dojoConfig.libRoot),h=a.resolve(dojoConfig.clientRoot);"/"==k[0]?k=a.resolve(k):a.resolve(f+"/"+k)?e.watchr.paths[c]=a.resolve(f+"/"+k):g.existsSync(a.resolve(k))?e.watchr.paths[c]=a.resolve(k):a.resolve(h+"/"+k)&&(e.watchr.paths[c]=
a.resolve(h+"/"+k))}for(var q=this,n=function(a){var c=[];g.existsSync(a)&&g.readdirSync(a).forEach(function(b){b=a+"/"+b;var k=g.statSync(b);k&&k.isDirectory()&&(c.push(b),c=c.concat(n(b)))});return c},k=function(){return{all_events:function(c){if(c&&c.name&&c.name.indexOf&&-1==c.name.indexOf(".git")&&-1==c.name.indexOf(".tmp")&&-1==c.name.indexOf("_jb_old_")&&-1==c.name.indexOf("_jb_bak_")&&-1==c.masks.toString().indexOf("access")){c.masks.toString().indexOf("moved_to");var k=a.resolve(c.watch+
"/"+c.name),e="changed";-1!==c.masks.toString().replace("all_events,","").indexOf("delete")&&(e="deleted");k&&m.publish(b.EVENTS.ON_FILE_CHANGED,{path:k,modulePath:k.replace(dojoConfig.libRoot,""),type:e},q)}},close_write:function(c){-1==c.name.indexOf(".git")&&-1==c.name.indexOf(".tmp")&&-1==c.name.indexOf("_jb_old_")&&-1==c.name.indexOf("_jb_bak_")&&-1==c.masks.toString().indexOf("access")&&-1==c.masks.toString().indexOf("moved_to")&&(c=a.resolve(c.watch+"/"+c.name))&&m.publish(b.EVENTS.ON_FILE_CHANGED,
{path:c,modulePath:c.replace(dojoConfig.libRoot,"")},q)},access:!0,moved_to:!0,moved_from:!0,"delete":!0}}(),f=d.create(!1),h=0;h<e.watchr.paths.length;h++)if(c=e.watchr.paths[h],g.existsSync(c)){var p=n(c);f.watch(k,c);for(c=0;c<p.length;c++)f.watch(k,p[c])}}})})},"nxapp/manager/ExportManager":function(){define("dcl/dcl nxapp/manager/ManagerBase nxapp/manager/_Drivers_Devices nxapp/utils/_LogMixin nxapp/utils/_console xide/utils nxapp/utils dojo/node!path dojo/node!fs-jetpack dojo/node!cheerio dojo/node!fs require dojo/has".split(" "),
function(p,r,n,q,b,m,a,g,h,f,d,e,l){return p([r,q,n],{declaredClass:"nxapp.manager.ExportManager",options:null,serverTemplates:null,linux32:!0,linux64:!0,osx:!0,arm:!0,windows:!0,nginxOptions:null,mongoOptions:null,serverOptions:null,init:function(a){this.profile=a},run:function(a){this.delegate=a;this.initWithOptions(this.options)},onProgress:function(a){this.delegate&&this.delegate.onProgress(a);b.log("Progress:  "+a)},onError:function(a){this.delegate&&this.delegate.onError(a)},onFinish:function(a){this.delegate&&
this.delegate.onFinish(a);b.log("Finish:  "+a)},initWithOptions:function(c){this.options=c;m.mixin(this,c);this.onProgress("Export Manager: begin export",{progress:0});b.log("export with options : ",c);if(!this.root)throw this.onError("Export Manager: have no root"),Error("Export Manager: have no root");if(!this.data)throw this.onError("Export Manager: have no data"),Error("Export Manager: have no data");if(this.user){this.client||(this.client=a.resolve(this.root+"/dist/all/Code/client/"));this.serverTemplates||
(this.serverTemplates=a.resolve(this.root+"/server-template"));this.dist||(this.dist=a.resolve(this.root+"/dist/all/server/"));b.log("export with \n",m.inspect({"System Data":this.data,"User Data":this.user+" \x3d "+g.resolve(this.user),Root:g.resolve(this.root),"Server-Templates":this.serverTemplates,Target:g.resolve(this.target),"Node Servers":g.resolve(this.dist),Client:this.client,"Export Windows":this.windows,"Export Linux - 32 ":this.linux32,"Export Linux - 64 ":this.linux64,"Export OSX":this.osx,
"Export ARM":this.arm}));c=m.mixin({port:8889,templatePath:a.resolve(this.serverTemplates+"/nginx/all/conf/nginx.app.template.conf")},this.nginxOptions);var k=m.mixin({port:9997,mongo_port:27018,mqtt_port:1884},this.serverOptions);this.exportNGINX(c);this.exportMongo(this.mongoOptions||{});this.createDirectoryLayout();this.exportServer();this.onProgress("Exported Servers",{progress:.2});this.exportUser();this.onProgress("Exported User",{progress:.3});this.exportSystem();this.onProgress("Exported System Data",
{progress:.4});this.exportMisc(k);this.onProgress("Exported Misc Data",{progress:.5});this.exportHTML(k);this.onProgress("Exported User Workspace HTML",{progress:.6});this.exportDevices({serverSide:!0});this.onProgress("Exported Devices",{progress:.7});this.exportDrivers({});this.onProgress("Exported Drivers",{progress:.8});this.client?this.exportClientEx():this.exportClientDist();this.onProgress("Exported Client Application Assets",{progress:.9});b.log("Export Done! Your application can be found at "+
this.target);this.onProgress("Export Done",{progress:1.2});this.onFinish("Export Done! Your application can be found at "+this.target)}else this.onError("Export Manager: have no user")},exportHTML:function(a){function k(b,k){var f=d.readdirSync(b);f.length&&_.each(f,function(d){if(-1!==d.indexOf(".dhtml")){var f=k.replace(e.path()+"/","");l.exportHTMLFile2(b+"/"+d,f,a)}})}var e=h.dir(this.target+"/www/user/workspace/"),l=this;(function(e){d.existsSync(e)?d.readdirSync(e).forEach(function(f){f=e+"/"+
f;var h=d.statSync(f);if(h){var t=f.replace(g+"/","");h.isDirectory()?k(f,t):-1!==f.indexOf(".dhtml")&&(t=t.replace(e+"/",""),l.exportHTMLFile2(f,t,a))}else b.error("cant get stat for "+f)}):b.error("device path "+e+" doesnt exists");return[]})(e.path())},exportHTMLFile2:function(a,b,e){var d=h.dir(this.root+"/export/"),d=m.readFile(g.resolve(d.path()+"/app.template.html")),l=m.pathinfo(a);b===l.basename&&(b="");b=m.mixin({libRoot:"/Code/client/src/lib",lodashUrl:"/Code/client/src/lib/external/lodash.min.js",
requireBaseUrl:"/Code/client/src/lib/xibm/ibm",jQueryUrl:"/Code/client/src/lib/external/jquery-1.9.1.min.js",data:"",user:"/user",css:"./"+m.cleanUrl(l.filename+".css"),theme:"bootstrap",blox_file:"./"+b+"/"+l.filename+".xblox",scene_file:"./"+b+"/"+l.filename+".dhtml",mount:"workspace",VFS_VARS:JSON.stringify({user_drivers:"./www/user/drivers",system_drivers:"./www/system/drivers"},null,2)},e);d=m.replace(d,null,b,{begin:"%",end:"%"});b=m.readFile(a);b=b.replace("\x3cviewHeaderTemplate/\x3e",d);
b=b.replace(/\burl\s*\(\s*["']?([^"'\r\n\)\(]+)["']?\s*\)/gi,function(a,c){var b=c.split("://"),k=b[1];return b[0]&&k?"url('./"+k+"')":c});d=f.load(b);b='\n\x3cscript type\x3d"text/javascript"\x3e\n\tvar test \x3d 0;\n\x3c/script\x3e';d("HEAD").append(d(b));m.writeFile(a.replace(".dhtml",".html"),d.html())},exportHTMLFile:function(a){var k=h.dir(this.root+"/export/"),e=h.dir(this.target+"/www/user/workspace/"),e=g.resolve(e.path()+"/ascene.dhtml"),k=m.readFile(g.resolve(k.path()+"/app.template.html"));
a=m.mixin({libRoot:"/Code/client/src/lib",lodashUrl:"/Code/client/src/lib/external/lodash.min.js",requireBaseUrl:"/Code/client/src/lib/xibm/ibm",jQueryUrl:"/Code/client/src/lib/external/jquery-1.9.1.min.js",data:"",user:"/user",css:"./ascene.css",theme:"bootstrap",blox_file:"./ascene.xblox",mount:"workspace",VFS_VARS:JSON.stringify({user_drivers:"./www/user/drivers",system_drivers:"./www/system/drivers"},null,2)},a);k=m.replace(k,null,a,{begin:"%",end:"%"});a=m.readFile(e);a=a.replace("\x3cviewHeaderTemplate/\x3e",
k);a=a.replace(/\burl\s*\(\s*["']?([^"'\r\n\)\(]+)["']?\s*\)/gi,function(a,c){var k=c.split("://"),e=k[1];return k[0]&&e?(b.error("----"+e),"url('./"+e+"')"):c});a=f.load(a);k='\n\x3cscript type\x3d"text/javascript"\x3e\n\tvar test \x3d 0;\n\x3c/script\x3e';a("HEAD").append(a(k));m.writeFile(e.replace(".dhtml",".html"),a.html())},exportDevices:function(a){var b=g.resolve(this.target+"/www/user/devices"),e=this.getDevices(b,"user_devices",a);m.writeFile(b+"/user_devices.json",JSON.stringify({items:e},
null,2));b=g.resolve(this.target+"/www/system/devices");e=this.getDevices(b,"system_devices",a);m.writeFile(b+"/system_devices.json",JSON.stringify({items:e},null,2))},exportDrivers:function(a){var b=g.resolve(this.target+"/www/user/drivers");a=this.getDrivers(b,"user_drivers");m.writeFile(b+"/user_drivers.json",JSON.stringify({items:a},null,2));b=g.resolve(this.target+"/www/system/drivers");a=this.getDrivers(b,"system_drivers");m.writeFile(b+"/system_drivers.json",JSON.stringify({items:a},null,2))},
exportMisc:function(b){var k=h.dir(this.root+"/export"),e=h.dir(this.target);h.copy(k.path(),e.path(),{matching:["**"],overwrite:!0});var d=a.readFile(g.resolve(k.path()+"/profile_device_server.json")),d=m.replace(d,null,b,{begin:"%",end:"%"});"false"!==this.linux32&&m.writeFile(e.path()+g.sep+"/server/linux_32/nxappmain/profile_device_server.json",d);"false"!==this.linux64&&m.writeFile(e.path()+g.sep+"/server/linux_64/nxappmain/profile_device_server.json",d);"false"!==this.windows&&"false"!==this.windows&&
m.writeFile(e.path()+g.sep+"/server/windows/nxappmain/profile_device_server.json",d);"false"!==this.arm&&m.writeFile(e.path()+g.sep+"/server/arm/nxappmain/profile_device_server.json",d);"false"!==this.osx&&m.writeFile(e.path()+g.sep+"/server/osx/nxappmain/profile_device_server.json",d);d=a.readFile(g.resolve(k.path()+"/start.js"));d=m.replace(d,null,b,{begin:"%",end:"%"});"false"!==this.linux32&&m.writeFile(e.path()+"/server/linux_32/start.js",d);"false"!==this.linux64&&m.writeFile(e.path()+"/server/linux_64/start.js",
d);"false"!==this.windows&&m.writeFile(e.path()+"/server/windows/start.js",d);"false"!==this.arm&&m.writeFile(e.path()+"/server/arm/start.js",d);"false"!==this.osx&&m.writeFile(e.path()+"/server/osx/start.js",d)},exportClientEx:function(){var a=h.dir(g.resolve(this.client)+""),b=h.dir(this.target+"/www/Code/client");h.copy(a.path(),b.path(),{matching:["**"],overwrite:!0})},exportClient:function(){var a=h.dir(this.root+"/Code/client"),b=h.dir(this.target+"/www/Code/client");h.copy(a.path(),b.path(),
{matching:["**"],overwrite:!0})},exportClientDist:function(){var a=h.dir(this.root+"/dist/all/Code/client/"),b=h.dir(this.target+"/www/Code/client");h.copy(a.path(),b.path(),{matching:["**"],overwrite:!0})},exportUser:function(){var a=h.dir(this.user),k=h.dir(this.target+"/www/user");b.log("export user from "+a.path()+" to "+k.path());try{h.copy(a.path(),k.path(),{matching:["**","!./.git/**/*","!**/**claycenter","!./claycenter","!**claycenter"],overwrite:!0})}catch(e){"EEXIST"===e.code&&b.error("Error copying, file exists!",
e),"EACCES"===e.code&&b.error("Error copying, file access perrmissions!",e),b.error("error : ",e)}},exportSystem:function(){var a=h.dir(this.data+"/system"),b=h.dir(this.target+"/www/system");h.copy(a.path(),b.path(),{matching:["**"],overwrite:!0})},clean:function(){},copyServer:function(a){var k=h.dir(this.target+"/server/"+a),e="",e=this.dist?h.dir(this.dist+"/"+a):h.dir(this.root+"/server/"+a);b.info("export Device-Server "+a+" from : "+e.path());try{h.copy(e.path(),k.path(),{matching:["**"],overwrite:!0})}catch(d){"EEXIST"===
d.code&&b.error("Error copying, file exists!",d),"EACCES"===d.code&&b.error("Error copying, file access perrmissions!",d)}},exportServer:function(a){"false"!==this.windows&&this.copyServer("windows");"false"!==this.linux32&&this.copyServer("linux_32");"false"!==this.linux64&&this.copyServer("linux_64");"false"!==this.arm&&this.copyServer("arm");"false"!==this.osx&&this.copyServer("osx")},createDirectoryLayout:function(){h.dir(this.target+"/data/_MONGO");h.dir(this.target+"/www/");h.dir(this.target+
"/nginx/logs")},exportMongo:function(a){a=h.dir(this.serverTemplates+"/mongo");var b=h.dir(this.target+"/mongo");h.copy(a.path(),b.path(),{matching:"mongod-arm mongod-linux_32 mongod-linux_64 mongod-windows.exe mongod-32.exe mongod-osx".split(" "),overwrite:!0})},exportNGINX:function(c){var k=h.dir(this.serverTemplates+"/nginx"),e=h.dir(this.target+"/nginx");try{h.copy(k.path(),e.path(),{matching:"nginx-arm nginx-linux_32 nginx-linux_64 nginx-windows.exe nginx-osx msvcr110.dll".split(" "),overwrite:!0})}catch(d){"EEXIST"===
d.code&&b.error("Error copying, file exists!",d),"EACCES"===d.code&&b.error("Error copying, file access perrmissions!",d),"ETXTBSY"===d.code&&b.error("Error copying, file is busy",d)}k=h.dir(this.serverTemplates+"/nginx/all/conf");e=h.dir(this.target+"/nginx");h.copy(k.path(),e.path(),{overwrite:!0});k=h.dir(this.serverTemplates+"/nginx/temp");e=h.dir(this.target+"/nginx/temp");h.copy(k.path(),e.path(),{overwrite:!0});e=a.readFile(c.templatePath);c=m.replace(e,null,c,{begin:"%%",end:"%%"});h.dir(this.serverTemplates+
"/nginx/all/conf");e=h.dir(this.target+"/nginx/");m.writeFile(e.path()+g.sep+"nginx.conf",c)}})})},"nxapp/manager/_Drivers_Devices":function(){define("dcl/dcl dojo/node!path dojo/node!fs nxapp/utils xide/utils/StringUtils xide/types nxapp/utils/_console".split(" "),function(p,r,n,q,b,m,a){return p(null,{declaredClass:"nxapp.manager._Drivers_Devices",profile:null,getDevices:function(g,h,f){function d(k,e){var d=n.readdirSync(k);d.length&&_.each(d,function(d){if(-1!=d.indexOf(".meta.json")){var f=b.getJson(q.readFile(k+
r.sep+d),!0,!1);if(f){if(c){var g=q.getCIByChainAndName(f,0,m.DEVICE_PROPERTY.CF_DEVICE_DRIVER_OPTIONS);!g||g.value&1<<m.DRIVER_FLAGS.RUNS_ON_SERVER||(g.value|=1<<m.DRIVER_FLAGS.RUNS_ON_SERVER)}f?(d={isDir:!1,path:e+"/"+d,parentId:e,scope:h,user:f,id:q.getCIInputValueByName(f,m.DEVICE_PROPERTY.CF_DEVICE_ID)},l.push(d)):a.error("device has no meta "+k+r.sep+d)}else a.error("cant get device meta for "+d+" path \x3d "+k+r.sep+d)}})}function e(b){var c=[];n.existsSync(b)?n.readdirSync(b).forEach(function(f){f=
b+"/"+f;var h=n.statSync(f);if(h){var m=f.replace(g+"/","");h.isDirectory()&&(l.push({isDir:!0,parent:m,name:m,path:m}),d(f,m),c.push(f.replace(g+"/","")),c=c.concat(e(f)))}else a.error("cant get stat for "+f)}):a.error("device path "+b+" doesnt exists");return c}require({packages:[{name:h,location:g}]});var l=[];f=f||{};var c=f.serverSide;e(g);return l},getDrivers:function(g,h,f){function d(c,k){var e=n.readdirSync(c);e.length&&_.each(e,function(e){if(-1!=e.indexOf(".meta.json")){var d=b.getJson(q.readFile(c+
r.sep+e),!0,!1);if(d){var f=q.getCIInputValueByName(d,m.DRIVER_PROPERTY.CF_DRIVER_ID),g=c+"/"+e.replace(".meta.json",".xblox"),t=b.getJson(q.readFile(g),!0,!1);t||a.warn("invalid blocks file for driver "+k+"/"+e+" blox path \x3d "+g);l.push({isDir:!1,path:k+"/"+e,parentId:k,scope:h,user:d,id:f,blox:t||{},blockPath:g})}else a.error("cant get driver meta "+c+r.sep+e)}})}function e(b){var k=[];n.existsSync(b)?n.readdirSync(b).forEach(function(a){a=b+"/"+a;var f=n.statSync(a);if(f){var h=a.replace(r+
"/","");f.isDirectory()&&(l.push({isDir:!0,parent:h,name:h,path:h}),d(a,h),k.push(a.replace(g+"/","")),k=k.concat(e(a)))}}):a.error("driver path "+b+" doesnt exists");return k}require({packages:[{name:h,location:g}]});var l=[];e(g);return l}})})},"nxapp/client/WebSocket":function(){define(["dojo/_base/declare","dojo/_base/lang","nxapp/utils/_LogMixin","nxapp/client/ClientBase","dojo/node!sockjs-client"],function(p,r,n,q,b){return p("nxapp.client.WebSocket",[q,n],{_socket:null,debugConnect:!0,connect:function(m){this.options=
r.mixin(this.options,m);m=this.options.host;var a=this.options.port;this.options.debug&&this.initLogger(this.options.debug);this.log("Sock-JS-Client Connecting to "+m+":"+a,"socket_client");var g=b.create(m+":"+a),h=this;g.on("close",function(){console.log("on close!",h.options)});g.on("connection",function(){h.log("socket client connected","socket_client");g.on("error",function(a){console.error("Socket client error ")});g.on("end",function(){h.log("socket client connection end","socket_client")})});
this._socket=g},emit:function(b,a){this.showDebugMsg("socket_client")&&(console.log("Emiting: "+b+" with: "),console.dir(a));this._socket.write(a)},onSignal:function(b,a){this._socket.on("data",a)}})})},"nxapp/client/ClientBase":function(){define(["dojo/_base/declare","dojo/Stateful","dojo/_base/lang"],function(p,r,n){return p("nxapp.server.ClientBase",[r],{options:null,_defaultOptions:function(){return{}},init:function(q){this.options=n.mixin(this._defaultOptions(),q.options)}})})},"dcl/inherited":function(){(function(p){"undefined"!=
typeof define?define(["./mini","./advise"],p):"undefined"!=typeof module?module.exports=p(require("./mini"),require("./advise")):p(dcl,advise)})(function(p,r){function n(b,a,g){var h=3>arguments.length&&b.callee,f=q.call(this,h?h.ctr:b,h?h.nom:a);if(f)return f.apply(this,h?b||a:g)}function q(m,a){var g=this.constructor._meta,h,f,d,e;if(!+g.weaver[a]){if(g){if(g.chains.hasOwnProperty(a)){if(h=g.chains[a])for(d=h.length-1;0<=d;--d)if(f=h[d],f.ctr===m)return 0<d?h[d-1]:0;return}h=g.bases;for(d=h.length-
1;0<=d&&h[d]!==m;--d);if(0<=d)for(++d,e=h.length;d<e;++d)if(g=(f=h[d])._meta){if((g=g.ownProps).hasOwnProperty(a))return g[a]}else return f.prototype[a]}return b[a]}}var b={};r.after(p,"_postprocess",function(b,a){for(var g=a._meta.bases,h=g.length-1,f,d,e;0<=h;--h)if(f=g[h],d=f._meta)d=d.ownProps,p.allKeys(d).some(function(a){e=d[a];if("function"==typeof e){if(e.nom===a)return 1;e.nom=a;e.ctr=f}});a.prototype.inherited=n;a.prototype.getInherited=q});p.getInherited=n.get=q;return p.inherited=n})},
"dcl/advise":function(){(function(p){"undefined"!=typeof define?define([],p):"undefined"!=typeof module?module.exports=p():advise=p()})(function(){function p(b,m){this.next_before=this.prev_before=this.next_after=this.prev_after=this.next_around=this.prev_around=this;this.instance=b;this.name=m}function r(b){var m=function(){var a,g,h=arguments,f;for(a=b.prev_before;a!==b;a=a.prev_before)a.before.apply(this,h);try{b.prev_around!==b&&(g=b.prev_around.around.apply(this,h))}catch(d){g=d,f=!0}for(a=b.next_after;a!==
b;a=a.next_after)a.after.call(this,h,g);if(f)throw g;return g};m.adviceNode=b;return m}function n(b,m,a){var g=b[m],h;g&&g.adviceNode&&g.adviceNode instanceof p?h=g.adviceNode:(h=new p(b,m),g&&g.advices?(g=g.advices,h.add(g.before,g.after,g.around)):h.add(0,0,g),b[m]=r(h));"function"==typeof a&&(a=a(m,b));return h.add(a.before,a.after,0,a.around)}var q=p.prototype={add:function(b,m,a,g){var h=new p(this.instance,this.name);h.parent=this;h.before=b;this._add("before",h);h.after=m;this._add("after",
h);h.around=a;this._add("around",h,g);if(h.original=g)h.around=n._instantiate(g,h.prev_around.around,this);return h},_add:function(b,m,a){if(m[b]||a)a="next_"+b,b="prev_"+b,(m[b]=this[b])[a]=(m[a]=this)[b]=m},remove:function(b){this._remove("before",b);this._remove("after",b);this._remove("around",b)},_remove:function(b,m){var a="next_"+b,g="prev_"+b;m[a][g]=m[g];m[g][a]=m[a]},destroy:function(){var b=this.prev_around.around,m=this.next_around,a=this.parent;this.remove(this);if(m!==this)for(;m!==
a;b=m.around,m=m.next_around)m.original&&(m.around=n._instantiate(m.original,b,this));this.instance=0}};q.unadvise=q.destroy;n.before=function(b,m,a){return n(b,m,{before:a})};n.after=function(b,m,a){return n(b,m,{after:a})};n.around=function(b,m,a){return n(b,m,{around:a})};n.Node=p;n._instantiate=function(b,m,a){return b(m)};return n})},"nxapp/manager/DeviceServerContext":function(){define("dcl/dcl nxapp/manager/Context nxapp/Commons xcf/types/Types dojo/node!path dojo/node!fs nxapp/utils xide/types nxapp/manager/DriverManager xcf/manager/DeviceManager nxapp/manager/FileManager xcf/manager/Context nxapp/manager/DeviceManager xcf/manager/BlockManager xide/manager/ResourceManager xblox/factory/Blocks dojo/node!tracer nxapp/utils/_console nxapp/manager/_Drivers_Devices dojo/_base/lang dojo/promise/all require".split(" "),
function(p,r,n,q,b,m,a,g,h,f,d,e,l,c,k,t,v,A,E,x,w,C){var y=p(null,{write:function(a){},emit:function(a){}}),z=p(null,{owner:null,remoteAddress:"fake - address",remotePort:"fake - port",constructor:function(b){a.mixin(this,b)},write:function(b){var c=this.owner.getDeviceManager(),k=a.getJson(b),k=k||{};if(k.data&&k.data.device){var e=c.getDeviceStoreItem(k.data.device);if(e&&(e=c.toDeviceControlInfo(e))&&!e.serverSide)return}if(k&&k.data&&k.data.deviceMessage&&k.data.deviceMessage.event===g.EVENTS.ON_COMMAND_FINISH)c.onCommandFinish(k.data.device,
k.data.deviceMessage);else if(k.data&&k.data.deviceMessage&&k.data.deviceMessage.event===g.EVENTS.ON_COMMAND_ERROR)c.onCommandError(k.data.device,k.data.deviceMessage);else if(k.event===g.EVENTS.ON_DEVICE_DISCONNECTED)c.publish(g.EVENTS.ON_DEVICE_DISCONNECTED,k.data);else{if(k.event===g.EVENTS.SET_DEVICE_VARIABLES)return c.onSetDeviceServerVariables(k.data);if(k.event===g.EVENTS.ON_DEVICE_CONNECTED)c.publish(g.EVENTS.ON_DEVICE_CONNECTED,k.data);else if(k.event!==g.EVENTS.ON_SERVER_LOG_MESSAGE)if(k.event===
g.EVENTS.ON_MQTT_MESSAGE)c.publish(g.EVENTS.ON_MQTT_MESSAGE,k.data),c.onMQTTMessage(k.data);else if(k.event!==g.EVENTS.ON_FILE_CHANGED)c.onDeviceServerMessage({data:b})}},emit:function(){A.error("device server client emit",arguments)}});return p([r,e,E],{declaredClass:"nxapp.manager.DeviceServerContext",profile:null,doTests:function(){require(["intern/lib/executors/PreExecutorEmbedded"],function(a){a=new a({executorId:"client",config:{proxyPort:9E3,proxyUrl:"http://localhost:9000/",tunnel:"NullTunnel",
capabilities:{name:"dojo-loader",project:"Dojo 2",fixSessionCapabilities:!1},environments:[{browserName:"internet explorer",version:["9.0","10.0","11.0"],platform:"Windows 7"},{browserName:"firefox",platform:"Windows 10"},{browserName:"chrome",platform:"Windows 10"},{browserName:"safari",version:"9",platform:"OS X 10.11"},{browserName:"android",platform:"Linux",version:"4.4",deviceName:"Google Nexus 7 HD Emulator"}],maxConcurrency:2,loaderOptions:{packages:[{name:"dojo",location:"./node_modules/dojo"},
{name:"dijit",location:"dijit"},{name:"dgrid",location:"dgrid"},{name:"dstore",location:"dstore"},{name:"xide",location:"xide"},{name:"xfile",location:"xfile"},{name:"dojox",location:"dojox"},{name:"xdojo",location:"xdojo"},{name:"xgrid",location:"xgrid"},{name:"xblox",location:"xblox"},{name:"xdocker",location:"xdocker"},{name:"wcDocker",location:"wcDocker/src"},{name:"dcl",location:"./node_modules/dcl"},{name:"tests",location:"tests"}]},excludeInstrumentation:/(?:node_modules|bower_components|tests)[\/\\]/,
suites:["tests/all"],functionalSuites:[]},defaultLoaderOptions:dojoConfig});try{a.run()}catch(b){A.error("error running tests ",b)}})},initManagers:function(a){a&&(this.profile=a);this.deviceManager.init();this.driverManager.init();this.blockManager.init();this.fileManager.init(a);this.blockManager.onReady();var b=this;this.subscribe(g.EVENTS.ON_FILE_CHANGED,function(a){b.onXIDEMessage({event:g.EVENTS.ON_FILE_CHANGED,data:a,type:a.type},!1);b.deviceManager.onFileChanged(a);b.driverManager.onFileChanged(a);
b.getDeviceServer().broadCastMessage(g.EVENTS.ON_FILE_CHANGED,{path:a.path,modulePath:a.modulePath,mask:a.mask,type:a.type})})},_reloadModule:function(b,c){function k(a){A.log(a.src,a.id);A.error("require error "+b,a);e.remove()}var e=null;b=b.replace("0/8","0.8");var d=x.getObject(a.replaceAll("/",".",b))||x.getObject(b);if(d&&d.prototype&&d.prototype.reloadModule)d.prototype.reloadModule();else{var e=C.on("error",k),f=x.getObject(a.replaceAll("/",".",b))||x.getObject(b);if(!f&&(f="undefined"!==
typeof b?f:null,!f&&"undefined"!==typeof window))if(f=a.getAt(window,a.replaceAll("/",".",b),null))d=f;else try{f=C(a.replaceAll(".","/",b))}catch(l){}f&&(d=f);C.undef(b);var h=this;c&&setTimeout(function(){C({waitSeconds:5});try{C([b],function(a){A.log("reloaded module : "+b+(null!==f?" have obj":"have no obj"));C({cacheBust:null});_.isString(a)?A.error("module reloaded failed : "+a+" for module : "+b):(a.modulePath=b,d&&(h.mergeFunctions(d.prototype,a.prototype),d.prototype&&d.prototype._onReloaded&&
d.prototype._onReloaded(a)),h.publish(g.EVENTS.ON_MODULE_RELOADED,{module:b,newModule:a}),a.prototype&&a.prototype.declaredClass&&h.publish(g.EVENTS.ON_MODULE_UPDATED,{moduleClass:a.prototype.declaredClass,moduleProto:a.prototype}))})}catch(a){A.error("error reloading module",a),logError(a,"error reloading module")}},10)}},fileChanged:function(a){var b=a.path;"changed"===a.type&&this._reloadModule(b,!0)},onAllDevicesStarted:function(){this.profile.test&&(A.error("being in test mode"),this.doTests())},
onReady:function(){this.initDevices();var a=this.getDeviceServer();if(a){var b=this.connection;a.clients||(a.clients=[]);b&&(a.clients.push(b),a.onClientConnection(b))}else A.error("have no device server")},getUserDirectory:function(){return this.profile.user},constructManagers:function(){f=p([f,l],{});this.driverManager=this.createManager(h,null);this.fileManager=this.createManager(d,null);this.blockManager=this.createManager(c,null);this.connection=new z({owner:this});this.deviceManager=this.createManager(f,
null,{deviceServerClient:new y({}),connection:this.connection});if(this.profile){var a=b.resolve(this.profile.system),a={system_drivers:b.resolve(a+"/system/drivers"),system_devices:b.resolve(a+"/system/devices")};if(this.profile.user){var e=b.resolve(this.profile.user);a.user_drivers=b.resolve(e+"/drivers");a.user_devices=b.resolve(e+"/devices");this.userDirectory=e}this.resourceManager=this.createManager(k);this.resourceManager.resourceVariables={VFS_CONFIG:a}}},onLoaded:function(){},initDevices:function(){var a=
this.profile,c=b.resolve(a.system),k=this.getDeviceManager(),e=this.getDriverManager(),d=a.serverSide;e.createStore({items:this.getDrivers(b.resolve(c+"/system/drivers"),"system_drivers")},"system_drivers",!0);k.initStore({items:this.getDevices(b.resolve(c+"/system/devices"),"system_devices",{serverSide:d})},"system_devices",!0);a.user&&(e.createStore({items:this.getDrivers(b.resolve(a.user+"/drivers"),"user_drivers")},"user_drivers",!0),k.initStore({items:this.getDevices(b.resolve(a.user+"/devices"),
"user_devices",{serverSide:d})},"user_devices",!0));w(k.connectToAllDevices()).then(function(){this.onAllDevicesStarted()}.bind(this))}})})},"nxapp/manager/DriverManager":function(){define("dcl/dcl nxapp/utils/_LogMixin xide/types xcf/manager/DriverManager nxapp/utils/_console dojo/node!path xide/mixins/EventedMixin xide/mixins/ReloadMixin dojo/Deferred xcf/model/Variable nxapp/utils".split(" "),function(p,r,n,q,b,m,a,g,h,f,d){return p([q,r],{declaredClass:"nxapp.manager.DriverManager",createDriverInstance:function(e){var l=
this.ctx;l.getConnectionManager();var c=l.getDeviceManager(),k=l.getDriverManager(),t=e.driverScope,q=e.deviceScope,r=new h,E=e.system_drivers+"/DriverBase.js",x=e[t]+"/"+e.driver,w=e.driverId,C=e.deviceId||e.id,y=e[t],z=e[q],D=e.hash,u=k.getDriverById(w),F=c.getDeviceById(C,c.stores[q]);if(!u){if(!y)return b.error("invalid drivers path "+y,e),r.reject("invalid drivers path "+y),r;C=l.getDrivers(m.resolve(y),t);if(!C||!C.length)return r.reject("have no devices at "+y),r;y=this.createStore({items:C},
t,!1);u=k.getDriverById(w,y);if(!u)return r.reject("cant find driver "+w),r}if(!F){k=l.getDevices(m.resolve(z),q);if(!k||!k.length)return r.reject("have no devices at "+z),r;F=c.initStore({items:k},q,!1).getSync(e.devicePath);if(!F)return r.reject("cant find device "+e.devicePath),r}F.info=e;var G=this;require(["system_drivers/DriverBase"],function(k){k.prototype.declaredClass=E;require([t+"/"+e.driver.replace(".js","")],function(f){f=new (p([k,a.dcl,g.dcl,f],{}));f.declaredClass=x;f.options=e;f.baseClass=
k.prototype.declaredClass;f.modulePath=x;f.delegate=c;f.driver=u;f.serverSide=e.serverSide;f.utils=d;f.types=n;f.device=F;f.getDevice=function(){return this.device};f.getDeviceInfo=function(){return this.getDevice().info};var h=u.user,t=d.getCIByChainAndName(h,0,n.DRIVER_PROPERTY.CF_DRIVER_COMMANDS);t&&t.params&&(f.sendSettings=d.getJson(t.params));(h=d.getCIByChainAndName(h,0,n.DRIVER_PROPERTY.CF_DRIVER_RESPONSES))&&h.params&&(f.responseSettings=d.getJson(h.params));try{f.start(),f.initReload()}catch(m){b.error("crash in driver instance startup! "+
F.toString())}G.driverInstance=f;h=w+"_"+D+"_"+F.path;u.blox&&u.blox.blocks||(b.error("Attention : INVALID driver",F.toString()),u.blox={blocks:[]});u.blockPath&&(d.getJson(d.readFile(u.blockPath)),u.blox=d.getJson(d.readFile(u.blockPath)));h=l.getBlockManager().createScope({id:h,device:F,driver:u,instance:f,ctx:l,serverSide:e.serverSide,getContext:function(){return this.instance}},dojo.clone(u.blox.blocks));f.blockScope=h;F.blockScope=h;F.driverInstance=f;G.blockScope=h;r.resolve({driverInstance:f,
blockScope:h})})});r.then(function(a){var c=a.blockScope;c.getBlocks({group:n.BLOCK_GROUPS.CF_DRIVER_RESPONSE_BLOCKS});c.getVariables({group:n.BLOCK_GROUPS.CF_DRIVER_RESPONSE_VARIABLES});a=c.getVariable("value");a||(a=new f({id:d.createUUID(),name:"value",value:"",scope:c,type:13,group:"processVariables",gui:!1,cmd:!1}),c.blockStore.putSync(a));a=[];var k=c.getBlocks({group:n.COMMAND_TYPES.INIT_COMMAND});try{_.each(k,function(a){!1!==a.enabled&&!0!==a.__started&&(a.solve(c),a.__started=!0)})}catch(e){b.error("starting init blocks failed",
e)}a=a.concat(c.getBlocks({group:n.COMMAND_TYPES.BASIC_COMMAND}));for(k=0;k<a.length;k++){var l=a[k];l.enabled&&l.start&&l.startup&&!0!==l.__started&&(l.start(),l.__started=!0)}});return r}})})},"xcf/manager/DriverManager":function(){define("dcl/dcl dojo/_base/declare dojo/_base/lang dojo/_base/json xide/types xcf/types/Types xide/utils xcf/manager/BeanManager xcf/model/Variable xcf/manager/DriverManager_Server xide/data/TreeMemory xide/data/ObservableStore dstore/Trackable xdojo/has xcf/model/Driver xide/manager/ServerActionBase xide/data/Reference dojo/Deferred xide/mixins/ReloadMixin xide/mixins/EventedMixin xdojo/has!xcf-ui?./DriverManager_UI xdojo/has!xcf-ui?xide/views/_CIDialog".split(" "),
function(p,r,n,q,b,m,a,g,h,f,d,e,l,c,k,t,v,A,E,x,w,C){n=[t,g,f];c("runDrivers");c("xcf-ui")&&n.push(w);return p(n,{loadDriverModule:function(c){var k=this.driverScopes.system_drivers+"DriverBase",e=require.toUrl(this.driverScopes.system_drivers);decodeURIComponent(e);var d=this,f=new A,l=require;l([k],function(k){var e=d.driverScopes[c.scope],h=!require.cache;h?require({config:{urlArgs:null}}):require({cacheBust:null});e=require.toUrl(e);h&&(e=e.replace("/.js","/"));var g=a.getCIInputValueByName(c.user,
b.DRIVER_PROPERTY.CF_DRIVER_CLASS),g=g.replace("./",""),g=g.replace(".js",""),g=c.scope+"/"+g,g=g.replace("","").trim();try{l.undef(g),l([g],function(a){function b(c,k){a.getFields=c.getFields;c.onReloaded=b;k.onReloaded=b}a.declaredClass=g;p([k,x.dcl,E.dcl,a],{}).getFields=a.getFields;a.onReloaded=b;f.resolve(a)})}catch(t){}});return f},getBlock:function(b){b=a.parse_url(b);b=a.urlArgs(b.host);var c=this.getItemById(b.driver.value),k=null;c&&c.blockScope&&(k=c.blockScope.getBlockById(b.block.value));
return k},getDriverByUrl:function(b){b=a.parse_url(b);b=a.urlArgs(b.host);return this.getItemById(b.driver.value)},declaredClass:"xcf.manager.DriverManager",addDeviceInstance:function(a,c){c.directory=!0;var k=c._store,e=c.path,d=this.ctx.getDeviceManager(),f=k.getSync(e+"_instances"),f=f||k.putSync({path:e+"_instances",name:"Instances",isDir:!0,type:"leaf",parentId:e,virtual:!0,isCommand:!1,icon:"fa-folder",children:[]}),e=d.getMetaValue(a,b.DEVICE_PROPERTY.CF_DEVICE_TITLE),k=k.putSync(new v({name:e,
isCommand:!1,path:f.path+"_instance_"+a.path,isDir:!1,type:"driver_instance",parentId:f.path,device:a,driver:c,_mayHaveChildren:!1,icon:a.iconClass,state:a.state}));f.children.push(k);a.addReference(k,{properties:{name:!0,enabled:!0,state:!0,iconClass:!0},onDelete:!1},!0);!c.instances&&(c.instances=[]);if(f=_.find(c.instances,{path:k.path}))console.log("instance already added "),c.instances.remove(f);c.instances.push(k)},beanNamespace:"driver",beanName:"Driver",beanIconClass:"fa-exchange",groupType:b.ITEM_TYPE.DRIVER_GROUP,
itemType:b.ITEM_TYPE.DRIVER,itemMetaTitleField:b.DRIVER_PROPERTY.CF_DRIVER_NAME,defaultScope:"system_drivers",serviceClass:"XCF_Driver_Service",rawData:null,store:null,treeView:null,driverScopes:null,_isLoading:!1,removeDriverInstance:function(a,b){var c=a.driver,k=c._store,e=c.path,d=e+"_instances_instance_"+b.path,f=k.getSync(d);f&&k.removeSync(d);(d=_.find(c.instances,{path:d}))&&c.instances.remove(d);b.removeReference(f);f&&(f.refresh(),k.getSync(e+"_instances").refresh())},onReloaded:function(){},
_onReloaded:function(){},onDeviceMessage:function(a){},_driverQueryCache:null,_getDriverById:function(c,k){var e=a.queryStore(k,{isDir:!1});_.isArray(e)||(e=[e]);for(var d=0;d<e.length;d++){var f=e[d],l=a.getInputCIByName(f.user,b.DRIVER_PROPERTY.CF_DRIVER_ID);if(l&&l.value==c)return k.getSync(f.path)}return null},getDriverById:function(a,b){if(b)return this._getDriverById(a,b);var k=null,e=null;c("xcf-ui");for(var d in this.stores)if(b=this.stores[d],k=this._getDriverById(a,b)){e=k;break}c("xcf-ui");
return e},getDriverByPath:function(b){var c=null,k;for(k in this.stores){a:{c=a.queryStore(this.stores[k],{isDir:!1});_.isArray(c)||(c=[c]);for(var e=0;e<c.length;e++){var d=c[e];if(d.path==b){c=d;break a}}c=null}if(c)return c}return null},getItemById:function(a){return this.getDriverById(a)},onNewDriverScopeCreated:function(a){},onScopeCreated:function(a){},onDeviceDisconnected:function(a){},onDriverCreated:function(a){c("xcf-ui")&&b.registerEnumeration("Driver",this.getDriversAsEnumeration(a))},
onDriverRemoved:function(a,k){c("xcf-ui")&&b.registerEnumeration("Driver",this.getDriversAsEnumeration(a))},onStoreReady:function(a){c("xcf-ui")&&b.registerEnumeration("Driver",this.getDriversAsEnumeration(a))},onStoreCreated:function(a){var k=a.type;a=a.store;var e=a.query({isDir:!1});if(k===b.ITEM_TYPE.DRIVER)for(k=0;k<e.length;k++){var d=e[k];null==d._completed&&"Default"!==d.name&&(d._completed=!0,c("xcf-ui")&&this.completeDriver(a,d,d))}},createStore:function(b,c,f){b=new (r("driverStore",[d,
l,e],{}))({data:b.items,Model:k,idProperty:"path",scope:c,id:a.createUUID(),observedProperties:["name","enabled"]});c&&!1!==f&&this.setStore(c,b);return b},initStore:function(a,b,c){return this.createStore(a,b,c)},getStore:function(a){a=a||"system_drivers";var b=this.stores[a];return b?b:this.ls(a)},ls:function(a,k){function e(c){try{var f=this.createStore(c,a,k);!1!==k&&this.setStore(a,f);this.onStoreReady(f);!1!==k&&this.publish(b.EVENTS.ON_STORE_CREATED,{data:c,owner:this,store:f,type:this.itemType});
d.resolve(f)}catch(l){logError(l,"error ls drivers")}}var d=new A;c("php")?this.runDeferred(null,"ls",[a]).then(e.bind(this)):d.resolve({items:[]});return d},init:function(){var a=this,c=b.EVENTS;this.stores={};this.subscribe([c.ON_SCOPE_CREATED,c.ON_STORE_CREATED]);this.subscribe(c.ON_BLOCK_EXPRESSION_FAILED,function(b){a.publish(c.ON_SERVER_LOG_MESSAGE,{data:{type:"Expression",device:b.deviceInfo},level:"error",message:"Expression Failed: "+b.item.title+" : "+b.item.value})});this.driverScopes=
{system_drivers:"system_drivers/",user_drivers:"user_drivers/"}}})})},"xcf/manager/BeanManager":function(){define("dcl/dcl xdojo/declare dojo/_base/lang xide/types xide/utils xide/manager/BeanManager dojo/Deferred xdojo/has!xcf-ui?xide/views/ActionDialog xdojo/has!xcf-ui?xide/views/CIActionDialog xdojo/has!xcf-ui?xide/views/CIGroupedSettingsView".split(" "),function(p,r,n,q,b,m,a,g,h,f,d){return p(m,{declaredClass:"xcf.manager.BeanManager",setStore:function(a,b){var c=this.stores[a];c&&(c.destroy(),
delete this.stores[a]);return this.stores[a]=b},getFile:function(b){var d=new a,c=this.ctx.getFileManager().getStore(b.scope);c.initRoot().then(function(){c._loadPath(".",!0).then(function(){c.getItem(b.path,!0).then(function(a){d.resolve(a)})})});return d},toUrl:function(a,b,c,k){return n.replace((k||"")+"deviceScope\x3d{deviceScope}\x26device\x3d{deviceId}\x26driver\x3d{driverId}\x26driverScope\x3d{driverScope}\x26block\x3d{block}",{deviceId:a.id,deviceScope:a.scope,driverId:b.id,driverScope:b.scope,
block:c.id})},openItemSettings:function(a,f){var c=a.user;if(!c||!c.inputs)return null;var k=this.getViewId(a),h=g.byId(k);try{if(h)return h.parentContainer&&h.parentContainer.selectChild(h),null}catch(m){b.destroy(h)}var h=this.ctx.mainView.getDocker(),n=this.getMetaValue(a,this.itemMetaTitleField),p=f?this.ctx.getDeviceManager().toDeviceControlInfo(f):null,h=h.addTab(null,{title:(n||a.name)+""+(f?":"+f.name+":"+p.host+":":""),icon:this.beanIconClass});if(n=b.getCIByChainAndName(c,0,q.DRIVER_PROPERTY.CF_DRIVER_COMMANDS))n.device=
f;a.blockScope&&!a.blockScope.serviceObject&&(a.blockScope.serviceObject=this.serviceObject);return b.addWidget(d,{cis:c.inputs,storeItem:a,iconClass:this.beanIconClass,id:k,delegate:this,storeDelegate:this,blockManager:this.ctx.getBlockManager(),options:{groupOrder:{General:1,Settings:2,Visual:3}}},this,h,!0)},newGroup:function(){var a=this,d=this.getItem(),c=d?!0===d.isDir?d.path:"":"",d=new f({title:"New "+this.groupType,delegate:{onOk:function(k,d){var f=b.getCIInputValueByName(d,"Title"),l=b.getCIInputValueByName(d,
"Scope");a.createGroup(l,c+"/"+f,function(b){b=a.createNewGroupItem(f,l,c);a.store.putSync(b);a.publish(q.EVENTS.ON_STORE_CHANGED,{owner:a,store:a.store,action:q.NEW_DIRECTORY,item:b})})}},cis:[b.createCI("Title",13,""),b.createCI("Scope",3,this.defaultScope,{options:[{label:"System",value:this.defaultScope},{label:"User",value:this.userScope},{label:"App",value:this.appScope}]})]});d.startup();d.show()},onDeleteItem:function(a){var d=!0===b.toBoolean(a.isDir),c=d?"removeGroup":"removeItem",k=this;
(new h({title:"Remove "+this.beanName+(d?" Group":"")+' "'+a.name+'"  ',style:"max-width:400px",titleBarClass:"text-danger",delegate:{isRemoving:!1,onOk:function(d){k[c](b.toString(a.scope),b.toString(a.path),b.toString(a.name),function(){k.onItemDeleted(a);k.publish(q.EVENTS.ON_STORE_CHANGED,{owner:k,store:k.store,action:q.DELETE,item:a})})}}})).show()},hasItemActions:function(){return!0},onItemDeleted:function(a){this.store.removeSync(a.path);a==this.currentItem&&(this.currentItem=null);a&&(a=this.getView(a))&&
b.destroyWidget(a)},onItemSelected:function(a){this.currentItem=a},onCIUpdate:function(a){a.owner===this&&this.updateCI(a.ci,a.newValue,a.oldValue,a.storeItem)},createNewGroupItem:function(a,b,c){return this.createItemStruct(a,b,c,a,!0,this.groupType)},createNewItem:function(a,b,c){return this.createItemStruct(a,b,c,c+"/"+a,!1,this.itemType)},init:function(){this.subscribe(q.EVENTS.ON_CI_UPDATE)},createItem:function(a,b,c,k,d){return this.runDeferred(null,"createItem",[a,b,c,k,d])},ls:function(a){return this.runDeferred(null,
"ls",[a]).then(function(a){try{this.rawData=a,this.initStore(a),this.publish(q.EVENTS.ON_STORE_CREATED,{data:a,owner:this,store:this.store,type:this.itemType})}catch(b){logError(b,"error ls")}}.bind(this))}})})},"xide/manager/BeanManager":function(){define("dcl/dcl dojo/_base/lang xide/utils xide/encoding/MD5 xide/registry xide/data/TreeMemory".split(" "),function(p,r,n,q,b,m){return p(null,{declaredClass:"xide.manager.BeanManager",beanNamespace:"beanNS",beanName:"beanName",createItemStruct:function(a,
b,h,f,d,e){return{name:a,isDir:d,parentId:h,path:f,beanType:e,scope:b}},getMetaValue:function(a,b){return n.getCIInputValueByName(n.getAt(a,this.itemMetaPath||"user"),b)},setCurrentItem:function(a){},getItem:function(){},onItemSelected:function(a){},onItemAdded:function(a){},onItemRemoved:function(a){},reload:function(){},getViewTarget:function(){return this.ctx.getApplication().mainView.getNewAlternateTarget()},getRightTopTarget:function(a,b,h,f){return this.ctx.getApplication().mainView.getRightTopTarget(a,
b,h,f)},getLayoutRightMain:function(a,b){return this.ctx.getApplication().mainView.getLayoutRightMain(a,b)},getRightBottomTarget:function(a,b){return this.ctx.getApplication().mainView.getRightBottomTarget(a,b)},getViewId:function(a,b){return this.beanNamespace+q(n.toString(a.scope)+n.toString(a.path),1)+(null!=b?b:"")},getView:function(a,g){var h=this.getViewId(a,g);return b.byId(h)},getStore:function(){return this.store},isValid:function(){return null!=this.store},initStore:function(a){this.store=
new m({data:a.items,idProperty:"path"});this.onStoreReady(this.store);return this.store},onStoreReady:function(){},createGroup:function(a,b,h){return this.callMethodEx(null,"createGroup",[a,b],h,!0)},removeGroup:function(a,b,h,f){return this.callMethodEx(null,"removeGroup",[a,b,h],f,!0)},removeItem:function(a,b,h,f){return this.callMethodEx(null,"removeItem",[a,b,h],f,!0)},updateCI:function(a,b,h,f){a&&f&&this.updateItemMetaData(n.toString(f.scope),n.toString(f.path),this.itemMetaStorePath||"/inputs",
{id:n.toString(a.id)},{value:b})},updateItemMetaData:function(a,b,h,f,d,e,l){return this.callMethodEx(null,"updateItemMetaData",[a,b,h,f,d],e,!1)},mergeNewModule:function(a){for(var b in a){var h=a[b];h&&_.isFunction(h)&&(this[b]=h)}},_onReloaded:function(a){this.mergeNewModule(a.prototype);a=this.declaredClass;(a=r.getObject(n.replaceAll("/",".",a))||r.getObject(a))&&a.prototype&&a.prototype.solve&&this.mergeNewModule(a.prototype)}})})},"xide/registry":function(){define(["dojo/_base/array","dojo/_base/window",
"xdojo/has"],function(p,r,n){var q={},b={},m={length:0,add:function(a){this._hash[a.id]&&(this.remove(a.id),this.add(a));b[a.id]=a;this.length++},remove:function(a){b[a]&&(delete b[a],this.length--)},byId:function(a){return"string"==typeof a?b[a]:a},byNode:function(a){return b[a.getAttribute("widgetId")]},toArray:function(){return _.values(_.mapKeys(b,function(a,b){a.id=b;return a}))},getUniqueId:function(a){var g;do g=a+"_"+(a in q?++q[a]:q[a]=0);while(b[g]);return g},findWidgets:function(a,g){function h(a){for(a=
a.firstChild;a;a=a.nextSibling)if(1==a.nodeType){var e=a.getAttribute("widgetId");e?(e=b[e])&&f.push(e):a!==g&&h(a)}}var f=[];h(a);return f},_destroyAll:function(){_.each(m.findWidgets(r.body()),function(a){a._destroyed||(a.destroyRecursive?a.destroyRecursive():a.destroy&&a.destroy())})},getEnclosingWidget:function(a){for(;a;){var g=1==a.nodeType&&a.getAttribute("widgetId");if(g)return b[g];a=a.parentNode}return null},_hash:b};return m})},"xcf/manager/DriverManager_Server":function(){define(["dcl/dcl",
"dojo/_base/lang","dojo/_base/declare","xide/types","xide/utils"],function(p,r,n,q,b){return p(null,{declaredClass:"xcf.manager.DriverManager_Server",onDriverBlocksChanged:function(m,a){var g=[],h=this.getStore()||this.store;if(!h)return console.error("getDriversAsEnumeration:: have no store!"),g;g=h.query({isDir:!1});for(h=0;h<g.length;h++){var f=g[h],d=f.user;b.getInputCIByName(d,q.DRIVER_PROPERTY.CF_DRIVER_ID);b.getInputCIByName(d,q.DRIVER_PROPERTY.CF_DRIVER_NAME);d&&f.blockPath&&f.blockPath.indexOf(a)}},
onFileChanged:function(m){if("changed"===m.type&&!m._didb){m._didb=!0;var a=b.replaceAll("\\","/",m.path),a=b.replaceAll("//","/",a),a=a.replace(/\\/g,"/"),g;g=a;g=-1!=g.indexOf("system/driver")?g.substr(g.indexOf("system/driver")+14,g.length):null;g&&-1!==g.indexOf(".xblox")&&(console.log("driver blocks changed "+g+" @ "+a,m),this.onDriverBlocksChanged(a,g))}},createDriverInstance:function(m,a){var g=this,h=this.driverScopes.system_drivers+"DriverBase";require([h],function(f){f.prototype.declaredClass=
h;var d=g.driverScopes[m.scope],e=b.getCIInputValueByName(m.user,q.DRIVER_PROPERTY.CF_DRIVER_CLASS);if(e){var l=d+e,l=l.replace(".js",""),l=l.replace("./","");console.log("create driver instance "+l);require([l],function(c){c=new (n([f],c.prototype));c.baseClass=f.prototype.declaredClass;c.modulePath=b.replaceAll("//","/",l);c.delegate=g;m.instance=c;a&&a(c);try{c.start()}catch(k){}return c})}else console.error("cant find driver class in meta")})},onDeviceDisconnected:function(b){},onDeviceMessage:function(m){if(m&&
m.device&&m.driverInstance){var a=m.device,g=m.driverInstance,h=g.options;if(h){var f=[m.deviceMessage];_.isString(m.deviceMessage)&&-1!=m.deviceMessage.indexOf(g.lineBreak)&&(f=m.deviceMessage.split(g.lineBreak));if(0<f.length){m=this.ctx.getBlockManager().getScope(h.id);g=m.getBlocks({group:q.BLOCK_GROUPS.CF_DRIVER_RESPONSE_BLOCKS});h=m.getVariables({group:q.BLOCK_GROUPS.CF_DRIVER_RESPONSE_VARIABLES});g&&0!=g.length||console.log("have no response blocks, abort");var d=m.getVariable("value");d||
(d=new Variable({id:b.createUUID(),title:"value",value:"",scope:m,type:13,group:"processVariables",gui:!1,cmd:!1}));for(var e=0;e<f.length;e++)if(0!=f[e].length){d.value=f[e];console.log("update process value "+d.value+" for "+a.host);this.publish(q.EVENTS.ON_DRIVER_VARIABLE_CHANGED,{item:d,scope:m,owner:this});for(var l=0;l<h.length;l++)"value"!=h[l].title&&m.expressionModel.parseVariable(m,h[l]);for(l=0;l<g.length;l++)m.solveBlock(g[l],{highlight:!0})}console.log("forward messages to scope")}}}},
init:function(){this.subscribe(q.EVENTS.ON_DEVICE_MESSAGE,this.onDeviceMessage);this.subscribe(q.EVENTS.ON_DEVICE_DISCONNECTED,this.onDeviceDisconnected)}})})},"xcf/model/Driver":function(){define(["dojo/_base/declare","xide/data/Model","xide/utils"],function(p,r,n){return p(r,{itemMetaPath:"user.meta",getStore:function(){return this._store},getScope:function(){var q=this.getStore();return q?q.scope:this.scope},getMetaValue:function(q){return n.getCIInputValueByName(this.user,q)},setMetaValue:function(q,
b,m){var a=n.getCIByChainAndName(this.user,0,q);if(!a)return null;var g=this.getMetaValue(q);n.setCIValueByField(a,"value",b);this[q]=b;if(!1!==m)return this.publish(types.EVENTS.ON_CI_UPDATE,{owner:this.owner,ci:a,newValue:b,oldValue:g})},getParent:function(){return this._store.getSync(this.parentId)}})})},"xide/data/Model":function(){define("dcl/dcl dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/aspect dojo/when".split(" "),function(p,r,n,q,b,m){function a(a,b){var c=a.schema[b];void 0===
c||c instanceof E||(c=new E(c),c._parent=a);c&&(c.name=b);return c}function g(b,c){var k,e=b.hasOwnProperty("_properties")&&b._properties[c];k=e;e||(e=a(b,c))&&e.validate&&(e=n.delegate(e,{_parent:b,key:c}));return e&&e.validate?m(e.validate(),function(a){a||k||((b.hasOwnProperty("_properties")?b._properties:b._properties=new A)[c]=e);return a}):!0}function h(a){var b,c=1;a(function(a,k,e){a&&a.then?(c++,b||(b=new q),a.then(function(a){k(a,e);c--;c||b.resolve()}).then(null,b.reject)):k(a,e)});if(b)return c--,
c||b.resolve(),b.promise}function f(){2>c&&t&&(t(),t=null);c--}function d(){return d}var e=[].slice,l=r("xide/data/Model",null,{schema:{},additionalProperties:!0,_scenario:"update",constructor:function(a){this.init(a)},refresh:function(a){var b=this._store;b&&b.refreshItem(this,a)},getStore:function(){return this._store},init:function(a){this._scenario="insert";a=this._setValues(a);for(var b in this.schema){var c=this.schema[b];c&&"object"===typeof c&&"default"in c&&!a.hasOwnProperty(b)&&(c=c["default"],
a[b]="function"===typeof c?c.call(this):c)}},_setValues:function(a){return n.mixin(this,a)},_getValues:function(){return this._values||this},save:function(a){var b=this;return m(a&&a.skipValidation?!0:this.validate(),function(a){if(!a)throw b.createValidationError(b.errors);a=b._scenario;b.prepareForSerialization();return b._store&&m(b._store["insert"===a?"add":"put"](b),function(a){b.set(a);b._scenario="update";return b})})},remove:function(){var a=this._store;return a.remove(a.getIdentity(this))},
prepareForSerialization:function(){this._scenario=void 0;this._inherited&&(this._inherited.toJSON=d)},createValidationError:function(a){return Error("Validation error")},property:function(b,c){var k=this.hasOwnProperty("_properties")?this._properties:this._properties=new A,d=k[b];d||(d=a(this,b),d=k[b]=d?n.delegate(d):new E,d.name=b,d._parent=this);return c?d.property.apply(d,e.call(arguments,1)):d},get:function(b){var c,k=this.schema[b];return(k=c||this.schema[b])&&k.valueOf&&(k.valueOf!==x||k.hasCustomGet)?
((c=c||this.hasOwnProperty("_properties")&&this._properties[b])||(c=n.delegate(a(this,b),{name:b,_parent:this})),c.valueOf()):this._getValues()[b]},set:function(a,b){if("object"===typeof a){c++;try{for(var k in a)b=a[k],!a.hasOwnProperty(k)||b&&b.toJSON===d||this.set(k,b)}finally{f()}}else{k=this.schema[a];if(!k&&!this.additionalProperties)return console.warn("Schema does not contain a definition for",a);var e=this.hasOwnProperty("_properties")&&this._properties[a];!e&&(b&&"object"===typeof b||k&&
k.put!==w)&&(e=this.property(a));e?e.put(b):(k&&k.coerce&&(b=k.coerce(b)),this._getValues()[a]=b,k&&!1!==k.validateOnSet&&g(this,a));return b}},observe:function(a,b,c){return this.property(a).observe(b,c)},validate:function(a){var b=this,c=!0,k=[],e;if(a){e={};for(var d=0;d<a.length;d++)e[d]=!0}return m(h(function(a){for(var d in b.schema)e&&!e.hasOwnProperty(d)||a(g(b,d),function(a,e){a||(c=!1,k.push.apply(k,b.property(e).errors))},d)}),function(){b.set("errors",c?void 0:k);return c})},isValid:function(){var a=
!0,b;for(b in this.schema){var c=this.hasOwnProperty("_properties")&&this._properties[b];c&&c.errors&&c.errors.length&&(a=!1)}return a}}),c=0,k,t;(l.nextTurn=function(a){t=a}).atEnd=!0;var v=r([l],{observe:function(a,b){var c;if("string"===typeof a)return this.inherited(arguments);b&&b.onlyFutureUpdates||(c=new v,this._has()&&(c.value=a(this.valueOf())));var k=this._addListener(function(b){b=a(b);c&&c.put(b)});return c?(c.remove=k.remove,c):k},validateOnSet:!1,validators:null,_addListener:function(a){return b.after(this,
"onchange",a,!0)},valueOf:function(){return this._get()},_get:function(){return this.value},_has:function(){return this.hasOwnProperty("value")},setValue:function(a){this.value=a},put:function(a){var b=this._get();a=this.coerce(a);this.errors&&this.set("errors",void 0);var k=this;c++;return m(this.setValue(a,this._parent),function(c){void 0!==c&&(a=c);k.onchange&&k._queueChange(k.onchange,b);var e,d=b&&"object"===typeof b&&!(b instanceof Array),l=a&&"object"===typeof a&&!(a instanceof Array);if(d||
l){c={};if(d)for(e in b=b._getValues?b._getValues():b,b)c[e]={old:b[e]};if(l)for(e in a=a._getValues?a._getValues():a,a)(c[e]=c[e]||{}).value=a[e];k._values=l&&a;for(e in c)d=c[e],(l=k._properties&&k._properties[e])&&l.onchange&&l._queueChange(l.onchange,d.old)}k.validateOnSet&&k.validate();f()})},coerce:function(a){var b=this.type;b&&("string"===b?a=""+a:"number"===b?a=+a:"boolean"===b?a="false"===a||"0"===a||a instanceof Array&&!a.length?!1:!!a:"function"!==typeof b||a instanceof b||(a=new b(a)));
return a},addError:function(a){this.set("errors",(this.errors||[]).concat([a]))},checkForErrors:function(a){var b=[];this.type&&!("function"===typeof this.type?a instanceof this.type:this.type===typeof a)&&b.push(a+" is not a "+this.type);!this.required||null!=a&&""!==a||b.push("required, and it was not present");return b},validate:function(){var a=this,b=this._parent,c=this.validators,k=this.valueOf(),e=[];return m(h(function(d){function f(a){a&&e.push.apply(e,a)}if(c)for(var l=0;l<c.length;l++)d(c[l].checkForErrors(k,
a,b),f);d(a.checkForErrors(k,a,b),f)}),function(){if(e.length)return a.set("errors",e),!1;void 0!==a.get("errors")&&a.set("errors",void 0);return!0})},_queueChange:function(a,b){if(!a._queued){a._queued=!0;var e=this,d=function(){a._queued=!1;a.call(e,e._get(),b)};k&&k.push(d);k||(!l.nextTurn.atEnd||0<c?(k=[d],l.nextTurn(function(){for(var a=0;a<k.length;a++)k[a]();k=null})):d())}},toJSON:function(){return this._values||this}}),A=function(){};A.prototype.toJSON=d;var E=l.Property=r(v,{init:function(a){if("string"===
typeof a||"function"===typeof a)a={type:a};a&&r.safeMixin(this,a)},_get:function(){return this._parent._getValues()[this.name]},_has:function(){return this.name in this._parent._getValues()},setValue:function(a,b){b._getValues()[this.name]=a}}),x=E.prototype.valueOf,w=E.prototype.put;return l})},"xide/manager/ServerActionBase":function(){define("dcl/dcl dojo/_base/declare xdojo/has dojo/Deferred xide/manager/RPCService xide/manager/ManagerBase xide/types xide/utils".split(" "),function(p,r,n,q,b,
m,a,g){n={declaredClass:"xide.manager.ServerActionBase",serviceObject:null,serviceUrl:null,singleton:!0,serviceClass:null,defaultOptions:{omit:!0,checkMessages:!0,checkErrors:!0},base64_encode:function(a){var b,d,e,l,c=0,k=0,g="",g=[];if(!a)return a;do b=a.charCodeAt(c++),d=a.charCodeAt(c++),e=a.charCodeAt(c++),l=b<<16|d<<8|e,b=l>>18&63,d=l>>12&63,e=l>>6&63,l&=63,g[k++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(b)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(d)+
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(e)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(l);while(c<a.length);g=g.join("");a=a.length%3;return(a?g.slice(0,a-3):g)+"\x3d\x3d\x3d".slice(a||3)},runDeferred:function(b,f,d,e){var l=new q,c;e=e||this.defaultOptions;this.check();if(!this.checkCall(b,f,e.omit))return l.reject("method doesnt exists: "+f+" for service class:"+this.serviceClass+" in "+this.declaredClass);this.prepareCall();
var k=this.getService(),g=this.getServiceClass(b),m=this,n=function(a,b){var k=l;e.returnProm&&(k=c);k._data=a;if(b&&e.onError)return e.onError(b);k.resolve(a)};c=k[g][f](d);c.then(function(b){b=b||{};var c=b.error||{};if(e.checkMessages&&c&&3==c.code)m.onMessages(c);if(e.checkErrors){if(1==c.code){m.onError(c,g+"::"+f);l.reject(c);return}}else{if(1==c.code&&e.displayError)m.onError(c,g+"::"+f);if(c&&0!=c.code){n(b,c);return}}e.omit&&m.publish(a.EVENTS.STATUS,{message:"Ok!",what:arguments},this);
n(b)},function(a){m.onError(a)});return e.returnProm?c:l},getService:function(){return this.serviceObject},getServiceClass:function(a){return a||this.serviceClass},hasMethod:function(a,b){var d=this.getService(),e=b||this.getServiceClass();return d&&e&&null!=d[e]&&null!=d[e][a]},findServiceUrl:function(a){var b=window.xFileConfig;if(b&&b.mixins)for(var d=0;d<b.mixins.length;d++){var e=b.mixins[d];if(e.declaredClass===a&&e.mixin&&e.mixin.serviceUrl)return decodeURIComponent(e.mixin.serviceUrl)}return null},
init:function(){this.check()},_initService:function(){return!1},check:function(){this.serviceObject||this._initService()},onError:function(b,f){if(b)if(1===b.code){if(b.message&&_.isArray(b.message)){this.publish(a.EVENTS.ERROR,{message:b.message.join("\x3cbr/\x3e")});return}}else 0===b.code&&this.publish(a.EVENTS.STATUS,"Ok");f&&(b.message=f+" -\x3e "+b.message);this.publish(a.EVENTS.ERROR,{error:b},this)},checkCall:function(a,b,d){a=this.getServiceClass(a);return this.getService()?this.hasMethod(b,
a)||!0!==d?!0:(this.onError({code:1,message:["Sorry, server doesnt know "+b]}),!1):!1},prepareCall:function(){var a={};this.config&&this.config.RPC_PARAMS&&(a=g.mixin(a,this.config.RPC_PARAMS.rpcFixedParams),this.serviceObject.extraArgs=a,this.config.RPC_PARAMS.rpcUserField&&(a[this.config.RPC_PARAMS.rpcUserField]=this.config.RPC_PARAMS.rpcUserValue,this.serviceObject.signatureField=this.config.RPC_PARAMS.rpcSignatureField,this.serviceObject.signatureToken=this.config.RPC_PARAMS.rpcSignatureToken))},
callMethodEx:function(b,f,d,e,l){(b=b||this.serviceClass)||console.error("have no service class! "+this.declaredClass,this);this.check();if(this.checkCall(b,f,l)){this.prepareCall();var c=this;if(!this.getServiceClass(b))debugger;var k=this.serviceObject[this.getServiceClass(b)];if(!k||!k[f])debugger;this.serviceObject[this.getServiceClass(b)][f](d).then(function(k){try{e&&e(k)}catch(d){console.error("bad news : callback for method "+f+" caused a crash in service class "+b),logError(d,"server method failed "+
d)}k&&k.error&&3==k.error.code&&setTimeout(function(){c.onMessages(k.error)},50);if(k&&k.error&&k.error&&0!=k.error.code)c.onError(k.error);else 1==l&&c.publish(a.EVENTS.STATUS,{message:"Ok!"},this)},function(a){c.onError(a)})}},callMethodEx2:function(a,b,d,e,l){this.check();if(this.checkCall(a,b,l))return this.prepareCall(),this.serviceObject[this.getServiceClass(a)][b](d)},callMethod:function(b,f,d,e){f=f||[[]];var l=this.serviceClass;try{var c=this;if(null==this.serviceObject[l][b]){if(!0===e)this.onError({code:1,
message:["Sorry, server doesnt know "+b]});return null}l={};l=g.mixin(l,this.config.RPC_PARAMS.rpcFixedParams);l[this.config.RPC_PARAMS.rpcUserField]=this.config.RPC_PARAMS.rpcUserValue;this.serviceObject.extraArgs=l;this.serviceObject.signatureField=this.config.RPC_PARAMS.rpcSignatureField;this.serviceObject.signatureToken=this.config.RPC_PARAMS.rpcSignatureToken;this.serviceObject[this.serviceClass][b](f).then(function(k){try{d&&d(k)}catch(f){console.error("crashed in "+b);console.dir(f);debugger}k&&
k.error&&3==k.error.code&&setTimeout(function(){c.onMessages(k.error)},50);if(k&&k.error&&k.error&&1==k.error.code)c.onError(k.error);else!1!==e&&c.publish(a.EVENTS.STATUS,{message:"Ok!"},this)},function(a){c.onError(a)})}catch(k){console.error("crash! "+k),c.onError(k)}}};p=p(m,n);p.declare=r(null,n);return p})},"xide/manager/RPCService":function(){define("dojo/_base/declare dojo/_base/lang xide/rpc/Service xide/rpc/JsonRPC dojo/has dojo/Deferred xide/utils xide/types xide/mixins/EventedMixin xide/encoding/SHA1".split(" "),
function(p,r,n,q,b,m,a,g,h,f){return p("xide.manager.RPCService",[n,h],{extraArgs:null,signatureField:"sig",signatureToken:null,correctTarget:!0,sync:!1,defaultOptions:{omit:!0,checkMessages:!0,checkErrors:!0},onError:function(a){if(a)if(1===a.code){if(a.message&&_.isArray(a.message)){this.publish(g.EVENTS.ERROR,{message:a.message.join("\x3cbr/\x3e")});return}}else 0===a.code&&this.publish(g.EVENTS.STATUS,"Ok");this.publish(g.EVENTS.ERROR,{error:a},this)},prepareCall:function(){var b={};this.config&&
this.config.RPC_PARAMS&&(this.extraArgs=b=a.mixin(b,this.config.RPC_PARAMS.rpcFixedParams),this.config.RPC_PARAMS.rpcUserField&&(b[this.config.RPC_PARAMS.rpcUserField]=this.config.RPC_PARAMS.rpcUserValue,this.signatureField=this.config.RPC_PARAMS.rpcSignatureField,this.signatureToken=this.config.RPC_PARAMS.rpcSignatureToken))},runDeferred:function(a,b,f,c){var k=new m;c=c||this.defaultOptions;if(!this.checkCall(a,b,c.omit))return k.reject("method doesnt exists: "+b+" for service class:"+this.serviceClass+
" in "+this.declaredClass);this.prepareCall();var h=this;this[this.getServiceClass(a)][b](f).then(function(a){if(c.checkMessages&&a&&a.error&&3==a.error.code)h.onMessages(a.error);c.checkErrors&&a&&a.error&&a.error&&0!=a.error.code?(h.onError(a.error),k.reject(a.error)):(c.omit&&h.publish(g.EVENTS.STATUS,{message:"Ok!",what:arguments},this),k.resolve(a))},function(a){h.onError(a)});return k},getParameterMap:function(a,b){var f=this._smd.services[a+"."+b];return f&&f.parameters?f.parameters:[]},_getRequest:function(a,
b){var f=this._smd,c=n.envelopeRegistry.match(a.envelope||f.envelope||"NONE"),k=(a.parameters||a.params||[]).concat(f.parameters||[]);if(c.namedParams){if(1==b.length&&r.isObject(b[0]))b=b[0];else{for(var g={},h=a.parameters||a.params,m=0;m<h.length;m++)"undefined"==typeof b[m]&&h[m].optional||(g[h[m].name]=b[m]);b=g}if(a.strictParameters||f.strictParameters)for(m in b){g=!1;for(h=0;h<k.length;h++)k[m].name==m&&(g=!0);g||delete b[m]}for(m=0;m<k.length;m++)if(g=k[m],!g.optional&&g.name&&null!=b&&!b[g.name])if(g["default"])b[g.name]=
g["default"];else if(!(g.name in b))throw Error("Required parameter "+g.name+" was omitted");}else k&&k[0]&&k[0].name&&1==b.length&&dojo.isObject(b[0])&&(b=!1===c.namedParams?n.toOrdered(k,b):b[0]);r.isObject(this._options)&&(b=dojo.mixin(b,this._options));k=a._schema||a.returns;m=c.serialize.apply(this,[f,a,b]);m._envDef=c;return dojo.mixin(m,{sync:this.sync,contentType:a.contentType||f.contentType||m.contentType,headers:a.headers||f.headers||m.headers||{},target:m.target||n.getTarget(f,a),transport:a.transport||
f.transport||m.transport,envelope:a.envelope||f.envelope||m.envelope,timeout:a.timeout||f.timeout,callbackParamName:a.callbackParamName||f.callbackParamName,rpcObjectParamName:a.rpcObjectParamName||f.rpcObjectParamName,schema:k,handleAs:m.handleAs||"auto",preventCache:a.preventCache||f.preventCache,frameDoc:this._options.frameDoc||void 0})},_executeMethod:function(a){var b=[],l;if(2==arguments.length&&r.isArray(arguments[1]))b=arguments[1];else for(l=1;l<arguments.length;l++)b.push(arguments[l]);
var c=this._getRequest(a,b);this.correctTarget&&(c.target=this._smd.target);if(this.extraArgs)for(var k in this.extraArgs)c.target+=-1!=c.target.indexOf("?")?"\x26":"?",c.target+=k+"\x3d"+this.extraArgs[k];this.signatureToken&&(c.target+=-1!=c.target.indexOf("?")?"\x26":"?",b=f._hmac(c.data,this.signatureToken,1),b=f._hmac(c.data,this.signatureToken,1),c.target+=this.signatureField+"\x3d"+b);b=n.transportRegistry.match(c.transport).fire(c);b.addBoth(function(a){return c._envDef.deserialize.call(this,
a)});return b},getServiceClass:function(a){return a||this.serviceClass},hasMethod:function(a,b){var f=b||this.getServiceClass();return this&&f&&null!=this[f]&&null!=this[f][a]},checkCall:function(a,b,f){a=this.getServiceClass(a);return this.hasMethod(b,a)||!0!==f?!0:(this.onError({code:1,message:["Sorry, server doesnt know "+b]}),!1)},base64_encode:function(a){var b,f,c,k,g=0,h=0,m="",m=[];if(!a)return a;do b=a.charCodeAt(g++),f=a.charCodeAt(g++),c=a.charCodeAt(g++),k=b<<16|f<<8|c,b=k>>18&63,f=k>>
12&63,c=k>>6&63,k&=63,m[h++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(b)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(f)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(c)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(k);while(g<a.length);m=m.join("");a=a.length%3;return(a?m.slice(0,a-3):m)+"\x3d\x3d\x3d".slice(a||3)},callMethodEx:function(a,b,f,c,k,g){if(!this[a]||null==
this[a][b])return!0===g&&k&&k({code:1,message:["Sorry, server doesnt know "+b+" in class"+a]}),null;g={};this.config&&this.config.RPC_PARAMS&&(g=r.mixin(g,this.config.RPC_PARAMS.rpcFixedParams),g[this.config.RPC_PARAMS.rpcUserField]=this.config.RPC_PARAMS.rpcUserValue,this.extraArgs=g,this.signatureField=this.config.RPC_PARAMS.rpcSignatureField,this.signatureToken=this.config.RPC_PARAMS.rpcSignatureToken);this[a][b](f).then(function(f){try{c&&c(f)}catch(l){console.error("bad news : callback for method "+
b+" caused a crash in service class "+a)}f&&f.error&&f.error&&0!=f.error.code&&k&&k(f.error)},function(a){k(a)})},callMethod:function(a,b,f,c,k,g){try{var h=this;if(null==this[a][b])return!0===g&&k&&k({code:1,message:["Sorry, server doesnt know "+b]}),null;g={};g=r.mixin(g,this.config.RPC_PARAMS.rpcFixedParams);this[a][b](f).then(function(a){try{c&&c(a)}catch(d){console.error("crashed in "+b),console.dir(d)}a&&a.error&&a.error&&1==a.error.code&&k&&k(a.error)},function(a){h.onError(a)})}catch(m){console.error("crash! "+
m)}}})})},"xide/rpc/Service":function(){define("dojo/_base/kernel dojo/_base/lang dojo/_base/xhr dojo/_base/declare xide/rpc/AdapterRegistry dojo/_base/url".split(" "),function(p,r,n,q,b,m){function a(a,b){var c=a._baseUrl;a.target&&(c=new p._Url(c,a.target)+"");b.target&&(c=new p._Url(c,b.target)+"");return c}function g(a,b){if(p.isArray(b))return b;for(var c=[],k=0;k<a.length;k++)c.push(b[a[k].name]);return c}var h=new b(!0),f=new b(!0),d=1;q=q("xide.rpc.Service",null,{constructor:function(a,b){function c(a){a._baseUrl=
new p._Url(p.isBrowser?location.href:p.config.baseUrl,k||".")+"";d._smd=a;b&&"methods"===b.services&&(a.services=a.methods,delete a.methods,a.transport="POST",b.mixin&&r.mixin(a,b.mixin),b=null);for(var c in d._smd.services){a=c.split(".");for(var e=d,f=0;f<a.length-1;f++)e=e[a[f]]||(e[a[f]]={});e[a[a.length-1]]=d._generateService(c,d._smd.services[c])}}var k,d=this;if(a)if(p.isString(a)||a instanceof p._Url){k=a instanceof p._Url?a+"":a;var f=n._getText(k);if(f)c(p.fromJson(f));else throw Error("Unable to load SMD from "+
a);}else c(a);this._options=b?b:{};this._requestId=0},_generateService:function(a,b){if(this[b])throw Error("WARNING: "+a+" already exists for service. Unable to generate function");b.name=a;var c=p.hitch(this,"_executeMethod",b),k=h.match(b.transport||this._smd.transport);k.getExecutor&&(c=k.getExecutor(c,b,this));k=b.returns||(b._schema={});k._service=c;c.servicePath="/"+a+"/";c._schema=k;c.id=d++;return c},_getRequest:function(b,d){var c=this._smd,k=f.match(b.envelope||c.envelope||"NONE"),h=(b.parameters||
[]).concat(c.parameters||[]);if(k.namedParams){if(1==d.length&&p.isObject(d[0]))d=d[0];else{for(var m={},q=0;q<b.parameters.length;q++)"undefined"==typeof d[q]&&b.parameters[q].optional||(m[b.parameters[q].name]=d[q]);d=m}if(b.strictParameters||c.strictParameters)for(q in d){for(var m=!1,n=0;n<h.length;n++)h[n].name==q&&(m=!0);m||delete d[q]}for(q=0;q<h.length;q++)if(m=h[q],!m.optional&&m.name&&!d[m.name])if(m["default"])d[m.name]=m["default"];else if(!(m.name in d))throw Error("Required parameter "+
m.name+" was omitted");}else h&&h[0]&&h[0].name&&1==d.length&&p.isObject(d[0])&&(d=!1===k.namedParams?g(h,d):d[0]);p.isObject(this._options)&&(d=p.mixin(d,this._options));delete d.mixin;h=b._schema||b.returns;q=k.serialize.apply(this,[c,b,d]);q._envDef=k;return p.mixin(q,{sync:!1,contentType:b.contentType||c.contentType||q.contentType,headers:b.headers||c.headers||q.headers||{},target:q.target||a(c,b),transport:b.transport||c.transport||q.transport,envelope:b.envelope||c.envelope||q.envelope,timeout:b.timeout||
c.timeout,callbackParamName:b.callbackParamName||c.callbackParamName,rpcObjectParamName:b.rpcObjectParamName||c.rpcObjectParamName,schema:h,handleAs:q.handleAs||"auto",preventCache:b.preventCache||c.preventCache,frameDoc:this._options.frameDoc||void 0})},_executeMethod:function(a){var b=[],c;for(c=1;c<arguments.length;c++)b.push(arguments[c]);var k=this._getRequest(a,b),b=h.match(k.transport).fire(k);b.addBoth(function(a){return k._envDef.deserialize.call(this,a)});return b}});q.transportRegistry=
h;q.envelopeRegistry=f;q._nextId=d;q.getTarget=a;q.toOrdered=g;q._sync=!1;f.register("URL",function(a){return"URL"==a},{serialize:function(a,b,c){return{data:p.objectToQuery(c),transport:"POST"}},deserialize:function(a){return a},namedParams:!0});f.register("JSON",function(a){return"JSON"==a},{serialize:function(a,b,c){return{data:p.toJson(c),handleAs:"json",contentType:"application/json"}},deserialize:function(a){return a}});f.register("PATH",function(a){return"PATH"==a},{serialize:function(b,d,
c){var k;b=a(b,d);if(p.isArray(c))for(k=0;k<c.length;k++)b+="/"+c[k];else for(k in c)b+="/"+k+"/"+c[k];return{data:"",target:b}},deserialize:function(a){return a}});h.register("POST",function(a){return"POST"==a},{fire:function(a){a.url=a.target;a.postData=a.data;return p.rawXhrPost(a)}});h.register("GET",function(a){return"GET"==a},{fire:function(a){a.url=a.target+(a.data?"?"+(a.rpcObjectParamName?a.rpcObjectParamName+"\x3d":"")+a.data:"");return n.get(a)}});p._contentHandlers&&(p._contentHandlers.auto=
function(a){var b=p._contentHandlers,c=a.getResponseHeader("Content-Type");return c?c.match(/\/.*json/)?b.json(a):c.match(/\/javascript/)?b.javascript(a):c.match(/\/xml/)?b.xml(a):b.text(a):b.text(a)});return q})},"xide/rpc/AdapterRegistry":function(){define(["dojo/_base/kernel","dojo/_base/lang"],function(p,r){var n=p.AdapterRegistry=function(q){this.pairs=[];this.returnWrappers=q||!1};r.extend(n,{register:function(q,b,m,a,g){this.pairs[g?"unshift":"push"]([q,b,m,a])},match:function(){for(var q=
0;q<this.pairs.length;q++){var b=this.pairs[q];if(b[1].apply(this,arguments))return b[3]||this.returnWrappers?b[2]:b[2].apply(this,arguments)}throw Error("No match found");},unregister:function(q){for(var b=0;b<this.pairs.length;b++)if(this.pairs[b][0]==q)return this.pairs.splice(b,1),!0;return!1}});return n})},"xide/rpc/JsonRPC":function(){define(["dojo/_base/lang","dojo/_base/json","./Service","dojo/errors/RequestError"],function(p,r,n,q){function b(b){return{serialize:function(a,g,h,f){a={id:this._requestId++,
method:g.name,params:h};b&&(a.jsonrpc=b);return{data:r.toJson(a),handleAs:"json",contentType:"application/json",transport:"POST"}},deserialize:function(a){if("Error"==a.name||a instanceof q)a=r.fromJson(a.responseText);if(a.error){var b=Error(a.error.message||a.error);b._rpcErrorObject=a.error;return b}return a.result}}}n.envelopeRegistry.register("JSON-RPC-1.0",function(b){return"JSON-RPC-1.0"==b},p.mixin({namedParams:!1},b()));n.envelopeRegistry.register("JSON-RPC-2.0",function(b){return"JSON-RPC-2.0"==
b},p.mixin({namedParams:!0},b("2.0")))})},"xide/encoding/SHA1":function(){define(["./_base"],function(p){function r(a,b){a[b>>5]|=128<<24-b%32;a[(b+64>>9<<4)+15]=b;for(var h=Array(80),f=1732584193,d=-271733879,e=-1732584194,l=271733878,c=-1009589776,k=0;k<a.length;k+=16){for(var m=f,q=d,n=e,r=l,x=c,w=0;80>w;w++){if(16>w)h[w]=a[k+w];else{var C=h[w-3]^h[w-8]^h[w-14]^h[w-16];h[w]=C<<1|C>>>31}C=p.addWords(p.addWords(f<<5|f>>>27,20>w?d&e|~d&l:40>w?d^e^l:60>w?d&e|d&l|e&l:d^e^l),p.addWords(p.addWords(c,
h[w]),20>w?1518500249:40>w?1859775393:60>w?-1894007588:-899497514));c=l;l=e;e=d<<30|d>>>2;d=f;f=C}f=p.addWords(f,m);d=p.addWords(d,q);e=p.addWords(e,n);l=p.addWords(l,r);c=p.addWords(c,x)}return[f,d,e,l,c]}function n(a){for(var b=[],h=0,f=8*a.length;h<f;h+=8)b[h>>5]|=(a.charCodeAt(h/8)&255)<<24-h%32;return b}function q(a){for(var b=[],h=0,f=4*a.length;h<f;h++)b.push("0123456789abcdef".charAt(a[h>>2]>>8*(3-h%4)+4&15),"0123456789abcdef".charAt(a[h>>2]>>8*(3-h%4)&15));return b.join("")}function b(a){for(var b=
[],h=0,f=32*a.length;h<f;h+=8)b.push(String.fromCharCode(a[h>>5]>>>24-h%32&255));return b.join("")}function m(a){for(var b=[],h=0,f=4*a.length;h<f;h+=3)for(var d=(a[h>>2]>>8*(3-h%4)&255)<<16|(a[h+1>>2]>>8*(3-(h+1)%4)&255)<<8|a[h+2>>2]>>8*(3-(h+2)%4)&255,e=0;4>e;e++)8*h+6*e>32*a.length?b.push("\x3d"):b.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(d>>6*(3-e)&63));return b.join("")}p.SHA1=function(a,g){var h=g||p.outputTypes.Base64,f=r(n(a),8*a.length);switch(h){case p.outputTypes.Raw:return f;
case p.outputTypes.Hex:return q(f);case p.outputTypes.String:return b(f);default:return m(f)}};p.SHA1._hmac=function(a,g,h){h=h||p.outputTypes.Base64;var f=n(g);16<f.length&&(f=r(f,8*g.length));var d=Array(16);g=Array(16);for(var e=0;16>e;e++)d[e]=f[e]^909522486,g[e]=f[e]^1549556828;a=r(d.concat(n(a)),512+8*a.length);a=r(g.concat(a),672);switch(h){case p.outputTypes.Raw:return a;case p.outputTypes.Hex:return q(a);case p.outputTypes.String:return b(a);default:return m(a)}};return p.SHA1})},"xide/manager/ManagerBase":function(){define("dcl/dcl xide/mixins/EventedMixin xide/model/Base xide/utils dojo/_base/xhr dojo/_base/kernel".split(" "),
function(p,r,n,q,b,m){r=p([n.dcl,r.dcl],{declaredClass:"xide.manager.ManagerBase",ctx:null,init:function(){this.initReload&&this.initReload()},_getText:function(a,g){var h;g=q.mixin({url:a,sync:!0,handleAs:"text",load:function(a){h=a}},g);var f=b.get(g);return g.sync?""+h+"":f},getContext:function(){return this.ctx}});p.chainAfter(r,"init");return r})},"xide/data/Reference":function(){define(["dojo/_base/declare","xide/utils"],function(p,r){var n={_sources:[],removeSource:function(b){},updateSource:function(b){},
onSourceUpdate:function(b){},onSourceRemoved:function(b){},onSourceDelete:function(b){},onItemChanged:function(b){},destroy:function(){this.item.removeReference&&this.item.removeReference(this);this.inherited(arguments)},addSource:function(b,m){this._sources.push({item:b,settings:m});var a=this;if(m&&m.onDelete)b._store.on("delete",function(g){g.target==b&&a._store.removeSync(a[a._store.idProperty])})},updateSources:function(b){for(var m=0;m<this._sources.length;m++){var a=this._sources[m],g=a.item,
a=a.settings;b.property&&a.properties&&a.properties[b.property]&&(g._store._ignoreChangeEvents=!0,g.set(b.property,b.value),g._store._ignoreChangeEvents=!1,g._store.emit("update",{target:g}))}},constructor:function(b){this._sources=[];r.mixin(this,b)}},q=p("xgrid.data.Reference",null,n);q.Implementation=n;return q})},"xcf/manager/DeviceManager":function(){define("dcl/dcl xdojo/declare dojo/_base/lang xide/encoding/MD5 xide/types xide/utils xide/factory xcf/manager/BeanManager xide/mixins/ReloadMixin xide/mixins/EventedMixin ./DeviceManager_Server ./DeviceManager_DeviceServer xide/data/TreeMemory dojo/has xide/data/ObservableStore dstore/Trackable xcf/model/Device dojo/Deferred xide/manager/ServerActionBase xide/data/Reference xide/utils/StringUtils xcf/mixins/LogMixin xdojo/has!xcf-ui?./DeviceManager_UI xdojo/has!xexpression?xexpression/Expression dojo/promise/all".split(" "),
function(p,r,n,q,b,m,a,g,h,f,d,e,l,c,k,t,v,A,E,x,w,C,y,z,D,u,F){a=[E,g,d,e,h.dcl,C];var G=c("xcf-ui"),B=b.DEVICE_PROPERTY,H=c("runDrivers"),I=b.EVENTS;c("xcf-ui")&&a.push(y);return p(a,{declaredClass:"xcf.manager.DeviceManager",beanNamespace:"device",beanName:"Device",beanIconClass:"fa-sliders",groupType:b.ITEM_TYPE.DEVICE_GROUP,itemType:b.ITEM_TYPE.DEVICE,itemMetaTitleField:B.CF_DEVICE_TITLE,systemScope:"system_devices",userScope:"user_devices",appScope:"app_devices",defaultScope:"system_devices",
serviceClass:"XCF_Device_Service",rawData:null,store:null,treeView:null,deviceServerClient:null,deviceInstances:null,driverScopes:null,autoConnectDevices:!0,consoles:null,lastUpTime:null,reconnectDevice:15E3,reconnectDeviceServer:5E3,onRunClassEvent:function(a){var b=a.args.id;if(this.running&&this.running[b]&&(b=this.running[b].delegate)){if(a.error&&b.onError)b.onError(a.error);if(a.finish&&b.onFinish)b.onFinish(a.finish);if(a.progress&&b.onProgress)b.onProgress(a.progress)}},getInstanceByName:function(a){var b=
this.deviceInstances,c;for(c in b){var k=b[c].device;if(k&&this.getMetaValue(k,B.CF_DEVICE_TITLE)===a)return b[c]}},getFile:function(a){var b=new A,c=this.ctx.getFileManager().getStore(a.scope);c.initRoot().then(function(){c._loadPath(".",!0).then(function(){c.getItem(a.path,!0).then(function(a){b.resolve(a)})})});return b},getSourceHash:function(){return this.ctx.getUserDirectory()||"no_user_directory"},checkDeviceServerConnection:function(){if(!this.ctx.getNodeServiceManager)return!0;if(!this.deviceServerClient&&
this.ctx.getNodeServiceManager){var a=this.ctx.getNodeServiceManager().getStore();if(!a)return console.error("checkDeviceServerConnection : have no service store"),!1;this.createDeviceServerClient(a)}return!0},addDriverFunctions:function(a,b){for(var c in b)"constructor"!==c&&"inherited"!==c&&"getInherited"!=c&&"isInstanceOf"!=c&&"__inherited"!=c&&"onModuleReloaded"!=c&&"start"!=c&&"publish"!=c&&"subscribe"!=c&&"getInherited"!=c&&"getInherited"!=c&&_.isFunction(b[c])&&!a[c]&&(a[c]=b[c])},addLoggingFunctions:function(a,
c){var k=this;c.log=function(a,d,e,f){f=f||{};var h=n.clone(f);f.type=f.type||d||"Driver";c.options&&(f.device=c.options);k.publish(b.EVENTS.ON_SERVER_LOG_MESSAGE,{data:f,level:a||"info",message:e,details:h})}},completeDriverInstance:function(a,c,k){var d=this,e=c.blockScope.blockStore,f=k.path,h=f+"_commands",g=f+"_variables";e.on("delete",function(a){var b=-1!==a.target.declaredClass.indexOf("Variable")?g:h,c=k._store.getSync(b);c&&c.refresh();(a=k._store.getSync(b+"_reference_"+a.target.id))&&
a.refresh()});e.on("added",function(c){var d=c.name,e=c.icon||"fa-exclamation",f=-1!==c.declaredClass.indexOf("Variable"),l=f?g:h;-1!=c.declaredClass.indexOf(f?"Variable":"Command")&&(d=new x({enabled:!0,path:l+"_reference_"+c.id,name:d,id:c.id,parentId:l,_mayHaveChildren:!1,virtual:!0,tooltip:!0,icon:e,ref:{driver:a,item:c,device:k},type:b.ITEM_TYPE.BLOCK}),d=k._store.putSync(d),c.addReference(d,{properties:{name:!0,enabled:!0,value:!0},onDelete:!0},!0),d.refresh())});c.setVariable=function(c,k,
e,f,h){if(c=this.blockScope.getVariable(c))c.value=k,!1===h&&(c.__ignoreChangeMark=!0),c.set("value",k,e,f,h),!1===h&&(c.__ignoreChangeMark=!1),d.publish(b.EVENTS.ON_DRIVER_VARIABLE_CHANGED,{item:c,scope:this.blockScope,driver:a,owner:d,save:!0===e,publish:f})};c.getVariable=function(a){return(a=this.blockScope.getVariable(a))?a._getArg(a.value,!1):""};c.log=function(a,k,e,f){f=f||{};var h=n.clone(f);f.type=f.type||k||"Driver";c.options&&(f.device=c.options);d.publish(b.EVENTS.ON_SERVER_LOG_MESSAGE,
{data:f,level:a||"info",message:e,details:h})};for(var l in a)"constructor"!==l&&"inherited"!==l&&"getInherited"!=l&&"isInstanceOf"!=l&&"__inherited"!=l&&"onModuleReloaded"!=l&&"start"!=l&&"publish"!=l&&"subscribe"!=l&&"getInherited"!=l&&"getInherited"!=l&&n.isFunction(a[l])&&!c[l]&&(c[l]=a[l])},onDeviceStarted:function(a,c,k){if(a&&c&&k){var d=this.toDeviceControlInfo(c),e=d.serverSide,f=d.isServer,h=a.blockScope;if(!f&&(f&&e||!e&&!f&&H)){e=[];f=h.getBlocks({group:b.COMMAND_TYPES.INIT_COMMAND});
try{_.each(f,function(a){!1!==a.enabled&&!0!==a.__started&&(a.solve(h),a.__started=!0)})}catch(g){logError(g,"starting init blocks failed")}e=e.concat(h.getBlocks({group:b.COMMAND_TYPES.BASIC_COMMAND}));for(f=0;f<e.length;f++){var l=e[f];l.enabled&&l.start&&l.startup&&!0!==l.__started&&(l.start(),l.__started=!0)}}a.__didStartBlocks=!0;this.publish(b.EVENTS.ON_DEVICE_DRIVER_INSTANCE_READY,{device:c,instance:a,driver:k,blockScope:h});this.publish(b.EVENTS.ON_DEVICE_CONNECTED,{device:d,instance:a,driver:k,
blockScope:h});this.ctx.getDriverManager().addDeviceInstance(c,k)}},getDevice:function(a){var b=a;if(_.isString(a)){var c=this.getItemById(a);c?b=c:(a=this.getItemByPath(a))&&(b=a)}return b},stopDevice:function(a){if(a=this.getDevice(a)||a){this.checkDeviceServerConnection();a._userStopped=!0;var b=this.toDeviceControlInfo(a);b?b.serverSide&&(b=b.hash,this.deviceInstances[b]&&(this._removeInstance(this.deviceInstances[b],b,a),delete this.deviceInstances[b])):console.error("cant find device::no device info",
a.toString&&a.toString())}else console.error("cant find device")},getStores:function(){return this.stores},getStore:function(a){a=a||"system_devices";var b=this.stores[a];if(b)return b;if(a)return this.ls(a)},getDevices:function(a,b){var c=this.getStore();if(!c)return[];c=m.queryStore(c,{isDir:!1});c._S&&(c=[c]);for(var k=[],d=0;d<c.length;d++){var e=c[d],f=this.getMetaValue(e,B.CF_DEVICE_ENABLED);if(!0===a&&1==f||null==f||!1===a)k.push(e),1==b&&(f=this.getMetaValue(e,B.CF_DEVICE_DRIVER))&&(f=this.ctx.getDriverManager().getItemById(f))&&
(e.driver=f)}return k},getStores:function(){var a=[],b;for(b in this.stores){var c=this.stores[b];c&&a.push(c)}return a},getStorePath:function(a){var b=this.getContext().getResourceManager();if("user_devices"===a)return b.getVariable("USER_DIRECTORY")},connectToAllDevices:function(){function a(b){if(!b)console.error("have no device store");else if(!b.connected){b.connected=!0;b=m.queryStore(b,{isDir:!1});b._S&&(b=[b]);_.isArray(b)||(b=[b]);for(var d=0;d<b.length;d++){var e=b[d],f=c.getMetaValue(e,
B.CF_DEVICE_ENABLED);if(1==f||null==f)e=c.startDevice(e),k.push(e)}}}if(this.deviceServerClient){var b=this.getStores(),c=this;if(this.getStores().length){var k=[];_.each(b,a,this);return k}}else this.checkDeviceServerConnection()},debug:function(){console.info("Debug info stores : ");_.each(this.stores,function(a){console.log("have store "+a.scope)})},_getLogText:function(a){return moment().format("HH:mm:ss:SSS")+" ::   "+a+""},_parse:function(a,c){var k=""+c;if(0<k.indexOf("{{")||0<k.indexOf("}}"))console.time("parse expression"),
k=(new z).parse(b.EXPRESSION_PARSER.FILTREX,k,this,{variables:a.getVariablesAsObject(),delimiters:{begin:"{{",end:"}}"}}),console.timeEnd("parse expression");else{var d=a.parseExpression(c);d&&(k=d)}return k},runCommand:function(a,b){},_lastActions:null,onStoreReloaded:function(a){this.completeDeviceStore()},getInstance:function(a){if(a=a?a._store?this.toDeviceControlInfo(a):a:null)return this.getDriverInstance(a,!1)},getDriverInstance:function(a,k){if(!a)return console.error("getDriverInstance::have no device info"),
null;for(var d in this.deviceInstances){var e=this.deviceInstances[d],f=e.options;if(f&&f.port===a.port&&f.host===a.host&&f.protocol===a.protocol&&f.isServer===a.isServer)return k&&e.sendSettings&&c("xcf-ui")&&(k=!1),!1!==k&&e&&!e.sendSettings&&(d=this.ctx.getDriverManager().getItemById(a.driverId))&&(d=d.user,(f=m.getCIByChainAndName(d,0,b.DRIVER_PROPERTY.CF_DRIVER_COMMANDS))&&f.params&&(e.sendSettings=m.getJson(f.params)),(d=m.getCIByChainAndName(d,0,b.DRIVER_PROPERTY.CF_DRIVER_RESPONSES))&&d.params&&
(e.responseSettings=m.getJson(d.params))),e}return null},_reconnectServerTimer:null,onDeviceServerConnectionLost:function(){if(!this.deviceServerClient||!this.deviceServerClient.pageUnloaded)if(this.deviceServerClient&&(this.deviceServerClient.destroy(),this.deviceServerClient=null),!this._reconnectServerTimer){var a=this;G&&a.ctx.getNotificationManager().postMessage({message:"Lost connection to device server, try reconnecting in 5 seconds",type:"error",showCloseButton:!0,duration:1E3});this._reconnectServerTimer=
setTimeout(function(){a.checkDeviceServerConnection();a._reconnectServerTimer=null},this.reconnectDeviceServer);console.log("lost device server connection");_.each(this.deviceInstances,function(a){if(a&&a.device&&!a.domNode){a=a.device;var c=a.driverInstance;c&&c.onLostServer&&c.onLostServer();a.setState(b.DEVICE_STATE.LOST_DEVICE_SERVER)}})}},onMQTTMessage:function(a){var k=m.getJson(a.message),d=!1;if(k){var e=k.sourceHost,f=k.sourcePort,h=a.host,g=a.port;e&&f&&e===h&&f==g&&(d=!0)}if(!d&&(d=a.topic.split("/"),
4==d.length&&"Variable"==d[2]&&k.device))if(this.getDeviceStoreItem(k.device)){if(a=this.toDeviceControlInfo(k.device))if(a=this.getDriverInstance(a))if(a=a.blockScope.getVariable(d[3]))c("xcf-ui")?(a.set("value",k.value),a.refresh()):(delete a.value,a.value=k.value),this.publish(b.EVENTS.ON_DRIVER_VARIABLE_CHANGED,{item:a,scope:a.scope,owner:this,save:!1,publish:!0,source:"mqtt",publishMQTT:!1})}else console.error("cant find device for : "+a.topic)},getBlock:function(a){for(var b in this.deviceInstances){var c=
this.deviceInstances[b];if(c&&c.device&&(c=c.blockScope)&&(c=c.resolveBlock(a)))return c}return this.ctx.getDriverManager().getBlock(a)},onNodeServiceStoreReady:function(a){this.deviceServerClient&&this.deviceServerClient.destroy();this.createDeviceServerClient(a.store)},onDriverUpdated:function(a,b){},onModuleReloaded:function(a){if(0!=this.deviceInstances.length){var b=m.replaceAll("//","/",a.module);a=a.newModule;for(var c in this.deviceInstances){var k=this.deviceInstances[c];if(k.modulePath===
b||k.baseClass===b)this.mergeFunctions(k,a.prototype),k.blockScope&&(k.blockScope.expressionModel.expressionCache={}),this.onDriverUpdated(k,b)}}},_removeInstance:function(a,b,c){a.destroy&&a.destroy();a.blockScope&&a.blockScope._destroy();delete this.deviceInstances[b];this.ctx.getBlockManager().removeScope(a.options.id);this.ctx.getDriverManager().removeDriverInstance(a,c);c.reset()},removeDriverInstance:function(a){if(a=this.getDriverInstance(a))this.ctx.getBlockManager().removeScope(a.options.id),
a.blockScope&&a.blockScope.destroy(),a.destroy();for(var b in this.deviceInstances)a==this.deviceInstances[b]&&delete this.deviceInstances[b]},getMetaValue:function(a,b){var c=a.user;return c?m.getCIInputValueByName(c,b):null},getDeviceByHost:function(a,b){for(var c=m.queryStore(this.getStore(),{isDir:!1}),k=0;k<c.length;k++){var d=c[k],e=this.getMetaValue(d,B.CF_DEVICE_HOST),f=this.getMetaValue(d,B.CF_DEVICE_PORT);if(e==a&&f==b)return d}return null},getDeviceByUrl:function(a){a=m.parse_url(a);a=
m.urlArgs(a.host);return this.getDeviceById(a.device.value)},getDeviceById:function(a,b){function c(b){b=m.queryStore(b,{isDir:!1});b._S&&(b=[b]);for(var d=0;d<b.length;d++){var e=b[d];if(k.getMetaValue(e,B.CF_DEVICE_ID)==a)return e}return null}var k=this,d=_.isString(b)?this.getStore(b):null;if(d)return c(d);for(var e in this.stores)if(d=c(this.stores[e]))return d;return null},getDevicesByDriverId:function(a){var b=m.queryStore(this.getStore(),{isDir:!1});b._S&&(b=[b]);for(var c=0;c<b.length;c++){var k=
b[c];if(this.getMetaValue(k,B.CF_DEVICE_ID)==a)return k}return null},_cachedItems:null,getDeviceStoreItem:function(a){if(a){if(!G&&a.hash&&this._cachedItems){var b=this._cachedItems[a.hash];if(b)return b}var c=this.getStore(a.deviceScope);if(c){var k=m.queryStore(c,{isDir:!1});if(!k)return null;k&&!_.isArray(k)&&(k=[k]);for(var d=0;d<k.length;d++){var b=k[d],e=b.user,f=m.getCIInputValueByName(e,B.CF_DEVICE_HOST),h=m.getCIInputValueByName(e,B.CF_DEVICE_PORT),g=m.getCIInputValueByName(e,B.CF_DEVICE_ID),
e=m.getCIInputValueByName(e,B.CF_DEVICE_PROTOCOL);if(h===a.port&&f===a.host&&e===a.protocol&&b.isServer()===a.isServer&&g===a.id)return(c=c.getSync(b.path))&&(b=c),!G&&a.hash&&(this._cachedItems||(this._cachedItems={}),this._cachedItems[a.hash]=b),b}}}},onDriverSettingsChanged:function(a,c){for(var k in this.deviceInstances){var d=this.deviceInstances[k];if(d&&d.driver==c){k=c.user;var e=m.getCIByChainAndName(k,0,b.DRIVER_PROPERTY.CF_DRIVER_COMMANDS);e&&e.params&&e==a&&(d.sendSettings=m.getJson(e.params));
(k=m.getCIByChainAndName(k,0,b.DRIVER_PROPERTY.CF_DRIVER_RESPONSES))&&k.params&&(d.responseSettings=m.getJson(k.params));break}}},onDeviceStateChanged:function(a,c){!0!==a._userStopped&&!0!==c&&a.info&&a.state&&a.state==b.DEVICE_STATE.DISCONNECTED&&this.ctx.getNotificationManager().postMessage({message:"Lost connection to "+a.info.host+", ...reconnecting",type:"error",showCloseButton:!1,duration:1500});!0!==c&&a.info&&a.state&&a.state==b.DEVICE_STATE.CONNECTED&&this.ctx.getNotificationManager().postMessage({message:"Connected to "+
a.info.host+"",type:"success",showCloseButton:!1,duration:2E3})},connectDevice:function(a){this.checkDeviceServerConnection();var c=this.toDeviceControlInfo(a);if(c){var k=c.hash;if(this.deviceInstances[k])return a.setState(b.DEVICE_STATE.CONNECTED),this.deviceInstances[k];a.setState(b.DEVICE_STATE.CONNECTING);this.publish(b.EVENTS.ON_STATUS_MESSAGE,{text:"Trying to connect to "+c.toString(),type:"info"});this.sendManagerCommand(b.SOCKET_SERVER_COMMANDS.MANAGER_START_DRIVER,c)}else console.error("couldnt start device, invalid control info")},
onAppReady:function(a){a=a.context;a.deviceManager=this;a.driverManager=this;a.blockManager&&m.mixin(a.blockManager.scopes,this.ctx.getBlockManager().scopes)},onHaveNoDeviceServer:function(){if(this.ctx.getNotificationManager())var a=this,b=this.ctx.getNotificationManager().postMessage({message:"Have no device server connection",type:"error",showCloseButton:!0,duration:1500,actions:{reconnect:{label:"Reconnect",action:function(){a.checkDeviceServerConnection();return b.update({message:"Reconnecting...",
type:"success",actions:!1,duration:1500})}}}})},setDriverScriptContent:function(a,b,c,k,d){return this.callMethodEx(null,"setDriverContent",[a,b,c],k,!0)},getDriverScriptContent:function(a,b,c,k){return this.callMethodEx(null,"getDriverContent",[a,b],c,!0)},createStore:function(a,b,c){a=new (r("deviceStore",[l,t,k],{}))({data:a.items,idProperty:"path",Model:v,id:m.createUUID(),scope:b,observedProperties:["name","state","iconClass","enabled"]});b&&!1!==c&&this.setStore(b,a);return a},initStore:function(a,
b,c){return this.createStore(a,b,c)},fixDeviceCI:function(a){var b=a.user,c=m.getCIByChainAndName(b,0,B.CF_DEVICE_DRIVER_OPTIONS);c?(c.data=[{value:2,label:"Runs Server Side"},{value:4,label:"Show Debug Messages"},{value:8,label:"Allow Multiple Device Connections"},{value:16,label:"Server"}],c.group="Common"):b.inputs.push({chainType:0,"class":"cmx.types.ConfigurableInformation",dataRef:"",dataSource:"",description:null,enabled:!0,enumType:"-1",flags:-1,group:"Common",id:B.CF_DEVICE_DRIVER_OPTIONS,
name:B.CF_DEVICE_DRIVER_OPTIONS,order:1,params:null,platform:null,title:"Driver Options",type:5,uid:"-1",value:0,data:[{value:2,label:"Runs Server Side"},{value:4,label:"Show Debug Messages"},{value:8,label:"Allow Multiple Device Connections"},{value:16,label:"Server"}],visible:!0,device:a});(c=m.getCIByChainAndName(b,0,B.CF_DEVICE_LOGGING_FLAGS))?c.group="Logging":b.inputs.push({chainType:0,"class":"cmx.types.ConfigurableInformation",dataRef:"",dataSource:"",description:null,enabled:!0,enumType:"-1",
flags:-1,group:"Logging",id:B.CF_DEVICE_LOGGING_FLAGS,name:B.CF_DEVICE_LOGGING_FLAGS,order:1,params:null,platform:null,title:"Logging Flags",type:B.CF_DEVICE_LOGGING_FLAGS,uid:"-1",value:0,data:[{value:2,label:"On Connected"},{value:4,label:"On Disconnected"},{value:8,label:"On Error"},{value:16,label:"Commands"},{value:32,label:"Responses"}],visible:!0,device:a});if(a=m.getCIByChainAndName(b,0,B.CF_DEVICE_PROTOCOL))a.type=3,a.options=[{label:"TCP",value:"tcp"},{label:"UDP",value:"udp"},{label:"Driver",
value:"driver"},{label:"SSH",value:"ssh"},{label:"Serial",value:"serial"},{label:"MQTT",value:"mqtt"}]},_deviceInfoCache:null,toDeviceControlInfo:function(a){if(!a)return null;c("xcf-ui");if(!a._store&&a.id){var k=this.getItemById(a.id);k&&(a=k)}if(!a||!a.path)if(k=this.getDeviceStoreItem(a),!k)return null;var d=a.user,k=m.getCIInputValueByName(d,B.CF_DEVICE_HOST),e=m.getCIInputValueByName(d,B.CF_DEVICE_PORT),f=m.getCIInputValueByName(d,B.CF_DEVICE_TITLE),h=m.getCIInputValueByName(d,B.CF_DEVICE_PROTOCOL),
g=m.getCIInputValueByName(d,B.CF_DEVICE_DRIVER),l=m.getCIInputValueByName(d,B.CF_DEVICE_OPTIONS),t=m.getCIInputValueByName(d,B.CF_DEVICE_LOGGING_FLAGS),d=m.getCIInputValueByName(d,B.CF_DEVICE_DRIVER_OPTIONS),n=a.isServerSide(),p=a.isServer(),r=null;this.fixDeviceCI(a);var v=this.ctx.getDriverManager().getDriverById(g);if(v){var A=v.user,r=m.getCIInputValueByName(A,b.DRIVER_PROPERTY.CF_DRIVER_CLASS),A=m.getCIByChainAndName(A,0,b.DRIVER_PROPERTY.CF_DRIVER_RESPONSES),E={},v=v.scope;A&&A.params&&(E=m.getJson(A.params));
r={host:k,port:e,protocol:h,driver:r?r.replace("./",""):"",driverId:g,driverScope:v,id:a.id,devicePath:a.path,deviceScope:a.getScope(),title:f,options:l,driverOptions:d,serverSide:n,isServer:p,responseSettings:E,source:G?"ide":"server",user_devices:this.ctx.getMount(a.getScope()),system_devices:this.ctx.getMount("system_devices"),system_drivers:this.ctx.getMount("system_drivers"),user_drivers:this.ctx.getMount("user_drivers"),loggingFlags:t,toString:function(){return a.getScope()+"://"+this.host+
":"+this.port+"@"+this.protocol}};r.hash=q(JSON.stringify({host:k,port:e,protocol:h,driverId:g,driverScope:v,id:a.id,devicePath:a.path,deviceScope:a.getScope(),source:G?"ide":"server",user_devices:this.ctx.getMount(a.getScope()),system_devices:this.ctx.getMount("system_devices"),system_drivers:this.ctx.getMount("system_drivers"),user_drivers:this.ctx.getMount("user_drivers")}),1);if(k=this.ctx.getUserDirectory())r.userDirectory=k}a.info=r;c("xcf-ui");return r},getItemById:function(a){for(var b in this.stores){var c;
c=this.stores[b];var k=_.find(c.data,{id:a});c=k?c.getSync(k.path):null;if(c)return c}},getItemByPath:function(a){for(var b in this.stores){var c=this.stores[b].getSync(a);if(c)return c}},onStoreCreated:function(a){var c=this,k=c.ctx,d=a.type,e=a.store,f=e?m.queryStore(e,{isDir:!1}):[],h=this.ctx.getDriverManager();f&&!_.isArray(f)&&(f=[f]);if(d===b.ITEM_TYPE.DEVICE){for(d=0;d<f.length;d++){var g=e.getSync(f[d].path);if(!g)console.error("cant find "+f[d].path);else if(null==g._completed){g._completed=
!0;var l=this.getMetaValue(g,B.CF_DEVICE_DRIVER);l?(l=h.getItemById(l),_.each(g.user.inputs,function(a){a.device=g;a.actionTarget=G?k.mainView.getToolbar():null;a.ctx=k}),!_.isEmpty(l)&&G&&(this.completeDevice(e,g,l),g.iconClass=g.getStateIcon())):console.error("device has no driver id!")}}D(this.connectToAllDevices()).then(function(){c.publish("DevicesConnected",a)})}},onClientMessage:function(a){this.checkDeviceServerConnection();this.deviceServerClient&&this.sendManagerCommand(b.SOCKET_SERVER_COMMANDS.WRITE_LOG_MESSAGE,
a)},onClientLogMessage:function(a){},onVariableChanged:function(a){var c=a.item,k=a.scope,d=c.name,e=!1!==a.publish;"value"!==d&&!1!==e&&c&&(c=c.value,(k=k.device)&&k.info&&(k=k.info,d=k.host+"/"+k.port+"/Variable/"+d,!1!==a.publishMQTT&&this.sendManagerCommand(b.SOCKET_SERVER_COMMANDS.MQTT_PUBLISH,{topic:d,data:{value:c,device:k}})))},init:function(){var a=this;this.initUI&&this.initUI();this.stores={};this._deviceInfoCache={};this.subscribe(b.EVENTS.ON_DRIVER_VARIABLE_CHANGED,this.onVariableChanged);
this.subscribe(b.EVENTS.ON_DEVICE_SERVER_CONNECTED,function(){a.autoConnectDevices&&D(a.connectToAllDevices()).then(function(){a.publish("DevicesConnected")})});this.subscribe([I.ON_NODE_SERVICE_STORE_READY,I.ON_MODULE_RELOADED,I.ON_DEVICE_DISCONNECTED,I.ON_DEVICE_CONNECTED,I.ON_CLIENT_LOG_MESSAGE,I.ON_STORE_CREATED]);this.deviceInstances=this.consoles={};this.driverScopes={system_drivers:"system_drivers/",user_drivers:"user_drivers/"};this.lastUpTime=(new Date).getTime();setInterval(function(){var b=
(new Date).getTime();3E4<b-a.lastUpTime&&(a.lastUpTime=(new Date).getTime());a.lastUpTime=b},1E3);this.initReload()},onDeviceServerConnected:function(){var a=this;this.deviceInstances&&_.each(this.deviceInstances,function(b){b&&b.device&&!b.domNode?a.startDevice(b.device):console.log("invalid instance")})},addDeviceInstance:function(a,b){},ls:function(a,k,d){function e(c){try{var d=this.createStore(c,a,!0===k?!1:!0);!1!==k&&this.setStore(a,d);this.onStoreReady(d);!1!==k&&this.publish(b.EVENTS.ON_STORE_CREATED,
{data:c,owner:this,store:d,type:this.itemType});f.resolve(d)}catch(h){logError(h,"error ls drivers")}}var f=new A;c("php")?this.runDeferred(null,"ls",[a]).then(e.bind(this)):f.resolve({items:[]});return f},hasStore:function(a){return this.stores[a]}})})},"xcf/manager/DeviceManager_Server":function(){define(["dcl/dcl"],function(p){return p(null,{})})},"xcf/manager/DeviceManager_DeviceServer":function(){define("dcl/dcl xide/encoding/MD5 xide/types xide/utils xide/factory xdojo/has dojo/Deferred xide/mixins/ReloadMixin xide/mixins/EventedMixin require xcf/model/Variable".split(" "),
function(p,r,n,q,b,m,a,g,h,f,d,e){var l=m("xcf-ui");String.prototype.setBytes||(String.prototype.setBytes=function(a){this.bytes=a});String.prototype.getString||(String.prototype.getString=function(){return this.string});String.prototype.setString||(String.prototype.setString=function(a){this.string=a});String.prototype.getBytes||(String.prototype.getBytes=function(){return this.bytes?this.bytes:q.stringToBuffer(this)});String.prototype.hexString||(String.prototype.hexString=function(){var a=this.getBytes();
return q.bufferToHexString(a)});Array.prototype.shuffle||(Array.prototype.shuffle=function(){for(var a=this.length,b,d;0<a;)d=Math.random()*a--|0,b=this[a],this[a]=this[d],this[d]=b});if("undefined"!==typeof sctx&&sctx)q.createUUID(),sctx.getResourceManager(),sctx.getApplication();else return p(null,{declaredClass:"xcf.manager.DeviceManager_DeviceServer",onReloaded:function(){console.error("-relloada")},running:null,runClass:function(a,b,d){this.checkDeviceServerConnection();if(this.deviceServerClient){var e=
q.createUUID();b.id=e;var f={"class":a,args:b,manager_command:n.SOCKET_SERVER_COMMANDS.RUN_CLASS};!this.running&&(this.running={});this.running[e]={"class":a,args:b,delegate:d};this.deviceServerClient.emit(null,f,n.SOCKET_SERVER_COMMANDS.RUN_CLASS)}else this.onHaveNoDeviceServer()},startDevice:function(b,k){var d=this;if(!b)return console.error("start device invalid item"),null;this.checkDeviceServerConnection();b.check();var e=new a;if(b._startDfd&&!b._startDfd.isResolved())return b._startDfd;!b.driverInstance&&
b.reset();!0===k&&b.setMetaValue(n.DEVICE_PROPERTY.CF_DEVICE_ENABLED,!0,!1);if(!b.getMetaValue(n.DEVICE_PROPERTY.CF_DEVICE_ENABLED)&&!0!==k)return this.publish(n.EVENTS.ON_STATUS_MESSAGE,{text:"Can`t start device because its not enabled! "+b.toString(),type:"error"}),setTimeout(function(){e.reject()},10),e;var h=this.toDeviceControlInfo(b);if(!h)return console.error("invalid client info, assuming no driver found"),e.reject("invalid client info, assuming no driver found"),e;if(!h)return console.error("couldnt start device, invalid control info "+
h.toString()),e.reject(),e;var g=h.hash,l=b.state===n.DEVICE_STATE.LOST_DEVICE_SERVER;if(this.deviceInstances[g]&&!0!==l)return e.resolve(this.deviceInstances[g]),e;if(l&&this.deviceInstances[g])return d.publish(n.EVENTS.ON_STATUS_MESSAGE,{text:"Trying to re-connect to "+h.toString(),type:"info"}),d.sendManagerCommand(n.SOCKET_SERVER_COMMANDS.MANAGER_START_DRIVER,h),b.setState(n.DEVICE_STATE.CONNECTING),e.resolve(this.deviceInstances[g]),e;b.setState(n.DEVICE_STATE.CONNECTING);b._userStopped=null;
b._startDfd=e;var l=this.driverScopes.system_drivers,m=l+"DriverBase";try{f([m],function(a){a.prototype.declaredClass=m;d.createDriverInstance(h,a,b).then(function(a){a||console.warn("buildMQTTParams:have no driver instance");h.mqtt={driverScopeId:a&&a.blockScope?a.blockScope.id:"have no driver instance",driverId:a?a.driver.id:"have no driver id",deviceId:b.path};d.publish(n.EVENTS.ON_STATUS_MESSAGE,{text:"Trying to connect to "+h.toString(),type:"info"});d.sendManagerCommand(n.SOCKET_SERVER_COMMANDS.MANAGER_START_DRIVER,
h);e.resolve(d.deviceInstances[g]);delete h.mqtt}).then(function(){},function(a){console.error("DeviceManager_DeviceServer::createDriverInstance error ",a);e.resolve(null)})},function(a){console.error(a)})}catch(q){logError(q,"DeviceManager::startDevice: requiring base driver at "+m+" failed! Base Driver - Prefix : "+l)}return e},getDriverModule:function(b){var k=new a,d=q.getCIInputValueByName(b.user,n.DRIVER_PROPERTY.CF_DRIVER_CLASS);b=b.scope;d=d?d.replace("./",""):"";b=f.toUrl(b);b=q.removeURLParameter(b,
"bust");b=q.removeURLParameter(b,"time");f.cache||(b=b.replace("/.js","/"));d=b+d+("\x26time"+(new Date).getTime());try{f([d],function(a){k.resolve(a)})}catch(e){console.error("error loading driver module",e),logError(e,"error loading driver module"),k.reject(e.message)}return k},createDriverInstance:function(b,k,d){var e=b.hash,l=this.driverScopes[b.driverScope],m=!f.cache,r=f.toUrl(l),r=q.removeURLParameter(r,"bust");m&&(r=r.replace("/.js","/"));var w=decodeURIComponent(r)+b.driver,w=w.replace("",
"").trim(),C=this,m=C.ctx,r=q.getCIInputValueByName(d.user,n.DEVICE_PROPERTY.CF_DEVICE_DRIVER),y=m.getDriverManager().getDriverById(r),z=new a;d.getMetaValue(n.DEVICE_PROPERTY.CF_DEVICE_ENABLED);if(!1===d.isEnabled())return setTimeout(function(){z.reject()}),z;if(!d.isServerSide())return z.reject("DeviceManager_DeviceServer: wont create driver instance! I am server and device isnt server side : "+b.title),z;try{f([w],function(a){var f=new (p([k,h.dcl,g.dcl,a],{}));f.declaredClass=w;f.options=b;f.baseClass=
k.prototype.declaredClass;f.modulePath=q.replaceAll("//","/",l+b.driver).replace(".js","");f.delegate=C;f.driver=y;f.serverSide=b.serverSide;f.utils=q;f.types=n;f.device=d;f.Module=a;f.getDevice=function(){return this.device};f.getDeviceInfo=function(){return this.getDevice().info};a=y.user;var m=q.getCIByChainAndName(a,0,n.DRIVER_PROPERTY.CF_DRIVER_COMMANDS);m&&m.params&&(f.sendSettings=q.getJson(m.params));(a=q.getCIByChainAndName(a,0,n.DRIVER_PROPERTY.CF_DRIVER_RESPONSES))&&a.params&&(f.responseSettings=
q.getJson(a.params));try{f.start(),f.initReload()}catch(r){console.error("crash in driver instance startup! "+d.toString()),logError(r,"crash in driver instance startup!")}C.deviceInstances[e]=f;y.blox&&y.blox.blocks||(y.blox={blocks:[]});d.driverInstance=f;C.getDriverInstance(b,!0);f._id=q.createUUID();z.resolve(f);return f})}catch(D){console.error("DeviceManager::createDriverInstance:: requiring base driver at "+w+" failed "+D.message,q.inspect(b))}return z},onSetDeviceServerVariables:function(a){var b=
this.getDriverInstance(a.device,!0),d=this.getDeviceStoreItem(a.device);if(d){if(!b.blockScope){var e=d.info,f=e.hash,h=b.driver,g=e.driverId,m=this.getContext(),e=e.serverSide,p=g+"_"+f+"_"+d.path;h.blox&&h.blox.blocks||(h.blox={blocks:[]});h.blockPath&&(q.getJson(q.readFile(h.blockPath)),h.blox=q.getJson(q.readFile(h.blockPath)));f=m.getBlockManager().createScope({id:p,device:d,driver:h,instance:b,serviceObject:this.serviceObject,ctx:m,serverSide:e,getContext:function(){return this.instance}},q.clone(h.blox.blocks),
function(a){a&&console.error(a+" : in "+h.name+" Resave Driver! in scope id "+p)});b.blockScope=f;d.blockScope=f;l&&this.completeDriverInstance(h,b,d)}if(b){var f=a.variables,r=b.blockScope;d.serverVariables=a.variables;_.each(f,function(a){var b=r.getVariable(a.name);b&&(b.value=a.value)})}this.onDeviceConnected(a,!1);d.setState(n.DEVICE_STATE.SYNCHRONIZING);d.setState(n.DEVICE_STATE.READY);d._startDfd&&d._startDfd.resolve(d.driverInstance);delete d._userStopped;delete d.lastError;delete d._startDfd;
d._startDfd=null}},onDeviceConnected:function(a,b){var d=this.getDeviceStoreItem(a.device);if(a.isReplay&&d&&d.state===n.DEVICE_STATE.READY)d.setState(n.DEVICE_STATE.READY);else{var e=this.getDriverInstance(a.device,!0)||a.instance;if(!e)d&&d.setState(n.DEVICE_STATE.DISCONNECTED);else if(d){var h=this.toDeviceControlInfo(d);if(h)if(e&&!d.serverVariables)d.setState(n.DEVICE_STATE.CONNECTED),this.getDeviceServerVariables(d,e);else if(h){var g=h.hash;if(this.deviceInstances[g]){if(!e.__didStartBlocks)this.onDeviceStarted(e,
d,e.driver);d.setState(n.DEVICE_STATE.READY);this.publish(n.EVENTS.ON_STATUS_MESSAGE,{text:'Device is Ready \x3cspan class\x3d"text-success"\x3e'+h.host+":"+h.port+"\x3c/span\x3e",type:"success"});return this.deviceInstances[g]}var l=this,m=this.driverScopes.system_drivers+"DriverBase";try{f([m],function(a){a.prototype.declaredClass=m;l.createDriverInstance(h,a,d)})}catch(q){console.error("requiring base driver at "+m+" failed",q)}}else console.error("couldnt start device, invalid control info")}}},
onDeviceDisconnected:function(a){if(a&&a.device){var b=a.error,d=b&&b.code?b.code:b||"",e=this.getDeviceStoreItem(a.device);if(e)if(!0===a.stopped)this.stopDevice(e);else{this.publish(n.EVENTS.ON_STATUS_MESSAGE,{text:'Device has been disconnected \x3cspan class\x3d"text-warning"\x3e'+a.device.host+":"+a.device.port+'\x3c/span\x3e :  \x3cspan class\x3d"text-danger"\x3e'+d+"\x3c/span\x3e",type:"info"});var f=this.toDeviceControlInfo(e);if(!f||f.serverSide)if(this.getDriverInstance(a.device,!0)&&this.removeDriverInstance(a.device),
e.reset(),e.state===n.DEVICE_STATE.DISABLED)e.setState(n.DEVICE_STATE.DISCONNECTED);else if(e.setState(n.DEVICE_STATE.DISCONNECTED),e.lastError=b,e.refresh(),f.serverSide&&e){var h=this;e.reconnectTimer||(e.isReconnecting=!0,e.lastReconnectTime?3600<e.lastReconnectTime&&(e.lastReconnectTime=3600):e.lastReconnectTime=1*h.reconnectDevice,e.reconnectRetry||(e.reconnectRetry=0),e.reconnectTimer=setTimeout(function(){e.reconnectTimer=null;e.lastReconnectTime*=2;e.reconnectRetry+=1;e.shouldReconnect()&&
(f&&e.setState(n.DEVICE_STATE.CONNECTING),h.startDevice(e))},e.lastReconnectTime))}}}},getDeviceServerVariables:function(a,b){var d=b.driver;d.blox&&d.blox.blocks||(d.blox={blocks:[]});var e=[];_.each(d.blox.blocks,function(a){a.group===n.BLOCK_GROUPS.CF_DRIVER_BASIC_VARIABLES&&e.push(a)});for(var d=[],f=0;f<e.length;f++)d.push({name:e[f].name,value:e[f].value,initial:e[f].value});a.setState(n.DEVICE_STATE.SYNCHRONIZING);this.sendManagerCommand(n.SOCKET_SERVER_COMMANDS.GET_DEVICE_VARIABLES,{device:this.toDeviceControlInfo(a),
variables:d})},onCommandFinish:function(a,b){var d=this.getDriverInstance(a,!0);if(d){var e=b.params||{};if(e.src&&e.id&&(d=d.blockScope.getBlockById(e.src))&&d.onCommandFinish)d.onCommandFinish(b)}},onCommandProgress:function(a,b){var d=this.getDriverInstance(a,!0);if(d){var e=b.params||{};if(e.src&&e.id&&(d=d.blockScope.getBlockById(e.src))&&d.onCommandProgress)d.onCommandProgress(b)}},onCommandPaused:function(a,b){var d=this.getDriverInstance(a,!0);if(d){var e=b.params||{};if(e.src&&e.id&&(d=d.blockScope.getBlockById(e.src))&&
d.onCommandPaused)d.onCommandPaused(b)}},onCommandStopped:function(a,b){var d=this.getDriverInstance(a,!0);if(d){var e=b.params||{};if(e.src&&e.id&&(d=d.blockScope.getBlockById(e.src))&&d.onCommandStopped)d.onCommandStopped(b)}},onCommandError:function(a,b){var d=this.getDriverInstance(a,!0);if(d){var e=b.params||{};if(e.src&&e.id&&(d=d.blockScope.getBlockById(e.src))&&d.onCommandError)d.onCommandError(b)}},onDeviceServerMessage:function(a){function b(a){delete a.resposeSettings;delete a.driver;delete a.lastResponse;
delete a.scope;delete a.driverId;delete a.device;delete a.sourceHost;delete a.sourcePort}var e=a.data,f=null;if(_.isString(e)&&-1!=e.indexOf("{"))try{f=dojo.fromJson(e)}catch(h){console.error("error parsing device message",a);return}else _.isObject(e)&&e.data&&(f=e);if(f&&f.data&&f.data.device){var g=f.data.device;if(g&&g.serverSide){var l=this.getDriverInstance(f.data.device,!0);if(l){var p=this.getDeviceStoreItem(g);if(p){(g=p.info)||console.error("invalid device : "+p.toString());var r=p.get("state");
a=g.serverSide;var y=f.data.deviceMessage,e=[];_.isString(y)?e=l.split(y):_.isObject(y)&&(b(y),e=[y]);var z=l.onMessageRaw({device:f.data.device,message:y,bytes:f.data.bytes});z&&!z.length&&(z=null);for(var D=[],u=0;u<e.length;u++)D.push(q.stringToBuffer(e[u]));if(z&&z.length)for(e=[],D=[],u=0;u<z.length;u++){var F=z[u];e.push(F.string);D.push(F.bytes)}if(e&&e.length)for(u=0;u<e.length;u++)F=e[u],l.onMessage({device:f.data.device,message:F,raw:y,bytes:D[u]}),l.onBroadcastMessage({device:f.data.device,
message:F,raw:y,bytes:D[u]});r!==n.DEVICE_STATE.READY&&p.set("state",n.DEVICE_STATE.READY);u=p.isDebug();f.event&&(f.data.driverInstance=l,this.publish(f.event,f.data));if(m("xcf-ui")){var G=[],r=this.consoles[g.hash+"-Console"];if(u){u=f.data.deviceMessage;if(_.isObject(u)){b(u);try{u=JSON.stringify(u)}catch(B){logError(B,"error serialize message")}}this.publish(n.EVENTS.ON_STATUS_MESSAGE,{text:"Device Message from "+l.options.host+' : \x3cspan class\x3d"text-info"\x3e'+u+"\x3c/span\x3e"})}if(r)for(var H=
0;H<r.length;H++){var I=r[H];if(I){var J=!0,L=!1;I.console&&(u=I.console.getTextEditor(),J=u.getAction("Console/Settings/Split").value,L=u.getAction("Console/Settings/HEX").value);if(!J&&L)u=q.bufferToHexString(f.data.bytes),I.log(u,J,!1,n.LOG_OUTPUT.RESPONSE);else for(G=[],_.isString(y)?G=J?z&&z.length?z:l.split(y):[y]:_.isObject(y)&&(b(y),G=[y]),u=0;u<G.length;u++)F=G[u],_.isString(F.string)&&0===F.string.length||(L&&(F=q.stringToHex(F.string)),I.log(F,J,!0,n.LOG_OUTPUT.RESPONSE))}}e&&e.length&&
this.publish(n.EVENTS.ON_DEVICE_MESSAGE_EXT,{device:p,deviceInfo:g,raw:y,messages:e,bytes:f.data.bytes})}if(0<e.length&&l.blockScope)for(f=l.blockScope,g=f.getBlocks({group:n.BLOCK_GROUPS.CF_DRIVER_RESPONSE_BLOCKS}),l=f.getVariables({group:n.BLOCK_GROUPS.CF_DRIVER_RESPONSE_VARIABLES}),p=f.getVariable("value"),p||(p=new d({id:q.createUUID(),name:"value",value:"",scope:f,type:13,group:"processVariables",gui:!1,cmd:!1}),f.blockStore.putSync(p)),y=0;y<e.length;y++)if(0!==e[y].length){p.value=new String(e[y]);
p.value.setBytes(D[y]);p.value.setString(e[y]);this.publish(n.EVENTS.ON_DRIVER_VARIABLE_CHANGED,{item:p,scope:f,owner:this,save:!1,source:n.MESSAGE_SOURCE.DEVICE,publishMQTT:!1});for(z=0;z<l.length;z++){var K=l[z];"value"!=l[z].title&&(r=null,r=p.value,"number"!=typeof r&&(r=""+r,r="'"+r+"'"),K.target&&"None"!=K.target&&null!==r&&"null"!=r&&"'null'"!=r&&(u=f.getVariable(K.target)))&&(u.value=r,this.publish(n.EVENTS.ON_DRIVER_VARIABLE_CHANGED,{item:u,scope:f,owner:this,save:!1,source:n.MESSAGE_SOURCE.BLOX}))}if(a){for(r=
0;r<e.length;r++)if(u=e[r],_.isObject(u)&&u.src&&(z=f.getBlockById(u.src))&&z.onData)z.onData(u);for(r=0;r<g.length;r++)if(z=g[r],!1!==z.enabled){z.override={args:K?[K.value]:null};try{f.solveBlock(g[r],{highlight:!1})}catch(M){logError(M,"----solving response block crashed ")}}}}}}else u&&console.error(" onDeviceMessage : failed! Have no device instance for "+f.data.device.host,f)}}},sendManagerCommand:function(a,b){this.checkDeviceServerConnection();var d={manager_command:a};q.mixin(d,b);if(this.deviceServerClient)return this.deviceServerClient.emit(null,
d,a);console.error("Send Manager Command "+a+" failed, have no  device Server client");this.onHaveNoDeviceServer()},sendDeviceCommand:function(a,b,d,e,f,h,g,l){this.checkDeviceServerConnection();var p=a.getDeviceInfo();q.mixin({src:d},p);var y={command:b,device_command:"Device_Send",options:p};q.mixin(y.options,{params:{src:d,id:e,wait:h,stop:g,pause:l}});e=this.getDevice(p.id);e&&_.isObject(e)?e._userStopped||e&&(e.state===n.DEVICE_STATE.DISABLED||e.state===n.DEVICE_STATE.DISCONNECTED||e.state===
n.DEVICE_STATE.CONNECTING)||(h=q.stringFromDecString(y.command),e.isDebug()&&this.publish(n.EVENTS.ON_STATUS_MESSAGE,{text:'Did send message : \x3cspan class\x3d"text-warnin"\x3e'+h.substr(0,30)+'\x3c/span\x3e to \x3cspan class\x3d"text-info"\x3e'+p.host+":"+p.port+"@"+p.protocol+"\x3c/span\x3e"}),p=r(JSON.stringify(a.options),1)+"-Console",this.deviceServerClient?(this.deviceServerClient.emit(null,y,"Device_Send"),m("xcf-ui")&&!1!==f&&_.each(this.consoles[p],function(a){a.printCommand('\x3cspan class\x3d"text-info"\x3e\x3cb\x3e'+
y.command+"\x3c/span\x3e","")})):(this.onHaveNoDeviceServer(),console.error("this.deviceServerClient is null"),console.error(" Send Device Command "+b+"failed, have no  device Server client")),a.blockScope&&(a=a.blockScope.getBlockById(d),this.publish(n.EVENTS.ON_DEVICE_COMMAND,{device:e,command:q.stringFromDecString(b),deviceInfo:this.toDeviceControlInfo(e),name:a?a.name:""}))):console.error("invalid device")},loadDevices:function(a){this.sendManagerCommand(n.SOCKET_SERVER_COMMANDS.INIT_DEVICES,
{path:a})},callMethod:function(a,b,d,e,f){this.checkDeviceServerConnection();a={method:b,args:d,device_command:n.SOCKET_SERVER_COMMANDS.CALL_METHOD,params:{id:f,src:e},options:a.options};if(this.deviceServerClient)this.deviceServerClient.emit(null,a,n.SOCKET_SERVER_COMMANDS.CALL_METHOD);else this.onHaveNoDeviceServer()},runShell:function(a,b,d,e,f){a=a.getDeviceInfo();this.sendManagerCommand(n.SOCKET_SERVER_COMMANDS.RUN_SHELL,{cmd:b,args:d,options:q.mixin(a,{params:{id:f,src:e}})})},watchDirectory:function(a,
b){this.checkDeviceServerConnection();var d={path:a,watch:b,manager_command:n.SOCKET_SERVER_COMMANDS.WATCH};if(this.deviceServerClient)this.deviceServerClient.emit(null,d,n.SOCKET_SERVER_COMMANDS.WATCH);else this.onHaveNoDeviceServer()},createDeviceServerClient:function(c){var k=this,d=new a;this.deviceServerClient=null;if(this.deviceServerClient=b.createClientWithStore(c,"Device Control Server",{delegate:{onConnected:function(){k.onDeviceServerConnected();d.resolve();k.publish(n.EVENTS.ON_DEVICE_SERVER_CONNECTED);
l&&k.ctx.getNotificationManager().postMessage({message:"Connected to Device Server",type:"success",duration:3E3})},onLostConnection:function(){k.onDeviceServerConnectionLost()},onServerResponse:function(a){var b=a.data,c=null;if(_.isString(b)){try{c=JSON.parse(b)}catch(d){c=b}if((c=c||{},c.data)&&c.data.deviceMessage&&c.data.deviceMessage.event===n.EVENTS.ON_COMMAND_FINISH){k.onCommandFinish(c.data.device,c.data.deviceMessage);return}if(c&&c.data&&c.data.deviceMessage&&c.data.deviceMessage.event===
n.EVENTS.ON_COMMAND_PROGRESS){k.onCommandProgress(c.data.device,c.data.deviceMessage);return}if(c&&c.data&&c.data.deviceMessage&&c.data.deviceMessage.event===n.EVENTS.ON_COMMAND_PAUSED){k.onCommandPaused(c.data.device,c.data.deviceMessage);return}if(c&&c.data&&c.data.deviceMessage&&c.data.deviceMessage.event===n.EVENTS.ON_COMMAND_STOPPED){k.onCommandStopped(c.data.device,c.data.deviceMessage);return}if(c.data&&c.data.deviceMessage&&c.data.deviceMessage.event===n.EVENTS.ON_COMMAND_ERROR){k.onCommandError(c.data.device,
c.data.deviceMessage);return}if(c.event===n.EVENTS.ON_DEVICE_DISCONNECTED){k.publish(n.EVENTS.ON_DEVICE_DISCONNECTED,c.data);return}if(c.event===n.EVENTS.SET_DEVICE_VARIABLES)return k.onSetDeviceServerVariables(c.data);if(c.event===n.EVENTS.ON_RUN_CLASS_EVENT)return k.onRunClassEvent(c.data);if(c.event===n.EVENTS.ON_DEVICE_CONNECTED){k.publish(n.EVENTS.ON_DEVICE_CONNECTED,c.data);return}if(c.event===n.EVENTS.ON_SERVER_LOG_MESSAGE){k.publish(n.EVENTS.ON_SERVER_LOG_MESSAGE,c.data);return}if(c.event===
n.EVENTS.ON_MQTT_MESSAGE){k.publish(n.EVENTS.ON_MQTT_MESSAGE,c.data);k.onMQTTMessage(c.data);return}if(c.event===n.EVENTS.ON_FILE_CHANGED)return k.ctx.onXIDEMessage(dojo.fromJson(a.data))}k.onDeviceServerMessage(a)}}}))return this.deviceServerClient.dfd=d,this.deviceServerClient}})})},"xcf/model/Device":function(){define("xdojo/declare xide/data/Model xide/data/Source xide/types xide/utils xide/mixins/EventedMixin xcf/types/Types".split(" "),function(p,r,n,q,b,m){return p("xcf.model.Device",[r,n,
m],{_userStopped:!1,getParent:function(){return this.getStore().getSync(this.parentId)},isServerSide:function(){var a=this.getMetaValue(q.DEVICE_PROPERTY.CF_DEVICE_DRIVER_OPTIONS);return 1<<q.DRIVER_FLAGS.RUNS_ON_SERVER&a},isServer:function(){var a=this.getMetaValue(q.DEVICE_PROPERTY.CF_DEVICE_DRIVER_OPTIONS);return 1<<q.DRIVER_FLAGS.SERVER&a},isDebug:function(){var a=this.getMetaValue(q.DEVICE_PROPERTY.CF_DEVICE_DRIVER_OPTIONS);return 1<<q.DRIVER_FLAGS.DEBUG&a},check:function(){this._startDfd&&!0===
this._userStopped&&this.reset()},getStore:function(){return this._store},getScope:function(){var a=this.getStore();return a?a.scope:this.scope},isEnabled:function(){return!0===this.getMetaValue(q.DEVICE_PROPERTY.CF_DEVICE_ENABLED)},shouldReconnect:function(){return this._userStopped?!1:this.isEnabled()},reset:function(){delete this._startDfd;this._startDfd=null;delete this.blockScope;this.blockScope=null;delete this.serverVariables;this.serverVariables=null;delete this.driverInstance;this.driverInstance=
null;clearTimeout(this.reconnectTimer);delete this.lastReconnectTime;delete this.reconnectRetry;delete this.isReconnecting;this.setState(q.DEVICE_STATE.DISCONNECTED)},constructor:function(){},state:q.DEVICE_STATE.DISCONNECTED,driverInstance:null,blockScope:null,getBlockScope:function(){return this.blockScope},getDriverInstance:function(){return this.driverInstance},getDriver:function(){var a=this.getBlockScope();return a?a.driver:null},getMetaValue:function(a){return b.getCIInputValueByName(this.user,
a)},setMetaValue:function(a,g,h){var f=b.getCIByChainAndName(this.user,0,a);if(!f)return null;var d=this.getMetaValue(a);b.setCIValueByField(f,"value",g);this[a]=g;if(!1!==h)return this.publish(q.EVENTS.ON_CI_UPDATE,{owner:this.owner,ci:f,newValue:g,oldValue:d})},getStateIcon:function(a){a=a||this.state;switch(a){case q.DEVICE_STATE.READY:case q.DEVICE_STATE.CONNECTED:return"fa-link iconStatusOn";case q.DEVICE_STATE.SYNCHRONIZING:case q.DEVICE_STATE.CONNECTING:return"fa-spinner fa-spin";case q.DEVICE_STATE.LOST_DEVICE_SERVER:return"fa-spinner fa-spin"}return"fa-unlink iconStatusOff"},
setState:function(a,b){if(a!==this.state){var h=this.state,f=this.getStateIcon(a);this.state=a;this.set("iconClass",f);this.set("state",a);this._emit(q.EVENTS.ON_DEVICE_STATE_CHANGED,{old:h,state:a,icon:f,"public":!0});this.refresh()}}})})},"xide/data/Source":function(){define(["dcl/dcl","dojo/_base/declare","xide/utils"],function(p,r,n){var q={_references:null,_originReference:null,onReferenceUpdate:function(){},onReferenceRemoved:function(){},onReferenceDelete:function(){},updateReference:function(){},
getReferences:function(){return this._references?n.pluck(this._references,"item"):[]},addReference:function(b,m,a){this._references||(this._references=[]);this._references.push({item:b,settings:m});var g=this;if(m&&m.onDelete&&b._store)b._store.on("delete",function(a){a.target==b&&g._store.removeSync(g[g._store.idProperty])});a&&b.addSource&&b.addSource(this,m)},removeReference:function(b){this._references&&_.each(this._references,function(m){m&&m.item==b&&this._references&&this._references.remove(m)},
this)},updateReferences:function(b){var m=b.property,a=b.value;this._references||(this._references=[]);for(var g=0;g<this._references.length;g++){var h=this._references[g],f=h.item,h=h.settings,d=f._store;if(this._originReference!=f&&b.property&&h.properties&&h.properties[b.property]){d&&(d._ignoreChangeEvents=!0);try{if(f.onSourceChanged)f.onSourceChanged(m,a);else f.set(m,a)}catch(e){}d&&(d._ignoreChangeEvents=!1,d.emit("update",{target:f}))}}},constructor:function(b){this._references=[];n.mixin(this,
b)},onItemChanged:function(b){this.updateReferences(b)}};r=r("xgrid.data.Source",null,q);r.dcl=p(null,q);r.Implementation=q;return r})},"xcf/mixins/LogMixin":function(){define(["dcl/dcl","xcf/types/Types","xide/utils"],function(p,r,n){var q=r.DEFAULT_DEVICE_LOGGING_FLAGS;p=p(null,{hasFlagEx:function(b,m,a){b=b.loggingFlags;b=_.isString(b)?n.fromJson(b):b||{};a=b[a]?b[a]:q[a];return null!=a&&a&m?!0:!1}});p.DEFAULT_LOGGING_FLAGS=q;return p})},"xcf/manager/Context":function(){define("dcl/dcl dojo/_base/declare dojo/_base/array dojo/_base/lang xide/manager/Context xide/factory xide/types xcf/manager/DriverManager xcf/manager/DeviceManager xcf/manager/ProtocolManager xcf/manager/Application xcf/manager/LogManager xide/manager/ResourceManager xide/manager/PluginManager xdojo/has xdojo/has!xideve?xcf/manager/WidgetManager".split(" "),
function(p,r,n,q,b,m,a,g,h,f,d,e,l,c,k,t){return p([b],{declaredClass:"xcf.manager.Context",getUserDirectory:function(){var a=this.getResourceManager();if(a)return a.getVariable("USER_DIRECTORY")},namespace:"xcf.manager.",driverManager:null,deviceManager:null,protocolManager:null,debugManager:null,nodeServiceManager:null,blockManager:null,getBlockManager:function(){return this.blockManager},getProtocolManager:function(){return this.protocolManager},getDriverManager:function(){return this.driverManager},
getDeviceManager:function(){return this.deviceManager},getNodeServiceManager:function(){return this.nodeServiceManager},getDebugManager:function(){return this.debugManager},constructManagers:function(a){this.isEditor()},initManagers:function(){this.isEditor()||(this.driverManager.init(),this.deviceManager.init(),k("protocols")&&this.protocolManager.init(),k("log")&&this.logManager.init());this.resourceManager&&this.resourceManager.init()}})})},"xide/manager/Context":function(){define("dcl/dcl dojo/_base/lang dojo/_base/json dojo/Deferred dojo/has xide/manager/ContextBase xide/factory xide/types xide/utils require dojo/promise/all xdojo/has!host-browser?xide/manager/Context_UI".split(" "),
function(p,r,n,q,b,m,a,g,h,f,d,e){n=p([m],{getMount:function(a){var b=this.getResourceManager();return(b=b?b.getVariable("VFS_CONFIG")||{}:null)&&b[a]?b[a]:null},toVFSShort:function(a,b){var k=this.getResourceManager();return(k=k?k.getVariable("VFS_CONFIG")||{}:null)&&k[b]&&(k=k[b],k=h.replaceAll("//","/",k),k=k.replace(/\/+$/,""),-1!==a.indexOf(k))?(k=k.replace(/\/+$/,""),a.substr(a.indexOf(k)+(k.length+1),a.length)):null},findVFSMount:function(a){var b=this.getResourceManager();if(b=b?b.getVariable("VFS_CONFIG")||
{}:null)for(var k in b){var d=b[k],d=h.replaceAll("//","/",d),d=d.replace(/\/+$/,"");if(-1!==a.indexOf(d))return k}return null},declaredClass:"xide.manager.Context",application:null,contextManager:null,fileManager:null,resourceManager:null,notificationManager:null,serviceObject:null,pluginManager:null,windowManager:null,logManager:null,mountManager:null,config:null,managers:null,namespace:"xide.manager.",defaultNamespace:"xide.manager.",vfsMounts:null,xideServiceClient:null,fileUpdateTimes:{},onXIDEMessage:function(a,
b){if(a&&a.event&&a.event===g.EVENTS.ON_FILE_CHANGED)if(a.data&&a.data.mask&&-1!==a.data.mask.indexOf("delete"))this.publish(g.EVENTS.ON_FILE_DELETED,a);else if(a.data&&"delete"==a.data.type)this.publish(g.EVENTS.ON_FILE_DELETED,a);else{var k=a.data.path,d=(new Date).getTime();if(this.fileUpdateTimes[k]&&1E3>d-this.fileUpdateTimes[k])this.fileUpdateTimes[k]=d;else if(!1!==b&&this.publish(a.event,a),this.fileUpdateTimes[k]=d,k=h.replaceAll("\\","/",a.data.path),k=h.replaceAll("//","/",a.data.path),
k=k.replace(/\\/g,"/"),-1===k.indexOf("/build/")&&null!=k&&null!=k.indexOf){if(k.match(/\.css$/))this.onCSSChanged({path:k});if(k.match(/\.js$/)&&(d=a.data.modulePath)){d=d.replace(".js","");try{f(d)}catch(e){}var m="data/system/drivers";-1!=k.indexOf(m)&&(d=k.substr(k.indexOf(m)+(m.length+1),k.length),d=d.replace(".js",""),d="system_drivers/"+d);m="user/drivers";-1!=k.indexOf(m)&&(d=k.substr(k.indexOf(m)+(m.length+1),k.length),d=d.replace(".js",""),d="user_drivers/"+d);(m=(m=this.getResourceManager())?
m.getVariable("VFS_CONFIG")||{}:null)&&m.user_drivers&&-1!==k.indexOf(m.user_drivers)&&(m=m.user_drivers,m=m.replace(/\/+$/,""),d=k.substr(k.indexOf(m)+(m.length+1),k.length),d=d.replace(".js",""),d="user_drivers/"+d);d=h.replaceAll(".","/",d);d.indexOf("/build/")}}}},onNodeServiceStoreReady:function(a){this.xideServiceClient&&this.xideServiceClient.destroy()},mergeFunctions:function(a,b,k,d){for(var e in b)_.isFunction(b[e])&&b[e]&&a&&(a[e]=b[e])},reloadModules:function(a,b){var k=new q,e=[],h=[],
g=this;f({cacheBust:"time\x3d"+(new Date).getTime()});_.each(a,function(a){var k=null,d=new q;!1!==b&&(k=f(a));f.undef(a);f([a],function(a){k&&g.mergeFunctions(k.prototype,a.prototype);h.push(a);d.resolve()});e.push(d)});d(e).then(function(){k.resolve(h);f({cacheBust:null})});return k},getModule:function(a){return r.getObject(h.replaceAll("/",".",a))||r.getObject(a)||(p.getObject?p.getObject(a)||p.getObject(h.replaceAll("/",".",a)):null)},_reloadModule:function(a,b){var k=null,d=new q;a=a.replace("0/8",
"0.8");var e=this.getModule(a);if(e&&e.prototype&&e.prototype.reloadModule)return e.prototype.reloadModule();var k=f.on("error",function(b){console.log(b.src,b.id);console.error("require error "+a,b);k.remove();d.reject(b)}),m=this.getModule(a);if(!m&&(m="undefined"!==typeof a?m:null,!m&&"undefined"!==typeof window))if(m=h.getAt(window,h.replaceAll("/",".",a),null))e=m;else try{m=f(h.replaceAll(".","/",a))}catch(p){console.log("couldnt require old module",a)}m&&(e=m);f.undef(a);var n=this;b?setTimeout(function(){f({cacheBust:"time\x3d"+
(new Date).getTime(),waitSeconds:5});try{f([a],function(b){f({cacheBust:null});if(_.isString(b))console.error("module reloaded failed : "+b+" for module : "+a);else{b.modulePath=a;e&&(n.mergeFunctions(e.prototype,b.prototype,e,b),e.prototype&&e.prototype._onReloaded&&e.prototype._onReloaded(b));if(m&&m.onReloaded)m.onReloaded(b,m);n.publish(g.EVENTS.ON_MODULE_RELOADED,{module:a,newModule:b});b.prototype&&b.prototype.declaredClass&&n.publish(g.EVENTS.ON_MODULE_UPDATED,{moduleClass:b.prototype.declaredClass,
moduleProto:b.prototype});d.resolve(b)}})}catch(b){console.error("error reloading module",b),logError(b,"error reloading module"),d.reject(b)}},100):d.resolve();return d},onCSSChanged:function(a){},onDidChangeFileContent:function(a){if(!a.didProcess&&(a.didProcess=!0,this.vfsMounts&&a.path)){var b=a.path;if(-1==b.indexOf(".css")&&-1==b.indexOf("resources")&&-1==b.indexOf("meta")&&-1!=b.indexOf(".js")){var b=a.mount.replace("/",""),k=null;if(this.vfsMounts[b]){var k=""+a.path,k=k.replace("./",""),
k=k.replace("/","."),k=k.replace(".js",""),k=h.replaceAll(".","/",k),d=this;setTimeout(function(){try{d._reloadModule(k,!0)}catch(a){console.error("error reloading module",a)}},100)}}}},getBlockManager:function(){return this.blockManager},getPluginManager:function(){return this.pluginManager},getService:function(){return this.serviceObject},getFileManager:function(){return this.fileManager},getResourceManager:function(){return this.resourceManager},getMountManager:function(){return this.mountManager},
getContextManager:function(){return this.contextManager},getLogManager:function(){return this.logManager},getApplication:function(){return this.application},constructor:function(a){this.managers=[];this.config=a;this.language="en";this.subscribe(g.EVENTS.ON_CHANGED_CONTENT,this.onDidChangeFileContent);b("xnode")&&this.subscribe(g.EVENTS.ON_NODE_SERVICE_STORE_READY,this.onNodeServiceStoreReady)},prepare:function(){this.config&&this.initWithConfig(this.config)},initWithConfig:function(a){a&&a.mixins&&
this.doMixins(a.mixins)},isEditor:function(){return this.args&&this.args.file}});p.chainAfter(n,"constructManagers");p.chainAfter(n,"initManagers");return n})},"xcf/manager/ProtocolManager":function(){define("dcl/dcl dojo/_base/declare xide/manager/ServerActionBase xide/types xide/utils xide/factory xaction/Action xcf/manager/BeanManager".split(" "),function(p,r,n,q,b,m,a,g,h,f,d,e,l,c){return p([n,g],{declaredClass:"xcf.manager.ProtocolManager",beanNamespace:"protocol",beanName:"Protocol",beanIconClass:"fa-code",
groupType:q.ITEM_TYPE.PROTOCOL_GROUP,itemType:q.ITEM_TYPE.PROTOCOL,itemMetaPath:"user.meta",itemMetaStorePath:"/meta/inputs",itemMetaTitleField:q.PROTOCOL_PROPERTY.CF_PROTOCOL_TITLE,systemScope:"system_protocols",userScope:"user_protocols",appScope:"app_protocols",defaultScope:"system_protocols",serviceClass:"XCF_Protocol_Service",rawData:null,store:null,treeView:null,protocolScopes:null,getItemActions:function(){var a=[],c=this,d=this.getItem(),e=d?!0===b.toBoolean(d.isDir):!1;a.push({title:"New Group",
icon:"el-icon-folder",place:"last",emit:!1,style:"",handler:function(a,b,d){c.newGroup()}});a.push({title:"Reload",icon:"fa-refresh",disabled:!1,command:"Reload",place:"last",emit:!1,style:"",handler:function(){c.reload()}});null!=this.getItem()&&(a.push({title:"Delete",icon:"el-icon-remove-circle",disabled:!1,command:"Delete",place:"last",emit:!1,style:"",handler:function(){c.onDeleteItem(d)}}),e?a.push({title:"New Protocol",icon:"el-icon-file-new",disabled:!1,command:"NewItem",place:"last",emit:!1,
style:"",handler:function(){c.newItem(d)}}):a.push({title:"Connect",icon:"el-icon-play-circle",disabled:!1,command:"Start",place:"last",emit:!1,style:"",handler:function(){c.startDevice(d)}}));return a},onItemRemoved:function(a){a==this.currentItem&&(this.currentItem=null);a&&(a=this.getView(a))&&b.destroyWidget(a)},_onDeleteItem:function(a){var c=!0===b.toBoolean(a.isDir),d=b.toString(a.name),e=c?"removeGroup":"removeItem",f=this;(new h({title:"Remove Protocol"+(c?" Group":"")+" '"+d+"'",style:"max-width:400px",
titleBarClass:"text-danger",delegate:{isRemoving:!1,onOk:function(c){f[e](b.toString(a.scope),b.toString(a.path),function(){f.onItemRemoved(a)})}},inserts:[{query:".dijitDialogPaneContent",insert:'\x3cdiv\x3e\x3cspan class\x3d"fileManagerDialogText"\x3eDo you really want to remove  this item?\x3c/span\x3e\x3c/div\x3e',place:"first"}]})).show()},newItem:function(){var a=this.getItem();a||(a={path:""});var c=[b.createCI("In Group",13,b.toString(a.path),{widget:{disabled:!0},group:"Common"}),b.createCI("Title",
13,"",{group:"Common"})],a=new d({title:"New Device",resizable:!0,delegate:{onOk:function(a,d){var k=b.createCI("Id",13,b.createUUID(),{visible:!1,group:"Common"});d.push(k);b.toOptions(d);b.getInputCIByName(c,"Title");b.getInputCIByName(c,"Scope");b.getInputCIByName(c,"In Group")}},cis:c});a.show();a.resize()},reload:function(){},onFileChanged:function(a){if(!a._pp2){a._pp2=!0;var c=a.data;this.fileUpdateTimes||(this.fileUpdateTimes={});if(c.event===q.EVENTS.ON_FILE_CHANGED){if(c.data&&c.mask&&-1!==
c.mask.indexOf("delete")){console.error("deleted");return}(new Date).getTime()}var d=b.replaceAll("\\","/",c.path),d=b.replaceAll("//","/",c.path),d=d.replace(/\\/g,"/");-1!=d.indexOf("protocols")&&(d.match(/\.json$/)&&(-1!=d.indexOf("data/system/protocols")&&console.log("protocol changed"+d),this.ls("system_protocols")),this.onFileChanged2&&this.onFileChanged2(a))}},init:function(){this.subscribe(q.EVENTS.ON_FILE_CHANGED,this.onFileChanged)},_resetItem:function(a){a.commandsItem&&b.removeFromStore(this.getStore(),
a.commandsItem,!0,"path","parentId");a.variablesItem&&b.removeFromStore(this.getStore(),a.variablesItem,!0,"path","parentId")},_completeProtocolItem:function(a){if(a&&a.user){var c=b.getInputCIByName(a.user.meta,"content"),d=this,e=this.getStore();if(!c&&(a.mount=""+a.scope,a.getPath=function(){return a.path},a.virtual=!1,a.isDir=!0,a.children=[],c=b.createCI("Content",q.ECIType.FILE_EDITOR,"no value",{group:"Content",editor:"JSON Editor",editorArgs:{subscribers:[{event:"onSave",handler:function(c){(c=
b.getJson(c.value))&&c.meta&&(a.user=c,a._completed=!1,d._resetItem(a),d._completeProtocolItem(a),d.publish(q.EVENTS.ON_PROTOCOL_CHANGED,{item:a}))},owner:d}],leftEditorArgs:{subscribers:[{event:"addAction",handler:function(a){console.log("add action",arguments)},owner:d}],hiddenFields:{},readOnlyNodes:{commands:!0,variables:!0,meta:!0},insertTemplates:[{label:"New Command",path:"commands",value:'{title:"No Title",send:""}',newNodeTemplate:"[]",collapse:!0,select:!0},{label:"New Variable",path:"variables",
value:'{title:"No Title",value:""}',newNodeTemplate:"[]",collapse:!0,select:!0}],renderTemplates:[{nodeValuePath:"field.innerHTML",match:[/^variables[\s]?\.(\d+)$/,/^commands[\s]?\.(\d+)$/],replaceWith:"{nodeValue} - {title}",variables:null,nodeValueTransform:function(a){return b.capitalize(a)},insertIfMatch:{}}]},rightEditorArgs:{subscribers:[{event:"addAction",handler:function(a){console.log("add action",arguments)},owner:d}]}},editorItem:a,editorOverrides:{},isOwnTab:!0}),a.user.meta.inputs.push(c),
!a._completed)){a._completed=!0;var f={path:b.createUUID(),name:"Commands",isDir:!0,type:"leaf",parentId:a.path,virtual:!0,children:[]};a.commandsItem=f;a.children.push(f);e.putSync(f);for(var h=a.user.commands,c=0;c<h.length;c++){var g=h[c];f.children.push(e.putSync({path:b.createUUID(),name:g.name,id:b.createUUID(),parentId:f.path,_mayHaveChildren:!1,virtual:!0,user:{},isDir:!1,value:g.value,ref:{protocol:a,item:g},type:"protocolCommand"}))}f={path:b.createUUID(),name:"Variables",isDir:!0,type:"leaf",
parentId:a.path,virtual:!0,items:[],children:[]};e.putSync(f);a.children.push(f);a.variablesItem=f;h=a.user.variables;for(c=0;c<h.length;c++)g=h[c],f.children.push(e.putSync({isDir:!1,path:b.createUUID(),name:g.name,id:b.createUUID(),parentId:f.path,_mayHaveChildren:!1,value:g.value,virtual:!0,user:{},ref:{protocol:a,item:g},type:"protocolVariable"}))}}},onStoreReady:function(a){a=a?b.queryStore(a,{isDir:!1}):[];var c=this;_.each(a,function(a,b,d){c._completeProtocolItem(a)})},onMainViewReady:function(){var b=
this,c=a.createDefault("New Protocol","fa-exchange","File/New/Protocol","__anewAction",null,{permanent:!0,handler:function(){b.newItem()}}).setVisibility(q.ACTION_VISIBILITY.ACTION_TOOLBAR,null).setVisibility(q.ACTION_VISIBILITY.MAIN_MENU,{}).setVisibility(q.ACTION_VISIBILITY.CONTEXT_MENU,null);b.publish(q.EVENTS.REGISTER_ACTION,{owner:b,action:c});f.prototype.ctx=this.ctx},openItemSettings:function(a){var c=a.user;if(!c||!c.meta)return null;var d=this.getViewId(a),f=l.byId(d);try{if(f)return f.parentContainer&&
f.parentContainer.selectChild(f),null}catch(h){b.destroyWidget(f)}var f=this.getViewTarget(),g=this.getMetaValue(a,this.itemMetaTitleField);a.beanContextName=this.ctx.mainView.beanContextName;return b.addWidget(e,{title:g||b.toString(a.name),cis:c.meta.inputs,beanContextName:this.ctx.mainView.beanContextName,storeItem:a,iconClass:this.beanIconClass,id:d,delegate:this,storeDelegate:this,closable:!0,showAllTab:!1,blockManager:this.ctx.getBlockManager()},this,f,!0)}})})},"xaction/Action":function(){define("xdojo/declare xide/model/Base xide/types xide/utils/ObjectUtils xide/utils xide/mixins/EventedMixin".split(" "),
function(p,r,n,q,b,m){b.mixin(n,{ACTION_VISIBILITY:{MAIN_MENU:"MAIN_MENU",CONTEXT_MENU:"CONTEXT_MENU",QUICK_LAUNCH:"QUICK_LAUNCH",ACTION_TOOLBAR:"ACTION_TOOLBAR",PROPERTY_VIEW:"PROPERTY_VIEW",RIBBON:"RIBBON",widgetArgs:null,factory:function(){var a=arguments[1]||b.clone(n.ACTION_VISIBILITY),h=arguments;if(0<h[0].length&&_.isNumber(h[0][0])){var f=h[0],d=0;_.each(a,function(b,h){"function"!==typeof a[h]&&d<f.length&&(a[h+"_val"]=f[d]);d++})}if(_.isString(h[0][0])){if(!0===h[0][2])b.mixin(a[h[0][0]+
"_val"],h[0][2]);else return a[h[0][0]+"_val"]=h[0][1],a;return h[1]}return a}}});n.ACTION_VISIBILITY_ALL="ACTION_VISIBILITY_ALL";var a=p("xaction/Action",[r,m],{disabled:!1,enabled:!0,object:null,show:!0,group:"",types:"",command:null,icon:"fa-play",event:null,handler:null,tab:null,visibility_:null,value:null,setVisibility:function(){if(2==arguments.length&&_.isString(arguments[0])&&arguments[0]==n.ACTION_VISIBILITY_ALL){var a=arguments[1],h=n.ACTION_VISIBILITY,f=this;[h.MAIN_MENU,h.ACTION_TOOLBAR,
h.CONTEXT_MENU,h.RIBBON].forEach(function(d){f.setVisibility(d,b.cloneKeys(a,!1))});return this}h=_.isArray(arguments[0])?arguments[0]:arguments;this.visibility_=n.ACTION_VISIBILITY.factory(h,this.visibility_);return this},getVisibility:function(a){this.visibility_||this.setVisibility(n.ACTION_VISIBILITY_ALL,{});return this.visibility_?(null==this.visibility_[a+"_val"]&&(this.visibility_[a+"_val"]={vis:a}),this.visibility_[a+"_val"]):{}},shouldDestroyWidget:function(a,b,f){a=null!=this.getVisibility?
this.getVisibility(a):null;var d=!0;a&&a.permanent&&(d=!(_.isFunction(a.permanent)?a.permanent(this,b,f):a.permanent));return d}});a.create=function(g,h,f,d,e,l,c,k,m,q,n){g=new a({permanent:d,command:f,icon:h,label:g,owner:this,types:l,operation:e,group:c,handler:q,title:g});b.mixin(g,n);return g};a.createDefault=function(b,h,f,d,e,l){return a.create(b,h,f,!1,null,null,d||"nogroup",null,!1,e,l)};return a})},"xcf/manager/Application":function(){define("dcl/dcl require xdojo/declare xide/manager/Application xide/utils xide/types xdojo/declare xdojo/has xdojo/has!xcf-ui?xcf/manager/Application_UI xdojo/has!xexpression?xexpression/Expression".split(" "),
function(p,r,n,q,b,m,a,g,h,f,d){return p(q,{declaredClass:"xcf.manager.Application",vfsItems:null,onReloaded:function(){},onMountDataReady:function(a){},onPluginLoaded:function(a){this.publish(m.EVENTS.ON_PLUGIN_READY,{name:a.name,mainView:this.rootView,config:this.config,ctx:this.ctx,panelManager:this,fileManager:this.ctx.getFileManager(),store:this.store,serviceObject:this.ctx.getService()},this)},_onXBlocksReady:function(){r("xfile/manager/BlockManager");var a=this.ctx;if(a.blockManager)a.blockManager.onReady();
r(["xcf/manager/BlockManager"],function(b){a.blockManager=new b;a.blockManager.ctx=a;a.blockManager.updatePalette=!1;a.blockManager.init();a.blockManager.onReady();a.blockManager.serviceObject=a.fileManager.serviceObject});var b=r("xblox/views/BlocksFileEditor");a.registerEditorExtension("xBlocks","xblox","fa-play-circle-o",this,!0,null,b,{ctx:this.ctx,mainView:this.mainView,blockManagerClass:"xfile.manager.BlockManager",registerView:!0})},onComponentReady:function(a){}})})},"xide/manager/Application":function(){define("dcl/dcl xdojo/has xide/manager/ManagerBase xide/types xide/utils dojo/Deferred dojo/promise/all dojo/has!host-browser?xide/manager/Application_UI".split(" "),
function(p,r,n,q,b,m,a,g){return p([n],{declaredClass:"xide.manager.Application",container:null,ctx:null,_debug:!0,_loadedComponents:{},_loadingComponents:null,getComponents:function(){return this._loadedComponents},doComponents:function(){var b=this.loadComponents(),f=require,d=this,e=[];if(!b||!b.dfd)return console.error("componentsToLoad is null or has no head dfd"),b;var g=q.COMPONENT_NAMES;if(r("xfile")&&b[g.XFILE].dfd){var c=new m;e.push(c);b[g.XFILE].dfd.then(function(){d.initXFile().then(function(){c.resolve()})})}if(r("xideve")&&
b[g.XIDEVE].dfd){var k=new m;e.push(k);b[g.XIDEVE].dfd.then(function(){d.initXIDEVE().then(function(){k.resolve()})})}if(r("xnode")&&b[g.XNODE].dfd){var n=new m;e.push(n);b[g.XNODE].dfd.then(function(){d.initXNODE().then(function(){n.resolve()})})}if(b[g.XBLOX].dfd){var p=new m;e.push(p);b[g.XBLOX].dfd.then(function(){f(["xblox/embedded_ui","xfile/manager/BlockManager","xblox/views/BlocksFileEditor"],function(){d.onXBlocksReady().then(function(){p.resolve()})})})}b.dfd.then(function(){a(e).then(function(){A.resolve()})});
var A=new m;A.then(function(){d.registerEditorExtensions()});return A},loadComponents:function(a){if(this._loadingComponents)return this._loadingComponents;var f=this,d,e;f._loadedComponents={};a=a||b.getJson(this.ctx.getResourceManager().getVariable("COMPONENTS"));_.each(a,function(b,c){!1===r(c)&&delete a[c]});if(!a)return null;d=function(){var b=_.find(a,{status:0});b?e(b.name,b):(a.dfd.resolve(a),f.publish(q.EVENTS.ON_ALL_COMPONENTS_LOADED,a),a.dfd.resolve())};e=function(a,b){var c=b.settings;
!1===r(a)&&console.error("loading component "+a+"which is disabled by has!");f.ctx.getPluginManager().loadComponent(a,null,!0===c?null:c).then(function(c){f._loadedComponents[a]=c;c={component:c,name:a};b.dfd.resolve(c);f.publish(q.EVENTS.ON_COMPONENT_READY,c);b.status=1;d()})};for(var g in a){var c=""+g,k=a[c];a[c]=k?{settings:k,status:0,name:c,dfd:new m}:{status:1}}a.dfd=new m;d();return this._loadingComponents=a},hasComponent:function(a){var f=b.getJson(this.ctx.getResourceManager().getVariable("COMPONENTS"));
return!(!f||!f[a])}})})},"xcf/manager/LogManager":function(){define(["dcl/dcl","xide/utils","xlog/manager/LogManager","xdojo/has!xcf-ui?xcf/views/LogView"],function(p,r,n,q){return p(n,{declaredClass:"xcf.manager.LogManager",createLoggingView:function(b,m){var a=this.getViewTarget();try{return r.addWidget(q,{delegate:this,store:b,title:"Log",closable:!0},this,a,!0)}catch(g){console.error(g)}},ls:function(b,m){var a=this;return this.callMethodEx(null,"ls",["unset"],function(g){a.rawData=g;a.initStore(g);
b&&b(g)},!0)}})})},"xlog/manager/LogManager":function(){define("dcl/dcl xdojo/declare xide/manager/ServerActionBase xide/manager/BeanManager xide/encoding/MD5 xide/types xide/utils dojo/cookie dojo/json dojo/Deferred xide/data/Memory dstore/Trackable xide/mixins/EventedMixin".split(" "),function(p,r,n,q,b,m,a,g,h,f,d,e,l){var c=r([l],{bytesLoaded:null,percentValue:null,item:null,delegate:null,_onEnd:null,_onHandle:null,serviceClass:"XIDE_Log_Service",constructor:function(a){this.item=a;this.subscribe(a.progressMessage,
this._onProgress);this.subscribe(a.progressFailedMessage,this._onProgressFailed)},_onProgressFailed:function(a){this.item.level="error";this.item.message=this.item.oriMessage+" : Failed";this.item._isTerminated=!0;a&&a.item&&a.item.error&&this.item.details&&(this.item.details.error=a.item.error)},_onFinish:function(){this._onHandle&&this._onHandle.remove()},destroy:function(){this._destroyHandles()},_onProgress:function(a){try{var b=a.progress;a=null;null==a&&(a=Math.round(100*b.loaded/b.total),this.bytesLoaded=
b.loaded);if(this.percentValue!=a){var c=""+this.item.oriMessage;this.item.message=""+(c+(" : "+a+"%"))}this.percentValue=a;this._emit("progress");100<=this.percentValue&&(this.item.message=this.item.oriMessage+" : Done",this._emit("finish"),this._onFinish(),this.destroy())}catch(d){console.error("crash in log progress "+d)}}});return p([n,q],{declaredClass:"xcf.manager.LogManager",serviceClass:"XIDE_Log_Service",cookiePrefix:"logging",singleton:!0,serviceView:null,clients:null,beanNamespace:"logging",
views:null,stores:{},removeStore:function(a){var b=this.stores[a];b&&(b.destroy&&b.destroy(),delete this.stores[a])},getViewId:function(a){return this.beanNamespace+b(JSON.stringify({info:a.info}),1)},loadPreferences:function(){var a=g(this.cookiePrefix+"_debug_settings");return a=a?h.parse(a):{}},savePreferences:function(a){g(this.cookiePrefix+"_debug_settings",h.stringify(a))},empty:function(a){this.clear(a);a=this.getStore(a);a.then&&a.then(function(a){a.setData([])})},clear:function(a){return this.runDeferred(null,
"clearAbs",[a||""]).then(function(a){})},getViewTarget:function(){return this.ctx.getApplication().mainView.getNewAlternateTarget()},getStore:function(b){if(!b)return this.store;var c=new f;if(this.stores[b])return c.resolve(this.stores[b]),c;var d=this;this.runDeferred(null,"lsAbs",[b||""]).then(function(e){_.isString(e)&&(e=a.getJson(e));e=d.initStore(e);d.stores[b]=e;c.resolve(e)});return c},isValid:function(){return null!=this.store},_buildLoggingMessage:function(b){var c={id:a.createUUID(),level:b.level,
message:b.message,host:"",data:b.data||{},time:b.time||(new Date).getTime(),type:"",show:!0,showDevice:!0};b.type&&(c.type=b.type);b.device&&b.device.host&&(c.host=b.device.host+":"+b.device.port);b.deviceMessage&&(c.message=c.message+":"+b.deviceMessage);c.ori=b;return c},initStore:function(b){var c={identifier:"time",label:"level",items:[],sort:"time"},e=null;0==b.length&&(b=[]);for(var f=0;f<b.length;f++)c.items.push(this._buildLoggingMessage(b[f]));try{e=new (r("LogStore",[d],{}))({idProperty:"time",
data:c,id:a.createUUID()})}catch(h){console.error("log creation failed: ",h)}return e},createLoggingView:function(b,c,d){c=c||this.getViewTarget();try{return a.addWidget(!1,{delegate:this,store:b,title:"Log",closable:!0,style:"padding:0px",silent:d},this,c,!0)}catch(e){console.error(e)}},updateViews:function(a,b){for(var c=0;c<this.views.length;c++)this.views[c].update(a,b)},refreshViews:function(a,b){for(var c=0;c<this.views.length;c++)this.views[c].grid.refresh()},addLogView:function(a){this.views.push(a)},
openLogView:function(a,b){this.isValid()||this.initStore([]);var c=this.createLoggingView(this.store,a,b);this.views.push(c);return c},_createPendingEvent:function(a,b,d,e){function f(a){!b._isTerminated&&h&&(b.message=b.oriMessage+" : Done",a&&!0===a.failed&&(b.level="error",b.message=b.oriMessage+" : Failed"),b._isTerminated=!0,h.remove(),h=null,g.refreshViews(),b.progressHandler&&b.progressHandler.destroy())}var h=null,g=this;b._isInProgress=!0;h=g.subscribe(d,f,g)[0];b.showProgress&&b.progressMessage&&
!b.progressHandler&&(a=new c(b,this),a._onEnd=f,a._onEndHandle=h,b.progressHandler=a)},addLoggingMessage:function(b){if(b&&b.data){var c=b.data.logId;!c&&b.data&&b.data.device&&(c=b.data.device,c=c.host+"_"+c.port+"_"+c.protocol)}var d={id:a.createUUID(),level:b.level,message:b.message,host:b.host||"",data:b.data||{},time:b.time||(new Date).getTime(),type:b.type||"",show:!0,showDevice:!0,terminatorItem:b.item,terminatorMessage:b.terminatorMessage,showProgress:b.showProgress,progressMessage:b.progressMessage,
progressFailedMessage:b.progressFailedMessage,details:b.details};b.data&&(b.data.type&&(d.type=b.data.type),b.data.device&&b.data.device.host&&(d.host=b.data.device.host+":"+b.data.device.port),b.data.deviceMessage&&(d.message=d.message+":"+b.data.deviceMessage));this.isValid();try{null==d.terminatorMessage||d._isTerminated||(null==d.oriMessage&&(d.oriMessage=""+d.message),this._createPendingEvent(d.oriMessage,d,d.terminatorMessage,d.time));var e=this.getStore(c);e&&(e.then?e.then(function(a){e=a;
d=a.putSync(d);a._emit("added",{item:d,store:e})}):(d=e.putSync(d),e._emit("added",{item:d,store:e})))}catch(f){console.error("adding log message to store failed "+f)}},onServerLogMessage:function(a){a.data&&a.data.time&&(a.time=a.data.time);this.addLoggingMessage(a);1==a.write&&this.publish(m.EVENTS.ON_CLIENT_LOG_MESSAGE,{message:a.message,data:a.data,details:a.details,level:a.level,type:a.type,time:a.data.time||a.time})},init:function(){this.subscribe([m.EVENTS.ON_SERVER_LOG_MESSAGE]);this.views=
[];this.stores={}},onStoreReloaded:function(a){for(a=0;a<this.views.length;a++){var b=this.views[a];b.reload(this.store);b.update()}},reload:function(){var a=this;this.currentItem=null;this.ls(function(b){a.onStoreReloaded(b)})},ls:function(b,c,d){var e=this;return this.callMethodEx(null,"lsAbs",[c||""],d||function(c){e.rawData=c;_.isString(c)&&(c=a.getJson(c));e.store=e.initStore(c);b&&b(c)},!0)}})})},"xide/manager/ResourceManager":function(){define(["dcl/dcl","xide/manager/ServerActionBase","xide/utils",
"xide/mixins/VariableMixin"],function(p,r,n,q){return p([r,q.dcl],{declaredClass:"xide.manager.ResourceManager",serviceClass:"XApp_Resource_Service",resourceData:null,resourceVariables:null,getResourceVariables:function(){return this.resourceVariables},setVariable:function(b,m){return this.resourceVariables[b]=m},getVariable:function(b){return this.resourceVariables[b]},init:function(){this.resourceVariables||(this.resourceVariables={})},replaceVariables:function(b,m){return n.multipleReplace(""+
b,m||this.resourceVariables)}})})},"xide/mixins/VariableMixin":function(){define(["dcl/dcl","xdojo/declare","xide/utils"],function(p,r,n){var q={resolve:function(b,m,a){m=m||this.resourceVariables||this.ctx.getResourceManager().getResourceVariables()||null;a=a||this.variableDelimiters||null;return n.replace(b,null,m,a)}};r=r("xide/mixins/VariableMixin",null,q);r.dcl=p(null,q);return r})},"xide/manager/PluginManager":function(){define("dcl/dcl dojo/has xide/manager/ManagerBase xide/utils xide/types xide/factory dojo/Deferred dojo/promise/all".split(" "),
function(p,r,n,q,b,m,a,g){return p(n,{declaredClass:"xide.manager.PluginManager",_defaultPackageLocationPrefix:"../../",_defaultPackageLocationSuffix:"/component",_defaultComponentFlags:{LOAD:1,RUN:2},defaultComponentMixin:function(a){return{owner:this,ctx:this.ctx,flags:a}},componentBaseClasses:null,ctx:null,pluginResources:null,pluginInstances:null,_componentReady:function(a,b,d){if(b.RUN)try{a.run(this.ctx)}catch(e){}return d.resolve(a)},_componentLoaded:function(a,b,d,e){try{q.mixin(d,this.defaultComponentMixin(b));
var g=m.createInstance(a,d,this.componentBaseClasses),c=function(a,b,c){this._componentReady(a,b,c)}.bind(this);b.LOAD?g.load().then(function(){c(g,b,e)}):c(g,b,e)}catch(k){e.reject(arguments),logError(k)}},loadComponent:function(b,f,d,e,g){d="true"===d?{}:d;b=-1==b.indexOf("/")?this._defaultPackageLocationPrefix+b+this._defaultPackageLocationSuffix:b;f=null!=f?f:this._defaultComponentFlags;var c=new a,k=this;(e=q.getObject(b))?_.isFunction(e.then)?e.then(function(a){k._componentLoaded(a,f,d,c)},
function(a){console.error("error in loading component at path "+b,a)}):this._componentLoaded(e,f,d,c):console.error("cant get object at "+b);return c},loadComponentResources:function(a,b){},reloadComponent:function(a){},loadPlugins:function(h){if(r("plugins")){var f=new a,d=[],e=this;this.pluginResources=h;this.pluginInstances=[];if(this.pluginResources)for(var l=0;l<this.pluginResources.length;l++){var c=this.pluginResources[l];c.type&&"JS-PLUGIN"==c.type&&c.path&&d.push(this.loadComponent(c.path,
null,c).then(function(a){a.pluginResources=c;e.pluginInstances.push(a)}))}g(d).then(function(){f.resolve(d);e.publish(b.EVENTS.ALL_PLUGINS_READY,{instances:e.pluginInstances,resources:h})});return f}}})})},"nxapp/manager/DeviceManager":function(){define("dcl/dcl dojo/node!fs xcf/manager/DeviceManager xide/utils xide/types nxapp/utils/_console nxapp/utils dojo/node!child_process".split(" "),function(p,r,n,q,b,m,a,g){function h(a,b,k,g,h,m,q){d.exec(k,e,function(a,b,c){if(b&&127===parseInt(b,10)&&(f.error("--have error "+
c),q&&q.onCommandError))q.onCommandError();b&&0===parseInt(b,10)&&f.error("--terminate with "+b);b&&1===parseInt(b,10)&&f.error("--terminate with 1 "+b);f.error("response ",arguments)}.bind(this))}var f=m;p(null,{emit:function(){f.error("device server client emit",arguments)}});var d=g,e={stdout:!0,stderr:!0,stdin:!0,failOnError:!0,stdinRawMode:!1,killSignal:"SIGTERM"};return p(n,{declaredClass:"nxapp.manager.DeviceManager",connection:null,runShell:function(a,c,k){var g=this.getContext().getConnectionManager();
d.exec(a,e,function(c,d,e){d&&127===parseInt(d,10)&&f.error("--have error "+e);c&&f.log("err",c);d&&f.log("stdout",d);e&&f.log("stderr",e);d&&0===parseInt(d,10)&&f.info("--terminate with 0"+d);if(d&&1===parseInt(d,10)){f.info("--terminate with 1 "+d);try{g.onData(g.getConnection2(k),q.mixin({cmd:a,event:b.EVENTS.ON_COMMAND_FINISH,result:d},k),new Buffer(d))}catch(h){f.error("onFinish-Error:",h)}}}.bind(this))},runShell2:function(a,b,d,f,g,m){g=a.options;h(a,{host:g.host,port:g.port,protocol:g.protocol},
b,d,f,e,m)},onDeviceMetaChanged:function(b,c){var d=this.store;d&&_.each(d.data,function(d){if(-1!==d.path.indexOf(c)&&r.existsSync(b)){var e=q.getJson(a.readFile(b));e&&(d.user=e)}})},onFileChanged:function(a){if("changed"===a.type&&!a._did){a._did=!0;a=q.replaceAll("\\","/",a.path);a=q.replaceAll("//","/",a);a=a.replace(/\\/g,"/");var b;b=a;b=-1!=b.indexOf("system/devices")?b.substr(b.indexOf("system/devices")+15,b.length):null;if(b&&-1!==b.indexOf(".meta.json"))this.onDeviceMetaChanged(a,b)}},
checkDeviceServerConnection:function(){},sendManagerCommand:function(a,b){try{var d=this.ctx.getDeviceServer(),e={manager_command:a};q.mixin(e,b);d.handleManagerCommand(e,this.connection)}catch(g){f.error("error "+g.message,g.stack)}},sendDeviceCommand:function(a,b,d,e){a=a.options;q.mixin({src:d},a);b={command:b,device_command:"Device_Send",options:a};q.mixin(b.options,{params:{src:d,id:e}});this.ctx.getDeviceServer().handleDeviceCommand(b,this.connection)}})})},"xcf/manager/BlockManager":function(){define("dcl/dcl xdojo/declare dojo/_base/lang xide/types xide/utils xide/factory xide/manager/ManagerBase xblox/manager/BlockManager".split(" "),
function(p,r,n,q,b,m,a,g){return p([a,g],{declaredClass:"xcf.manager.BlockManager",onReady:function(){},addDriverFunctions:function(a,b){for(var d in b)"constructor"!==d&&"inherited"!==d&&n.isFunction(b[d])&&(a[d]=b[d])},setScriptFunctions:function(a,b,d){var e=d;b.context||(b.context=a);a.blockScope||(a.blockScope=b);this.ctx.getDeviceManager();b.context?b.context.instance&&(b.device=b.context.instance):console.error("scope has no context!");a.callCommand||(a.callCommand=function(a){var b=this.blockScope.getBlockByName(a);
b?b.solve(this.blockScope):console.log("no such variable : "+a)});a.setVariable||(a.setVariable=function(d,c,k,g,m){var n=this.blockScope.getVariable(d);n?(n.value=c,n.set("value",c),console.log("setting variable "+d+" to "+c),!1!==g&&e.publish(q.EVENTS.ON_DRIVER_VARIABLE_CHANGED,{item:n,scope:b,driver:a,owner:e,save:!0===k,source:m||q.MESSAGE_SOURCE.BLOX})):console.log("no such variable : "+d)});a.getVariable||(a.getVariable=function(a){return(a=this.blockScope.getVariable(a))?a.value:""});this.inherited(arguments)},
onReloaded:function(){this.init()},getDeviceVariablesAsEventOptions:function(a){a=[];var b=function(a,b,c,d,e){d="";if(0<c)for(var k=0;k<c;k++)d+="\x26nbsp;",d+="\x26nbsp;",d+="\x26nbsp;";return{label:d+("\x3cspan style\x3d''\x3e"+a+"\x3c/span\x3e"),label2:e,value:b}};this.ctx.getDriverManager();for(var d=this.ctx.getDeviceManager(),e=d.getDevices(!1,!0),g=0;g<e.length;g++){var c=e[g],k=c.driver;if(k){c=d.getMetaValue(c,q.DEVICE_PROPERTY.CF_DEVICE_TITLE);a.push(b(c,k.id+"/"+k.id,0,!1));for(var m=
k.blockScope.getVariables(),n=0;n<m.length;n++){var p=m[n],r=k.id+"/"+p.id;a.push(b(p.title,r,1,ci.value===r,c+"/"+p.title))}}}},onCreateVariableCI:function(a){console.log("onCreateVariableCI12",a);var b=a.CI,d=a.owner;a=null!=d.scope.device;console.log("ci value "+b.value);if(a){a=[];var e=function(a,b,c,d,e){d="";if(0<c)for(var k=0;k<c;k++)d+="\x26nbsp;",d+="\x26nbsp;",d+="\x26nbsp;";return{label:d+("\x3cspan style\x3d''\x3e"+a+"\x3c/span\x3e"),label2:e,value:b}};this.ctx.getDriverManager();for(var g=
this.ctx.getDeviceManager(),c=g.getDevices(!1,!0),k=0;k<c.length;k++){var d=c[k],m=d.driver;if(m){var n=g.getMetaValue(d,q.DEVICE_PROPERTY.CF_DEVICE_TITLE);a.push(e(n,m.id+"/"+m.id,0,!1));for(var p=m.blockScope.getVariables(),r=0;r<p.length;r++){var d=p[r],x=m.id+"/"+d.id;a.push(e(d.name,x,1,b.value===x,n+"/"+d.title))}}}b.options=a;b.widget={"class":"xide.form.FilterSelect"}}}})})},"xblox/manager/BlockManager":function(){define("dcl/dcl dojo/_base/lang dojo/has dojo/Deferred dojo/promise/all xide/types xide/utils xide/factory xblox/model/ModelBase xblox/model/Scope xblox/model/BlockModel xide/mixins/ReloadMixin xide/manager/ManagerBase xblox/data/Store xdojo/has!xblox-ui?xblox/manager/BlockManagerUI".split(" "),
function(p,r,n,q,b,m,a,g,h,f,d,e,l,c,k){return p([l,e.dcl],{declaredClass:"xblox/manager/BlockManager",serviceObject:null,loaded:{},scope:null,scopes:null,_createBlock:null,_registerActions:function(){},toScope:function(b){try{b=a.getJson(b)}catch(c){return console.error("BlockManager::toScope: failed,err\x3d"+c),null}b||(console.error("correct data"),b={blocks:[],variables:[]});var d=a.createUUID(),e=b;!r.isArray(b)&&r.isObject(b)&&(d=b.scopeId||d,e=b.blocks||[]);b=this.getScope(d,{owner:this},!0);
e=b.blocksFromJson(e);for(d=0;d<e.length;d++)e[d]._lastRunSettings={force:!1,highlight:!0};b.serviceObject=this.serviceObject;return b},loadFiles:function(a){for(var c=[],d=new q,e=0;e<a.length;e++){var k=a[e];c.push(this.load(k.mount,k.path,k.force))}b(c).then(function(a){d.resolve(a)});return d.promise},load:function(b,c,d){var e=new q,k=this,f=a.replaceAll("/","",b),g=a.replaceAll("./","",c),h=f+g,h=h.trim();this.loaded[h]&&!0===d&&(this.removeScope(this.loaded[h].id),this.loaded[h]=null);if(!0!==
d&&this.loaded[h])return e.resolve(this.loaded[h]),e.promise;this.ctx.getFileManager().getContent(f,g,function(a){if(a=k.toScope(a))k.loaded[h]=a,a.mount=b,a.path=c;e.resolve(a)},!1);return e.promise},onBlocksReady:function(a){for(var b=a.allBlocks(),c=0;c<b.length;c++)this.setScriptFunctions(b[c],a,this);if((a=a.getBlocks({group:"On Load"}))&&0<a.length)for(c=0;c<a.length;c++)if(b=a[c],b.onLoad)b.onLoad()},getBlock:function(){},setScriptFunctions:function(a,b,c){a.blockScope||(a.blockScope=b);b.serviceObject=
this.serviceObject;a.setVariable||(a.setVariable=function(d,e,k,f,g){if(d=this.blockScope.getVariable(d))d.value=e,!1!==f&&c.publish(m.EVENTS.ON_VARIABLE_CHANGED,{item:d,scope:b,driver:a,owner:c,save:!0===k,source:g||m.MESSAGE_SOURCE.BLOX})});a.getVariable||(a.getVariable=function(a){return(a=this.blockScope.getVariable(a))?a.value:""})},hasScope:function(a){this.scopes||(this.scopes={});return this.scopes[a]?this.scopes[a]:null},getScope:function(a,b,c){this.scopes||(this.scopes={});if(!this.scopes[a]&&
(this.scopes[a]=this.createScope({id:a,ctx:this.ctx}),this.scopes[a].userData=b,!1!==c))try{g.publish(m.EVENTS.ON_SCOPE_CREATED,this.scopes[a])}catch(d){console.error("bad, scope creation failed "+d,d)}return this.scopes[a]},removeScope:function(a){this.scopes||(this.scopes={});for(var b in this.loaded)this.loaded[b].id==a&&delete this.loaded[b];try{this.scopes[a]&&(this.scopes[a]._destroy(),delete this.scopes[a])}catch(c){debugger}return null},createScope:function(b,e,k){e=e||[];var g=new c({data:[],
Model:d,id:a.createUUID(),__events:{},observedProperties:["name","enabled","value"],getLabel:function(a){return a.name},labelAttr:"name"});g.reset();g.setData([]);g={owner:this,blockStore:g,serviceObject:this.serviceObject,config:this.config};a.mixin(g,b);try{var h=new f(g);e&&h.initWithData(e,k);h.init()}catch(l){logError(l,"error creating scope, data:",b)}return h},onReloaded:function(){},init:function(){this.scope={variables:[],blocks:[]};h.prototype.types=m;h.prototype.factory=g;if(this.onReady)this.onReady()}})})},
"xblox/model/Scope":function(){define("dcl/dcl ./ModelBase ./Expression xide/factory xide/utils xide/types xide/mixins/EventedMixin dojo/_base/lang dojo/has xide/encoding/MD5".split(" "),function(p,r,n,q,b,m,a,g,h,f,d,e){var l=h("xcf-ui");r=p([r,a.dcl],{declaredClass:"xblox.model.Scope",variableStore:null,serviceObject:null,context:null,blockStore:null,expressionModel:null,getExpressionModel:function(){this.expressionModel||(this.expressionModel=new n);return this.expressionModel},toFriendlyName:function(a,
d){if(!d||!a)return null;var e=this,f=this.ctx,g=this.driver,g=f.getDeviceManager(),h=f.getDriverManager();if(-1==d.indexOf("://"))return(e=e.getBlockById(d))?e.name:d;var f=b.parse_url(d),f=b.urlArgs(f.host),l=g.getItemById(f.device.value);if(l){var m=g.toDeviceControlInfo(l),g=h.getDriverById(m.driverId);if((l=l.driverInstance)||g)if(e=g.blockScope?g.blockScope:l?l.blockScope:e,(a=e.getStore().getSync(f.block.value))||l&&l.blockScope&&(a=l.blockScope.getBlock(f.block.value)))return m.title+"/"+
a.name}return d},getContext:function(){return this.instance},toString:function(){var a={blocks:null,variables:null},b=this.blocksToJson();try{dojo.fromJson(JSON.stringify(b))}catch(d){return}a.blocks=b;return JSON.stringify(a,null,2)},initWithData:function(a,b){a&&this.blocksFromJson(a,null,b);this.clearCache()},getService:function(){return this.serviceObject},getStore:function(){return this.blockStore},reset:function(){this.getExpressionModel().reset()},empty:function(){this.clearCache();var a=this.blockStore,
b=this.getBlocks();a.silent(!0);_.each(b,function(b){b&&a.removeSync(b.id)});a.setData([]);a.silent(!1)},fromScope:function(a){var b=this.blockStore;b.silent(!0);this.empty();a=a.blocksToJson();this.blocksFromJson(a);b.silent(!1)},clearCache:function(){this.getExpressionModel().reset()},getVariableStore:function(){return this.blockStore},getBlockStore:function(){return this.blockStore},getVariables:function(a){if(!this.blockStore)return[];var b=this.blockStore.data,d=[];if(a&&"processVariables"===
a.group){for(a=0;a<b.length;a++)"processVariables"===b[a].group&&d.push(b[a]);return d}if(!a){for(a=0;a<b.length;a++){var e=b[a],f=e.declaredClass;"xblox.model.variables.Variable"!=f&&"xcf.model.Variable"!=f||d.push(e)}return d}return this.blockStore.query(a)},loopBlock:function(a,b){if(a&&0<a.interval&&a.enabled&&!0!==a._destroyed){var d=this;a._loop&&clearTimeout(a._loop);a._loop=setInterval(function(){!a.enabled||a._destroyed?(clearTimeout(a._loop),a._loop=null):a.solve(d,b||a._lastSettings)},
a.interval)}},getEventsAsOptions:function(a){var b=[],d;for(d in m.EVENTS)b.push({label:m.EVENTS[d],value:m.EVENTS[d]});b=b.concat([{label:"onclick",value:"onclick"},{label:"ondblclick",value:"ondblclick"},{label:"onmousedown",value:"onmousedown"},{label:"onmouseup",value:"onmouseup"},{label:"onmouseover",value:"onmouseover"},{label:"onmousemove",value:"onmousemove"},{label:"onmouseout",value:"onmouseout"},{label:"onkeypress",value:"onkeypress"},{label:"onkeydown",value:"onkeydown"},{label:"onkeyup",
value:"onkeyup"},{label:"onfocus",value:"onfocus"},{label:"onblur",value:"onblur"},{label:"onchange",value:"onchange"}]);for(d=0;d<b.length;d++){var e=b[d];if(e.value===a){e.selected=!0;break}}return b},getVariablesAsObject:function(){for(var a=this.getVariables(),b={},d=0;d<a.length;d++)b[a[d].title]=a[d].value;return b},getVariablesAsOptions:function(){var a=this.getVariables(),b=[];if(a)for(var d=0;d<a.length;d++)b.push({label:a[d].label,value:a[d].variable});return b},getCommandsAsOptions:function(a){var b=
this.getBlocks({declaredClass:"xcf.model.Command"}),d=[];if(b)for(var e=0;e<b.length;e++){var f={};f[a||"label"]=b[e].name;f.value=b[e].name;d.push(f)}return d},_cached:null,getBlocks:function(a,b){if(!l&&!1!==b&&(this._cached||(this._cached={}),a)){var d=f(JSON.stringify(a),1);if(d=this._cached[d])return d}if(!this.blockStore)return[];a=a||{id:/\S+/};var e=this.blockStore.query(a,null,b);l||!1===b||(d=f(JSON.stringify(a),1),this._cached[d]=e);return e},registerVariable:function(a){this.variables[a.title]=
a;this.blockStore&&this.blockStore.putSync(a)},getVariable:function(a){for(var b=this.getVariables(),d=0;d<b.length;d++){var e=b[d];if(e.name===a)return e}return null},getVariableById:function(a){if(!a)return null;var b=a.split("/"),d=this;2==b.length&&((a=d.owner)&&a.hasScope&&(a.hasScope(b[0])?d=a.getScope(b[0]):console.error("have scope id but cant resolve it",this)),a=b[1]);return(b=d.blockStore.getSync(a))?b:null},registerBlock:function(a,b){var d=this.blockStore;if(d){var e=d.getSync(a.id);
if(e)return e;e=null;return e=a.addToStore?a.addToStore(d):d.putSync(a,b)}},allBlocks:function(a,b){return this.getBlocks({},b)},hasGroup:function(a){for(var b=this.allGroups({},!1),d=0;d<b.length;d++)if(b[d]===a)return!0;return!1},allGroups:function(){for(var a=[],b=this.allBlocks({},!1),d=function(b){for(var d=0;d<a.length;d++)if(a[d]===b)return!0;return!1},e=0;e<b.length;e++){var f=b[e];f.parentId||(f.group?d(f.group)||a.push(f.group):d("No Group")||a.push("No Group"))}return a},variablesToJson:function(){var a=
[],b=this.variableStore?this.getVariables():this.variables,d;for(d in b){var e=b[d];if(!1!==e.serializeMe&&null!=e.keys){var f={},g;for(g in e)if(this.isString(e[g])||this.isNumber(e[g])||this.isBoolean(e[g]))f[g]=e[g];a.push(f)}}return a},isScript:function(a){return this.isString(a)&&(-1!=a.indexOf("return")||-1!=a.indexOf(";")||-1!=a.indexOf("[")||-1!=a.indexOf("{")||-1!=a.indexOf("}"))},variablesToJavascriptEx:function(a,b){for(var d=[],e=this.variableStore?this.getVariables():this.variables,f=
0;f<e.length;f++){var g=e[f];if(g!=a){var h=""+g.value;a&&a.value&&-1==a.value.indexOf(g.title)||b&&-1==b.indexOf(g.title)||0==h.length||(this.isScript(h)||-1!=h.indexOf("'")?this.isScript(h)&&(h=this.expressionModel.parseVariable(this,g)):h="'"+h+"'","''"===h&&(h="'0'"),d.push(h))}}return d},variablesToJavascript:function(a,b){for(var d="",e=this.variableStore?this.getVariables():this.variables||[],f=0;f<e.length;f++){var g=e[f];if(g!=a){var h=""+g.value;a&&a.value&&-1==a.value.indexOf(g.title)||
b&&-1==b.indexOf(g.title)||0==h.length||(this.isScript(h)||-1!=h.indexOf("'")?this.isScript(h)&&(h=this.expressionModel.parseVariable(this,g)):h="'"+h+"'","''"===h&&(h="'0'"),d+="var "+g.title+" \x3d "+h+";",d+="\n")}}return d},variablesFromJson:function(a){for(var d=[],e=0;e<a.length;e++){var f=a[e];f.scope=this;if(f.declaredClass){var g=b.replaceAll(".","/",f.declaredClass),h=require(g);h?d.push(new h(f)):console.log("couldnt resolve "+g)}else console.log("   variable has no class ")}return d},
regenerateIDs:function(a){for(var d=this,e=function(a){var c=b.createUUID(),f=d.getBlocks({parentId:a.id});if(f&&0<f.length)for(var g=0;g<f.length;g++){var h=f[g];h.parentId=c;e(h)}a.id=c},f=0;f<a.length;f++)e(a[f])},cloneBlocks2:function(a,d){var e=this.blocksToJson(a),f=this.owner.getScope(b.createUUID(),null,!1),e=f.blocksFromJson(e,!1),g=this.blockStore,e=f.allBlocks();f.regenerateIDs(e);e=f.blocksToJson(e);if(d)for(f=0;f<e.length;f++){var h=e[f];null==h.parentId&&(h.group=d)}var l=[],e=this.blocksFromJson(e);
_.each(e,function(a){l.push(g.getSync(a.id))});return l},cloneBlocks:function(a){a=this.blocksToJson(a);var d=this.owner.getScope(b.createUUID(),null,!1);a=d.blocksFromJson(a,!1);a=d.allBlocks();for(d=0;d<a.length;d++){var e=a[d];e.id=b.createUUID();e.parentId=null}this.blocksToJson(a);this.blocksFromJson(a);return a},blockToJson:function(a){var b={_containsChildrenIds:[]},d;for(d in a)if("ctrArgs"!=d&&("function"===typeof a[d]||a.serializeField(d))){if(this.isString(a[d])||this.isNumber(a[d])||this.isBoolean(a[d]))b[d]=
a[d];if("parent"!=d)if(this.isBlock(a[d]))b[d]=a[d].id,b._containsChildrenIds.push(d);else if(this.areBlocks(a[d])){b[d]=[];for(var e=0;e<a[d].length;e++)b[d].push(a[d][e].id);b._containsChildrenIds.push(d)}}return b},blocksToJson:function(a){try{var b=[];a=a&&a.length?a:this.blockStore?this.getBlocks():this.blocks;for(var d in a){var e=a[d];if(null!=e.keys&&!1!==e.serializeMe){var f={_containsChildrenIds:[]},g;for(g in e)if("ctrArgs"!=g&&("function"===typeof e[g]||e.serializeField(g))){if(this.isString(e[g])||
this.isNumber(e[g])||this.isBoolean(e[g]))f[g]=e[g];_.isObject(e[g])&&e.serializeObject&&!0===e.serializeObject(g)&&(f[g]=JSON.stringify(e[g],null,2));if("parent"!=g)if(this.isBlock(e[g]))f[g]=e[g].id,f._containsChildrenIds.push(g);else if(this.areBlocks(e[g])){f[g]=[];for(var h=0;h<e[g].length;h++)f[g].push(e[g][h].id);f._containsChildrenIds.push(g)}}b.push(f)}}}catch(l){console.error("from json failed : "+l)}return b},_createBlockStore:function(){},blockFromJson:function(a){a.scope=this;null==a._containsChildrenIds&&
(a._containsChildrenIds=[]);for(var d={},e=0;e<a._containsChildrenIds.length;e++){var f=a._containsChildrenIds[e];d[f]=a[f];a[f]=null}delete a._containsChildrenIds;if(!a.declaredClass)return console.log("   not a class "),null;f=e=null;try{f=b.replaceAll(".","/",a.declaredClass),e=require(f)}catch(g){try{f=b.replaceAll("/",".",a.declaredClass),e=require(f)}catch(h){}}e||(e=p.getObject(a.declaredClass));if(!e)return null;f=null;try{f=q.createBlock(e,a)}catch(l){return logError(l),null}f._children=
d;return f},blocksFromJson:function(a,d,e){for(var f=[],g={},h=0;h<a.length;h++){var l=a[h];l.scope=this;null==l._containsChildrenIds&&(l._containsChildrenIds=[]);for(var m={},n=0;n<l._containsChildrenIds.length;n++){var r=l._containsChildrenIds[n];m[r]=l[r];l[r]=null}delete l._containsChildrenIds;if(l.declaredClass){var z=n=null;try{z=b.replaceAll(".","/",l.declaredClass),n=require(z)}catch(D){console.error("couldnt resolve class "+z)}n||(n=p.getObject(l.declaredClass));if(n){z=null;try{z=q.createBlock(n,
l,null,!1)}catch(u){console.error("error in block creation ",u+" "+l.declaredClass);logError(u);continue}z._children=m;g[z.id]=m;f.push(z)}else console.log("couldnt resolve "+z)}else console.log("   not a class ")}a=this.allBlocks(null,!1);for(h=0;h<a.length;h++){l=a[h];l._children=g[l.id];if(l._children){for(r in l._children)if("string"==typeof l._children[r])(m=this.getBlockById(l._children[r]))?(l[r]=m,m.parent=l,m.postCreate&&m.postCreate()):(this.blockStore.removeSync(l._children[r]),e&&e("   couldnt resolve child: "+
l._children[r]+"@"+l.name+":"+l.declaredClass),console.log("   couldnt resolve child: "+l._children[r]+"@"+l.name+":"+l.declaredClass));else if("object"==typeof l._children[r])for(l[r]=[],n=0;n<l._children[r].length;n++)(m=this.getBlockById(l._children[r][n]))?(l[r].push(m),(z=this.getBlockById(m.parentId))?m.parent=z:console.error("child has no parent")):(e&&e("   couldnt resolve child: "+l._children[r]+"@"+l.name+":"+l.declaredClass),console.log("   couldnt resolve child: "+l._children[r][n]+"@"+
l.name+":"+l.declaredClass));delete l._children}!1!==d&&null!=l.parentId&&null==this.getBlockById(l.parentId)&&(l.parentId=null);l.postCreate()}this.allBlocks();return f},resolveBlock:function(a){var d=this,e=this.ctx,d=this.driver,d=e.getDeviceManager(),e=e.getDriverManager();if(-1==a.indexOf("://"))return(d=this.getBlockById(a))?d:a;a=b.parse_url(a);a=b.urlArgs(a.host);var f=d.getItemById(a.device.value);if(!f){var g=d.getInstanceByName(a.device.value);g&&(f=g.device)}if(f&&(d=d.toDeviceControlInfo(f),
d=e.getDriverById(d.driverId),(e=f.driverInstance)||d)&&(a=(d=e?e.blockScope:d.blockScope)?d.getStore().getSync(a.block.value):null))return a},getBlock:function(a){return this.getBlockById(a)},getBlockByName:function(a){if(-1!==a.indexOf("://")){var b=this.resolveBlock(a);if(b)return b}for(var d=this.getBlocks(),e=0;e<d.length;e++)if(b=d[e],b.name===a)return b;return(a=this.blockStore.query({name:a}))&&0<a.length?a[0]:null},getBlockById:function(a){return this.blockStore.getSync(a)},_flatten:function(a){var b=
[],d;for(d in a){var e=a[d];if(null!=e.keys){b.push(e);for(var f in e)if("ctrArgs"!=f&&"parent"!==f)if(this.isBlock(e[f]))b.push(e[f]);else if(this.areBlocks(e[f]))for(var g=0;g<e[f].length;g++)b.push(e[f][g])}}return b},flatten:function(a){var b=[],d;for(d in a){var e=a[d];if(null!=e.keys){var f=_.find(b,{id:e.id});f||b.push(e);for(var g in e)if("ctrArgs"!=g&&"parent"!==g){var h=e[g];if(this.isBlock(h))(f=_.find(b,{id:h.id}))||b.push(h);else if(this.areBlocks(h))for(var l=0;l<h.length;l++){var m=
h[l];(f=_.find(b,{id:m.id}))||b.push(m);b=b.concat(this.flatten([m]))}}}}return b=_.uniq(b,!1,function(a){return a.id})},_getSolve:function(a){return a.prototype?a.prototype.solve:a.__proto__.solve},solveBlock:function(a,d,e,f){d=d||{highlight:!1};var h=null;this.isString(a)?(h=this.getBlockByName(a))||(h=this.getBlockById(a)):this.isObject(a)&&(h=a);a=null;if(h){if(!0!==d.force&&0==h.enabled)return null;!0===d.force&&(d.force=!1);var l=h.declaredClass;(l=g.getObject(b.replaceAll("/",".",l))||g.getObject(l))?
l.prototype&&l.prototype.solve&&(a=l.prototype.solve.apply(h,[this,d])):(a=h.solve(h.getScope(),d,e,f),delete h.override,h.override={})}return a},solve:function(a,b){for(var d="",e=0;e<this.items.length;e++)d+=this.items[e].solve(a,b);return d},parseExpression:function(a,b,d,e,f,g,h,l){return this.getExpressionModel().parse(this,a,b,e,f,g,d,h,l)},isString:function(a){return"string"==typeof a},isNumber:function(a){return"number"==typeof a},isBoolean:function(a){return"boolean"==typeof a},isObject:function(a){return"object"===
typeof a},isBlock:function(a){var b=!1;"object"==typeof a&&null!=a&&void 0==a.length&&a.serializeMe&&(b=!0);return b},areBlocks:function(a){var b=!1;"object"==typeof a&&null!=a&&0<a.length&&this.isBlock(a[0])&&(b=!0);return b},_onVariableChanged:function(a){a.item&&this.getExpressionModel().variableFuncCache[a.item.title]&&delete this.expressionModel.variableFuncCache[a.item.title]},init:function(){this.getExpressionModel();this.subscribe(m.EVENTS.ON_DRIVER_VARIABLE_CHANGED,this._onVariableChanged);
var a=this;this.subscribe(m.EVENTS.ON_MODULE_RELOADED,function(d){var e=d.module,f=d.newModule;(d=a.getBlocks().filter(function(a){return a.declaredClass==e||a.declaredClass==b.replaceAll("/",".",e)?a:null}))&&_.each(d,function(a){var b=f.prototype,c;for(c in b){var d=b[c];d&&_.isFunction(d)&&(a[c]=d)}})})},_destroy:function(){for(var a=this.allBlocks(),b=0;b<a.length;b++){var d=a[b];if(d)try{d&&d.stop&&d.stop(!0),d&&d.reset&&d.reset(),d&&d._destroy&&d._destroy(),d&&d.destroy&&d.destroy(),d._emit&&
d._emit(m.EVENTS.ON_ITEM_REMOVED,{item:d})}catch(e){}}},destroy:function(){this._destroy();this.reset();this._destroyed=!0;delete this.expressionModel},moveTo:function(a,b,d,e){if(e){if(b.canAdd&&b.canAdd()){var f=this.getBlockById(a.parentId);f&&f.removeBlock(a,!1);b.add(a,null,null);return}console.error("cant reparent");return!1}if(b.parentId||0!=e)if(!a.parentId&&b.parentId&&0==e)a.group=b.group;else if(a.parentId||b.parentId||!e){if(a.parentId&&b.parentId&&0==e&&a.parentId===b.parentId){var g=
this.getBlockById(a.parentId);if(!g)return!1;var h=g[g._getContainer(a)],f=a.indexOf(h,a);b=a.indexOf(h,b);h=f>b?-1:1;d=Math.abs(f-(b+(1==d?-1:1)));for(b=0;b<d-1;b++)g.move(a,h);return!0}if(a.parentId&&b.parentId&&0==e&&a.parentId!==b.parentId){console.log("same parent!");f=this.getBlockById(a.parentId);if(f&&(g=this.getBlockById(b.parentId))&&f&&f.removeBlock&&g.canAdd&&g.canAdd())f.removeBlock(a,!1),g.add(a,null,null);else return!1;h=g[g._getContainer(a)];null==h&&console.error("weird : target parent has no item container");
f=g.indexOf(h,a);b=g.indexOf(h,b);if(!f||!b){console.error(" weird : invalid drop processing state, have no valid item indicies");return}h=f>b?-1:1;d=Math.abs(f-(b+(1==d?-1:1)));for(b=0;b<d-1;b++)g.move(a,h);return!0}}else return b.canAdd&&b.canAdd()&&(a.group=null,b.add(a,null,null)),!0;else{(f=this.getBlockById(a.parentId))&&f.removeBlock&&(f.removeBlock(a,!1),a.parentId=null,a.group=b.group);var g=[],h=this.getBlocks({group:b.group}),l=[],f=this.getBlockStore(),m=f.storage.index[b.id];for(b=0;b<
h.length;b++)if(e=h[b],null==h[b].parentId&&h[b]!=a&&(e=f.storage.index[e.id],e=d?e>=m:e<=m))g.push(h[b]),l.push(f.storage.index[h[b].id]);for(b=0;b<g.length;b++)f.remove(g[b].id);this.getBlockStore().remove(a.id);d&&this.getBlockStore().putSync(a);for(b=0;b<g.length;b++)f.put(g[b]);d||this.getBlockStore().putSync(a);return!0}return!1}});p.chainAfter(r,"destroy");return r})},"xblox/model/Expression":function(){define(["xdojo/declare","xdojo/has","xide/utils","xide/types","xblox/model/ModelBase"],
function(p,r,n,q,b,m,a){var g="undefined"!==typeof window?window.console:global.console;m&&g&&g.error&&(g=a);return p("xblox.model.Expression",[b],{id:null,context:null,variableDelimiters:{begin:"[",end:"]"},blockCallDelimiters:{begin:"{",end:"}"},expressionCache:null,variableFuncCache:null,constructor:function(){this.reset()},reset:function(){this.expressionCache={};this.variableFuncCache={}},replaceVariables:function(a,b,d,e,l,c,k,m){k=k||this.variableDelimiters;m=m||q.CIFLAG.NONE;m&q.CIFLAG.DONT_ESCAPE&&
(e=!1);m&q.CIFLAG.DONT_PARSE&&(d=!1);var n=this._findOcurrences(b,k);if(n)for(var p=0;p<n.length;p++){var r=n[p],r=r.replace(k.begin,""),r=r.replace(k.end,"");(r=this._getVar(a,r))&&r.flags&q.CIFLAG.DONT_PARSE&&(d=!1);var x=null;if(r){if(c){b=b.replace(n[p],"this.getVariable('"+r.name+"')");continue}x=this.getValue(r.value);l&&r.name in l&&(x=l[r.name]);if(this.isScript(x)&&!1!==d)try{var w=a.variablesToJavascript(r,!0);w&&(x=w+x);var C=(new Function("{\n"+x+"\n}")).call(a.context||{});"undefined"===
C||"undefined"===typeof C?x=""+r.value:(x=C,m&q.CIFLAG.DONT_ESCAPE||(x="'"+x+"'"))}catch(y){g.log(" parsed variable expression failed \n"+x,y)}else this.isNumber(x)||!1!==e&&(x="'"+x+"'")}else x=n[p];b=b.replace(n[p],x)}return b},parse:function(a,b,d,e,l,c,k,m,n){b=this.replaceAll("''","'",b);d=c||a.context||a.getContext()||{};b=this.replaceVariables(a,b,null,null,k,null!=d.getVariable,null,n);k=this.isScript(b);if(!k&&(this.isString(b)||this.isNumber(b)))return e&&e("Expression "+b+" evaluates to "+
b),b;-1==b.indexOf("return")&&k&&(b="return "+b);a=this;try{b=this.replaceAll("''","'",b);var q=this.expressionCache[b];q||(q=new Function("{"+b+"; }"),this.expressionCache[b]=q);a=q.apply(d,m)}catch(p){return g.error("     invalid expression : \n"+b,p),l&&l("invalid expression : \n"+b+": "+p,p),a=""+b}e&&e("Expression "+b+" evaluates to "+a);return a},parseVariableO:function(a,b){var d=""+b.value;if("None"===b.title)return"";try{var e=a.variablesToJavascript(b,!1);e&&(d=e+d);var l=(new Function("{"+
d+"}")).call(this.context||{});"undefined"===l||"undefined"===typeof l?d=""+b.value:this.isNumber(l)?d=l:(d=""+l,d="'"+d+"'")}catch(c){g.error("parse variable failed : "+b.title+"\n"+d)}return d},parseVariable:function(a,b,d,e,g,c,k){var m=""+b.value;d=d||"";!1!==g?(g=this.variableFuncCache[a.id+"|"+b.title],g||(g=new Function("{"+d+m+"}"),this.variableFuncCache[a.id+"|"+b.title]=g)):g=new Function("{"+d+m+"}");a=g.apply(c||a.context||{},k||[]);return m="undefined"===a||"undefined"===typeof a?""+
b.value:this.isNumber(a)||!1===e?a:"'"+a+"'"},replaceBlockCalls:function(a,b){var d=this._findOcurrences(b,this.blockCallDelimiters);if(d)for(var e=0;e<d.length;e++){var g=this._removeDelimiters(d[e],this.blockCallDelimiters),g=a.solveBlock(g).join("\n");b=b.replace(d[e],g)}return b},_getVar:function(a,b){return a.getVariable(this._getVarName(b))},_getVarName:function(a){return this._removeDelimiters(a,this.variableDelimiters)},_removeDelimiters:function(a,b){return a.replace(b.begin,"").replace(b.end,
"")},_escapeRegExp:function(a){for(var b="[](){}*+.".split(""),d=0;d<b.length;d++)a=a.replace(b[d],"\\"+b[d]);return a},_findOcurrences:function(a,b){var d=this._escapeRegExp(b.begin),e=this._escapeRegExp(b.end);return a.match(new RegExp(d+"("+("[^"+e+"]*")+")"+e,"g"))}})})},"xblox/model/BlockModel":function(){define(["dcl/dcl","xdojo/declare","xide/data/Model","xide/data/Source"],function(p,r,n,q){return r("xblox.model.BlockModel",[n,q],{declaredClass:"xblox.model.BlockModel",icon:"fa-play",mayHaveChildren:function(b){return null!=
this.items&&0<this.items.length},getChildren:function(b){return this.items},getBlockIcon:function(){return'\x3cspan class\x3d"'+this.icon+'"\x3e\x3c/span\x3e'}})})},"xblox/data/Store":function(){define("dojo/_base/declare xide/data/TreeMemory xide/data/ObservableStore xide/data/Model dstore/Trackable dojo/Deferred".split(" "),function(p,r,n,q,b,m){return p("xblox.data.Store",[r,b,n],{idProperty:"id",parentField:"parentId",filter:function(a){var b=this.inherited(arguments);this._state.filter=a;return b},
getChildren:function(a){return this.root.filter({parentId:this.getIdentity(a)})},__getChildren:function(a){return this.inherited(arguments)},_fetchRange:function(a){var b=new m;a=this.fetchRangeSync(a);if(this._state.filter){if(this._state&&this._state.filter&&this._state.filter.parentId){var h=this.getSync(this._state.filter.parentId);h&&(this.reset(),a=h.items,h.getChildren&&(a=h.getChildren()),b.resolve(a))}this._state&&this._state.filter&&this._state.filter.group&&(this.getSync(this._state.filter.parent),
h&&(this.reset(),a=h.items))}b.resolve(a);return b},mayHaveChildren:function(a){return a.mayHaveChildren?a.mayHaveChildren(a):null!=a.items&&0<a.items.length}})})},"xblox/factory/Blocks":function(){define("xide/factory xide/utils xide/types xide/mixins/ReloadMixin xide/mixins/EventedMixin xblox/model/logic/CaseBlock xblox/model/Block xblox/model/functions/CallBlock xblox/model/functions/StopBlock xblox/model/functions/PauseBlock xblox/model/functions/SetProperties xblox/model/code/CallMethod xblox/model/code/RunScript xblox/model/loops/ForBlock xblox/model/loops/WhileBlock xblox/model/variables/VariableAssignmentBlock xblox/model/logic/IfBlock xblox/model/logic/ElseIfBlock xblox/model/logic/SwitchBlock xblox/model/variables/VariableSwitch xblox/model/logging/Log xblox/model/server/RunServerMethod xblox/model/server/Shell xblox/model/code/RunBlock xblox/model/events/OnEvent xblox/model/events/OnKey xblox/model/mqtt/Subscribe xblox/model/mqtt/Publish xblox/model/File/ReadJSON xcf/factory/Blocks".split(" "),
function(p,r,n,q,b,m,a,g,h,f,d,e,l,c,k,t,v,A,E,x,w,C,y,z,D,u,F,G,B){p.prepareBlockContructorArgs=function(a){a||(a={});a.id||(a.id=r.createUUID());a.items||(a.items=[])};p.createBlock=function(a,b,c,d){p.prepareBlockContructorArgs(b);a=p.createInstance(a,b,c);a.ctrArgs=null;var e;try{a&&a.init&&a.init();a.scope&&(e=a.scope.registerBlock(a,d));try{a.initReload&&a.initReload()}catch(f){debugger}}catch(g){logError(g,"create block")}return e||a};var H=null;p.clearVariables=function(){};p.getAllBlocks=
function(a,b,c,d,e){if(!1!==e&&null!=H){for(a=0;a<H.length;a++)if(b=H[a],"Set Variable"===b.name){H.remove(b);break}return H}0==e&&(H=null);e=p._getFlowBlocks(a,b,c,d);e=e.concat(p._getLoopBlocks(a,b,c,d));e=e.concat(p._getCommandBlocks(a,b,c,d));e=e.concat(p._getCodeBlocks(a,b,c,d));e=e.concat(p._getEventBlocks(a,b,c,d));e=e.concat(p._getLoggingBlocks(a,b,c,d));e=e.concat(p._getServerBlocks(a,b,c,d));e=e.concat(p._getMQTTBlocks(a,b,c,d));return H=e=e.concat(p._getFileBlocks(a,b,c,d))};p._getMQTTBlocks=
function(a,b,c,d){var e=[];e.push({name:"MQTT",iconClass:"fa-cloud",items:[{name:"Subscribe",owner:b,iconClass:"fa-bell",proto:F,target:c,ctrArgs:{scope:a,group:d}},{name:"Publish",owner:b,iconClass:"fa-send",proto:G,target:c,ctrArgs:{scope:a,group:d}}]});p.publish(n.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:e,group:"MQTT"});return e};p._getFileBlocks=function(a,b,c,d){var e=[];e.push({name:"File",iconClass:"fa-file",items:[{name:"%%Read JSON",owner:b,iconClass:"fa-file",proto:B,target:c,ctrArgs:{scope:a,
group:d}}]});p.publish(n.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:e,group:"File"});return e};p._getServerBlocks=function(a,b,c,d){var e=[];e.push({name:"Server",iconClass:"el-icon-repeat",items:[{name:"Run Server Method",owner:b,iconClass:"fa-plug",proto:C,target:c,ctrArgs:{scope:a,group:d}},{name:"Shell",owner:b,iconClass:"fa-code",proto:y,target:c,ctrArgs:{scope:a,group:d}}]});p.publish(n.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:e,group:"Server"});return e};p._getVariableBlocks=function(a,b,c,d){var e=
[];e.push({name:"Flow",iconClass:"el-icon-random",items:[{name:"If...Else",owner:b,iconClass:"el-icon-fork",proto:v,target:c,ctrArgs:{scope:a,group:d,condition:"[value]\x3d\x3d'PW'"}}]});return e};p._getEventBlocks=function(a,b,c,d){var e=[];e.push({name:"Events",iconClass:"fa-bell",items:[{name:"On Event",owner:b,iconClass:"fa-bell",proto:D,target:c,ctrArgs:{scope:a,group:d}},{name:"On Key",owner:b,iconClass:"fa-keyboard-o",proto:u,target:c,ctrArgs:{scope:a,group:d}}]});p.publish(n.EVENTS.ON_BUILD_BLOCK_INFO_LIST,
{items:e,group:"Events"});return e};p._getLoggingBlocks=function(a,b,c,d){var e=[];e.push({name:"Logging",iconClass:"fa-bug",items:[{name:"Log",owner:b,iconClass:"fa-bug",proto:w,target:c,ctrArgs:{scope:a,group:d}}]});p.publish(n.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:e,group:"Logging"});return e};p._getCodeBlocks=function(a,b,c,f){var g=[];g.push({name:"Code",iconClass:"fa-code",items:[{name:"Call Method",owner:b,iconClass:"el-icon-video",proto:e,target:c,ctrArgs:{scope:a,group:f}},{name:"Run Script",
owner:b,iconClass:"fa-code",proto:l,target:c,ctrArgs:{scope:a,group:f}},{name:"Run Block",owner:b,iconClass:"fa-code",proto:z,target:c,ctrArgs:{scope:a,group:f}},{name:"Set Properties",owner:b,iconClass:"fa-code",proto:d,target:c,ctrArgs:{scope:a,group:f}}]});p.publish(n.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:g,group:"Code"});return g};p._getFlowBlocks=function(a,b,c,d){var e=[];e.push({name:"Flow",iconClass:"el-icon-random",items:[{name:"If...Else",owner:b,iconClass:"el-icon-fork",proto:v,target:c,
ctrArgs:{scope:a,group:d,condition:"[value]\x3d\x3d'PW'"}},{name:"Switch",owner:b,iconClass:"el-icon-fork",proto:E,target:c,ctrArgs:{scope:a,group:d}},{name:"Variable Switch",owner:b,iconClass:"el-icon-fork",proto:x,target:c,ctrArgs:{scope:a,group:d}}]});p.publish(n.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:e,group:"Flow"});return e};p._getLoopBlocks=function(a,b,d,e){var f=[];f.push({name:"Loops",iconClass:"el-icon-repeat",items:[{name:"While",owner:b,iconClass:"el-icon-repeat",proto:k,target:d,ctrArgs:{scope:a,
group:e,condition:"[Volume]\x3c\x3d100"}},{name:"For",owner:b,iconClass:"el-icon-repeat",proto:c,target:d,ctrArgs:{scope:a,group:e,initial:"1",comparator:"\x3c\x3d","final":"5",modifier:"+1",counterName:"value"}}]});p.publish(n.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:f,group:"Loops"});return f};p._getMathBlocks=function(a,b,c,d){b=[];b.push({name:"Math",owner:this,iconClass:"el-icon-qrcode",dstItem:c,items:[{name:"If...Else",owner:c,iconClass:"el-icon-compass",proto:v,item:c,ctrArgs:{scope:a,group:d}}]});
return b};p._getTimeBlocks=function(a,b,c,d){b=[];b.push({name:"Time",owner:this,iconClass:"el-icon-qrcode",dstItem:c,items:[{name:"If...Else",owner:c,iconClass:"el-icon-time",proto:v,item:c,ctrArgs:{scope:a,group:d}}]});return b};p._getTransformBlocks=function(a,b,c,d){b=[];b.push({name:"Time",owner:this,iconClass:"el-icon-magic",dstItem:c,items:[{name:"If...Else",owner:c,iconClass:"el-icon-time",proto:v,item:c,ctrArgs:{scope:a,group:d}}]});return b};return p})},"xblox/model/logic/CaseBlock":function(){define("dcl/dcl xide/utils xide/types xblox/model/Block dojo/Deferred xblox/model/logic/BreakBlock".split(" "),
function(p,r,n,q,b,m){return p(q,{declaredClass:"xblox.model.logic.CaseBlock",comparator:null,expression:null,items:null,name:"Case",icon:"",hasInlineEdits:!0,toText:function(){return'\x3cspan style\x3d"text-indent: 1em;"\x3e\x26nbsp;\x26nbsp;\x26nbsp;'+this.getBlockIcon("I")+this.name+" "+this.makeEditable("comparator","right","text","Enter a comparison","inline")+(null!=this.expression?" "+this.makeEditable("expression","right","text","Enter a value to compare"):"")+"\x3c/span\x3e"},canAdd:function(){return[]},
_solve:function(a,b,h){b=b||{highlight:!1};for(var f=[],d=0;d<this.items.length;d++){var e=this.items[d];-1!==e.declaredClass.indexOf("BreakBlock")&&h.stop();this.addToEnd(f,e.solve(a,b))}return f},solve:function(a,b,h){try{var f=a.getVariableById(b.variable);!f&&h.args&&h.args[0]&&(f={value:h.args[0]});var d="";if(f)d=this._getArg(f.value,!0);else return this.onFailed(this,h),!1;if(!0===a.parseExpression(""+d+""+this.comparator+this._getArg(this.expression,!0)))return this.onSuccess(this,h),this._solve(a,
h,b),!0;this.onFailed(this,h);return!1}catch(e){console.error("case block crashed! ",e.stack),console.trace()}},getChildren:function(a){return this.items},getFields:function(){function a(a,b){return{label:b||a,value:a}}var b=this.inherited(arguments)||this.getDefaultFields();b.push(r.createCI("Expression",13,this.expression,{group:"General",title:"Expression",dst:"expression"}));b.push(r.createCI("Comparator",3,this.comparator,{group:"General",title:"Comparator",dst:"comparator",widget:{options:[a("\x3d\x3d"),
a("\x3c\x3d"),a("\x3d\x3e"),a("!\x3d"),a("\x3c"),a("\x3e")],editable:!0}}));return b},runAction:function(a){if("New/Break"===a.command){a=new b;var g=this.add(m,{group:null});a.resolve({select:[g],focus:!0,append:!1});g.refresh();return a}},getActions:function(){return[this.createAction({label:"Break",command:"New/Break",tab:"Home",icon:"fa-stop",group:"File",mixin:{addPermission:!0,custom:!0,quick:!1}})]}})})},"xblox/model/logic/BreakBlock":function(){define(["dcl/dcl","xide/utils","xide/types",
"xblox/model/Block"],function(p,r,n,q){return p(q,{declaredClass:"xblox.model.logic.BreakBlock",name:"Break",icon:"fa-stop",hasInlineEdits:!1,canAdd:!1,toText:function(){return'\x26nbsp;\x3cspan class\x3d"fa-stop text-warning"\x3e\x3c/span\x3e\x26nbsp;\x26nbsp;\x3cspan\x3e'+this.name+"\x3c/span\x3e"},solve:function(b,m){this.onSuccess(this,m)},getFields:function(){return this.inherited(arguments)||this.getDefaultFields()}})})},"xblox/model/functions/CallBlock":function(){define("dcl/dcl xide/utils xide/types dojo/Deferred xblox/model/Block xcf/model/Command".split(" "),
function(p,r,n,q,b,m){return p(m,{declaredClass:"xblox.model.functions.CallBlock",command:"Select command please",icon:"",args:null,_timeout:100,isCommand:!0,_commandHandles:null,onCommandProgress:function(a){this.getScope().getContext();var b=a.params;b&&b.id&&(this._emit("cmd:"+a.cmd+"_"+b.id,{msg:a}),a.lastResponse&&this.storeResult(a.lastResponse),this._emit("progress",{msg:a,id:b.id}));this._lastResult=null;this._lastResult=a?a.result:null;a=this.getItems(n.BLOCK_OUTLET.PROGRESS);this._lastSettings||
(this._lastSettings={});this._lastSettings.override={};a.length&&this.runFrom(a,0,this._lastSettings)},stop:function(){this._lastCommand&&this._lastCommand.stop()},pause:function(){this._lastCommand&&this._lastCommand.pause()},destroy:function(){_.invoke(this._commandHandles,"remove");delete this._commandHandles;delete this._lastCommand},solve:function(a,b){this._commandHandles&&_.invoke(this._commandHandles,"remove");this._commandHandles=[];var h=this._timeout||50;_.isString(h)&&(h=parseInt(h));
var f=new q,d=this._commandHandles;b=b||{};setTimeout(function(){if(this.command){var e=null;if(this.args){b.override=b.override||{};var h=a.expressionModel.replaceVariables(a,this.args,!1,!1,null,null,{begin:"%%",end:"%%"});try{e=r.fromJson(h)}catch(c){e=h}b.override.args=_.isArray(e)?e:[h];b.override.mixin=e}if(this._lastCommand=a.resolveBlock(this.command))d.push(this._lastCommand._on("paused",this.onCommandPaused,this)),d.push(this._lastCommand._on("finished",this.onCommandFinish,this)),d.push(this._lastCommand._on("stopped",
this.onCommandStopped,this)),d.push(this._lastCommand._on("error",this.onCommandError,this)),d.push(this._lastCommand._on("progress",this.onCommandProgress,this));if(e=a.solveBlock(this.command,b))this.onSuccess(this,b);else this.onFailed(this,b);f.resolve(e);return e}}.bind(this),h);return f},hasInlineEdits:!0,makeEditable:function(a,b,h,f,d,e,l){return'\x3ca   tabIndex\x3d"-1" pos\x3d\''+b+"' display-mode\x3d'"+(d||"popup")+"' display-type\x3d'"+(h||"text")+"' data-prop\x3d'"+a+"' data-title\x3d'"+
f+"' class\x3d'editable editable-click'  href\x3d'#'\x3e"+this[a]+"\x3c/a\x3e"},getFieldOptions:function(a){if("command"===a)return this.scope.getCommandsAsOptions("text")},toText:function(){var a="Unknown",b=this.scope.getBlock(this.command);b&&(a=b.name);-1!==this.command.indexOf("://")&&(a='\x3cspan class\x3d"text-info"\x3e'+this.scope.toFriendlyName(this,this.command)+"\x3c/span\x3e");return this.getBlockIcon("D")+"Call Command : "+a},getFields:function(){var a=this.getDefaultFields();this.command.indexOf("://")&&
this.scope.toFriendlyName(this,this.command);a.push(r.createCI("value","xcf.widgets.CommandPicker",this.command,{group:"General",title:"Command",dst:"command",options:this.scope.getCommandsAsOptions(),block:this,pickerType:"command",value:this.command}));a.push(r.createCI("arguments",27,this.args,{group:"Arguments",title:"Arguments",dst:"args"}));a.push(r.createCI("timeout",13,this._timeout,{group:"General",title:"Delay",dst:"_timeout"}));return a}})})},"xcf/model/Command":function(){define("dcl/dcl xblox/model/Block xblox/model/Contains xide/utils xide/types dojo/Deferred module require xblox/types/Types".split(" "),
function(p,r,n,q,b,m,a,g,h){return p([r,n],{declaredClass:"xcf.model.Command",startup:!1,auto:null,send:"",name:"No Title",observed:["send"],interval:0,flags:2048,_runningDfd:null,__started:!1,isCommand:!0,getItems:function(a){return this.getItemsByType(a)},onCommandFinish:function(a){this.getScope().getContext();var d=null;if(a.params&&a.params.id){var e=a.params.id,d=this.getDeferred(e);delete this._solving[e];a.lastResponse&&this.storeResult(a.lastResponse);this._emit("finished",{msg:a,result:this._lastResult})}a=
this.getItems(b.BLOCK_OUTLET.FINISH);a.length&&this.runFrom(a,0,this._lastSettings);this.resolve({});this.onSuccess(this,this._lastSettings);d&&d.resolve(this._lastResult)},onCommandPaused:function(a){this.getScope().getContext();var d=a.params;d&&d.id&&(a.lastResponse&&this.storeResult(a.lastResponse),this._emit("paused",{msg:a,result:this._lastResult,id:d.id}));a=this.getItems(b.BLOCK_OUTLET.PAUSED);a.length&&this.runFrom(a,0,this._lastSettings)},onCommandStopped:function(a){this.getScope().getContext();
var d=a.params;d&&d.id&&(a.lastResponse&&this.storeResult(a.lastResponse),this._emit("stopped",{msg:a,result:this._lastResult,id:d.id}));a=this.getItems(b.BLOCK_OUTLET.STOPPED);a.length&&this.runFrom(a,0,this._lastSettings)},onCommandProgress:function(a){this.getScope().getContext();var d=a.params;d&&d.id&&(a.lastResponse&&this.storeResult(a.lastResponse),this._emit("progress",{msg:a,result:this._lastResult,id:d.id}));a=this.getItems(b.BLOCK_OUTLET.PROGRESS);a.length&&this.runFrom(a,0,this._lastSettings)},
storeResult:function(a){var b=q.getJson(a);a=null;if(b&&b.result&&_.isString(b.result)){var e=b.result,g=-1!==e.indexOf("{")||-1!==e.indexOf("["),b=e;g&&(e=q.getJson(e,!0,!1))&&(b=e);this._lastResult=null!==b?a=b:null}return a},resolve:function(a){a=a||this._lastResult;this._runningDfd&&this._runningDfd.resolve(a)},onCommandError:function(a){this.getScope().getContext();var d=a.params;d.id&&(a.lastResponse&&this.storeResult(a.lastResponse),this._emit("cmd:"+a.cmd+"_"+d.id,a),this._emit("error",{msg:a,
result:this._lastResult,id:d.id}));this.onFailed(this,this._settings);a=this.getItems(b.BLOCK_OUTLET.ERROR);a.length&&this.runFrom(a,0,this._lastSettings)},sendToDevice:function(a,d,e,g,c){if(!this._destroyed){a=this.replaceAll("'","",a);c=c||q.createUUID();var k=this,h=this.flags&b.CIFLAG.WAIT?!0:!1;this.lastCommand=""+a;if(this.scope.instance)h&&this._on("cmd:"+a+"_"+c,function(a){if(a.error)k.onFailed(k,d);else k.onSuccess(k,d)}),this.scope.instance.sendMessage(a,null,this.id,c,h,e,g);else return this.publish(b.EVENTS.ON_STATUS_MESSAGE,
{text:"Command "+this.name+" : have no device",type:"error",delay:1E3}),!1;return c}},reset:function(){this._lastSettings={};this._loop&&(clearTimeout(this._loop),this._loop=null);delete this._runningDfd},_solving:null,addDeferred:function(a){this._solving||(this._solving={});this._solving[a]=new m;return this._solving[a]},getDeferred:function(a){this._solving||(this._solving={});return this._solving[a]},_resolve:function(a,d,e){var g=this.scope;a=a||this._get("send");d=d||{};var c=d.flags||this.flags,
k=!(c&b.CIFLAG.DONT_PARSE),h=c&b.CIFLAG.EXPRESSION;c&b.CIFLAG.TO_HEX&&(a=q.to_hex(a));!1!==k&&(a=q.convertAllEscapes(a,"none"));d=d||this._lastSettings||{};if(c=(d=d.override||this.override||{},d.variables)?d.variables:null)for(var m in c)_.isNumber(c[m])&&(c[m]=Math.round(c[m]));m="";var n=this.getDriverModule();n&&n.resolveBefore&&!1!==e&&(a=n.resolveBefore(this,a));m=h&&!1!==k?g.parseExpression(a,null,c,null,null,null,d.args):""+a;n&&n.resolveAfter&&!1!==e&&(m=n.resolveAfter(this,m));return m},
solve:function(a,d,e,g){var c=null;a=a||this.scope;(d=this._lastSettings=d||this._lastSettings||{},d.override)&&d.override.mixin&&q.mixin(this.override,d.override.mixin);var k=g||this._get("send")||this.send,h=!(this.flags&b.CIFLAG.DONT_PARSE);g=this.flags&b.CIFLAG.WAIT?!0:!1;var m=q.createUUID();this.flags&b.CIFLAG.TO_HEX&&(k=q.to_hex(k));!1!==h&&(k=q.convertAllEscapes(k,"none"));if(this.enabled||!0===e){1==e&&this._loop&&this.reset();if(!0!==g)this.onRun(this,d);else this.onRun(this,d,{timeout:!1}),
c=this.addDeferred(m);if(this.items&&0<this.items.length){if(k&&0<k.length&&(k=this._resolve(this.send,d))&&0<k.length)if(this.sendToDevice(k,d))this.onSuccess(this,d);else this.onFailed(this,d);if(g)return c;e=[];for(c=0;c<this.items.length;c++)g=this.items[c],g.enabled&&e.push(g.solve(a,d));return e}if(0<k.length){if((k=this._resolve(this.send,d))&&0<k.length&&!this.sendToDevice(k,d,null,null,m))this.onFailed(this,d);if(!0!==g)this.onSuccess(this,d);else this._settings=d;e&&this.auto&&0<this.getInterval()&&
this.scope.loopBlock(this,d);return g?c:[k]}return!1}this.reset()},canAdd:function(){return[]},mayHaveChildren:function(a){return null!=this.items&&0<this.items.length},getChildren:function(a){return this.items},hasInlineEdits:!0,toText:function(a,b,e,g){var c="";!1!==a&&(c+="\x3cspan class\x3d'text-primary inline-icon'\x3e"+this.getBlockIcon()+"\x3c/span\x3e");!1!==b&&(c+=""+this.makeEditable("name","bottom","text","Enter a unique name","inline")+"");1==g&&(c+="\x3cbr/\x3e");!1!==e&&(c+="\x3cspan class\x3d'text-muted small'\x3e Send:\x3ckbd class\x3d'text-warning'\x3e"+
this.makeEditable("send","bottom","text","Enter the string to send","inline")+"\x3c/kbd\x3e\x3c/span\x3e");!1!==a&&(this.startup&&(c+=this.getIcon("fa-bell inline-icon text-warning","text-align:right;float:right;","")),this.auto&&0<this.getInterval()&&(c+=this.getIcon("fa-clock-o inline-icon text-warning","text-align:right;float:right","")));return c=this.getDriverToText(c)||c},getInterval:function(){return parseInt(this.interval)},start:function(){this.startup&&!this.auto?this.solve(this.scope):
this.auto&&0<this.getInterval()&&this.scope.loopBlock(this)},getDriverModule:function(){var a=null,b=this.getInstance();b?a=b.Module:(b=this.getScope().driver)&&b.Module&&(a=b.Module);return a},getDriverToText:function(a){var b=this.getDriverModule();if(b&&b.toText)return b.toText(this,a)},getDriverFields:function(a){var b=this.getDriverModule(),e=[];b&&b.getFields&&(e=b.getFields(this,a)||[]);return e},getFields:function(){var a=this.inherited(arguments)||this.getDefaultFields(),d=this;a.push(this.utils.createCI("name",
13,this.name,{group:"General",title:"Name",dst:"name",order:200}));a.push(this.utils.createCI("startup",0,this.startup,{group:"General",title:"Send on Startup",dst:"startup",order:199}));a.push(this.utils.createCI("auto",0,this.auto,{group:"General",title:"Auto Send",dst:"auto",order:198}));a.push(this.utils.createCI("interval",13,this.interval,{group:"General",title:"Interval",dst:"interval",order:197}));a.push(this.utils.createCI("send",b.ECIType.EXPRESSION_EDITOR,this.send,{group:"Send",title:"Send",
dst:"send",widget:{instantChanges:!1,allowACECache:!0,showBrowser:!1,showSaveButton:!0,style:"height:inherit;",editorOptions:{showGutter:!1,autoFocus:!1},aceOptions:{hasEmmet:!1,hasLinking:!1,hasMultiDocs:!1},item:this},delegate:{runExpression:function(a,b,c){return d.scope.expressionModel.parse(d.scope,a,!1,b,c)}}}));a.push(this.utils.createCI("flags",5,this.flags,{group:"General",title:"Flags",dst:"flags",data:[{value:4096,label:"Dont parse",title:"Do not parse the string and use it as is"},{value:2048,
label:"Expression",title:"Parse it as Javascript"},{value:32768,label:"Wait",title:"Wait for response"}],widget:{hex:!0}}));return a=a.concat(this.getDriverFields(a))},icon:"fa-exclamation",getIconClass:function(){return"el-icon-play-circle"},getBlockIcon:function(){return'\x3cspan class\x3d"'+this.icon+'"\x3e\x3c/span\x3e '},canEdit:function(){return!0},onChangeField:function(a,b,e){var g=this.getInterval();"auto"==a&&(1==b?0<g&&this.scope.loopBlock(this):this._loop&&this.reset());"enabled"==a&&
(0==b?this.reset():g&&this.scope.loopBlock(this));"interval"==a&&(0<g&&this.auto?this.scope.loopBlock(this):this.reset());this.inherited(arguments)},destroy:function(){this.reset()},pause:function(){var a=this.lastCommand||this._resolve(this.send,this._lastSettings);null!==a&&this.sendToDevice(a,this._lastSettings,!1,!0)},stop:function(a){1!=a&&(this.onSuccess(this,{highlight:!0}),this.resolve(""),a=this.lastCommand||this._resolve(this.send,this._lastSettings),_.isEmpty(a)||this.sendToDevice(a,this._lastSettings,
!0,!1),delete this._runningDfd)}})})},"xblox/model/Contains":function(){define(["dcl/dcl","dojo/promise/all","xide/types"],function(p,r,n){return p(null,{declaredClass:"xblox.model.Contains",runByType:function(n,b){var m=this.getItemsByType(n);m.length&&this.runFrom(m,0,b)},getItemsByType:function(n){var b=this.items;if(!n)return b;var m=[];_.each(b,function(a){a.outlet&n&&m.push(a)});return m},getContainer:function(){return this[this._getContainer()]},mayHaveChildren:function(n){n=this[this._getContainer()];
return null!=n&&0<n.length},getChildren:function(n){return this[this._getContainer()]},canAdd:function(){return[]},runFrom:function(n,b,m){var a=this,g=n||this.items;n=[];var h=function(b){b._deferredObject.then(function(d){console.log("----def block finish");b._lastResult=b._lastResult||d;a._currentIndex++;a.runFrom(g,a._currentIndex,m)})};if(g.length)for(;b<g.length;b++){var f=g[b];if(!0===f.deferred&&f.enabled){f._deferredObject=new Deferred;this._currentIndex=b;h(f);var d=f.solve(this.scope,m);
n.push(d);break}else f.enabled&&(d=f.solve(this.scope,m),n.push(d),f.onDidRun())}else this.onSuccess(this,m);this._lastSettings&&delete this._lastSettings.override;return n},_solve:function(n,b,m,a){!this._lastRunSettings&&b&&(this._lastRunSettings=b);b=this._lastRunSettings||b;this._currentIndex=0;this._return=[];n=this[this._getContainer()];if(n.length)return n=this.runFrom(n,0,b),this.onSuccess(this,b),n;this.onSuccess(this,b);return[]},onDidRunItem:function(q,b,m){this._emit(n.EVENTS.ON_RUN_BLOCK_SUCCESS,
this);q.resolve(b)},onDidRunItemError:function(n,b,m){n.reject(b)},onRunThis:function(q){this._emit(n.EVENTS.ON_RUN_BLOCK,this)},onDidRunThis:function(n,b,m,a){var g=this;if(m&&m.length)m=g.runFrom(m,0,a),r(m).then(function(h){g.onDidRunItem(n,b,a)},function(b){console.error("error in chain",b);g.onDidRunItem(n,b,a)});else g.onDidRunItem(n,b,a)},___solve:function(n,b,m,a){}})})},"xblox/types/Types":function(){define(["xide/types/Types","dojo/_base/lang","xide/utils"],function(p,r,n){p.BLOCK_MODE=
{NORMAL:0,UPDATE_WIDGET_PROPERTY:1};p.BLOCK_OUTLET={NONE:0,PROGRESS:1,ERROR:2,PAUSED:4,FINISH:8,STOPPED:16};n.mixin(p.EVENTS,{ON_RUN_BLOCK:"onRunBlock",ON_RUN_BLOCK_FAILED:"onRunBlockFailed",ON_RUN_BLOCK_SUCCESS:"onRunBlockSuccess",ON_BLOCK_SELECTED:"onItemSelected",ON_BLOCK_UNSELECTED:"onBlockUnSelected",ON_BLOCK_EXPRESSION_FAILED:"onExpressionFailed",ON_BUILD_BLOCK_INFO_LIST:"onBuildBlockInfoList",ON_BUILD_BLOCK_INFO_LIST_END:"onBuildBlockInfoListEnd",ON_BLOCK_PROPERTY_CHANGED:"onBlockPropertyChanged",
ON_SCOPE_CREATED:"onScopeCreated",ON_VARIABLE_CHANGED:"onVariableChanged",ON_CREATE_VARIABLE_CI:"onCreateVariableCI"});p.BlockType={AssignmentExpression:"AssignmentExpression",ArrayExpression:"ArrayExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DoWhileStatement:"DoWhileStatement",DebuggerStatement:"DebuggerStatement",
EmptyStatement:"EmptyStatement",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForInStatement:"ForInStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",Program:"Program",Property:"Property",ReturnStatement:"ReturnStatement",
SequenceExpression:"SequenceExpression",SwitchStatement:"SwitchStatement",SwitchCase:"SwitchCase",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement"};return p})},"xblox/model/functions/StopBlock":function(){define(["dcl/dcl","xide/utils","xide/types",
"dojo/Deferred","xblox/model/Block"],function(p,r,n,q,b){return p(b,{declaredClass:"xblox.model.functions.StopBlock",command:"Select command please",icon:"",args:null,_timeout:100,solve:function(b,a){if(this.command){var g=b.resolveBlock(this.command);if(g&&g.stop){var h=g.stop();this.onSuccess(this,a)}else this.onFailed(this,a);return h}},hasInlineEdits:!0,makeEditable:function(b,a,g,h,f,d,e){return'\x3ca   tabIndex\x3d"-1" pos\x3d\''+a+"' display-mode\x3d'"+(f||"popup")+"' display-type\x3d'"+(g||
"text")+"' data-prop\x3d'"+b+"' data-title\x3d'"+h+"' class\x3d'editable editable-click'  href\x3d'#'\x3e"+this[b]+"\x3c/a\x3e"},getFieldOptions:function(b){if("command"===b)return this.scope.getCommandsAsOptions("text")},toText:function(){var b="Unknown",a=this.scope.getBlock(this.command);a&&(b=a.name);-1!==this.command.indexOf("://")&&(b='\x3cspan class\x3d"text-info"\x3e'+this.scope.toFriendlyName(this,this.command)+"\x3c/span\x3e");return this.getBlockIcon("D")+"Stop Command : "+b},onChangeField:function(b,
a){},getFields:function(){var b=this.inherited(arguments)||this.getDefaultFields();this.command.indexOf("://")&&this.scope.toFriendlyName(this,this.command);b.push(r.createCI("value","xcf.widgets.CommandPicker",this.command,{group:"General",title:"Command",dst:"command",options:this.scope.getCommandsAsOptions(),block:this,pickerType:"command",value:this.command}));return b}})})},"xblox/model/functions/PauseBlock":function(){define(["dcl/dcl","xide/utils","xide/types","dojo/Deferred","xblox/model/Block"],
function(p,r,n,q,b){return p(b,{declaredClass:"xblox.model.functions.PauseBlock",command:"Select command please",icon:"",args:null,_timeout:100,solve:function(b,a){if(this.command){var g=b.resolveBlock(this.command);if(g&&g.pause){var h=g.pause();this.onSuccess(this,a)}else this.onFailed(this,a);return h}},hasInlineEdits:!0,makeEditable:function(b,a,g,h,f,d,e){return'\x3ca   tabIndex\x3d"-1" pos\x3d\''+a+"' display-mode\x3d'"+(f||"popup")+"' display-type\x3d'"+(g||"text")+"' data-prop\x3d'"+b+"' data-title\x3d'"+
h+"' class\x3d'editable editable-click'  href\x3d'#'\x3e"+this[b]+"\x3c/a\x3e"},getFieldOptions:function(b){if("command"===b)return this.scope.getCommandsAsOptions("text")},toText:function(){var b="Unknown",a=this.scope.getBlock(this.command);a&&(b=a.name);-1!==this.command.indexOf("://")&&(b='\x3cspan class\x3d"text-info"\x3e'+this.scope.toFriendlyName(this,this.command)+"\x3c/span\x3e");return this.getBlockIcon("D")+"Pause Command : "+b},onChangeField:function(b,a){},getFields:function(){var b=
this.inherited(arguments)||this.getDefaultFields();this.command.indexOf("://")&&this.scope.toFriendlyName(this,this.command);b.push(r.createCI("value","xcf.widgets.CommandPicker",this.command,{group:"General",title:"Command",dst:"command",options:this.scope.getCommandsAsOptions(),block:this,pickerType:"command",value:this.command}));return b}})})},"xblox/model/functions/SetProperties":function(){define(["dcl/dcl","xide/utils","xide/types","dojo/Deferred","xblox/model/Block"],function(p,r,n,q,b){return p(b,
{declaredClass:"xblox.model.functions.SetProperties",command:"Select block",icon:"",args:null,_timeout:100,solve:function(b,a){var g=new q;if(this.command){var h=b.resolveBlock(this.command);if(h&&this.props){for(var f in this.props)h.set(f,this.props[f]),h[f]=this.props[f],h.onChangeField&&h.onChangeField(f,this.props[f]);this.onSuccess(this,a)}else this.onFailed(this,a);g.resolve([])}return g},hasInlineEdits:!1,makeEditable:function(b,a,g,h,f,d,e){return'\x3ca   tabIndex\x3d"-1" pos\x3d\''+a+"' display-mode\x3d'"+
(f||"popup")+"' display-type\x3d'"+(g||"text")+"' data-prop\x3d'"+b+"' data-title\x3d'"+h+"' class\x3d'editable editable-click'  href\x3d'#'\x3e"+this[b]+"\x3c/a\x3e"},getFieldOptions:function(b){if("command"===b)return this.scope.getCommandsAsOptions("text")},toText:function(){var b="Unknown",a=this.scope.getBlock(this.command);a&&(b=a.name);-1!==this.command.indexOf("://")&&(b='\x3cspan class\x3d"text-info"\x3e'+this.scope.toFriendlyName(this,this.command)+"\x3c/span\x3e");return this.getBlockIcon("D")+
"Set Properties : "+b},serializeObject:function(b){return"props"===b?!0:!1},onChangeField:function(b,a,g){"command"===b&&(delete this.props,this.props={})},init:function(){this.props&&_.isString(this.props)&&(this.props=r.fromJson(this.props))},getFields:function(){var b=this.inherited(arguments)||this.getDefaultFields();this.command.indexOf("://")&&this.scope.toFriendlyName(this,this.command);b.push(r.createCI("value","xcf.widgets.CommandPicker",this.command,{group:"General",title:"Command",dst:"command",
options:this.scope.getCommandsAsOptions(),block:this,pickerType:"command",value:this.command}));var a=this.scope.resolveBlock(this.command);if(a&&a.getFields){this.props||(this.props={});var a=a.getFields(),g=_.find(a,{dst:"description"});a.remove(g);_.each(a,function(a){a.group="Properties";a.value=r.getAt(this.props,a.dst,a.value);a.dst="props."+a.dst},this);b=b.concat(a)}return b}})})},"xblox/model/code/CallMethod":function(){define(["dcl/dcl","xblox/model/Block","xide/utils"],function(p,r,n){return p(r,
{declaredClass:"xblox.model.code.CallMethod",name:"Call Method",method:"",args:"",sharable:!0,solve:function(n,b){var m=this.getContext();if(m&&null!=m[this.method]){var a=[],g=m[this.method];try{var h=this.getArgs(b);console.log("args",h);a=g.apply(m,h||[]);this.onSuccess(this,b);return a}catch(f){console.error("call method "+this.method+" failed: "+f),logError(f),this.onFailed(this,b)}}else this.onFailed(this,b);return[]},toText:function(){var n=this.getBlockIcon()+" "+this.name+" ";this.method&&
(n+=this.makeEditable("method","bottom","text","Enter a driver method","inline"));return n},getFields:function(){var p=this.getDefaultFields();this.getContext();p.push(n.createCI("value",13,this.method,{group:"General",title:"Method",dst:"method"}));p.push(n.createCI("value",27,this.args,{group:"Arguments",dst:"args",widget:{title:""}}));return p},getBlockIcon:function(){return'\x3cspan class\x3d"fa-caret-square-o-right"\x3e\x3c/span\x3e'}})})},"xblox/model/code/RunScript":function(){define("dcl/dcl xdojo/has dojo/Deferred xblox/model/Block xide/utils xblox/model/Contains dojo/promise/all xide/types module".split(" "),
function(p,r,n,q,b,m,a,g,h,f,d,e,l){var c="undefined"!==typeof window?window.console:global.console;f&&c&&c.error&&(c=d);return p([q,m],{declaredClass:"xblox.model.code.RunScript",name:"Run Script",method:"",args:"",deferred:!1,sharable:!0,context:null,icon:"fa-code",observed:["method"],getContext:function(){return this.context||(this.scope.getContext?this.scope.getContext():this)},solve2:function(a,b,d,e){this._currentIndex=0;this._return=[];var f=""+this._get("method"),g=this,h=this.getContext();
if(f&&f.length){var l=function(){var a=new Function("{"+f+"}"),c=g.getArgs()||[];try{var k=a.apply(h,c||{});g._lastResult=k;d&&d("Expression "+f+" evaluates to "+k);if("false"!==k&&!1!==k)g.onSuccess(g,b,{result:k});else return g.onFailed(g,b),[]}catch(l){return e&&e("invalid expression : \n"+f+": "+l),g.onFailed(g,b),[]}};if(a.global)(function(){window=a.global;var c=g.getArgs()||[];try{var l=null,l=h.runExpression?h.runExpression(f,null,c):(new Function("{"+f+"}")).bind(this).apply(h,c||{});g._lastResult=
l;d&&d("Expression "+f+" evaluates to "+l);if("false"!==l&&!1!==l)g.onSuccess(g,b);else return g.onFailed(g,b),[]}catch(m){return g._lastResult=null,e&&e("invalid expression : \n"+f+": "+m),g.onFailed(g,b),[]}}).call(a.global);else return l()}else c.error("have no script");l=this[this._getContainer()];if(l.length)this.runFrom(l,0,b);else this.onSuccess(this,b);this.onDidRun();return[]},solve:function(a,b,c,d,e,f){this._currentIndex=0;this._return=[];b=b||{};c=d||(this._get("method")?this._get("method"):
this.method);var g=this;d=this.getContext();var h=this[this._getContainer()],l=new n,m=g.deferred;this.onRunThis(b);var p=a.expressionModel.replaceVariables(a,c,null,null),q=a.expressionModel.expressionCache[p];q||(q=a.expressionModel.expressionCache[p]=new Function("{"+p+"}"));a=g.getArgs(b)||[];try{m&&(d.resolve=function(a){g._deferredObject&&g._deferredObject.resolve();g.onDidRunThis(l,a,h,b)});var r=q.apply(d,a||{});g._lastResult=r;e&&e("Expression "+c+" evaluates to "+r);if(!m)g.onDidRunThis(l,
r,h,b);if("false"!==r&&!1!==r)g.onSuccess(g,b);else g.onFailed(g,b)}catch(G){G=G||{},g.onDidRunItemError(l,G,b),g.onFailed(g,b),f&&f("invalid expression : \n"+c+": "+G)}return l},toText:function(){var a='\x3cspan style\x3d""\x3e'+this.getBlockIcon()+" "+this.name+" :: \x3c/span\x3e";this.method&&(a+=this.method.substr(0,50));return a},canAdd:function(){return[]},getFields:function(){"No Description"===this.description&&(this.description=e);var a=this.inherited(arguments)||this.getDefaultFields(),
c=this;a.push(b.createCI("name",13,this.name,{group:"General",title:"Name",dst:"name"}));a.push(b.createCI("deferred",0,this.deferred,{group:"General",title:"Deferred",dst:"deferred"}));a.push(b.createCI("arguments",27,this.args,{group:"Arguments",title:"Arguments",dst:"args"}));a.push(b.createCI("value",g.ECIType.EXPRESSION_EDITOR,this.method,{group:"Script",title:"Script",dst:"method",select:!0,widget:{allowACECache:!0,showBrowser:!1,showSaveButton:!0,editorOptions:{showGutter:!0,autoFocus:!1},
item:this},delegate:{runExpression:function(a,b,d){c.method=a;c.solve(c.scope,null,b,d)}}}));return a}})})},"xblox/model/loops/ForBlock":function(){define("dcl/dcl xblox/model/Block xblox/model/variables/Variable xblox/model/Contains dojo/promise/all dojo/Deferred".split(" "),function(p,r,n,q,b,m){return p([r,q],{declaredClass:"xblox.model.loops.ForBlock",initial:null,"final":null,comparator:null,modifier:null,items:null,counterName:null,_counter:null,name:"For",sharable:!0,icon:"",ignoreErrors:!1,
runFrom:function(a,b,h){var f=this,d=a||this.items;a=[];var e=function(a){a._deferredObject.then(function(b){console.log("----def block finish");a._lastResult=a._lastResult||b;f._currentIndex++;f.runFrom(d,f._currentIndex,h)})};if(d.length)for(;b<d.length;b++){var l=d[b];if(!1!==l.enabled)if(!0===l.deferred){l._deferredObject=new m;this._currentIndex=b;e(l);l=l.solve(this.scope,h);a.push(l);break}else l=l.solve(this.scope,h),a.push(l)}else this.onSuccess(this,h);return a},_currentForIndex:0,solveSubs:function(a,
g,h,f){var d=this;f.override=f.override||{};f.override.args=[this._currentForIndex];if(h.length)return g=d.runFrom(h,0,f),b(g).then(function(a){},function(b){console.error("error in chain",b);d.onDidRunItem(a,b,f)}),g;d.onDidRunItem(a,g,f)},_solve:function(a,g){var h=new m,f=this,d=this.solveSubs(h,null,this.items,g);b(d).then(function(a){a=a.indexOf(!1);!0!==f.ignoreErrors&&-1!==a?h.resolve(!1):h.resolve(!0)});return h},step:function(a,b){var h=this._checkCondition(a,b),f=new m;h&&this._solve(a,
b).then(function(a){1==a?f.resolve(!0):f.resolve(!1)});return f},_forState:!1,loop:function(a,b){var h=this;this.step(a,b).then(function(f){h._updateCounter(a);h._currentForIndex=h._counter.value;if(1==f)h.loop(a,b);else h.onFailed(h,b)})},solve:function(a,b){this._counter=new n({title:this.counterName,value:this.initial,scope:a,register:!1});this._forState=!0;this._currentForIndex=this.initial;this.loop(a,b);return[]},_checkCondition:function(a,b){var h=a.parseExpression(""+this._counter.value+this.comparator+
this["final"]);if(0!=h)this.onSuccess(this,b);return this._forState=h},_updateCounter:function(a){var b=this._counter.value,b=a.parseExpression(""+b+this.modifier);if(b==this._counter.value)return!1;this._counter.value=b;return!0},mayHaveChildren:function(a){return null!=this.items&&0<this.items.length},getChildren:function(a){a=[];this.items&&(a=a.concat(this.items));return a},canAdd:function(){return[]},toText:function(){return this.getBlockIcon("F")+this.name+" "+this.initial+" "+this.comparator+
" "+this["final"]+" with "+this.modifier},getFields:function(){var a=this.inherited(arguments)||this.getDefaultFields();return a=a.concat([this.utils.createCI("initial",13,this.initial,{group:"General",title:"Initial",dst:"initial"}),this.utils.createCI("Final",13,this["final"],{group:"General",title:"Final",dst:"final"}),this.utils.createCI("comparator",13,this.comparator,{group:"General",title:"Comparision",dst:"comparator"}),this.utils.createCI("modifier",13,this.modifier,{group:"General",title:"Modifier",
dst:"modifier"}),this.utils.createCI("Abort on Error",0,this.ignoreErrors,{group:"General",title:"Ignore Errors",dst:"ignoreErrors"})])}})})},"xblox/model/loops/WhileBlock":function(){define(["dcl/dcl","xblox/model/Block","xblox/model/variables/Variable"],function(p,r,n){return p(r,{declaredClass:"xblox.model.loops.WhileBlock",condition:null,items:null,loopLimit:1500,name:"While",wait:0,_currentIndex:0,sharable:!0,icon:"",_timer:null,canAdd:function(){return[]},_solve:function(n,b){for(var m=0;m<
this.items.length;m++)this.items[m].solve(n,b);return[]},doStep:function(n){if(this._currentIndex<this.loopLimit){var b=[];this._checkCondition(this.scope)?(this.onSuccess(this,n),this.addToEnd(b,this._solve(this.scope,n)),this._currentIndex++):(this._timer&&clearInterval(this._timer),this.onFailed(this,n))}else console.error("--while block : reached loop limit"),this.reset()},reset:function(){this._timer&&(clearTimeout(this._timer),this._timer=null);this._currentIndex=0},solve:function(n,b){this.loopLimit=
1500;b=b||{};var m=0,a=this,g=this._getArg(this.wait);this.reset();if(0<g)return this._timer=setInterval(function(){a.doStep(b)},g),[];for(;this._checkCondition(n)&&m<this.loopLimit;)this._solve(n,b),m++;this.reset();return[]},toText:function(){return this.getBlockIcon("G")+this.name+" "+this.condition},_checkCondition:function(n){return n.parseExpression(this.condition)},mayHaveChildren:function(n){return null!=this.items&&0<this.items.length},getChildren:function(n){n=[];this.items&&(n=n.concat(this.items));
return n},getFields:function(){var n=this,b=this.inherited(arguments)||this.getDefaultFields();b.push(this.utils.createCI("condition",25,this.condition,{group:"General",title:"Expression",dst:"condition",delegate:{runExpression:function(b,a,g){return n.scope.expressionModel.parse(n.scope,b,!1,a,g)}}}));b.push(this.utils.createCI("wait",13,this.wait,{group:"General",title:"Wait",dst:"wait"}));return b}})})},"xblox/model/variables/VariableAssignmentBlock":function(){define("dcl/dcl xblox/model/Block xide/utils xide/types dstore/legacy/DstoreAdapter xide/factory xdojo/has".split(" "),
function(p,r,n,q,b,m,a){return p(r,{declaredClass:"xblox.model.variables.VariableAssignmentBlock",variable:null,value:null,name:"Set Variable",icon:"",hasInlineEdits:!0,flags:4,toText:function(){var a=this.scope.getVariableById(this.variable),a=a?a.name:"";this.variable&&-1!==this.variable.indexOf("://")&&(a='\x3cspan class\x3d"text-info"\x3e'+this.scope.toFriendlyName(this,this.variable)+"\x3c/span\x3e");return this.getBlockIcon("C")+this.name+" "+a+"\x3cspan class\x3d'text-muted small'\x3e to \x3ckbd class\x3d'text-warning'\x3e"+
this.makeEditable("value","bottom","text","Enter the string to send","inline")+"\x3c/kbd\x3e\x3c/span\x3e"},_getPreviousResult:function(){var a=null;return(a=(a=this.getPreviousBlock())&&a._lastResult&&a.enabled?a:this.getParent())&&null!=a._lastResult?(this.isArray(a._lastResult),a._lastResult):null},solve:function(a,b){var f=this.value,d=!1;if(!f){var e=this.getArgs();0<e.length&&(f=e[0])}if(this.variable&&null!==f){this.onRun(this,b);var l=-1!==this.variable.indexOf("://")?this.scope.resolveBlock(this.variable):
a.getVariableById(this.variable),e=this._getArg(f),c=this.getArgs(b)||[];if(!l)return[];var k=null;this.isScript(e)?(k=this.override||{},k=a.parseExpression(f,null,null,null,null,null,c||k.args),k=this.replaceAll("'","",k),l.value!==k&&(d=!0)):(c&&1==c.length&&(e=c[0]),l.value!==e&&(d=!0),k=l.value=e);l.set("value",k);f=!1;(c=this.getContext())&&(c=c.device)&&c.info&&c.info.serverSide&&(f=this.flags&q.VARIABLE_FLAGS.PUBLISH_IF_SERVER?!0:!1);this.flags&q.VARIABLE_FLAGS.PUBLISH&&d&&(f=!0);d&&m.publish(q.EVENTS.ON_DRIVER_VARIABLE_CHANGED,
{item:l,scope:this.scope,save:!1,block:this,name:l.name,value:e,publish:f,result:k});this.onSuccess(this,b);return[]}},canAdd:function(){return null},getFields:function(){var a=this.inherited(arguments)||this.getDefaultFields(!1),b=this;a.push(this.utils.createCI("value",29,this.value,{group:"General",title:"Value",dst:"value",widget:{allowACECache:!0,showBrowser:!1,showSaveButton:!0,editorOptions:{showGutter:!1,autoSelect:!1,autoFocus:!1,hasConsole:!1,hasItemActions:function(){return!1}},item:this},
delegate:{runExpression:function(a,d,e){return b.scope.expressionModel.parse(b.scope,a,!1,d,e)}}}));a.push(n.createCI("value","xcf.widgets.CommandPicker",this.variable,{group:"Variable",title:"Variable",dst:"variable",block:this,pickerType:"variable",value:this.variable,widget:{store:this.scope.blockStore,labelField:"name",valueField:"id",value:this.variable,query:[{group:"basicVariables"},{group:"processVariables"}]}}));a.push(this.utils.createCI("flags",5,this.flags,{group:"Variable",title:"Flags",
dst:"flags",data:[{value:2,label:"Publish to network",title:"Publish to network in order to make a network variable"},{value:4,label:"Publish if server",title:"Publish only on network if this is running server side"}],widget:{hex:!0}}));return a}})})},"dstore/legacy/DstoreAdapter":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/store/util/QueryResults"],function(p,r,n){function q(b){return b}var b={store:null,constructor:function(b){this.store=b;if(b._getQuerierFactory("filter")||
b._getQuerierFactory("sort"))this.queryEngine=function(a,h){h=h||{};var f=b._getQuerierFactory("filter"),d=f?f(a):q,f=b._getQuerierFactory("sort"),e=q;f&&(e=f(r.map(h.sort,function(a){return{property:a.attribute,descending:a.descending}})));var l=q;isNaN(h.start)&&isNaN(h.count)||(l=function(a){var b=h.start||0,b=a.slice(b,b+(h.count||Infinity));b.total=a.length;return b});return function(a){return l(e(d(a)))}};var a=this;b.on("add,update,delete",function(g){var h=g.type,f=g.target;a.notify("add"===
h||"update"===h?f:void 0,"delete"===h||"update"===h?"id"in g?g.id:b.getIdentity(f):void 0)})},labelAttr:"title",getLabel:function(b){return this.store.getLabel(b)},query:function(b,a){a=a||{};var g=this.store.filter(b),h,f,d;if(d=a.sort)if("[object Array]"===Object.prototype.toString.call(d))for(var e;e=d.pop();)g=g.sort(e.attribute,e.descending);else g=g.sort(d);g.track&&!g.tracking&&(g=g.track(),f=!0);"start"in a&&(h=a.start||0,h=g[g.fetchRangeSync?"fetchRangeSync":"fetchRange"]({start:h,end:a.count?
h+a.count:Infinity}));h=h||g[g.fetchSync?"fetchSync":"fetch"]();d=h.totalLength;h=new n(h);h.total=d;h.observe=function(a,b){function d(a){return void 0===a&&f?-1:a}var e=g.on("add",function(b){a(b.target,-1,d(b.index))}),h=g.on("update",function(e){!b&&e.previousIndex===e.index&&isFinite(e.index)||a(e.target,d(e.previousIndex),d(e.index))}),m=g.on("delete",function(b){a(b.target,d(b.previousIndex),-1)}),n={remove:function(){e.remove();h.remove();m.remove()}};n.cancel=n.remove;return n};return h},
notify:function(){}};r.forEach(["get","put","add","remove","getIdentity"],function(m){b[m]=function(){var a=this.store;return(a[m+"Sync"]||a[m]).apply(a,arguments)}});return p(null,b)})},"xblox/model/logic/IfBlock":function(){define("dcl/dcl xblox/model/Block xblox/model/Statement xblox/model/logic/ElseIfBlock dojo/Deferred xide/utils".split(" "),function(p,r,n,q,b,m){return p(r,{declaredClass:"xblox.model.logic.IfBlock",condition:"Invalid Expression",consequent:null,elseIfBlocks:null,alternate:null,
canAdd:function(){return[]},autoCreateElse:!0,name:"if",icon:"",add:function(a,b,h){null==h&&(h="consequent");return this._add(a,b,h,!1)},__addToStore:function(a){a.put(this)},mayHaveChildren:function(a){return null!==this.items&&this.items.length||null!==this.elseIfBlocks&&this.elseIfBlocks.length||null!=this.consequent&&this.consequent.length||null!=this.alternate&&this.alternate.length},getChildren:function(a){a=[];this.consequent&&(a=a.concat(this.consequent));this.elseIfBlocks&&(a=a.concat(this.elseIfBlocks));
this.alternate&&(a=a.concat(this.alternate));return a},toText:function(){return"\x3cspan class\x3d'text-primary'\x3e"+this.getBlockIcon("E")+this.name+" \x3c/span\x3e\x3cspan class\x3d'text-warning small'\x3e"+this.condition+"\x3cspan\x3e"},_checkCondition:function(a){return a.parseExpression(this.condition,null,null)},solve:function(a,b){var h=this._checkCondition(a),f=this.getElseIfBlocks(),d=this.childrenByNotClass(q),e=null,d=d.filter(function(a){return!a.isInstanceOf(n)});if(1==h||0<h){this.onSuccess(this,
b);if(d&&d.length)for(f=0;f<d.length;f++)e=d[f].solve(a,b);return e}e=!1;this.onFailed(this,b);if(f)for(d=0;d<f.length&&!e;d++){h=f[d];if(h._checkCondition(a))return h.onSuccess(h,b),e=!0,h.solve(a,b);h.onFailed(h,b)}d=this.childrenByClass(n);if(0<d.length&&!e){e=null;for(f=0;f<d.length;f++)e=d[f].solve(a,b);return e}return[]},empty:function(a){this._empty(this.alternate);this._empty(this.consequent);this._empty(this.elseIfBlocks)},removeBlock:function(a){a&&(a&&a.empty&&a.empty(),delete a.items,
a.parent=null,this.alternate.remove(a),this.consequent.remove(a),this.elseIfBlocks.remove(a))},_getContainer:function(a){return-1!=this.consequent.indexOf(a)?"consequent":-1!=this.alternate.indexOf(a)?"alternate":-1!=this.elseIfBlocks.indexOf(a)?"elseIfBlocks":"_"},init:function(){this.alternate=this.alternate||[];this.consequent=this.consequent||[];this.elseIfBlocks=this.elseIfBlocks||[];for(var a=0;a<this.alternate.length;a++)this.alternate[a].parentId=this.id,this.alternate[a].parent=this;for(a=
0;a<this.elseIfBlocks.length;a++)this.elseIfBlocks[a].parentId=this.id,this.elseIfBlocks[a].parent=this;for(a=0;a<this.consequent.length;a++)this.consequent[a].parentId=this.id,this.consequent[a].parent=this},getFields:function(){var a=this,b=this.inherited(arguments)||this.getDefaultFields();b.push(this.utils.createCI("condition",this.types.ECIType.EXPRESSION_EDITOR,this.condition,{group:"General",title:"Expression",dst:"condition",delegate:{runExpression:function(b,f,d){return a.scope.expressionModel.parse(a.scope,
b,!1,f,d)}}}));return b},postCreate:function(){this._postCreated||(this._postCreated=!0)},toCode:function(a,b){},getElseIfBlocks:function(){return this.childrenByClass(q)},runAction:function(a){var g=this.scope.blockStore;a=a.command;if("New/Else"===a||"New/Else If"===a){a="New/Else If"===a?q:n;var h=m.mixin({name:"else",items:[],dstField:"alternate",parentId:this.id,parent:this,scope:this.scope,canAdd:function(){return[]},canEdit:function(){return!1}},a==q?{name:"else if",dstField:"elseIfBlocks"}:
{name:"else",dstField:"alternate"});a=this.add(a,h,a==n?"alternate":"elseIfBlocks");var h={select:[a],focus:!0,append:!1,expand:!0,delay:10},f=new b;g._emit("added",{target:a});f.resolve(h);a.refresh();return f}},getActions:function(){var a=[];0==this.alternate.length&&a.push(this.createAction({label:"Else",command:"New/Else",icon:this.getBlockIcon("I"),tab:"Home",group:"File",mixin:{addPermission:!0,custom:!0}}));a.push(this.createAction({label:"Else If",command:"New/Else If",icon:this.getBlockIcon("I"),
tab:"Home",group:"File",mixin:{addPermission:!0,custom:!0}}));return a}})})},"xblox/model/Statement":function(){define(["dcl/dcl","xblox/model/Block"],function(p,r){return p(r,{declaredClass:"xblox.model.Statement",toText:function(){return this.name},getChildren:function(){return this.items}})})},"xblox/model/logic/ElseIfBlock":function(){define(["dcl/dcl","xblox/model/Block","xblox/model/Contains"],function(p,r,n){return p([r,n],{declaredClass:"xblox.model.logic.ElseIfBlock",condition:"",consequent:null,
name:"else if",icon:"",solve:function(n,b){return this._checkCondition(n)?this._solve(n,b):!1},toText:function(){return"\x3cspan class\x3d'text-primary'\x3e"+this.getBlockIcon("E")+this.name+" \x3c/span\x3e\x3cspan class\x3d'text-warning small'\x3e"+(this.condition||"")+"\x3cspan\x3e"},_checkCondition:function(n){return null!==this.condition?n.parseExpression(this.condition):!1},getFields:function(){var n=this,b=this.inherited(arguments)||this.getDefaultFields();b.push(this.utils.createCI("condition",
this.types.ECIType.EXPRESSION_EDITOR,this.condition,{group:"General",title:"Expression",dst:"condition",delegate:{runExpression:function(b,a,g){return n.scope.expressionModel.parse(n.scope,b,!1,a,g)}}}));return b}})})},"xblox/model/logic/SwitchBlock":function(){define(["dcl/dcl","xblox/model/Block","xblox/model/logic/CaseBlock","xblox/model/logic/DefaultBlock","dojo/Deferred"],function(p,r,n,q,b){return p(r,{declaredClass:"xblox.model.logic.SwitchBlock",items:null,name:"Switch",icon:null,toText:function(){return this.getBlockIcon("H")+
this.name+" "},canAdd:function(){return[]},getFields:function(){return this.getDefaultFields(!1,!1)},solve:function(b,a){var g=this._stopped=!1,h=[];this.onSuccess(this,a);for(var f=0;f<this.items.length;f++){var d=this.items[f];if("xblox.model.logic.CaseBlock"===d.declaredClass&&(d=d.solve(b,this,a),0!=d)){g=!0;this.addToEnd(h,d);break}if(this._stopped)break}if(!g)for(f=0;f<this.items.length;f++)d=this.items[f],"xblox.model.logic.CaseBlock"!=d.declaredClass&&this.addToEnd(h,d.solve(b,a));return h},
init:function(){},getChildren:function(b){return this.items},stop:function(){this._stopped=!0},runAction:function(m){var a=m.command;if("New/Case"===a||"New/Default"===m.command){m=this.scope.blockStore;var g=new b,h=null;switch(a){case "New/Case":h=this.add(n,{comparator:"\x3d\x3d",expression:"on",group:null});break;case "New/Default":h=this.add(q,{group:null})}g.resolve({select:[h],focus:!0,append:!1});h.refresh();m._emit("added",{target:h})}},getActions:function(b,a){var g=[this.createAction({label:"New Case",
command:"New/Case",icon:this.getBlockIcon("I"),tab:"Home",group:"File",mixin:{addPermission:!0,custom:!0,quick:!1}})];_.find(this.items,{declaredClass:"xblox.model.logic.DefaultBlock"})||g.push(this.createAction({label:"Default",command:"New/Default",icon:"fa-eject",tab:"Home",group:"File",mixin:{addPermission:!0,custom:!0,quick:!1}}));return g}})})},"xblox/model/logic/DefaultBlock":function(){define(["dcl/dcl","xide/utils","xide/types","xblox/model/Block"],function(p,r,n,q){return p(q,{declaredClass:"xblox.model.logic.DefaultBlock",
name:"Default",icon:"",hasInlineEdits:!1,toText:function(){return'\x26nbsp;\x3cspan class\x3d"fa-eject text-info"\x3e\x3c/span\x3e\x26nbsp;\x26nbsp;\x3cspan\x3e'+this.name+"\x3c/span\x3e"},solve:function(b,m){this.onSuccess(this,m);return this._solve(b,m)},getFields:function(){return this.inherited(arguments)||this.getDefaultFields()}})})},"xblox/model/variables/VariableSwitch":function(){define("dcl/dcl xblox/model/logic/SwitchBlock xide/types xblox/model/logic/CaseBlock xblox/model/logic/DefaultBlock dojo/Deferred".split(" "),
function(p,r,n,q,b,m){return p(r,{declaredClass:"xblox.model.variables.VariableSwitch",name:"Switch on Variable",icon:"",variable:"PowerState",toText:function(){var a=this.scope.getVariableById(this.variable),a=a?a.name:"";return this.getBlockIcon("H")+this.name+" "+a},getFields:function(){var a=this.getDefaultFields(!1,!1);return a=a.concat([this.utils.createCI("Variable",3,this.variable,{group:"General",widget:{store:this.scope.blockStore,labelField:"name",valueField:"id",query:[{group:"basicVariables"},
{group:"processVariables"}]},dst:"variable"})])}})})},"xblox/model/logging/Log":function(){define("dcl/dcl dojo/Deferred xblox/model/Block xide/utils xide/types xide/mixins/EventedMixin".split(" "),function(p,r,n,q,b,m){return p([n,m.dcl],{declaredClass:"xblox.model.logging.Log",name:"Log Message",level:"info",message:'return "Message: " + arguments[0];',_type:"XBlox",host:"this host",sharable:!0,toText:function(){var a="text-primary";switch(this.level){case "info":a="text-info";break;case "warn":a=
"text-warning";break;case "error":a="text-danger"}a=this.getBlockIcon()+" "+this.name+" : \x3cspan class\x3d'"+a+" small'\x3e  :: ";this.message&&(a+=this.message);return a+"\x3c/span\x3e"},_solveExpression:function(a,b,h,f,d){if((a=""+a)&&a.length){a=q.convertAllEscapes(a,"none");var e=this.getArgs();try{var l=b.parseExpression(a,null,null,null,null,this,e);f&&f("Expression "+a+" evaluates to "+l);return l}catch(c){d&&d("invalid expression : \n"+a+": "+c),this.onFailed(this,h)}}else console.error("have no script");
return a},solve:function(a,g,h,f){console.log("-log");var d=new r,e=a.device;a=this._solveExpression(this.message,a,g,h,f);e={message:a,level:this.level,type:this._type,details:this.getArgs(),time:(new Date).getTime(),data:{device:e?e.info:null},write:!0};this.onSuccess(this,g);d.resolve(a);try{this.publish(b.EVENTS.ON_SERVER_LOG_MESSAGE,e)}catch(l){this.onFailed(this,g)}return d},canAdd:function(){return null},getFields:function(){var a=this.inherited(arguments)||this.getDefaultFields(),b=this;a.push(q.createCI("Level",
3,this.level,{group:"General",options:[{value:"info",label:"Info"},{value:"warn",label:"Warning"},{value:"error",label:"Error"},{value:"debug",label:"Debug"},{value:"help",label:"Help"},{value:"verbose",label:"verbose"},{value:"silly",label:"Silly"}],dst:"level"}));a.push(q.createCI("message",25,this.message,{group:"General",title:"Message",dst:"message",delegate:{runExpression:function(a,f,d){b._solveExpression(a,b.scope,null,f,d)}}}));a.push(q.createCI("message",13,this._type,{group:"General",title:"Type",
dst:"_type"}));return a},getBlockIcon:function(){return'\x3cspan class\x3d"fa-bug"\x3e\x3c/span\x3e'}})})},"xblox/model/server/RunServerMethod":function(){define(["dcl/dcl","xblox/model/server/ServerBlock","xide/utils"],function(p,r,n){return p(r,{declaredClass:"xblox.model.server.RunServerMethod",description:"Runs a JSON-RPC-2.0 method on the server",name:"Run Server Method",method:"XShell::run",args:"",deferred:!0,defaultServiceClass:"XShell",defaultServiceMethod:"run",sharable:!0,onMethodChanged:function(p,
b){this.method=p;if(!n.isValidString(this.args)){var m=this.getServerParams();m&&this._updateArgs(m,b)}},_getArgs:function(){var p=n.getJson(this.args||"[]"),b=[];if(p){var m=!1;p&&p[0]&&null!=p[0].optional&&(m=!0);if(m)for(m=0;m<p.length;m++){var a=p[m],g=a.value;-1!=a.name.indexOf("Base64")&&(g=this.getService().base64_encode(g));"notset"!==a.value?-1!=a.value.indexOf("[")&&-1!=a.value.indexOf("]")?(g=this.scope.expressionModel.replaceVariables(this.scope,a.value,!1,!1),-1!=a.name.indexOf("Base64")&&
(g=this.getService().base64_encode(g)),b.push(g)):b.push(g||a["default"]):b.push(a["default"]||g)}}else return[this.args];return b},_updateArgs:function(n,b){var m=this.utils.getCIWidgetByName(b,"args");if(m){var a=JSON.stringify(n);m.editBox.set("value",a);this.args=a}},getServerParams:function(){var n=this.getService().getParameterMap(this.getServiceClass(),this.getServiceMethod());if(n)for(var b=0;b<n.length;b++)n[b].value="notset";return n},onReloaded:function(n){console.log("sdfsd");this._solve()},
_solve:function(n,b,m,a){console.log("solve223")},solve:function(n,b,m,a){this._return=[];this._lastResult=null;n=[];if(!this.isInValidState())return this.onFailed(this,b),n;n=this._getArgs();this.onRun(this,b);this.getService();b=this.scope.serviceObject;console.error("run deferred");(b=b.runDeferred(this.getServiceClass(),this.getServiceMethod(),n))&&b.then(function(a){console.error("returned ",a)});return b},toText:function(){var n=this.getBlockIcon()+" "+this.name+" :: ";this.method&&(n+=this.method.substr(0,
50));return n},canAdd:function(){return[]},getFields:function(){var p=this.inherited(arguments)||this.getDefaultFields(),b=this;p.push(n.createCI("value",25,this.method,{group:"General",title:"Method",dst:"method",description:"This should be in the format : MyServerClass::myMethod",delegate:{runExpression:function(m,a,g){b.method=m;b.solve(b.scope,null,a,g)}}}));return p=p.concat(this.getServerDefaultFields())},getBlockIcon:function(){return'\x3cspan class\x3d"fa-plug"\x3e\x3c/span\x3e'},mayHaveChildren:function(n){return null!=
this.items&&0<this.items.length},getChildren:function(n){return this.items},onChangeField:function(n,b,m){if("method"===n)this.onMethodChanged(b,m)},isInValidState:function(){return null!=this.getService()},getService:function(){var n=this.scope.getService();n||console.error("have no service object");return n},getServiceClass:function(){return this.method.split("::")[0]||this.defaultServiceClass},getServiceMethod:function(){return this.method.split("::")[1]||this.defaultServiceMethod},hasMethod:function(n){return this.isInValidState()&&
null!=this.getService()[this.getServiceClass()]&&null!=this.getService()[this.getServiceClass()][this.getServiceMethod()]},hasServerClass:function(n){return this.isInValidState()&&null!=this.getService()[this.getServiceClass()]},getServerFunction:function(){return this.isInValidState()&&this.getServiceClass()&&this.getServiceMethod()?this.getService()[this.getServiceClass()][this.getServiceMethod()]:null}})})},"xblox/model/server/ServerBlock":function(){define(["dcl/dcl","xblox/model/Block","xide/utils"],
function(p,r,n){return p(r,{declaredClass:"xblox.model.server.ServerBlock",name:"Run Server Block",method:"XShell::run",args:"",deferred:!0,defaultServiceClass:"XShell",defaultServiceMethod:"run",sharable:!0,onReloaded:function(){console.log("1")},solve:function(n,b,m,a){this._currentIndex=0;this._return=[];if((n=""+this.method)&&n.length){var g=new Function("{"+n+"}"),h=this.getArgs();try{var f=g.apply(this,h||{});this._lastResult=f;m&&m("Expression "+n+" evaluates to "+f);if("false"!==f&&!1!==f)this.onSuccess(this,
b);else return this.onFailed(this,b),[]}catch(d){return a&&a("invalid expression : \n"+n+": "+d),this.onFailed(this,b),[]}}else console.error("have no script");m=this[this._getContainer()];if(m.length)this.runFrom(m,0,b);else this.onSuccess(this,b);return[]},toText:function(){var n=this.getBlockIcon()+" "+this.name+" :: ";this.method&&(n+=this.method.substr(0,50));return n},canAdd:function(){return[]},getServerDefaultFields:function(p){p=p||[];p.push(n.createCI("args",27,this.args,{group:"General",
title:"Arguments",dst:"args"}));return p},getFields:function(){return this.inherited(arguments)||this.getDefaultFields()},getBlockIcon:function(){return'\x3cspan class\x3d"fa-plug"\x3e\x3c/span\x3e'},mayHaveChildren:function(n){return null!=this.items&&0<this.items.length},getChildren:function(n){return this.items},isInValidState:function(){return null!=this.getService()},getService:function(){return this.scope.getService()},getServiceClass:function(){return this.method.split("::")[0]||this.defaultServiceClass},
getServiceMethod:function(){return this.method.split("::")[1]||this.defaultServiceMethod},hasMethod:function(n){return this.isInValidState()&&null!=this.getService()[this.getServiceClass()]&&null!=this.getService()[this.getServiceClass()][this.getServiceMethod()]},hasServerClass:function(n){return this.isInValidState()&&null!=this.getService()[this.getServiceClass()]},getServerFunction:function(){return this.isInValidState()&&this.getServiceClass()&&this.getServiceMethod()?this.getService()[this.getServiceClass()][this.getServiceMethod()]:
null}})})},"xblox/model/server/Shell":function(){define(["dcl/dcl","xblox/model/server/ServerBlock","xide/utils","xcf/model/Command"],function(p,r,n,q){return p([q,r],{declaredClass:"xblox.model.server.Shell",description:"Runs a JSON-RPC-2.0 method on the server",name:"Run Shell",method:"",args:"",deferred:!0,defaultServiceClass:"XShell",defaultServiceMethod:"run",sharable:!0,onMethodChanged:function(b,m){this.method=b;if(!n.isValidString(this.args)){var a=this.getServerParams();a&&this._updateArgs(a,
m)}},_getArgs:function(){var b=n.getJson(this.args||"[]"),m=[];if(b){var a=!1;b&&b[0]&&null!=b[0].optional&&(a=!0);if(a)for(a=0;a<b.length;a++){var g=b[a],h=g.value;-1!=g.name.indexOf("Base64")&&(h=this.getService().base64_encode(h));"notset"!==g.value?-1!=g.value.indexOf("[")&&-1!=g.value.indexOf("]")?(h=this.scope.expressionModel.replaceVariables(this.scope,g.value,!1,!1),-1!=g.name.indexOf("Base64")&&(h=this.getService().base64_encode(h)),m.push(h)):m.push(h||g["default"]):m.push(g["default"]||
h)}}else return[this.args];return m},_updateArgs:function(b,m){var a=this.utils.getCIWidgetByName(m,"args");if(a){var g=JSON.stringify(b);a.editBox.set("value",g);this.args=g}},getServerParams:function(){var b=this.getService().getParameterMap(this.getServiceClass(),this.getServiceMethod());if(b)for(var m=0;m<b.length;m++)b[m].value="notset";return b},onReloaded:function(b){console.log("sdfsd");this._solve()},_solve:function(b,m,a,g){console.log("solve223")},solve:function(b,m,a,g,h,f){this._return=
[];this._lastResult=null;this._lastSettings=m||this._lastSettings;m=this.getInstance();console.log("run");b=b.expressionModel.replaceVariables(b,this.method,!1,!1);m.runShell(b,n.mixin({},{}),this.id,this.id,this)},toText:function(){var b=this.getBlockIcon()+" "+this.name+" :: ";this.method&&(b+=this.method.substr(0,50));return b},canAdd:function(){return[]},getFields:function(){var b=this.inherited(arguments)||this.getDefaultFields(),m=this;b.push(n.createCI("value",25,this.method,{group:"General",
title:"Cmd",dst:"method",delegate:{runExpression:function(a,b,h){m.method=a;m.solve(m.scope,null,b,h)}}}));return b},getBlockIcon:function(){return'\x3cspan class\x3d"fa-plug"\x3e\x3c/span\x3e'},mayHaveChildren:function(b){return null!=this.items&&0<this.items.length},getChildren:function(b){return this.items},onChangeField:function(b,m,a){if("method"===b)this.onMethodChanged(m,a)},isInValidState:function(){return null!=this.getService()},getService:function(){var b=this.scope.getService();b||console.error("have no service object");
return b},getServiceClass:function(){return this.method.split("::")[0]||this.defaultServiceClass},getServiceMethod:function(){return this.method.split("::")[1]||this.defaultServiceMethod},hasMethod:function(b){return this.isInValidState()&&null!=this.getService()[this.getServiceClass()]&&null!=this.getService()[this.getServiceClass()][this.getServiceMethod()]},hasServerClass:function(b){return this.isInValidState()&&null!=this.getService()[this.getServiceClass()]},getServerFunction:function(){return this.isInValidState()&&
this.getServiceClass()&&this.getServiceMethod()?this.getService()[this.getServiceClass()][this.getServiceMethod()]:null}})})},"xblox/model/code/RunBlock":function(){define(["dcl/dcl","xblox/model/Block","xide/types","xide/utils"],function(p,r,n,q){return p(r,{declaredClass:"xblox.model.code.RunBlock",name:"Run Block",file:"",method:"",args:"",sharable:!0,block:"",description:"Runs another Block",solve:function(b,m){var a=this.getContext();if(a&&null!=a[this.method]){var g=[],h=a[this.method];try{var f=
this._getArgs(),g=h.apply(a,f||[]);this.onSuccess(this,m);return g}catch(d){console.error("call method failed"),this.onFailed(this,m)}}else this.onFailed(this,m);return[]},toText:function(){var b=this.getBlockIcon()+" "+this.name+" ";this.method&&(b+=this.method.substr(0,20));return b},getFields:function(){var b=this.getDefaultFields();b.push(q.createCI("Block",n.ECIType.BLOCK_REFERENCE,this.block,{toolTip:"Enter  block, you can use also the block's share title",group:"General",dst:"block",value:this.block,
title:"Block",scope:this.scope}));b.push(q.createCI("File",n.ECIType.FILE,this.file,{toolTip:"Leave empty to auto-select this file",group:"General",dst:"file",value:this.file,intermediateChanges:!1,acceptFolders:!1,acceptFiles:!0,encodeFilePath:!1,buildFullPath:!0,filePickerOptions:{dialogTitle:"Select Block File",filePickerMixin:{beanContextName:this.id,persistent:!1,globalPanelMixin:{allowLayoutCookies:!1}},configMixin:{beanContextName:this.id,LAYOUT_PRESET:n.LAYOUT_PRESET.SINGLE,PANEL_OPTIONS:{ALLOW_MAIN_MENU:!1,
ALLOW_NEW_TABS:!0,ALLOW_MULTI_TAB:!1,ALLOW_INFO_VIEW:!0,ALLOW_LOG_VIEW:!1,ALLOW_CONTEXT_MENU:!0,ALLOW_LAYOUT_SELECTOR:!0,ALLOW_SOURCE_SELECTOR:!0,ALLOW_COLUMN_RESIZE:!0,ALLOW_COLUMN_REORDER:!0,ALLOW_COLUMN_HIDE:!0,ALLOW_ACTION_TOOLBAR:!0,ALLOW_BREADCRUMBS:!1}},defaultStoreOptions:{fields:1663,includeList:"xblox",excludeList:"*"},startPath:this.file}}));return b},getBlockIcon:function(){return'\x3cspan class\x3d"el-icon-share-alt"\x3e\x3c/span\x3e'}})})},"xblox/model/events/OnEvent":function(){define("dcl/dcl dojo/_base/lang dojo/Deferred xblox/model/Block xide/utils xide/types xide/mixins/EventedMixin xblox/model/Referenced xide/registry dojo/on xwire/_Base".split(" "),
function(p,r,n,q,b,m,a,g,h,f,d){return p([q,a.dcl,g.dcl,d],{declaredClass:"xblox.model.events.OnEvent",name:"On Event",event:"",reference:"",references:null,sharable:!0,_didSubscribe:!1,filterPath:"item.name",filterValue:"",valuePath:"item.value",_nativeEvents:"onclick ondblclick onmousedown onmouseup onmouseover onmousemove onmouseout onkeypress onkeydown onkeyup onfocus onblur onchange".split(" "),stop:function(){this._destroy()},solve:function(a,b,c,d){c&&this._destroy();b=this._lastSettings=b||
this._lastSettings;if(!this._didSubscribe)return this._registerEvent(this.event),this.onSuccess(this,b),!1;this.onSuccess(this,b);this._currentIndex=0;this._return=[];a=this[this._getContainer()];if(a.length)return a=this.runFrom(a,0,b),this.onSuccess(this,b),a;this.onSuccess(this,b);return[]},toText:function(){var a=this.getBlockIcon()+" "+this.name+" :: ";this.event&&(a+=this.event);return a},canAdd:function(){return[]},getFields:function(){var a=this.inherited(arguments)||this.getDefaultFields();
this.deserialize(this.reference);var d=null;if(-1<b.contains(this._nativeEvents,this.event))for(var d=[{label:"onclick",value:"onclick"},{label:"ondblclick",value:"ondblclick"},{label:"onmousedown",value:"onmousedown"},{label:"onmouseup",value:"onmouseup"},{label:"onmouseover",value:"onmouseover"},{label:"onmousemove",value:"onmousemove"},{label:"onmouseout",value:"onmouseout"},{label:"onkeypress",value:"onkeypress"},{label:"onkeydown",value:"onkeydown"},{label:"onkeyup",value:"onkeyup"},{label:"onfocus",
value:"onfocus"},{label:"onblur",value:"onblur"},{label:"onchange",value:"onchange"}],c=0;c<d.length;c++){var f=d[c];if(f.value===this.event){f.selected=!0;break}}else d=this.scope.getEventsAsOptions(this.event);a.push(b.createCI("Event",m.ECIType.ENUMERATION,this.event,{group:"General",options:d,dst:"event",widget:{search:!0}}));a.push(b.createCI("Filter Path",13,this.filterPath,{group:"General",dst:"filterPath"}));a.push(b.createCI("Filter Value",13,this.filterValue,{group:"General",dst:"filterValue"}));
a.push(b.createCI("Value Path",13,this.valuePath,{group:"General",dst:"valuePath"}));a.push(b.createCI("Object/Widget",m.ECIType.WIDGET_REFERENCE,this.reference,{group:"Widget",dst:"reference",value:this.reference}));return a},getBlockIcon:function(){return'\x3cspan class\x3d"fa-bell"\x3e\x3c/span\x3e'},onEvent:function(a){this._lastResult=a;if(this.filterPath&&this.filterValue){var b=this.getValue(a,this.filterPath);if(b&&this.filterValue!==b)return}b=null;this.valuePath&&(this._lastSettings||(this._lastSettings=
{}),b=this.getValue(a,this.valuePath),null!==b&&(!this._lastSettings.override&&(this._lastSettings.override={}),this._lastSettings.override.args=[b]));this.solve(this.scope,this._lastSettings)},_subscribe:function(a,d,c){if(a)if(-1==b.contains(this._nativeEvents,a))this.__events&&this.__events[a]&&(c=this.__events[a],_.each(c,function(a){this.unsubscribe(a.type,a.handler);a.remove()},this),_.each(c,function(b){this.__events[a].remove(b)},this)),this.subscribe(a,this.onEvent);else if(c){d=a.replace("on",
"");var g=this;c=f(c,d,function(a){g.onEvent(a)});console.log("wire native event : "+d);this._events.push(c)}},_registerEvent:function(a){try{if(!a||!a.length)return;console.log("register event : "+a+" for "+this.reference);var b=this.resolveReference(this.deserialize(this.reference)),c=this;if(b&&b.length){for(var d=0;d<b.length;d++){var f=b[d];if(f&&f.id){var g=h.byId(f.id);if(g&&g.on){var m=this.event.replace("on","");console.log("found widget : "+f.id+" will register event "+m);var n=g.on(m,r.hitch(this,
function(a){console.log("event triggered : "+c.event);c.onEvent(a)}));this._events.push(n)}else this._subscribe(a,this.onEvent,f)}else this._subscribe(a,this.onEvent,f)}console.log("objects found : ",b)}else this._subscribe(a,this.onEvent)}catch(p){logError(p,"registering event failed")}this._didSubscribe=a},onLoad:function(){this._onLoaded=!0;this.event&&this.event.length&&this.enabled&&this._registerEvent(this.event)},updateEventSelector:function(a,b){var c=[];if(a&&a.length)for(var c=[{label:"onclick",
value:"onclick"},{label:"ondblclick",value:"ondblclick"},{label:"onmousedown",value:"onmousedown"},{label:"onmouseup",value:"onmouseup"},{label:"onmouseover",value:"onmouseover"},{label:"onmousemove",value:"onmousemove"},{label:"onmouseout",value:"onmouseout"},{label:"onkeypress",value:"onkeypress"},{label:"onkeydown",value:"onkeydown"},{label:"onkeyup",value:"onkeyup"},{label:"onfocus",value:"onfocus"},{label:"onblur",value:"onblur"},{label:"onchange",value:"onchange"}],d=0;d<c.length;d++){var f=
c[d];if(f.value===this.event){f.selected=!0;break}}else c=this.scope.getEventsAsOptions(this.event);for(d=0;d<b.length;d++)if(f=b[d],f.widget&&"Event"===f.widget.title){d=f._widget;d.nativeWidget.set("options",c);d.nativeWidget.reset();d.nativeWidget.set("value",this.event);this.publish(m.EVENTS.RESIZE,{});break}},onReferenceChanged:function(a,b){this._destroy();this.reference=a;var c=this.resolveReference(this.deserialize(a));this.updateEventSelector(c,b);this._registerEvent(this.event)},onChangeField:function(a,
b,c){"event"==a&&(this._destroy(),this._onLoaded&&(this.event=b,this._registerEvent(b)));if("reference"==a)this.onReferenceChanged(b,c);this.inherited(arguments)},activate:function(){this._destroy();this._registerEvent(this.event)},deactivate:function(){this._destroy()},_destroy:function(){this._events||(this._events=[]);_.each(this._events,dojo.unsubscribe);this.unsubscribe(this.event,this.onEvent);this._lastResult=null;this._didSubscribe=!1}})})},"xblox/model/Referenced":function(){define(["dcl/dcl",
"dojo/_base/declare","xide/mixins/ReferenceMixin"],function(p,r,n){var q={reference:null,deserialize:function(b){if(!b||0==b.length)return{};try{return dojo.fromJson(b)}catch(m){return{}}}};r=r("xblox.model.Referenced",[n],q);r.dcl=p(n.dcl,q);return r})},"xide/mixins/ReferenceMixin":function(){define(["dcl/dcl","dojo/_base/declare","xide/types","xide/utils","xide/registry"],function(p,r,n,q,b){function m(a,b){var f=a.document.getElementById(b);return f?f:null}q.find=function(a,b,f){return(a=$(b).find(a))&&
0<a.length?!1===f?a:a[0]:null};var a={_targetReference:null,getTarget:function(){return this._targetReference||this.inherited(arguments)},skipWidgetCSSClasses:"dijitButtonHover dijitHover dijit dijitInline dijitReset dijitCheckBoxChecked dijitChecked dijitLeft".split(" "),_cssClassesToQuery:function(a){var b="";if(a){a=a.split(" ");for(var f=0;f<a.length;f++)-1<q.contains(this.skipWidgetCSSClasses,a[f])||-1<a[f].toLowerCase().indexOf("hover")||(b+=""+a[f])}return b.trim()},resolveReference:function(a,
h){var f=null;try{f=this.getTarget()}catch(d){return logError(d),null}var e=this.scope,l=a.reference;if(!(a&&l&&l.length)&&f)return[f];switch(a.mode){case n.WIDGET_REFERENCE_MODE.BY_ID:if(this.scope&&this.scope.document){f=[];if(-1!==l.indexOf(" "))for(var l=l.split(" "),c=0;c<l.length;c++){var k=m(e,l[c]);k&&f.push(k)}else return[m(e,l)];return f}e=b.byId(l);f="undefined"!==typeof document?document.getElementById(l):null;if(e||f)return e?[e]:[f];break;case n.WIDGET_REFERENCE_MODE.BY_CLASS:if(e=dojo.getObject(l)||
p.getObject(l))return[e];break;case n.WIDGET_REFERENCE_MODE.BY_CSS:e=this._cssClassesToQuery(l);this._parseString&&(e=this._parseString(e,h,null,h&&h.flags?h.flags:n.CIFLAG.EXPRESSION)||e);f=null;this.scope&&this.scope.global&&this.scope.global.$?f=this.scope.global.$:"undefined"!==typeof $&&(f=$);if(f&&(f=f(e)))return f;if(e=q.find(e,null,!1))return e}return null}};r=r("xblox.model.ReferenceMixin",null,a);r.dcl=p(null,a);return r})},"xwire/_Base":function(){define(["dcl/dcl","xide/mixins/EventedMixin"],
function(p,r){function n(b,m){for(var a=q(m),g=0,h=a.length;g<h;++g){var f=a[g];b=null==b?b:b[f]}return b}function q(b,m){return""===b?[]:"function"!==typeof b.splice?b.split("."):m?b.slice():b}return p([r.dcl],{declaredClass:"xwire._Base",constructor:function(b){for(var m in b)b.hasOwnProperty(m)&&(this[m]=b[m])},getValue:function(b,m){return n(b,m)},setValue:function(b,m,a){var g=q(m,!0),h=g.pop();b=0<g.length?n(b,g):b;return Object(b)===b&&m?"function"===typeof b.set?b.set(h,a):b[h]=a:void 0}})})},
"xblox/model/events/OnKey":function(){define("dcl/dcl dojo/_base/lang dojo/_base/array dojo/Deferred xblox/model/Block xide/utils xide/types xide/mixins/EventedMixin xblox/model/Referenced xblox/model/Contains xblox/model/events/OnEvent xide/registry dojo/on".split(" "),function(p,r,n,q,b,m,a,g,h,f,d,e,l){return p([b,g.dcl,h.dcl,f],{declaredClass:"xblox.model.events.OnKey",name:"On Key",event:"",reference:"",references:null,description:"Triggers when a keyboard sequence "+this.event+" has been entered",
listeners:null,sharable:!0,toText:function(){var a=this.getBlockIcon()+" "+this.name+" :: ";this.event&&(a+=this.event);return a},canAdd:function(){return[]},getFields:function(){var b=this.inherited(arguments)||this.getDefaultFields();b.push(m.createCI("Keyboard Sequence",a.ECIType.STRING,this.event,{group:"General",dst:"event",value:this.event,intermediateChanges:!1}));b.push(m.createCI("Object/Widget",a.ECIType.WIDGET_REFERENCE,this.reference,{group:"General",dst:"reference",value:this.reference}));
return b},getBlockIcon:function(){return'\x3cspan class\x3d"fa-keyboard-o"\x3e\x3c/span\x3e'},onEvent:function(a){this._lastResult=a;this.solve(this.scope,this._lastRunSettings)},_addListerner:function(a,b,d){null==this.listeners&&(this.listeners=[]);var e=null,e=new window.keypress.Listener(d,{is_unordered:!0,prevent_repeat:!1,prevent_default:!1,on_keyup:function(a){console.log("up")},on_keydown:function(a){console.log("down")},on_release:function(a){console.log("release")}});e.simple_combo(a,function(a){b&&
b(arguments)});this.listeners.push(e)},_subscribe:function(a,b,d){a&&(d&&d.domNode&&(d=d.domNode),this._addListerner(a,b,d))},_registerEvent:function(a){if(a&&a.length){var b=this.resolveReference(this.deserialize(this.reference)),d=this;if(b&&b.length)for(var f=0;f<b.length;f++){var g=b[f];if(g&&g.id){var h=e.byId(g.id);h=null,this._subscribe(a,function(){d.onEvent(arguments)},g)}else this._subscribe(a,function(){d.onEvent(arguments)},g)}else this._subscribe(a,function(){d.onEvent(arguments)})}},
onLoad:function(){this._onLoaded=!0;this.event&&this.event.length&&this.enabled&&this._registerEvent(this.event)},destroy:function(){this.inherited(arguments)},updateEventSelector:function(b,d){var e=[];if(b&&b.length)for(var e=[{label:"onclick",value:"onclick"},{label:"ondblclick",value:"ondblclick"},{label:"onmousedown",value:"onmousedown"},{label:"onmouseup",value:"onmouseup"},{label:"onmouseover",value:"onmouseover"},{label:"onmousemove",value:"onmousemove"},{label:"onmouseout",value:"onmouseout"},
{label:"onkeypress",value:"onkeypress"},{label:"onkeydown",value:"onkeydown"},{label:"onkeyup",value:"onkeyup"},{label:"onfocus",value:"onfocus"},{label:"onblur",value:"onblur"},{label:"onchange",value:"onchange"}],f=0;f<e.length;f++){var g=e[f];if(g.value===this.event){g.selected=!0;break}}else e=this.scope.getEventsAsOptions(this.event);for(f=0;f<d.length;f++)if(g=d[f],g.widget&&"Event"===g.widget.title){f=g._widget;f.nativeWidget.set("options",e);f.nativeWidget.reset();f.nativeWidget.set("value",
this.event);this.publish(a.EVENTS.RESIZE,{});break}},onReferenceChanged:function(a,b){this._destroy();this.reference=a;this.resolveReference(this.deserialize(a));this._registerEvent(this.event)},onChangeField:function(a,b,d){"event"==a&&(this._destroy(),this._onLoaded&&(this.event=b,this._registerEvent(b)));if("reference"==a)this.onReferenceChanged(b,d);this.inherited(arguments)},activate:function(){this._destroy();this._registerEvent(this.event)},deactivate:function(){this._destroy()},_destroy:function(){if(this.listeners)for(var a=
0;a<this.listeners.length;a++){var b=this.listeners[a];b.stop_listening();var d=b.get_registered_combos();d&&b.unregister_many(d);b.reset();console.log("did destroy listener")}this.listeners=[]},onFieldsRendered:function(a,b){}})})},"xblox/model/mqtt/Subscribe":function(){define("dcl/dcl xdojo/has dojo/Deferred xblox/model/Block xide/utils xblox/model/Contains xide/types".split(" "),function(p,r,n,q,b,m,a,g,h){r="undefined"!==typeof window?window.console:global.console;g&&r&&r.error&&(r=h);return p([q,
m],{declaredClass:"xblox.model.mqtt.Subscribe",name:"Subscribe",topic:"Topic",args:"",deferred:!1,sharable:!0,context:null,icon:"fa-bell",path:"",qos:0,stop:function(){var a=this.getInstance();a&&a.callMethod("unSubscribeTopic",b.mixin({topic:this.topic},b.getJson(this.args)),this.id,this.id)},onData:function(a){if(a&&a.topic&&a.topic==this.topic){delete a.src;delete a.id;this.getContext();var d=this[this._getContainer()],e=this._lastSettings,g=[];if(0<d.length){var d=a,c=this.path&&this.path.length?
this.path:null!==a.payload?"payload":null;c&&_.isObject(a)&&(d=b.getAt(a,c,a));for(a=0;a<this.items.length;a++)c=this.items[a],c.enabled&&(c.override={args:[d]},g.push(c.solve(this.scope,e)))}this.onSuccess(this,this._lastSettings);return g}},observed:["topic"],getContext:function(){return this.context||(this.scope.getContext?this.scope.getContext():this)},solve:function(a,d,e,g,c,k){this._currentIndex=0;this._return=[];this._lastSettings=d;(a=this.getInstance())&&a.callMethod("subscribeTopic",b.mixin({topic:this.topic,
qos:this.qos},b.getJson(this.args||"{}")),this.id,this.id);d=d||{};this.onRunThis(d)},toText:function(){var a='\x3cspan style\x3d""\x3e'+this.getBlockIcon()+""+this.makeEditable("topic","bottom","text","Enter a topic","inline")+" :: \x3c/span\x3e";this.topic&&(a+=this.topic.substr(0,30));return a},canAdd:function(){return[]},getFields:function(){var f=this.inherited(arguments)||this.getDefaultFields();f.push(b.createCI("name",13,this.name,{group:"General",title:"Name",dst:"name"}));f.push(b.createCI("arguments",
27,this.args,{group:"Arguments",title:"Arguments",dst:"args"}));f.push(b.createCI("topic",a.ECIType.STRING,this.topic,{group:"General",title:"Topic",dst:"topic",select:!0}));f.push(b.createCI("name",a.ECIType.ENUMERATION,this.qos,{group:"General",title:"QOS",dst:"qos",widget:{options:[{label:"0 - at most once",value:0},{label:"1 - at least once",value:1},{label:"2 - exactly once",value:2}]}}));f.push(b.createCI("path",a.ECIType.STRING,this.path,{group:"General",title:"Value Path",dst:"path"}));return f}})})},
"xblox/model/mqtt/Publish":function(){define("dcl/dcl xdojo/has dojo/Deferred xblox/model/Block xide/utils xblox/model/Contains xide/types xcf/model/Command".split(" "),function(p,r,n,q,b,m,a,g,h,f){r="undefined"!==typeof window?window.console:global.console;h&&r&&r.error&&(r=f);return p(g,{declaredClass:"xblox.model.mqtt.Publish",name:"Publish",topic:"",args:"",deferred:!1,sharable:!0,context:null,icon:"fa-send",isCommand:!0,qos:0,retain:!1,path:null,onData:function(a){if(a&&a.topic&&a.topic==this.topic){this.getContext();
var e=this[this._getContainer()],f=this._lastSettings,c=[];if(0<e.length)for(e=a,(this.path="value",_.isObject(a))&&(e=b.getAt(a,this.path,a)),a=0;a<this.items.length;a++){var g=this.items[a];g.enabled&&(g.override={args:[e]},c.push(g.solve(this.scope,f)))}this.onSuccess(this,this._lastSettings);return c}},observed:["topic"],getContext:function(){return this.context||(this.scope.getContext?this.scope.getContext():this)},solve:function(a,e,f,c,g,h){this._currentIndex=0;this._return=[];e=this._lastSettings=
e||this._lastSettings;c=this.getInstance();1==f&&this._loop&&this.reset();f=this.args;g=this.getArgs(e);g[0]&&(f=g[0]);c&&(f=b.getJson(f,!0,!1),null!==f&&0!==f&&!0!==f&&!1!==f&&_.isObject(f)||(f={payload:this.args}),a=a.expressionModel.replaceVariables(a,this.topic,!1,!1),c.callMethod("publishTopic",b.mixin({topic:a,qos:this.qos,retain:this.retain},f),this.id,this.id));e=e||{};this.onDidRun();this.onSuccess(this,e);return!0},toText:function(a,b,f,c){a='\x3cspan style\x3d""\x3e'+this.getBlockIcon()+
" "+this.makeEditable("name","top","text","Enter a name","inline")+" :: \x3c/span\x3e";this.topic&&(a+=this.makeEditable("topic","bottom","text","Enter a topic","inline"),this.startup&&(a+=this.getIcon("fa-bell inline-icon text-warning","text-align:right;float:right;","")),0<this.interval&&(a+=this.getIcon("fa-clock-o inline-icon text-warning","text-align:right;float:right","")));return a},canAdd:function(){return[]},getFields:function(){var d=this.inherited(arguments)||this.getDefaultFields();d.push(b.createCI("qos",
a.ECIType.ENUMERATION,this.qos,{group:"General",title:"QOS",dst:"qos",widget:{options:[{label:"0 - at most once",value:0},{label:"1 - at least once",value:1},{label:"2 - exactly once",value:2}]}}));d.push(b.createCI("arguments",27,this.args,{group:"Arguments",title:"Arguments",dst:"args"}));d.push(b.createCI("topic",a.ECIType.STRING,this.topic,{group:"General",title:"Topic",dst:"topic",select:!0}));d.push(b.createCI("retain",a.ECIType.BOOL,this.retain,{group:"General",title:"Retain",dst:"retain"}));
d.remove(_.find(d,{name:"send"}));d.remove(_.find(d,{name:"waitForResponse"}));return d}})})},"xblox/model/File/ReadJSON":function(){define("dcl/dcl xdojo/has dojo/Deferred xblox/model/Block xide/utils xblox/model/Contains dojo/promise/all xide/types module xdojo/has!xblox-ui?xfile/data/DriverStore xdojo/has!xblox-ui?xfile/views/FileGridLight".split(" "),function(p,r,n,q,b,m,a,g,h,f,d){r("electronx");r("xcf-ui");r("php");return p([q,m],{declaredClass:"xblox.model.File.ReadJSON",name:"Read JSON",deferred:!1,
sharable:!1,context:null,icon:"fa-file",observed:["path"],getContext:function(){return this.context||(this.scope.getContext?this.scope.getContext():this)},getFileContent:function(a){new n;var b=this.getScope().ctx;b.getFileManager();(b=b.getDeviceManager().getInstanceByName("File-Server"))||console.error("ReadJSON : have no file server driver");return b.callCommand("GetProg",{override:{args:[a]}})},processJSON:function(a,d){var c=this.jsonPath;this._lastResult=c?b.getAt(a,c):a;this.onSuccess(this,
d);this.runByType(g.BLOCK_OUTLET.FINISH,d)},solve:function(a,d,c,f,g){this._currentIndex=0;this._return=[];d=this._lastSettings=d||this._lastSettings||{};c=""+this._get("path");this.getContext();this._getContainer();var h=new n,m=this;this.onRunThis(d);a=a.expressionModel.replaceVariables(a,c,null,null);console.log("path "+a);this.getFileContent(a).then(function(a){(a=a.content)&&(a=b.getJson(a,!0))&&m.processJSON(a,d)});this.getArgs(d);try{f&&f("Expression "+c+" evaluates to "+a)}catch(p){p=p||{},
this.onDidRunItemError(h,p,d),this.onFailed(this,d),g&&g("invalid expression : \n"+c+": "+p)}return h},toText:function(){var a='\x3cspan style\x3d""\x3e'+this.getBlockIcon()+" "+this.name+" :: \x3c/span\x3e";this.path&&(a+=this.path.substr(0,50));return a},canAdd:function(){return[]},getFields:function(){var a=this.inherited(arguments)||this.getDefaultFields(),h=this.getScope().ctx,c=h.getDeviceManager().getInstanceByName("File-Server"),k=b.clone(g.DEFAULT_FILE_GRID_PERMISSIONS),h={ctx:h,owner:this,
selection:"/",resizeToParent:!0,Module:d,permissions:k};if(c&&f){var k=function(a){return new f({data:[],config:m,mount:"none",options:n,driver:c,micromatch:"(*.json)|!(*.*)",glob:a})},m={},n={fields:g.FIELDS.SHOW_ISDIR|g.FIELDS.SHOW_OWNER|g.FIELDS.SHOW_SIZE|g.FIELDS.SHOW_FOLDER_SIZE|g.FIELDS.SHOW_MIME|g.FIELDS.SHOW_PERMISSIONS|g.FIELDS.SHOW_TIME|g.FIELDS.SHOW_MEDIA_INFO};h.leftStore=k("/*");h.rightStore=k("/*")}a.push(b.createCI("path",4,this.path,{group:"General",title:"Path",dst:"path",filePickerOptions:h,
widget:{item:this}}));a.push(b.createCI("jsonPath",13,this.jsonPath,{group:"General",title:"Select",dst:"jsonPath"}));return a}})})},"xcf/factory/Blocks":function(){define("xblox/factory/Blocks xcf/model/Command xblox/model/functions/CallBlock xblox/model/functions/StopBlock xblox/model/functions/PauseBlock xide/factory".split(" "),function(p,r,n,q,b,m){return p?(p._getCommandBlocks=function(a,g,h,f){var d=[];d.push({name:"Commands",iconClass:"el-icon-random",items:[{name:"Call Command",owner:g,iconClass:"el-icon-video",
proto:n,target:h,ctrArgs:{scope:a,group:f,condition:""}},{name:"Stop Command",owner:g,iconClass:"el-icon-video",proto:q,target:h,ctrArgs:{scope:a,group:f,condition:""}},{name:"Pause Command",owner:g,iconClass:"el-icon-video",proto:b,target:h,ctrArgs:{scope:a,group:f,condition:""}},{name:"New Command",owner:g,iconClass:"el-icon-video",proto:r,target:h,ctrArgs:{scope:a,group:f,condition:"",name:"No-Title"}}]});return d},p):m})},"nxappmain/main_export":function(){require("dojo/node!path dojo/node!fs dojo/node!util dojo/node!vm nxapp/Commons nxapp/Logger nxapp/utils/_console xide/utils nxappmain/nxAppExport nxapp/manager/ExportManager nxapp/model/ExportOptions xide/types require".split(" "),
function(p,r,n,q,b,m,a,g,h,f,d,e,l){p=new h({commander:null});p.init();p=p.profile;a.log("export "+p.user+" and system data:  "+p.system);new d(p);(new f).initWithOptions(p)})},"nxapp/Logger":function(){define(["dcl/dcl","xide/types","xide/factory","dojo/node!winston","nxapp/utils/_console"],function(p,r,n,q,b){return p(null,{declaredClass:"nxapp.Logger",fileLogger:null,loggly:null,delegate:null,publishLog:!1,loggers:{},constructor:function(b){for(var a in arguments)arguments.hasOwnProperty(a)&&(this[a]=
b[a])},createLogger:function(b){var a=new q.Logger({transports:[new q.transports.File(b)]});if(this.publishLog)a.on("logging",function(a,h,f,d){d.logId=b.filename;a={level:h,message:f,data:d,time:(new Date).getTime()};n.publish(r.EVENTS.ON_SERVER_LOG_MESSAGE,a)});return a},log:function(){return this.logger.log.apply(this.logger,arguments)},verbose:function(){return this.logger.verbose.apply(this.logger,arguments)},info:function(){return this.logger.info.apply(this.logger,arguments)},start:function(b){this.loggers=
{};this.options=b;this.logger=new q.Logger({transports:[new q.transports.Console({level:"debug"})]});this.logger.transports.console.level="debug";this.logger.on("logging",function(a,b,h,f){})}})})},"nxappmain/nxAppExport":function(){define("dcl/dcl nxapp/utils/FileUtils dojo/node!commander dojo/node!fs dojo/node!os dojo/node!path xide/factory/Events dojo/has xide/model/Base xide/utils nxappmain/nxAppBase".split(" "),function(p,r,n,q,b,m,a,g,h,f,d){g.add("windows",function(){return"win32"===b.platform()});
g.add("osx",function(){return"darwin"===b.platform()});g.add("linux",function(){return"linux"===b.platform()});g.add("arm",function(){return"arm"===b.arch()});return p(d,{declaredClass:"nxappmain.nxAppExport",profilePath:"/nxappmain/profile_device_server.json",init:function(){this.commander||(n.version("0.0.1").option("-f, --file \x3cpath\x3e","run a file").option("-r, --root \x3cpath\x3e","root path to Control-Freak").option("-u, --user \x3cpath\x3e","user directory").option("-t, --target \x3cpath\x3e",
"target directory").option("-s, --system \x3cname\x3e","path to system scope location").option("-d, --dist \x3cpath\x3e","path to the pre-compiled NodeJS servers").option("--windows \x3cboolean\x3e","true/false to export windows NodeJS server").option("--osx \x3cboolean\x3e","true/false to export OSX NodeJS server").option("--linux32 \x3cboolean\x3e","true/false to export Linux-32 Bit NodeJS server").option("--linux64 \x3cboolean\x3e","true/false to export Linux-64 NodeJS server").option("--arm \x3cboolean\x3e",
"true/false to export ARM-v7 NodeJS server").option("--client \x3cstring\x3e","path to client root"),this.commander=n,this.commander.allowUnknownOption(!0),this.commander.parse(process.argv));if(n.jhelp){var a=[];n.options.map(function(b){a.push(b)});console.log(JSON.stringify(a));process.exit()}this.profile=this.getProfile(this.profilePath);n.root||(this.profile.root=r.resolve("../.."));n.target||(this.profile.target=r.resolve("../../myapp"));f.mixin(this.profile,this.commander);var b=m.resolve(this.profile.system);
q.existsSync(b)?this.profile.system=b:(b=process.cwd()+"/data/system",this.profile.system=b,n.system=b)}})})},"nxapp/model/ExportOptions":function(){define(["dcl/dcl","xide/model/Base","xide/mixins/EventedMixin","xide/encoding/MD5","xide/utils"],function(p,r,n,q,b){return p([r.dcl,n.dcl],{connected:!1,__registered:!1,declaredClass:"nxapp/model/ExportOptions",toString:function(){var b=this.options;return b.deviceScope+"://"+b.host+":"+b.port+"@"+b.protocol},constructor:function(b){this.options=b}})})},
"nxappmain/main_server":function(){require("dojo/node!readline nxapp/Commons xide/types nxapp/utils/TCPUtils nxappmain/nxAppBase nxapp/manager/DeviceServerContext nxapp/client/WebSocket xlog/Server dojo/node!winston dojo/node!path dojo/node!fs dojo/node!util dojo/node!vm nxapp/manager/MQTTManager nxapp/Commons nxapp/utils/FileUtils nxapp/Logger nxapp/utils/_console require".split(" "),function(p,r,n,q,b,m,a,g,h,f,d,e,l,c,k,t,v,A,E){global.dojoRequire=E;r={filename:"all.log",dirname:dojoConfig.logRoot,
json:!0};var x=new g({});x.start({fileLogger:r,console:null});var w=new b({commander:null}),C,y,z;w.init();var D=w.profile;b=w.commander;if(b.file){console.log("run js file : "+b.file);f=f.resolve(b.file);if(d.existsSync(f)){m=new l.createContext({require:E.nodeRequire,commander:b,console:console,process:process,setTimeout:setTimeout,global:global});t=t.readFile(f);(new l.Script(t)).runInContext(m);return}console.error("file specified but doesnt exists "+b.file)}b.port&&(D.socket_server.port=b.port);
b.host&&(D.socket_server.host=b.host);if(w.commander.info)console.log(JSON.stringify({host:"http://"+w.profile.socket_server.host,port:w.profile.socket_server.port})),process.exit();else{var u=new m;u.profile=D;u.constructManagers();u.initManagers(D);u.logManager=x;var F=new c({ctx:u,profile:D});F.init(D);u.connectionManager.mqttManager=F;u.mqttManager=F;var G=null,B=function(){var b=new a;b.init({options:{host:"http://"+w.profile.socket_server.host,port:w.profile.socket_server.port,debug:w.profile.debug}});
b.connect();b.onSignal(n.SIGNAL_RESPONSE,function(a){D.common.stdout&&process.stdout.write(a+"\n");w.commander.oneshot&&w.commander.command&&process.exit()});return b},H=function(){w.commander.host&&(C=w.commander.host);w.commander.port&&(y=parseInt(w.commander.port));w.commander.protocol&&(z=w.commander.protocol);if(w.commander.driver){console.error("run in driver mode");var a=B(),b={driver:"xcf/driver/SubTest",host:"192.168.1.20",port:23,protocol:"tcp"},c=n.SOCKET_SERVER_COMMANDS.SIGNAL_MANAGER;
b.manager_command=n.SOCKET_SERVER_COMMANDS.START_DRIVER;c=n.SOCKET_SERVER_COMMANDS.SIGNAL_MANAGER;a.emit(c,b)}else if(w.commander.send){console.error("sending command");console.error("  create web socket client to control server : http://"+w.profile.socket_server.host+":"+w.profile.socket_server.port);var a=B(),d=function(b){if(null!==a&&null!=b){var c={command:b,host:C,port:y,protocol:z},d=n.SOCKET_SERVER_COMMANDS.SIGNAL_DEVICE;"startDriver"==b?(c.manager_command=n.SOCKET_SERVER_COMMANDS.MANAGER_START_DRIVER,
d=n.SOCKET_SERVER_COMMANDS.SIGNAL_MANAGER):"status"==b?(c.manager_command=n.SOCKET_SERVER_COMMANDS.MANAGER_STATUS,d=n.SOCKET_SERVER_COMMANDS.SIGNAL_MANAGER):"closeall"==b?(c.manager_command=n.SOCKET_SERVER_COMMANDS.MANAGER_CLOSE_ALL,d=n.SOCKET_SERVER_COMMANDS.SIGNAL_MANAGER):c.device_command=n.SOCKET_SERVER_COMMANDS.DEVICE_SEND;a.emit(d,c)}},b=function(b){if(null!==a&&null!=b)if(b.indexOf&&-1!=b.indexOf(";")){b=b.split(";");for(var c=0;c<b.length;c++)d(b[c])}else d(b)};p.createInterface({input:process.stdin,
output:process.stdout}).on("line",function(a){null!=a&&0<a.length&&(console.log("sending stdin : "+a),d(a))});"string"==typeof w.commander.command&&b(w.commander.command);console.error("Send command. ^C to close connection and quit")}};if(D.common.createSocketServer)q.checkPort(D.socket_server.port,D.socket_server.host,function(a,b,c,d){a=!1;"closed"==b?(console.log("have no device server yet, creating a new one \x3d "+c+":"+d),u.deviceServer||(G=q.createDeviceServer(D,u),u.deviceServer=G,u.logger=
h,u.deviceServer.logger=h,u.logManager=x,G.mqttManager=F,a=!0)):"open"==b&&(a=!0);a&&H()});else try{H()}catch(I){console.error("app crash!")}}})},"nxapp/manager/MQTTManager":function(){define("dcl/dcl nxapp/manager/ManagerBase nxapp/utils/_LogMixin nxapp/types/Types dojo/node!mosca dojo/node!mqtt dojo/node!node-notifier dojo/node!colors xide/utils nxapp/utils/_console".split(" "),function(p,r,n,q,b,m,a,g,h,f){return p([r,n],{declaredClass:"nxapp.manager.MQTTManager",options:null,profile:null,lastUpTime:null,
mqttClients:null,publishTopic:function(a,b){var f={topic:a,payload:JSON.stringify(b),qos:1};this.server.publish(f,function(){})},createMQTTClient2:function(a,b,g){var c=a+":"+b,h=m.connect("mqtt://localhost",{clean:!1,clientId:c}),n=this.ctx;f.log("create mqtt - client for "+c);h.on("connect",function(){f.log("on connected local mqtt client for "+c)});h.on("message",function(c,f){n.getDeviceServer().broadCastMessage(q.EVENTS.ON_MQTT_MESSAGE,{host:a,port:b,topic:c,message:f.toString(),mqtt:g})});return h},
createMQTTClient:function(a,b,f){a=a+":"+b;if(this.mqttClients[a])return this.mqttClients[a];if(!this.mqttClients[a])return b=m.connect("mqtt://localhost",{clean:!1,clientId:a}),b.on("connect",function(){}),this.mqttClients[a]=b},onConnectedToDevice:function(a,b,f){},onWakeup:function(){this.lastUpTime=(new Date).getTime();for(var a=0;a<this.pool.length;a++){var b=this.pool[a];b.socket&&b.socket.close&&b.socket.close();b.socket&&b.socket._socket&&b.socket._socket.close&&b.socket._socket.close()}this.pool=
[]},init:function(d){function e(){if(!l.__started){l.__started=!0;try{a.notify({title:"Control-Freak",message:"All servers up and running, you can start now Control-Freak IDE",sound:!0,wait:!0,open:"file:///"},function(a,b){})}catch(b){}f.log(g.green("\n\r\t Device server up and running\n\r \t ***********   You can start Control Freak now  **************\n\r"));l.ctx.onReady()}}this.profile=d;this.lastUpTime=(new Date).getTime();var l=this;this.mqttClients={};d={type:"mongo",url:"mongodb://localhost:27017/mqtt",
pubsubCollection:"xcf",mongo:{}};h.mixin(d,this.profile.ascoltatore);d={port:1883,backend:d,persistence:{factory:b.persistence.Mongo,url:"mongodb://localhost:27017/mqtt"}};this.profile.mosca.port&&(this.profile.mosca.port=parseInt(this.profile.mosca.port));h.mixin(d,this.profile.mosca);if("false"===this.profile.mqtt)f.warn("MQTT is disabled, proceed without"),this.server={},e();else try{var c=new b.Server(d);c.on("error",function(a){f.error("Unable to connect to Mongo:"+a.message);e()});c.on("ready",
e);c.on("clientConnected",function(){});c.on("clientDisconnected",function(){});l.server=c}catch(k){f.error("error starting mosca ",k)}},onTimeout:function(a){},onClose:function(a){this.removeConnection(a)},onDrain:function(a){},onError:function(a,b){},onData:function(a,b){throw Error();},onConnect:function(a,b,g,c){f.log("Connected to "+a+":"+b+" via "+g,"protocol_messages");a={device:{host:a,port:b,protocol:g,deviceScope:c}};this.ctx.getDeviceServer().broadCastMessage(q.EVENTS.ON_DEVICE_CONNECTED,
a)},onHandle:function(a,b){this.showDebugMsg("protocol_messages")}})})}}});define("nxappmain/serverbuild",[],1);
//# sourceMappingURL=serverbuild.js.map